// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/InfoSummary/js/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/event dojo/_base/lang dojo/_base/html dojo/_base/Color dojo/DeferredList esri/layers/GraphicsLayer esri/graphic esri/geometry/Extent esri/geometry/Point esri/symbols/PictureMarkerSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/renderers/SimpleRenderer esri/request esri/tasks/query esri/tasks/QueryTask esri/symbols/jsonUtils".split(" "),function(w,t,u,r,
c,b,f,d,g,h,k,p,n,q,C,D,z,A,y){return w("ClusterLayer",[d],{constructor:function(a){this.clusterGraphics=null;this.cancelRequest=!1;this.clusterSize=120;this._singles=[];this.initalLoad=this._showSingles=!0;this.updateFeatures=[];this._parentLayer=a.parentLayer;this.name=a.name;this._map=a.map;this.color=b.fromString(a.color||"#ff0000");this.symbolData=a.lyrInfo.symbolData;this.itemId=a.lyrInfo.itemId;this.refresh=a.lyrInfo.refresh;this.node=a.node;this._features=a.features;this.id=a.id;this.infoTemplate=
a.infoTemplate;this.url=a.lyrInfo.url;this._testRenderer=a.lyrInfo.renderer;a.originOperLayer&&this._getInfoTemplate(a.originOperLayer);this._setupSymbols();this._setFieldNames();this._initFeatures()},_initFeatures:function(){"undefined"===typeof this._features?"undefined"!==typeof this.url?this.loadData(this.url):this.loaded="error":this.loaded=!0;"error"!==this.loaded&&(this.extentChangeSignal=this._map.on("extent-change",r.hitch(this,this.handleMapExtentChange)),this.clickSignal=this.on("click",
r.hitch(this,this.handleClick)))},_getInfoTemplate:function(a){if(a&&a.parentLayerInfo&&a.parentLayerInfo.controlPopupInfo&&(a=a.parentLayerInfo.controlPopupInfo.infoTemplates)&&this.url){var b=this.url.split("/").pop();b&&(a.indexOf?-1<a.indexOf(b)&&(this.infoTemplate=a[b].infoTemplate):a.hasOwnProperty(b)&&(this.infoTemplate=a[b].infoTemplate))}},_setFieldNames:function(){this._fieldNames=[];if(this.infoTemplate&&"undefined"!==typeof this.infoTemplate.info)for(var a=this.infoTemplate.info.fieldInfos,
b=0;b<a.length;b++)a[b].visible&&this._fieldNames.push(a[b].fieldName);1>this._fieldNames.length&&(this._fieldNames=["*"])},clearSingles:function(a){t.forEach(a||this._singles,function(a){this.remove(a)},this);this._singles.length=0},_getSingleGraphic:function(a){a=new g(new k(a.geometry.x,a.geometry.y,this._map.spatialReference),null,a.attributes);a.setSymbol(this._singleSym);return a},_addSingles:function(a){t.forEach(a,function(a){a=this._getSingleGraphic(a);this._singles.push(a);this._showSingles&&
this.add(a)},this);this._map.infoWindow.setFeatures(this._singles)},initalCount:function(a){var b=new z;b.returnGeometry=!1;b.geometry=this._map.extent;(new A(a)).executeForIds(b).then(r.hitch(this,function(a){this.node&&(this.node.innerHTML=a?a.length.toLocaleString():0,c.setStyle(this.node.parentNode.childNodes[1],"right",this.node.clientWidth+"px"),a=70-this.node.parentNode.childNodes[1].childNodes[0].clientHeight,2<a?c.setStyle(this.node.parentNode.childNodes[1],"top",a/2+"px"):c.setStyle(this.node.parentNode.childNodes[1],
"top","2px"))}))},loadData:function(a){if(0<a.length){this.initalCount(a);var b=new z;b.where="1\x3d1";b.returnGeometry=!1;this.queryPending=!0;(new A(a)).executeForIds(b).then(r.hitch(this,function(b){if(b){this.queryIDs=b;b=[];var c,B;c=0;for(B=this.queryIDs.length;c<B;c+=1E3){var m=this.queryIDs.slice(c,c+1E3);b.push(D({url:a+"/query",content:{f:"json",outFields:this._fieldNames.join(),objectids:m.join(),returnGeometry:"true",outSR:this._map.spatialReference.wkid}}))}this._features=[];this.cancelRequest?
console.log("Cancelled ClusterLayer 1"):(new f(b)).then(r.hitch(this,function(a){this.queryPending=!1;if(this.cancelRequest)console.log("Cancelled ClusterLayer 2");else if(a){for(var b=this._map.spatialReference,l=[],x=0;x<a.length;x++)for(var e=0;e<a[x][1].features.length;e++){var v=a[x][1].features[e];if("undefined"!==typeof v.geometry){var c=new k(v.geometry.x,v.geometry.y,b),c=new g(c);c.setAttributes(v.attributes);this.infoTemplate&&c.setInfoTemplate(this.infoTemplate);l.push(c)}}a=!0;1E4>l&&
(a=JSON.stringify(this._features)!==JSON.stringify(l));a&&(this._features=l,this.clusterFeatures());this.loaded=!0}}))}}))}},handleClick:function(a){var b=[];if(a.graphic&&(b=a.graphic,b.attributes)){var c=b.attributes;c.Data&&1<c.Data.length?(this.clearSingles(this._singles),b=c.Data,a.stopPropagation(),this._addSingles(b),this._map.infoWindow.setFeatures(c.Data)):this._map.infoWindow.setFeatures([b])}this._map.infoWindow.show(a.mapPoint);u.stop(a)},handleMapExtentChange:function(a){if(a.levelChange)this.clusterFeatures();
else if(a.delta){var b=a.delta;a=Math.abs(b.x);b=Math.abs(b.y);(50<a||50<b)&&this.clusterFeatures()}},refreshFeatures:function(a){if(this.itemId){a=a.featureSet.features;var b=!0;1E4>a.length&&(b=JSON.stringify(this.updateFeatures)!==JSON.stringify(a));if(b){this._features=[];this._parentLayer.clear();var b=this._parentLayer.spatialReference,c;this._parentLayer.renderer?c=this._parentLayer.renderer:this._testRenderer&&(c=this._testRenderer);for(var f=0;f<a.length;f++){var d=a[f];if(d.geometry){this._features.push({attributes:d.attributes,
geometry:new k(d.geometry.x,d.geometry.y,b)});var m=new g(this.getGraphicOptions(d,b,c));m.setAttributes(d.attributes);this._infoTemplate&&m.setInfoTemplate(this._infoTemplate);m.setSymbol(c.getSymbol(m));this._parentLayer.add(m)}else console.log("Null geometry skipped")}this.clusterFeatures()}this.updateFeatures=a}else this.url&&this.loadData(this.url)},getGraphicOptions:function(a,b,c){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:
"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new k(a.geometry.x,a.geometry.y,a.geometry.spatialReference),symbol:c.symbol}},flashFeatures:function(){this.flashGraphics(this.graphics)},flashSingle:function(a){if("undefined"===typeof a.symbol){var c=new q(q.STYLE_NULL,new b(0,0,0,0),0),g=this.color.toRgb();a.setSymbol(new n(n.STYLE_CIRCLE,9,c,new b([g[0],g[1],g[2],0.5])))}this.flashGraphics([a])},flashGraphics:function(a){var c=new q(q.STYLE_SOLID,
this.color,7),g=new q(q.STYLE_SOLID,this.color,3),k=new q(q.STYLE_NULL,new b(0,0,0,0),0),f=0;clearInterval(this.s);this.s=setInterval(r.hitch(this,function(){for(var b=0;b<a.length;b++){var d=a[b],h;if(f%2){if(h=d.symbol)"function"===typeof h.setOutline&&h.setOutline(c),d.setSymbol(h)}else if(h=d.symbol)"function"===typeof h.setOutline&&h.setOutline(g),d.setSymbol(h)}this.redraw();f+=1;if(5===f){clearInterval(this.s);for(b=0;b<a.length;b++)d=a[b],h=d.symbol,"undefined"!==typeof h&&("function"===typeof h.setOutline&&
h.setOutline(k),d.setSymbol(h));this.redraw();this.clusterFeatures()}}),600)},setColor:function(a){this.color=a},cancelPendingRequests:function(){console.log("Cancel Query...");this.queryPending&&(this.cancelRequest=!0);this.removeEventListeners()},removeEventListeners:function(){this.extentChangeSignal&&(this.extentChangeSignal.remove(),this.extentChangeSignal=null);this.clickSignal&&(this.clickSignal.remove(),this.clickSignal=null)},clusterFeatures:function(){this.clear();this._map.infoWindow.isShowing&&
this._map.infoWindow.hide();var a=this._features,b=0;if("undefined"!==typeof a){if(0<a.length){var c=this.clusterSize;this.clusterGraphics=[];for(var d=this._map.spatialReference,f=this._map.extent,m=new k(f.xmin,f.ymax,d),n=Math.ceil(this._map.height/c),p=Math.ceil(this._map.width/c),l=f.getWidth()/this._map.width*c,c=f.getHeight()/this._map.height*c,f=0;f<n;f++)for(var x=0;x<p;x++){var e=m.x+l*x,v=m.y-c*f,v=new h(e,v-c,e+l,v,d),e=[],F;for(F in a){var s=a[F];v.contains(s.geometry)&&(b+=1,e.push(s))}0<
e.length&&(v=this.getClusterCenter(e),this.clusterGraphics.push({center:v,graphics:e}))}for(var q in this.clusterGraphics)a=this.clusterGraphics[q],d=a.graphics.length,m=a.graphics,n=19*d.toString().length,this._setSymbols(n+5,n+1),m={Count:d,Data:m},1<d?"undefined"!==typeof this.symbolData?"CustomSymbol"!==this.symbolData.symbolType?(this.add(new g(a.center,this.csym,m)),this.add(new g(a.center,this.csym3,m))):(this.add(new g(a.center,this.csym,m)),this.add(new g(a.center,this.psym,m))):(this.add(new g(a.center,
this.csym,m)),this.add(new g(a.center,this.psym,m))):(a=a.graphics[0].geometry,this.renderer&&(this.renderer.hasOwnProperty("getSymbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new g(a,null,m.Data[0].attributes),d=this.renderer.getSymbol(a),a.setInfoTemplate(this.infoTemplate),a.setSymbol(d),this.add(a)):this.renderer.hasOwnProperty("symbol")&&"LayerSymbol"===this.symbolData.symbolType?(a=new g(a,null,m.Data[0].attributes),a.setInfoTemplate(this.infoTemplate),a.setSymbol(y.fromJson(this.renderer.symbol)),
this.add(a)):"EsriSymbol"===this.symbolData.symbolType?this.add(new g(a,y.fromJson(this.symbolData.symbol),m)):"LayerSymbol"!==this.symbolData.symbolType?this.add(new g(a,this.psym,m)):(a=this.renderer.symbol?new g(a,this.renderer.symbol,m):new g(a,this.psym,m),a.setInfoTemplate(this.infoTemplate),this.add(a))))}this._updateNode(b)}},_updateNode:function(a){this.node&&(this.node.innerHTML=a.toLocaleString(),a=this.node.clientWidth&&0<this.node.clientWidth?this.node.clientWidth:10*a.toLocaleString().length,
c.setStyle(this.node.parentNode.childNodes[1],"right",a+"px"),0===this.node.parentNode.childNodes[1].childNodes[0].clientHeight?(this.initalLoad=!0,a=60):(a=70-this.node.parentNode.childNodes[1].childNodes[0].clientHeight,this.initalLoad=!1),2<a?c.setStyle(this.node.parentNode.childNodes[1],"top",a/2+"px"):c.setStyle(this.node.parentNode.childNodes[1],"top","2px"))},_updatePanelTime:function(a){this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e";var b="";""!==this.config.mainPanelText&&(b=this.config.mainPanelText+
" ");this.pageTitle.innerHTML=b+(new Date(a)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},_setSymbols:function(a,c){var d=this.color.toRgb(),f,g,k;if("undefined"!==typeof this.symbolData){var h;"custom"===this.backgroundClusterSymbol?h=d:(f=y.fromJson(this.backgroundClusterSymbol),0===f.outline.color.a||0===f.outline.width?(g=q.STYLE_NULL,k=0):(g=q.STYLE_SOLID,k=f.outline.width));f?(d=q(g,f.outline.color,k),h=f.color.toRgb(),
this.csym=new n(n.STYLE_CIRCLE,a,d,new b([h[0],h[1],h[2],0.75]))):this.csym=new n(n.STYLE_CIRCLE,a,null,new b([h[0],h[1],h[2],0.75]));d=this.symbolData.s;(d=-1<d.indexOf("${appPath}")?this.symbolData.s.replace("${appPath}",window.location.origin+window.location.pathname):this.symbolData.s?this.symbolData.s:this.icon.imageData)&&"CustomIcon"===this.symbolData.iconType?this.psym=new p(d,a-6,a-6):d&&"LayerIcon"===this.symbolData.iconType?this.psym=y.fromJson(this.symbolData.symbol):(d=q(this.icon.outline.style,
this.icon.outline.color,this.icon.outline.width),this.psym=new n(this.icon.style,this.icon.size,d,this.icon.color));this.csym2=r.clone(this.psym);this.csym3=r.clone(this.csym2);"undefined"!==typeof this.csym2.xoffset&&(this.csym3.xoffset=0);"undefined"!==typeof this.csym2.yoffset&&(this.csym3.yoffset=0)}else f=new q(q.STYLE_NULL,new b(0,0,0,0),0),this.csym=new n(n.STYLE_CIRCLE,a,f,new b([d[0],d[1],d[2],0.5])),this.psym=new p(this.icon.url,a-10,a-10),this.psym2=new p(this.icon.url,c-7,c-7),f=new q(q.STYLE_NULL,
new b(0,0,0,0),0),this.csym2=new n(n.STYLE_CIRCLE,c,f,new b([d[0],d[1],d[2],0.5]))},_setupSymbols:function(){if("undefined"!==typeof this.symbolData){this.backgroundClusterSymbol=this.symbolData.clusterSymbol;this.icon=this.symbolData.icon;"LayerSymbol"===this.symbolData.symbolType?this._parentLayer.renderer?this.renderer=this._parentLayer.renderer:this.symbolData.renderer&&(this.renderer=this._testRenderer):this.renderer=new C(y.fromJson(this.symbolData.symbol));var a=this.color.toRgb(),c=new q(q.STYLE_NULL,
new b(0,0,0,0),0);this._singleSym=new n(n.STYLE_CIRCLE,9,c,new b([a[0],a[1],a[2],0.5]))}},getClusterCenter:function(a){var b=0,c=0,d=a.length;t.forEach(a,function(a){b+=a.geometry.x;c+=a.geometry.y},this);return new k(b/d,c/d,a[0].geometry.spatialReference)},_clear:function(){this.clear();this._features=[]}})})},"widgets/InfoSummary/js/ThemeColorManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/xhr","dojo/dom-style","dojo/_base/Color"],function(w,t,u,r,c){return w(null,
{_theme:null,_styleName:"",_styleColor:null,_options:null,constructor:function(b){this._theme=b.theme;this._styleName=b.stylename;this.getStyleColor(this._styleName);this._options=b},setStyle:function(b){this._styleName=b;this.getStyleColor(this._styleName)},getStyleColor:function(b){var c=b?b:this._theme.styles[0];u.get({url:"././themes/"+this._theme.name+"/manifest.json",handleAs:"json",load:t.hitch(this,function(b){b=b.styles;for(var g=0;g<b.length;g++){var h=b[g];if(h.name===c){this._styleColor=
h.styleColor;this.updateUI(this._styleColor);break}}})})},updateUI:function(b){if(b){for(var c=this._options.updateNodes,d=0;d<c.length;d++)r.set(c[d].node,c[d].styleProp,b);this.updateClusterLayerColors(this._options.layerList)}},updateClusterLayerColors:function(b){var f=c.fromHex(this._styleColor),d=30,g;for(g in b){var h=b[g];if("ClusterLayer"===h.type&&h.layerObject.symbolData&&h.layerObject.symbolData.clusteringEnabled&&"ThemeCluster"===h.layerObject.symbolData.clusterType){var k=f.g,p=f.b,
n=f.r-d;255<n?n-=255:0>n&&(n+=255);p-=d;255<p?p-=255:0>p&&(p+=255);k-=d;255<k?k-=255:0>k&&(k+=255);d+=d;h.layerObject.setColor(c.fromArray([n,k,p,1]));h.layerObject.clusterFeatures()}}}})})},"widgets/InfoSummary/js/LayerVisibilityManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","jimu/LayerInfos/LayerInfos"],function(w,t,u,r){return w(null,{_layerList:{},_map:null,_initalLayerVisibility:{},_opLayers:null,_parent:null,constructor:function(c){this._map=c.map;this._layerList=
c.configLayerList;this._parent=c.parent;this.setOpLayers(this._map);this.storeInitalVisibility();this.setInitalVisibility()},setOpLayers:function(c){c.itemId&&r.getInstance(c,c.itemInfo).then(t.hitch(this,function(b){this._opLayers=b}))},setInitalVisibility:function(){for(var c in this._layerList){var b=this._layerList[c];"ClusterLayer"===b.type&&(b.layerObject.setVisibility&&b.layerObject.setVisibility(!0),b.layerObject.visible=!0,b.layerObject._parentLayer&&(b.layerObject._parentLayer.setVisibility&&
b.layerObject._parentLayer.setVisibility(!1),b.layerObject._parentLayer.hasOwnProperty("visibility")&&(b.layerObject._parentLayer.visibility=!1)));var f;b.layerObject.layerInfos?f=b.layerObject:b.li&&"undefined"!==typeof b.li.parentLayerID&&(f=this._map.getLayer(b.li.parentLayerID));if(f&&f.visibleLayers){var d=t.clone(f.visibleLayers);f.layerInfos&&(0<f.layerInfos.length&&b.li&&("undefined"!==typeof b.li.subLayerId&&-1===d.indexOf(b.li.subLayerId)?"ClusterLayer"!==b.type&&d.push(b.li.subLayerId):
-1<d.indexOf(b.li.subLayerId)&&"ClusterLayer"===b.type&&d.splice(d.indexOf(b.li.subLayerId),1)),d&&f.setVisibleLayers(d),f.setVisibility&&f.setVisibility(!0),f.hasOwnProperty("visible")&&(f.visible=!0))}}},storeInitalVisibility:function(){this._initalLayerVisibility={};u.forEach(this._opLayers._operLayers,t.hitch(this,function(c){if("ArcGISFeatureLayer"===c.layerType||"ArcGISMapServiceLayer"===c.layerType||"undefined"===typeof c.layerType)if(c.layerObject&&this.shouldCheck(c))this._initalLayerVisibility[c.id]=
{type:c.layerType,layerObject:c.layerObject,visible:c.layerObject.visible,visibleSubLayers:t.clone(c.layerObject.visibleLayers)};else if(c.featureCollection)for(var b=0;b<c.featureCollection.layers.length;b++){var f=c.featureCollection.layers[b];this.shouldCheck(f)&&(this._initalLayerVisibility[f.id]={type:f.layerType,layerObject:f.layerObject,visible:"undefined"!==typeof f.layerObject.visible?f.layerObject.visible:f.visibility,pl:c})}else c.layers&&(this._initalLayerVisibility[c.id]={type:c.layerType,
layerObject:c.layerObject,visible:c.layerObject.visible,visibleSubLayers:t.clone(c.layerObject.visibleLayers)})}))},shouldCheck:function(c){return this._layerList?!(c.id in this._layerList):!0},setLayerVisibility:function(c,b){var f=[];if(c)for(var d in c){var g=c[d];if(-1===f.indexOf(g.id))if(g.visibleSubLayers)g.layerObject.setVisibleLayers(g.visibleSubLayers);else if("undefined"===typeof g.pl)g.layerObject.setVisibility(b?!1:g.visible);else{var h=t.clone(g.layerObject.visibleLayers);if(g.layerObject.layerInfos){if(0<
g.layerObject.layerInfos.length)for(var k in c){var p=c[k];p.li&&p.li.subLayerId&&-1===h.indexOf(p.li.subLayerId)&&h.push(p.li.subLayerId)}b?(h=this._initalLayerVisibility[g.layerObject.id],h.visibleSubLayers&&(g.layerObject.setVisibleLayers(h.visibleSubLayers),g.layerObject.setVisibility&&g.layerObject.setVisibility(!0))):(h&&g.layerObject.setVisibleLayers(h),g.layerObject.setVisibility&&g.layerObject.setVisibility(!0))}else g.layerObject.setVisibility&&g.layerObject.setVisibility(b?!1:g.visible),
g.pl.hasOwnProperty("visibility")&&(g.pl.visibility=b?!1:g.visible)}}},resetLayerVisibility:function(){this.setLayerVisibility(this._initalLayerVisibility,!1);this._initalLayerVisibility={};var c={},b;for(b in this._layerList)"ClusterLayer"===this._layerList[b].type&&(c[b]=this._layerList[b],this._layerList[b].pl&&(this._layerList[b].pl.setVisibility&&this._layerList[b].pl.setVisibility(!0),this._layerList[b].pl.hasOwnProperty("visibility")&&(this._layerList[b].pl.visibility=!0)));0<Object.keys(c).length&&
this.setLayerVisibility(c,!0);this._layerList={}}})})},"widgets/InfoSummary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:widgets/InfoSummary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv id\x3d"panelMain" class\x3d"panelContent" data-dojo-attach-point\x3d"panelMain"\x3e\r\n    \x3cdiv class\x3d"page"\x3e\r\n      \x3cdiv class\x3d"pageContent rounded" data-dojo-attach-point\x3d"pageContent"\x3e\r\n        \x3cdiv class\x3d"pageHeader roundedTop" data-dojo-attach-point\x3d"pageHeader" id\x3d"pageHeader"\x3e\r\n          \x3cdiv class\x3d"pageLabel" data-dojo-attach-point\x3d"pageLabel"\x3e\x3c/div\x3e\r\n          \x3cdiv class\x3d"pageCounter"\x3e\r\n            \x3cdiv data-dojo-attach-point\x3d"panelMainIcon" /\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"pageTitle" data-dojo-attach-point\x3d"pageTitle"\x3e\x3c/div\x3e\r\n        \x3cdiv id\x3d"pageCloseMain" class\x3d"pageClose" data-dojo-attach-point\x3d"pageCloseMain" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"pageBody" data-dojo-attach-point\x3d"pageBody"\x3e\r\n        \x3cdiv id\x3d"pageMain" class\x3d"resultsContent" data-dojo-attach-point\x3d"pageMain"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/InfoSummary/css/style.css":".jimu-widget-InfoSummary{width: 360px; height: 100%;}.jimu-widget-InfoSummary .legendLayer{font-size: 12px;}.jimu-widget-InfoSummary .legendOff{visibility:visible; height:1px; border-bottom: 1px solid #dcdcdc; overflow:hidden;}.jimu-widget-InfoSummary .legendOn{display:block; width:100%; visibility:visible; height:auto;}.jimu-widget-InfoSummary .clusterSymbol{margin: 4px 4px 4px 4px; display:block; width:35px; visibility:visible; height:35px; float:left; -moz-border-radius: 30px; -webkit-border-radius: 30px; border-radius: 30px; opacity:0.60; filter:alpha(opacity\x3d30); z-index:3;}.jimu-widget-InfoSummary .clusterSymbol2{display:block; width:100%; visibility:visible; height:auto; float:left; border-bottom: 1px solid #dcdcdc; z-index:3;}.jimu-widget-InfoSummary .recImg2 {padding-top: 4px; position: absolute; left: 4px; top: 5px; width: 48px; height: 48px;}.jimu-widget-InfoSummary .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-InfoSummary .roundedTop {-moz-border-radius: 5px 5px 0 0; -webkit-border-radius: 5px 5px 0 0; border-radius: 5px 5px 0 0;}.jimu-widget-InfoSummary .panelMain {display: block;}.jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; top: 0px; width: 360px; height: 100%;}.jimu-widget-InfoSummary .page {position: relative; width: 360px; margin-left: 0; height: 100%; display: block; background-color: rgba(0,0,0,0.1);}.jimu-widget-InfoSummary .pageContent {position:absolute; left: 10px; right: 10px; top: 5px; bottom: 5px; overflow: hidden; display: block; background-color: rgba(255,255,255,1);}.jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 280px; text-align: center; display: block;}.jimu-widget-InfoSummary .pageTitle {position: absolute; left: 0px; bottom: 10px; width : 100%; height: auto; font-size: 12px; color: #ffffff; text-align: center;}.jimu-widget-InfoSummary .pageCounter {position: absolute; top: 40px; width: auto; height: auto; bottom:25px; left: 15px; right:15px;}.jimu-widget-InfoSummary .pageClose {position: absolute; right: 10px; top: 10px; background: url(../images/btn4.png) no-repeat; cursor: pointer; width: 20px; height: 20px; display: block;}.jimu-widget-InfoSummary .pageBody {position: absolute; top: 280px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y: auto;}.jimu-widget-InfoSummary .resultsContent {width: 100%; min-height: 100%; overflow-x: hidden; overflow-y: visible;}.jimu-widget-InfoSummary .rec {position: relative; width: 100%; height: 70px; display: block; border-bottom: 1px solid #dcdcdc; text-align: center; line-height: 70px; color: #6e6e6e; overflow:hidden; cursor:pointer;}.jimu-widget-InfoSummary .recIcon {position: absolute; left: 10px; top: 10px; width: 50px; height: 50px; border: 3px solid rgba(0,0,0,1); -moz-border-radius: 41px; -webkit-border-radius: 41px; border-radius: 41px; opacity:0.3; filter:alpha(opacity\x3d30); cursor: pointer;}.jimu-widget-InfoSummary .thumb2{width:43px; height:43px; align-content:center; vertical-align:super; z-index:1;}.jimu-widget-InfoSummary .active {opacity:0.8; filter:alpha(opacity\x3d80); background-color: rgba(0,0,0,0.25);}.jimu-widget-InfoSummary .recLabel {position: absolute; left: 60px; height: 100%; display: block; line-height: 50px; font-size: 16px; font-family: sans-serif; font-weight: 500; text-align: center; vertical-align: central; color: #000000; margin-left: 20px; margin-right: 20px; text-overflow: ellipsis;}.jimu-widget-InfoSummary .recNum {position: absolute; right: 0px; max-width: 120px; min-width: 30px; height: 100%; line-height: 70px; color: #000000; text-align: center; font-size: 28px; font-family: Steelfish; overflow: hidden; margin-right: 10px;}.jimu-widget-InfoSummary .innerMainPanelIcon {max-width: 320px; max-height: 200px; vertical-align: middle;}.jimu-widget-InfoSummary .innerSVGPosition {width: 100%; height: 100%; vertical-align: middle;}.jimu-widget-InfoSummary .innerCirclePosition {position: relative; top: 8px; left: 8px;}.jimu-widget-InfoSummary .pageBodyNoIcon {position: absolute; top: 30px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;} .jimu-widget-InfoSummary .pageHeaderNoIcon {position: relative; width: 100%; height: 30px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageLabel {padding-top: 10px; padding-left: 20px; float: left; color: whitesmoke; font-size: 16px;} @media only screen and (max-width: 750px) {.jimu-widget-InfoSummary .pageContent {} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 30px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 10px; right: 30px; width: auto; height: auto; font-size: 12px; color: #ffffff; overflow: hidden; text-align: left;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; font-family: Steelfish; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px;} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 30px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}}@media only screen and (max-width: 470px) {.jimu-widget-InfoSummary{width: 100% !important; height: 50%;} .jimu-widget-InfoSummary .panelContent {position: absolute; right: 0px; bottom: 0px; width: 100%;} .jimu-widget-InfoSummary .page {position: relative; width: 100%; height: 100%; display: block; background-color: rgba(0,0,0,0.15);} .jimu-widget-InfoSummary .pageHeader {position: relative; width: 100%; height: 30px; text-align: center; display: block;} .jimu-widget-InfoSummary .pageTitle {position: absolute; left: 10px; right: 30px; width: auto; height: auto; font-size: 12px; color: #ffffff; overflow: hidden; text-align: left;} .jimu-widget-InfoSummary .pageCounter {display: none; position: absolute; left: 5px; margin-left: 0px; top: 5px; width: 70px; font-size: 40px; height: 70px; line-height: 70px; font-family: Steelfish; border: 5px solid rgba(0,0,0,1); -moz-border-radius: 40px; -webkit-border-radius: 40px; border-radius: 40px; opacity:0.3; filter:alpha(opacity\x3d30);} .jimu-widget-InfoSummary .pageBody {position: absolute; top: 30px; bottom: 0px; width: 100%; display: block; color: #000000; font-size: 10px; text-align: center; padding: 0px; overflow-x: hidden; overflow-y:auto;}} ",
"url:widgets/InfoSummary/config.json":'{\r\n    "mainPanelIcon": "",\r\n    "layerInfos": []\r\n}',"*now":function(w){w(['dojo/i18n!*preload*widgets/InfoSummary/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("jimu/BaseWidget jimu/LayerInfos/LayerInfos jimu/utils dojo/dom dojo/dom-class dojo/dom-construct dojo/on dojo/dom-style dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/promise/all dojo/_base/array dojo/query dijit/_WidgetsInTemplateMixin esri/graphic esri/geometry/Point esri/tasks/query esri/tasks/QueryTask esri/tasks/FeatureSet esri/arcgis/utils esri/symbols/jsonUtils esri/renderers/SimpleRenderer ./js/ClusterLayer ./js/ThemeColorManager ./js/LayerVisibilityManager esri/layers/LayerDrawingOptions".split(" "),function(w,
t,u,r,c,b,f,d,g,h,k,p,n,q,C,D,z,A,y,a,B,G,H,I,m,J,E){return g([w,C],{baseClass:"jimu-widget-InfoSummary",name:"InfoSummary",opLayers:null,opLayerInfos:null,layerList:{},UNIQUE_APPEND_VAL_CL:"_CL",widgetChange:!1,layerVisibilityManager:null,refreshInterval:0,refreshIntervalValue:0,configLayerInfos:[],queryLookupList:[],legendNodes:[],currentQueryList:[],postCreate:function(){this.inherited(arguments);this.configLayerInfos=this.config.layerInfos;this.queryLookupList=[];this.layerList={};this._initWidget()},
startup:function(){this.inherited(arguments);this.mapExtentChangedHandler=this.map.on("extent-change",h.hitch(this,this._mapExtentChange));this._mapExtentChange()},onOpen:function(){this.widgetChange=!1;this._updatePanelHeader();"undefined"===typeof this.mapExtentChangedHandler&&(this.mapExtentChangedHandler=this.map.on("extent-change",h.hitch(this,this._mapExtentChange)),this._mapExtentChange());this.layerVisibilityManager=new J({map:this.map,configLayerList:this.layerList,parent:this});this.config.refreshEnabled&&
this.enableRefresh();this.map.infoWindow.highlight=!0;for(var l in this.layerList){var a=this.layerList[l];if(a.li&&a.li.orgRenderer){if(a.layerObject.setRenderer)a.layerObject.setRenderer(a.li.newRenderer);else if(a.layerObject.setLayerDrawingOptions){var e=[],b=new E;b.renderer=a.li.newRenderer;e[a.li.subLayerId]=b;a.layerObject.setLayerDrawingOptions(e)}else console.log("Error setting the new renderer...will use the default rendering of the layer");a.layerObject.refresh()}a.layerObject&&"undefined"!==
typeof a.layerObject.visible&&(a.layerObject.visible?c.contains("recIcon_"+l,"active")||c.add("recIcon_"+l,"active"):c.contains("recIcon_"+l,"active")&&c.remove("recIcon_"+l,"active"))}},enableRefresh:function(){var l=null,a=!1,e;for(e in this.layerList){l=this.layerList[e];if("ClusterLayer"!==l.type)!a&&l.li&&l.li.itemId&&(B.getItem(l.li.itemId).then(h.hitch(this,this._updateItem)),a=!0),l=l.layerObject;else for(var b=0;b<this.opLayers.length;b++){var c=this.opLayers[b];if(c.layerObject){l=c.layerObject;
break}}l&&(l.refreshInterval=this.config.refreshInterval)}l=6E4*this.config.refreshInterval;0===this.refreshInterval&&0===this.refreshIntervalValue?(this.refreshIntervalValue=l,this.refreshInterval=setInterval(h.hitch(this,this.refreshLayers),this.refreshIntervalValue)):0!==this.refreshIntervalValue&&this.refreshIntervalValue!==l&&(this.refreshIntervalValue=l,clearInterval(this.refreshInterval),this.refreshInterval=0,this.refreshInterval=setInterval(h.hitch(this,this.refreshLayers),this.refreshIntervalValue))},
_updatePanelTime:function(l){this.pageTitle.innerHTML="\x3cdiv\x3e\x3c/div\x3e";var a="";""!==this.config.mainPanelText&&(a=this.config.mainPanelText+" ");this.pageTitle.innerHTML=a+(new Date(l)).toLocaleDateString(navigator.language,{month:"2-digit",day:"2-digit",year:"numeric",hour:"numeric",minute:"2-digit",hour12:!0})},refreshLayers:function(){for(var l in this.layerList){var a=this.layerList[l],e;a.li&&a.li.itemId?e=a.li.itemId:a.layerObject.itemId&&(e=a.layerObject.itemId);e&&-1===this.currentQueryList.indexOf(e)&&
(this.currentQueryList.push(e),B.getItem(e).then(h.hitch(this,this._updateItem)))}},_updateItem:function(a){this._updatePanelTime(a.item.modified);for(var b=a.itemData,e=0;e<b.layers.length;e++)this._updateLayerItem(b.layers[e]);this.currentQueryList.splice(this.currentQueryList.indexOf(a.item.id),1)},_updateLayerItem:function(a){var b,e,c;for(c in this.layerList)if(this.layerList[c].pl){if(this.layerList[c].pl.layerDefinition.name===a.layerDefinition.name){b=this.layerList[c];e=b.pl;break}}else if(this.layerList[c].layerObject._parentLayer&&
this.layerList[c].layerObject._parentLayer.name===a.layerDefinition.name){this.layerList[c].layerObject.refreshFeatures(a);break}if(a&&e){a=a.featureSet.features;c=e.featureSet.features;var d=!0;1E4>a.length&&(d=JSON.stringify(c)!==JSON.stringify(a));if(d){e.layerObject.clear();c=b.layerObject.spatialReference;for(d=0;d<a.length;d++){var f=a[d];if(f.geometry){var g=this.getGraphicOptions(f,c,b.layerObject.renderer),h=new D(g);h.setSymbol(g.symbol);h.setAttributes(f.attributes);this._infoTemplate&&
h.setInfoTemplate(this._infoTemplate);e.layerObject.add(h)}else console.log("Null geometry skipped")}b.layerObject.refresh();e.layerObject.refresh();e.featureSet.features=a;this.countFeatures(b.layerObject,b.node)}}},getGraphicOptions:function(a,b,e){return"undefined"!==typeof a.geometry.rings?{geometry:{rings:a.geometry.rings,spatialReference:{wkid:b.wkid}}}:"undefined"!==typeof a.geometry.paths?{geometry:{paths:a.geometry.paths,spatialReference:{wkid:b.wkid}}}:{geometry:new z(a.geometry.x,a.geometry.y,
a.geometry.spatialReference),symbol:e.symbol}},_initWidget:function(){this.map.itemId&&t.getInstance(this.map,this.map.itemInfo).then(h.hitch(this,function(a){this.opLayers=a._operLayers;this.opLayerInfos=a._layerInfos;this._createPanelUI(this.configLayerInfos)}))},_updatePanelHeader:function(){this.pageLabel.innerHTML=u.sanitizeHTML(this.label);if(this.config.displayPanelIcon){this.pageHeader&&(k.removeClass(this.pageHeader,"pageHeaderNoIcon"),k.addClass(this.pageHeader,"pageHeader"));this.pageBody&&
(k.removeClass(this.pageBody,"pageBodyNoIcon"),k.addClass(this.pageBody,"pageBody"));var a=this.config.mainPanelText;"undefined"===typeof a&&(a="");this.pageTitle.innerHTML=a;this.panelMainIcon.innerHTML=this.config.mainPanelIcon;d.set(this.pageLabel,"display","block")}else this.pageHeader&&(k.removeClass(this.pageHeader,"pageHeader"),k.addClass(this.pageHeader,"pageHeaderNoIcon")),this.pageBody&&(k.removeClass(this.pageBody,"pageBody"),k.addClass(this.pageBody,"pageBodyNoIcon")),d.set(this.pageLabel,
"display","none")},_createPanelUI:function(a){this.numClusterLayers=0;this._updatePanelHeader();this._updateUI(null);this._clearChildNodes(this.pageMain);this.updateEnd=[];for(var b=0;b<a.length;b++)this._createLayerListItem(a[b]);for(var e in this.layerList)a=this.layerList[e],"ClusterLayer"!==a.type&&this.updateEnd.push(this.own(f(a.layerObject,"update-end",h.hitch(this,this.onUpdateEnd))));this.addMapLayers();this.legendNodes.push({node:this.pageHeader,styleProp:"background-color"});this.themeColorManager=
new m({updateNodes:this.legendNodes,layerList:this.layerList,theme:this.appConfig.theme,stylename:this.styleName})},_createLayerListItem:function(a){for(var b=0;b<this.opLayers.length;b++){var e=this.opLayers[b];if(e.id===a.id||e.id===a.parentLayerID)if("ArcGISMapServiceLayer"===e.layerType){if(e=this._getSubLayerByURL(a.id),"undefined"!==typeof e){this.getLayer(e,a,"Feature Layer");break}}else if("ArcGISFeatureLayer"===e.layerType||"ArcGISStreamLayer"===e.layerType||"undefined"===typeof e.layerType)if(e.layerObject&&
e.id===a.id){this.getLayer(e,a,"Feature Layer");break}else if(e.featureCollection)for(var c=0;c<e.featureCollection.layers.length;c++){var d=e.featureCollection.layers[c];if(d.id===a.id||e.id===a.id){this.getLayer(d,a,"Feature Collection");break}}}},removeMapLayer:function(a){a+=this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(a)&&this.map.removeLayer(this.map.getLayer(a))},addMapLayers:function(){for(var a=Object.keys(this.layerList).reverse(),b=0;b<a.length;b++){var e=this.layerList[a[b]];
e.type&&"ClusterLayer"===e.type&&this.map.addLayer(e.layerObject)}},_getSubLayerByURL:function(a){for(var b=null,e=0;e<this.opLayerInfos.length;e++){var c=this.opLayerInfos[e];if(0<c.newSubLayers.length&&(b=this._recurseOpLayers(c.newSubLayers,a)))break}return b},_recurseOpLayers:function(a,b){for(var e=0;e<a.length;e++){var c=a[e];if(0<c.newSubLayers.length)this._recurseOpLayers(c.newSubLayers,b);else if(c.id===b)return c}},getLayer:function(a,b,e){var c=null,d=null,f=null,g=null;"ArcGISFeatureLayer"===
a.layerType?b.symbolData.clusteringEnabled?(c=this._getClusterLayer(b,a.layerObject,e,b.infoTemplate,a.originOperLayer),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id},this.numClusterLayers+=1):(a.parentLayerInfo&&a.parentLayerInfo.layerObject&&(d=a.parentLayerInfo.layerObject,f=b.id),c=a.layerObject,g=f?f:b.id,this.layerList[g]={type:d?e:c.type,layerObject:d?d:c,visible:!0,pl:a,li:b},this.updateRenderer(g)):"ArcGISStreamLayer"===a.layerType?(c=a.layerObject,this.layerList[c.id]=
{type:"StreamLayer",layerObject:c,visible:!0,id:c.id}):b.symbolData.clusteringEnabled?(c=this._getClusterLayer(b,a.layerObject,e,b.infoTemplate,a.originOperLayer),this.layerList[c.id]={type:"ClusterLayer",layerObject:c,visible:!0,id:c.id,li:b},this.numClusterLayers+=1):(a.parentLayerInfo&&a.parentLayerInfo.layerObject&&(d=a.parentLayerInfo.layerObject,f=d.visibleLayers?a.id:d.id),c=a.layerObject,g=f?f:a.id,this.layerList[g]={type:d?e:c.type,layerObject:d?d:c,visible:!0,pl:a,li:b},this.updateRenderer(g));
d?this._addPanelItem(d,b):c&&this._addPanelItem(c,b)},updateRenderer:function(a){a=this.layerList[a];if("LayerSymbol"!==a.li.symbolData.symbolType){"undefined"===typeof a.li.orgRenderer&&(a.li.orgRenderer=a.layerObject.renderer?a.layerObject.renderer:a.li.renderer);var b=new H(G.fromJson(a.li.symbolData.symbol));a.li.newRenderer=b;if(a.layerObject.setRenderer)a.layerObject.setRenderer(b);else if(a.layerObject.setLayerDrawingOptions){var c=[],d=new E;d.renderer=b;c[a.li.subLayerId]=d;a.layerObject.setLayerDrawingOptions(c)}else console.log("Error setting the new renderer...will use the default rendering of the layer");
a.layerObject.refresh()}},_addPanelItem:function(a,c){a.setVisibility&&a.setVisibility(!0);var e=a.id;a.visibleLayers&&(e=c.id);var d=b.create("div",{"class":"rec"},this.pageMain),g;g="recIcon active";var s=c.symbolData.icon.url;s&&-1<s.indexOf("${appPath}")?s=c.symbolData.icon.url.replace("${appPath}",window.location.origin+window.location.pathname):s&&-1<s.indexOf("data:image")||(s=c.symbolData.icon.imageData&&c.symbolData.icon.imageData.indexOf("data:image")?c.symbolData.icon.imageData:-1<c.symbolData.s.indexOf("data:image")&&
-1===c.symbolData.s.indexOf("\x3csvg")?c.symbolData.s:-1<c.symbolData.s.indexOf("${appPath}")?c.symbolData.s.replace("${appPath}",window.location.origin+window.location.pathname):void 0);g=b.create("div",{"class":g,id:"recIcon_"+e},d);s?(k.setStyle(g,"background-image","url("+s+")"),k.setStyle(g,"background-repeat","no-repeat"),k.setStyle(g,"background-position","center"),k.setStyle(g,"background-size","contain")):g.innerHTML=c.panelImageData;s=b.create("div",{"class":"recLabel",innerHTML:"\x3cp\x3e"+
c.label+"\x3c/p\x3e"},d);k.setStyle(s,"top","40px");d=b.create("div",{"class":"recNum",id:"recNum_"+e,innerHTML:""},d);s=this.layerList[e].type;"ClusterLayer"===s?(a.node=d,this._addClusterLegend(a,c.imageData,c),a.clusterFeatures()):"StreamLayer"===s?(this.layerList[e].node=d,this.countFeatures(a,d)):this.layerList[e].node=d;f(g,"click",h.hitch(this,this._toggleLayer,this.layerList[e]));this.layerList[e].pl&&(this.layerList[e].pl.featureSet||this.countFeatures(this.layerList[e].layerObject,d))},
_addClusterLegend:function(a,c){var e=b.create("div",{"class":"legendLayer legendOff",id:"legend_"+a.id},this.pageMain),e=b.create("div",{"class":"clusterSymbol2",id:"legend_symbol2_"+a.id},e),e=b.create("div",{"class":"clusterSymbol recImg",id:"legend_symbol_"+a.id,innerHTML:c},e);this.legendNodes.push({node:e,styleProp:"background-color"})},_getClusterLayer:function(a,c,e,d,g){var f=null,f=a.id+this.UNIQUE_APPEND_VAL_CL;-1<this.map.graphicsLayerIds.indexOf(f)?(f=this.map.getLayer(f),d=e=!1,JSON.stringify(f.symbolData)!==
JSON.stringify(a.symbolData)&&(f.symbolData=a.symbolData,d=!0),c=b.toDom(a.panelImageData),JSON.stringify(f.icon)!==JSON.stringify(c.src)&&(f.icon=c.src,d=!0),b.destroy(c.id),f.refresh!==a.refresh&&(f.refresh=a.refresh,e=!0),d&&f._setupSymbols(),e?f.refreshFeatures(f.url):d&&f.clusterFeatures()):f=new I({name:a.label+this.UNIQUE_APPEND_VAL_CL,id:f,map:this.map,node:r.byId("recNum_"+f),features:"Feature Collection"===e?this._getSourceFeatures(c):void 0,infoTemplate:"undefined"!==typeof c.infoTemplate?
c.infoTemplate:d,refreshInterval:this.config.refreshInterval,refreshEnabled:this.config.refreshEnabled,parentLayer:c,lyrInfo:a,originOperLayer:g});return f},_getSourceFeatures:function(a){for(var b=[],c=0;c<a.graphics.length;c++){var d=a.graphics[c];d.geometry&&(d.geometry.x?b.push({geometry:new z(d.geometry.x,d.geometry.y,d.geometry.spatialReference),attributes:d.attributes}):b.push(d))}return b},_updateUI:function(a){this.styleName=a;0<Object.keys(this.layerList).length&&(this.themeColorManager=
new m({updateNodes:this.legendNodes,layerList:this.layerList,theme:this.appConfig.theme,stylename:a}))},_toggleLayer:function(a){this.map.infoWindow.hide();var b=a.id?a.id:a.layerObject.id,e=this.layerList[b];e||(e=this.layerList[b]);e||(a.pl&&(b=a.pl.id),e=this.layerList[b]);e&&(a=!1,e.li&&e.li.hasOwnProperty("subLayerId")&&(a="undefined"!==typeof e.li.subLayerId),c.contains("recIcon_"+b,"active")?(c.remove("recIcon_"+b,"active"),a&&"ClusterLayer"!==e.type?(b=e.layerObject.visibleLayers,a=b.indexOf(e.li.subLayerId),
-1<a&&b.splice(a,1),e.layerObject.setVisibleLayers(b),e.layerObject.setVisibility(!0)):e&&(e.layerObject.setVisibility(!1),this.layerList[b].visible=!1,"undefined"!==typeof e.pl&&(e.pl.visibility=!1,-1<this.map.graphicsLayerIds.indexOf(b)&&(e=this.map.getLayer(b),e.setVisibility(!1))))):(c.add("recIcon_"+b,"active"),a&&"ClusterLayer"!==e.type?(b=e.layerObject.visibleLayers,b.push(e.li.subLayerId),e.layerObject.setVisibleLayers(b),e.layerObject.setVisibility(!0)):e&&(e.layerObject.setVisibility(!0),
"ClusterLayer"===e.type&&e.layerObject.flashFeatures(),this.layerList[b].visible=!0,"undefined"!==typeof e.pl&&(e.pl.visibility=!0,-1<this.map.graphicsLayerIds.indexOf(b)&&(e=this.map.getLayer(b),e.setVisibility(!0))))))},_toggleLegend:function(a,b){if("thumb2"!==b.currentTarget.className&&"recIcon"!==b.currentTarget.className){var e=a.layerObject.id;c.contains("legend_"+e,"legendOff")?(c.remove("legend_"+e,"legendOff"),c.add("legend_"+e,"legendOn")):c.contains("legend_"+e,"legendOn")&&(c.remove("legend_"+
e,"legendOn"),c.add("legend_"+e,"legendOff"))}},onAppConfigChanged:function(a,b,c){switch(b){case "themeChange":case "layoutChange":this.destroy();break;case "styleChange":this._updateUI(c);break;case "widgetChange":this.widgetChange=!0;break;case "mapChange":this._clearMap()}},_clearMap:function(){if(this.layerList){for(var a in this.layerList){var b=this.layerList[a];"ClusterLayer"===b.type&&(b.layerObject._clear(),this.map.removeLayer(b.layerObject))}this.layerList={}}},setPosition:function(a,
b){var c;"BoxTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=c={right:"0px",bottom:"0px",top:"0px",height:"auto","z-index":"auto"},c=u.getPositionStyle(this.position),c.position="absolute",b=this.map.id,k.place(this.domNode,b),k.setStyle(this.domNode,c),d.set(this.pageContent,"bottom","60px")):"DartTheme"===this.appConfig.theme.name?(this.inherited(arguments),this.position=c={right:"0px",bottom:"80px",top:"0px",height:"auto","z-index":"auto"},c=u.getPositionStyle(this.position),
c.position="absolute",b=this.map.id,k.place(this.domNode,b),k.setStyle(this.domNode,c)):"LaunchpadTheme"===this.appConfig.theme.name?this.inherited(arguments):(470>=window.innerWidth?(this.position=c={right:"0px",bottom:"0px",height:"none","z-index":"auto",relativeTo:"browser"},c=u.getPositionStyle(this.position),c.position="absolute",k.place(this.domNode,window.jimuConfig.layoutId),r.byId("map").style.bottom=window.innerHeight/2+"px"):(this.position=c={right:"0px",bottom:"0px",height:"none","z-index":"auto"},
c=u.getPositionStyle(this.position),c.position="absolute",k.place(this.domNode,this.map.id)),k.setStyle(this.domNode,c))},_close:function(){this.widgetManager.closeWidget(this.id)},onClose:function(){this.inherited(arguments);this.queryList&&(this.queryList.cancel(),this.queryLookupList=[]);this.layerVisibilityManager&&(this.layerVisibilityManager.resetLayerVisibility(),this.layerVisibilityManager=null);for(var a in this.layerList){var b=this.layerList[a];b.li&&b.li.orgRenderer&&(b.layerObject.setRenderer?
b.layerObject.setRenderer(b.li.orgRenderer):b.layerObject.setLayerDrawingOptions?b.layerObject.setLayerDrawingOptions([]):console.log("Error re-setting the renderer"),b.layerObject.refresh())}0!==this.refreshInterval&&(this.refreshIntervalValue=0,clearInterval(this.refreshInterval),this.refreshInterval=0);this.mapExtentChangedHandler.remove();this.mapExtentChangedHandler=void 0;this._resetMapDiv()},_resetMapDiv:function(){r.byId("map").style.bottom="0px"},_clearChildNodes:function(a){for(;a.hasChildNodes();)a.removeChild(a.lastChild)},
onUpdateEnd:function(a){(a=this.layerList[a.target.id])&&this.countFeatures(a.layerObject,a.node)},_mapExtentChange:function(){var a=[],b=[],c;for(c in this.layerList){var d=this.layerList[c];if(d.li&&d.li.url&&"ClusterLayer"!==d.type&&"undefined"===typeof d.queryCount){var f=d.li.url;if(-1<f.indexOf("MapServer")||-1<f.indexOf("FeatureServer")){this.promises&&(this.promises.cancel("redundant",!1),this.promises=void 0);var g=new A;g.geometry=this.map.extent;g.returnGeometry=!1;f=new y(f);a.push(f.executeForIds(g));
b.push(d.node)}}"ClusterLayer"===d.type&&d.layerObject.initalLoad&&d.layerObject._updateNode(d.layerObject.node.innerHTML);"ClusterLayer"!==d.type&&("undefined"===typeof d.layerObject?console.log("layer object not known"):d.pl&&d.pl.featureSet?this.countFeatures(d.layerObject,d.node):"StreamLayer"===d.type&&this.countFeatures(d.layerObject,d.node))}0<a.length&&(this.promises=p(a).then(function(a){this.promises=void 0;if(a)for(var c=0;c<a.length;c++)if(a[c]){var d=b[c].innerHTML.length===a[c].length.length;
b[c].innerHTML=a[c].length.toLocaleString();if(!d){d=b[c].parentNode.childNodes[1];k.setStyle(d,"right",(30>b[c].clientWidth?15*a[c].length.length:b[c].clientWidth)+"px");var e=70-d.childNodes[0].clientHeight;2<e&&70>e?k.setStyle(d,"top",e/2+"px"):k.setStyle(d,"top","2px")}}else b[c].innerHTML=0}))},countFeatures:function(a,b){var c=new A;c.geometry=this.map.extent;a.queryCount&&a.queryCount(c,h.hitch(this,function(a){if(b){b.innerHTML=a.toLocaleString();var c=b.parentNode.childNodes[1];k.setStyle(c,
"right",(30>b.clientWidth?10*a.length:b.clientWidth)+"px");a=70-c.childNodes[0].clientHeight;2<a&&70>a?k.setStyle(c,"top",a/2+"px"):k.setStyle(c,"top","2px")}}))}})});