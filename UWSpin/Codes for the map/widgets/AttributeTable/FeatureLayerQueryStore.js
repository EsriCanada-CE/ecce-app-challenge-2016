// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/_base/array esri/tasks/query esri/tasks/QueryTask ./FeatureLayerQueryResult".split(" "),function(f,n,k,l,p,m){return f(null,{queryUrl:"",idProperty:"id",data:null,_entityData:null,constructor:function(b){f.safeMixin(this,b);this.data=[];this._entityData=[];this.layer=b.layer;this.objectIds=b.objectIds;this.where=b.where;this.orderByFields=b.orderByFields;this.totalCount=b.totalCount;this.batchCount=b.batchCount||25;this.idProperty=this.layer.objectIdField;
this.spatialFilter=b.spatialFilter;this.layer&&this.layer.url&&(this.queryTask=new p(this.layer.url))},get:function(b){return this.data[b]},getIdentity:function(b){return b[this.idProperty]},query:function(b,g){var d=new l,a=g&&g.start||0,h=this.batchCount,e=null;"function"===typeof b?e=b(this._entityData):"[object Array]"===Object.prototype.toString.call(b)&&(e=b);if(this.objectIds)e=e?e:this.objectIds,d.objectIds=e.length>=a+this.batchCount?e.slice(a,a+h):e.slice(a);else if(e&&0<e.length?d.objectIds=
e.length>=a+this.batchCount?e.slice(a,a+h):e.slice(a):(d.start=a,d.num=h,d.where=this.where,d.geometry=this.spatialFilter,d.spatialRelationship=l.SPATIAL_REL_INTERSECTS),(a=g.sort)&&0<a.length)a=k.map(a,function(a){return a.attribute+" "+(a.descending?"DESC":"ASC")}),d.orderByFields=a;d.returnGeometry=!1;d.outFields=["*"];var f=this.totalCount,a=null,a=!d.where;if(!(d.objectIds&&0<d.objectIds.length)&&a)return new m([]);a=this.queryTask?this.queryTask.execute(d):this.layer.queryFeatures(d);a.total=
a.then(n.hitch(this,function(a){var c=0,b=this.layer.objectIdField;if(this.objectIds){if(!b)for(c=0;c<a.fields.length;c++)if("esriFieldTypeOID"===a.fields[c].type){b=a.fields[c].name;break}for(var e={},c=0;c<a.features.length;c++)e[a.features[c].attributes[b]]=a.features[c];a.features=k.map(d.objectIds,function(a){return e[a]})}for(c=0;c<a.features.length;c++)a.features[c]&&(a.features[c]=a.features[c].attributes,this.data[a.features[c][b]]=a.features[c],this._entityData.push(a.features[c]));a=a.features;
return f}),function(){console.log("FeatureLayerQueryStore queryFeatures failed.");return 0});return new m(a)}})});