// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),function(f,e,g,d,h,k,l,m){return f([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(a){this.portalUrl=a},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=this.userRole=null},loadPrivileges:function(a){a&&this.portalUrl!==a&&(this._clearLoadedInfo(),
this.portalUrl=a);if(this._privilegeLoaded())return a=new g,a.resolve(!0),a;a=d.getPortal(a);return a.haveSignIn()?this._loadUserInfo(a):this._signIn(a)},_signIn:function(a){return a.loadSelfInfo().then(e.hitch(this,function(a){var b=d.getPortal(a.portalHostname);return null===b?!1:b.signIn().then(e.hitch(this,function(a){return this._loadUserInfo(b,a)}))}))},_registerOrgCredential:function(a,c){c=h.getStandardPortalUrl(c);var b=e.clone(a.toJson()),d=c+"/sharing/rest";b.server=d;b.resources=[d];l.id.registerToken(b)},
_loadUserInfo:function(a,c){return a.loadSelfInfo().then(e.hitch(this,function(a){this.userPortalUrl=a.urlKey?a.urlKey+"."+a.customBaseUrl:this.portalUrl;return a&&a.user?(this.userRole=new k({id:a.user.roleId?a.user.roleId:a.user.role,role:a.user.role}),a.user.privileges&&this.userRole.setPrivileges(a.user.privileges),this.portalSelf=a,c&&this._registerOrgCredential(c,this.userPortalUrl),this.portalAnalysis=new m(this.userRole,this.portalSelf),!0):!1}))},_privilegeLoaded:function(){return null!==
this.portalSelf},getUser:function(){return this._privilegeLoaded()?this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?this.userRole.isAdmin():null},getUserPortal:function(){return this._privilegeLoaded()?this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},canPerformAnalysis:function(){return this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(a){return this.portalAnalysis.hasPrivileges(a)}})});