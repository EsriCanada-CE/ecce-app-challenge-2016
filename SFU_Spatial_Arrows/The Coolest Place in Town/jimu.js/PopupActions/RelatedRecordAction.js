// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dojo/on dojo/topic jimu/WidgetManager jimu/LayerInfos/LayerInfos jimu/PopupActions/PopupAction".split(" "),function(c,b,d,e,f,g,h,k){return c([d],{name:null,map:null,popupUnion:null,attrWidgetState:null,appConfig:null,constructor:function(){this.own(f.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)))},postCreate:function(){this.inherited(arguments);h.getInstance(this.map,this.map.itemInfo).then(b.hitch(this,function(a){this.layerInfos=
a}));this.showRelatedRecordBtn=new k({popupUnion:this.popupUnion,buttonInfo:{label:window.jimuNls.popupManager.showRelatedRecords,baseClass:"relationship",onClick:b.hitch(this,this._onRealtionshipClick)}});this.hide();this._updateAttrWidgetState();this.own(e(this.showRelatedRecordBtn,"selectionChange",b.hitch(this,this._onSelectionChange)))},_updateAttrWidgetState:function(){this.attrWidgetState=this.appConfig.getConfigElementsByName("AttributeTable")[0]},_onRealtionshipClick:function(a){var l=this.layerInfos.getLayerInfoById(a._layer.id),
c=a.attributes[a._layer.objectIdField];this.attrWidgetState&&this.attrWidgetState.visible&&g.getInstance().triggerWidgetOpen(this.attrWidgetState.id).then(b.hitch(this,function(a){a.showRelatedRecordsFromPopup(l,[c])}))},_onSelectionChange:function(a){this.layerInfos&&this.attrWidgetState&&this.attrWidgetState.visible&&a._layer&&a._layer.relationships&&0<a._layer.relationships.length?(a=this.layerInfos.getLayerInfoById(a._layer.id))?a.getRelatedTableInfoArray().then(b.hitch(this,function(a){0<a.length?
this.show():this.hide()})):this.hide():this.hide()},_onAppConfigChanged:function(a){this.appConfig=a;this._updateAttrWidgetState()},show:function(){this.showRelatedRecordBtn.show()},hide:function(){this.showRelatedRecordBtn.hide()},destroy:function(){this.showRelatedRecordBtn.destroy();this.inherited(arguments)}})});