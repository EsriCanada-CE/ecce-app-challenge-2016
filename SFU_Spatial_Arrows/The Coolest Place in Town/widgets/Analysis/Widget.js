// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/JobInfo":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./GPMessage"],function(m,d,p,g,b){m=m(null,{declaredClass:"esri.tasks.JobInfo",constructor:function(c){this.messages=[];d.mixin(this,c);c=this.messages;var g,n=c.length;for(g=0;g<n;g++)c[g]=new b(c[g])},jobId:"",jobStatus:""});d.mixin(m,{STATUS_CANCELLED:"esriJobCancelled",STATUS_CANCELLING:"esriJobCancelling",STATUS_DELETED:"esriJobDeleted",STATUS_DELETING:"esriJobDeleting",STATUS_EXECUTING:"esriJobExecuting",
STATUS_FAILED:"esriJobFailed",STATUS_NEW:"esriJobNew",STATUS_SUBMITTED:"esriJobSubmitted",STATUS_SUCCEEDED:"esriJobSucceeded",STATUS_TIMED_OUT:"esriJobTimedOut",STATUS_WAITING:"esriJobWaiting"});return m})},"esri/tasks/GPMessage":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){m=m(null,{declaredClass:"esri.tasks.GPMessage",constructor:function(b){d.mixin(this,b)}});d.mixin(m,{TYPE_INFORMATIVE:"esriJobMessageTypeInformative",TYPE_PROCESS_DEFINITION:"esriJobMessageTypeProcessDefinition",
TYPE_PROCESS_START:"esriJobMessageTypeProcessStart",TYPE_PROCESS_STOP:"esriJobMessageTypeProcessStop",TYPE_WARNING:"esriJobMessageTypeWarning",TYPE_ERROR:"esriJobMessageTypeError",TYPE_EMPTY:"esriJobMessageTypeEmpty",TYPE_ABORT:"esriJobMessageTypeAbort"});return m})},"esri/dijit/analysis/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/event dojo/_base/json dojo/dom-attr dojo/has dojo/i18n dojo/io-query dojo/i18n!../../nls/jsapi dojo/json dojo/string dojo/query dojo/date/locale dojo/dom-style dojo/dom-class dojo/dom-construct dojo/Deferred dojo/number dojo/_base/window dojo/when dojo/data/ItemFileWriteStore dijit/registry dijit/Dialog dijit/form/CheckBox ../../kernel ../../lang ../../request ./HelpWindow ../../tasks/query ../../dijit/BrowseItems ../../layers/FeatureLayer ./PluginAnalysisLayers ../../tasks/Geoprocessor ../../dijit/SingleFilter".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a,t,f,G,x,z,I,L,J,H,M,E,K,O){m={};d.mixin(m,{_helpDialog:null,i18n:null,initHelpLinks:function(a,f,c){this._helpDialog||(this._helpDialog=new L);if(a){var h=t.byNode(a),e=h?h.get("helpFileName"):c&&c.helpFileName?c.helpFileName:null,s=h?h.get("isSingleTenant"):c&&c.isSingleTenant?c.isSingleTenant:!1;k("[esriHelpTopic]",a).forEach(function(h,t,k){h&&(A.set(h,"display",!z.isDefined(f)||!0===f?"":"none"),g.connect(h,"onclick",d.hitch(this,function(f){b.stop(f);
this._helpDialog.show(f,{helpId:u.get(h,"esriHelpTopic"),helpFileName:e,analysisGpServer:c&&c.analysisGpServer?c.analysisGpServer:null,helpParentNode:a,isPortal:s})})))},this)}},constructAnalysisFeatColl:function(a){var f={},c;f.featureCollection=a.layerDefinition;for(c in f.featureCollection)f.featureCollection.hasOwnProperty(c)&&"objectIdField"===c&&(f.featureCollection.objectIdFieldName=d.clone(f.featureCollection.objectIdField),delete f.featureCollection.objectIdField);f.featureCollection.features=
a.featureSet.features;return f},constructAnalysisInputLyrObj:function(a){var f={},c,b=a.getMap()||a._map,h;if(a.url&&!a._collection){f={url:a.url};c=this.isHostedService(a.url);h=10.2<=a.version&&a._useStandardizedQueries;a.getDefinitionExpression&&a.getDefinitionExpression()?f.filter=a.getDefinitionExpression():z.isDefined(a.definitionExpression)&&""!==a.definitionExpression&&(f.filter=a.definitionExpression);if(a.useMapTime&&a.timeInfo&&b.timeExtent&&(h||c||10.2<=a.version))h="",a.timeInfo.startTimeField&&
!a.timeInfo.endTimeField?(b.timeExtent.startTime&&(h=a.timeInfo.startTimeField+" \x3e "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.startTime)+"'"),b.timeExtent.endTime&&(b.timeExtent.startTime&&(h+=" AND "),h+=a.timeInfo.startTimeField+" \x3c "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.endTime)+"'")):!a.timeInfo.startTimeField&&a.timeInfo.endTimeField?(b.timeExtent.startTime&&(h=a.timeInfo.endTimeField+" \x3e "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.startTime)+"'"),
b.timeExtent.endTime&&(b.timeExtent.startTime&&(h+=" AND "),h+=a.timeInfo.endTimeField+" \x3c "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.endTime)+"'")):a.timeInfo.startTimeField&&a.timeInfo.endTimeField&&(b.timeExtent.startTime&&(h=a.timeInfo.startTimeField+" \x3e "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.startTime)+"'"),b.timeExtent.endTime&&(b.timeExtent.startTime&&(h+=" AND "),h+=a.timeInfo.endTimeField+" \x3c "+(c?"":"timestamp ")+"'"+this.formatDate(b.timeExtent.endTime)+
"'")),f.filter=f.filter?f.filter+(" AND "+h):h;a.credential&&(f.serviceToken=a.credential.token);-1!==f.url.indexOf("?")&&(a=f.url.substring(f.url.indexOf("?")+1,f.url.length),a=e.queryToObject(a),d.mixin(f,a),f.url=f.url.substring(0,f.url.indexOf("?")))}else if(!a.url||a._collection)try{f=a.toJson()}catch(s){a._json=q.parse(a._json),f=a.toJson()}return f},formatDate:function(a){return v.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+v.format(a,{selector:"time",timePattern:"HH:mm:ss"})},
isHostedService:function(a){if(!a)return!1;var f=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return f&&a},buildReport:function(a,f){var c="";f||(f={},d.mixin(f,r.analysisMsgCodes));p.forEach(a,function(a,b){var s,h,t;"string"===typeof a.message?(s=z.isDefined(f[a.messageCode])?f[a.messageCode]:a.message,c+=a.style.substring(0,a.style.indexOf("\x3c/"))+(!this._isEmptyObject(a.params)?w.substitute(s,a.params):s)+a.style.substring(a.style.indexOf("\x3c/"))):
d.isArray(a.message)&&(t=[],h=d.clone(a.style),p.forEach(a.message,function(c,b){h=h.replace(/<\//,"${"+b+"}");s=z.isDefined(f[a.messageCode+"_"+b])?f[a.messageCode+"_"+b]:c;s=!this._isEmptyObject(a.params)?w.substitute(s,a.params):s;t.push(s+"\x3c/")},this),h=w.substitute(h,t),c+=h)},this);return c},getLayerFeatureCount:function(a,f){var c=new J;c.geometry=f.geometry||"";c.where=f.where||"1\x3d1";c.geometryType=f.geometryType||"esriGeometryEnvelope";return a.queryCount(c)},createPolygonFeatureCollection:function(a){var f;
f={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPolygon"}};f.layerDefinition={currentVersion:10.2,copyrightText:"",defaultVisibility:!0,relationships:[],isDataVersioned:!1,supportsRollbackOnFailureParameter:!0,supportsStatistics:!0,supportsAdvancedQueries:!0,geometryType:"esriGeometryPolygon",minScale:0,maxScale:0,objectIdField:"OBJECTID",templates:[],type:"Feature Layer",displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",
allowGeometryUpdates:!0,htmlPopupType:"",hasM:!1,hasZ:!1,globalIdField:"",supportedQueryFormats:"JSON",hasStaticData:!1,maxRecordCount:-1,indexes:[],types:[],drawingInfo:{renderer:{type:"simple",symbol:{color:[0,0,0,255],outline:{color:[0,0,0,255],width:3,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSNull"},label:"",description:""},transparency:0,labelingInfo:null,fixedSymbols:!0},fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",name:"TITLE",
length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return f},createPointFeatureCollection:function(a){var f;f={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint"}};f.layerDefinition={objectIdField:"OBJECTID",templates:[],type:"Feature Layer",
drawingInfo:{renderer:{field1:"TYPEID",type:"simple",symbol:{height:24,xoffset:0,yoffset:12,width:24,contentType:"image/png",type:"esriPMS",url:"http://static.arcgis.com/images/Symbols/Basic/GreenStickpin.png"},description:"",value:"0",label:"Stickpin"}},displayField:"TITLE",visibilityField:"VISIBLE",name:a,hasAttachments:!1,typeIdField:"TYPEID",capabilities:"Query",types:[],geometryType:"esriGeometryPoint",fields:[{alias:"OBJECTID",name:"OBJECTID",type:"esriFieldTypeOID",editable:!1},{alias:"Title",
name:"TITLE",length:50,type:"esriFieldTypeString",editable:!0},{alias:"Visible",name:"VISIBLE",type:"esriFieldTypeInteger",editable:!0},{alias:"Description",name:"DESCRIPTION",length:1073741822,type:"esriFieldTypeString",editable:!0},{alias:"Type ID",name:"TYPEID",type:"esriFieldTypeInteger",editable:!0}]};return f},createFolderStore:function(f,c){var b=new a({data:{identifier:"id",label:"name",items:[]}});b.newItem({name:c,id:""});p.forEach(f,function(a){b.newItem({name:a.title,id:a.id})});return b},
setupFoldersUI:function(a){a.folderSelect.set("store",a.folderStore);a.folderSelect.set("required",!0);a.folderSelect.set("searchAttr","name");z.isDefined(a.folderId)?a.folderStore.get(a.folderId).then(d.hitch(this,function(f){z.isDefined(f)?a.folderSelect.set("item",f):a.folderStore.get("").then(function(f){a.folderSelect.set("item",f)},this)})):a.folderName?a.folderStore.fetch({query:{name:a.folderName},onComplete:d.hitch(this,function(f){z.isDefined(f)&&0<f.length?a.folderSelect.set("item",f[0]):
a.folderStore.get("").then(function(f){a.folderSelect.set("item",f)},this)})}):a.username?a.folderSelect.set("displayedValue",a.username):a.folderStore.get("").then(function(f){a.folderSelect.set("item",f)},this)},_isEmptyObject:function(a){for(var f in a)if(a.hasOwnProperty(f))return!1;return!0},validateServiceName:function(a,f){var c=/(:|&|<|>|%|#|\?|\\|\"|\/|\+)/.test(a),b=!0,d,s;z.isDefined(f)&&f.textInput&&(s=f.textInput);this.initI18n();0===a.length||0===w.trim(a).length?(d=this.i18n.requiredValue,
b=!1):c?(d=this.i18n.invalidServiceName,b=!1):98<a.length?(d=this.i18n.invalidServiceNameLength,b=!1):170<encodeURIComponent(a).length&&(d=this.i18n.invalidEncodedServiceNameLength,b=!1);s&&!b&&s.set("invalidMessage",d);return b},getStepNumber:function(a){k(".esriAnalysisNumberLabel",a).forEach(function(a,f){var c=this._getNumberLabel(f);u.set(a,"innerHTML",c)},this)},_getNumberLabel:function(a){var f="";this.initI18n();switch(a){case 0:f=this.i18n.oneLabel;break;case 1:f=this.i18n.twoLabel;break;
case 2:f=this.i18n.threeLabel;break;case 3:f=this.i18n.fourLabel;break;case 4:f=this.i18n.fiveLabel;break;case 5:f=this.i18n.sixLabel;break;case 6:f=this.i18n.sevenLabel;break;case 7:f=this.i18n.eightLabel;break;case 8:f=this.i18n.nineLabel}return f},populateAnalysisLayers:function(a,f,c,b){if(a){var d=[],s=a.get(f);a._titleRow&&A.set(a._titleRow,"display","none");a._analysisLabelRow&&A.set(a._analysisLabelRow,"display","table-row");a._selectAnalysisRow&&(A.set(a._selectAnalysisRow,"display","table-row"),
h.add(a._analysisSelect.domNode,"esriTrailingMargin3"),A.set(a._analysisSelect.domNode.parentNode,"padding-bottom","1em"));a.domNode&&this.getStepNumber(a.domNode);z.isDefined(b)&&b.chooseLabel&&d.push({value:-1,label:this.i18n.chooseLabel});if(!z.isDefined(b)||!z.isDefined(b.posIncrement))z.isDefined(b)||(b={}),b.posIncrement=0;p.forEach(a.get(c),function(a,f){f+=b.posIncrement;var c={value:z.isDefined(b)&&b.chooseLabel?f+1:f,label:a.name};s&&a.name===s.name&&(c.selected=!0);d.push(c)},this);a._analysisSelect.addOption(d);
a._analysisSelect.set("required",!0)}},isValidAnalysisLayer:function(a){var f,c,b,d,s,h,t,e="",k=!0;f={isValid:k,validationMessage:e};var l,n,v=0,G=0,r=0;if(!z.isDefined(a)||!z.isDefined(a.toolName))return f;this.initI18n();z.isDefined(this.i18n.cblPointMsg)||(this.i18n.cblPointMsg="You need to have at least one point feature layer to run ${toolName}.",console.log("was empty initialized"));f=a.toolName;c=a.featureLayers;b=a.analysisLayer;d=f.charAt(0).toLowerCase()+f.substring(1);t=this.i18n;a=a.showReadyToUseLayers||
!1;p.forEach(c,function(a){"esriGeometryPoint"===a.geometryType&&(h=!0,v++);if("esriGeometryPoint"===a.geometryType||"esriGeometryMultipoint"===a.geometryType)l=!0;"esriGeometryPolyline"===a.geometryType&&(n=!0,r++);"esriGeometryPolygon"===a.geometryType&&(s=!0,G++)},this);if(-1!==p.indexOf(["CreateDriveTimeAreas","PlanRoutes","ConnectOriginsToDestinations"],f)&&(!h||b&&"esriGeometryPoint"!==b.geometryType))e=w.substitute(this.i18n.selectPointLayer,{toolName:t[d]}),k=!1;else if(("AggregatePoints"===
f||"InterpolatePoints"===f)&&(b&&!("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType)||!l))e=w.substitute(this.i18n.selectPointLayer,{toolName:t[d]}),k=!1;else if("CalculateDensity"===f&&(!l&&!n||b&&!("esriGeometryPoint"===b.geometryType||"esriGeometryMultipoint"===b.geometryType||"esriGeometryPolyline"===b.geometryType)))e=w.substitute(this.i18n.areaFeatureInvalidMsg,{toolName:t[d]}),k=!1;else if("FindHotSpots"===f&&(!l&&!s||b&&!("esriGeometryPoint"===b.geometryType||
"esriGeometryMultipoint"===b.geometryType||"esriGeometryPolygon"===b.geometryType)))e=w.substitute(this.i18n.hotspotsLineFeatureMsg,{toolName:t[d]}),k=!1;else if(("OverlayLayers"===f||"AggregatePoints"===f||"SummarizeWithin"===f||"SummarizeNearby"===f||"FindNearest"===f||"MergeLayers"===f)&&!a&&(0===c.length||1===c.length&&(c[0]===b||!z.isDefined(b))))e=w.substitute(this.i18n.overlayValidationMsg,{toolName:t[d]}),k=!1;else if("ConnectOriginsToDestinations"===f&&!a&&(0===c.length||2>v))e=w.substitute(this.i18n.odPointMsg,
{toolName:t[d]}),k=!1;else if("ChooseBestFacilities"===f&&(0===c.length||0===v))e=w.substitute(this.i18n.cblPointMsg,{toolName:t[d]}),k=!1;else if("AggregatePoints"===f&&!a&&1<c.length)s=p.some(c,function(a){return"esriGeometryPolygon"===a.geometryType}),s||(e=w.substitute(this.i18n.aggregatePolyMsg,{toolName:t[d]}),k=!1);else if("MergeLayers"===f&&!a&&1<c.length)1<v||(1<r||1<G)||(e=this.i18n.mergeValidationMsg,k=!1);else if(("SummarizeWithin"===f||"DissolveBoundaries"===f)&&(b&&"esriGeometryPolygon"!==
b.geometryType||!s))e=w.substitute(this.i18n.selectPolyLayer,{toolName:t[d]}),k=!1;else if("ExtractData"===f)(k=p.some(c,function(a){return-1!==a.capabilities.indexOf("Extract")}))||(e=w.substitute(this.i18n.extractValidationMsg));else if(("ConnectOriginsToDestinations"===f||"ChooseBestFacilities"===f)&&1<c.length)h=p.some(c,function(a){var s=z.isDefined(b)&&b.id===a.id;return"esriGeometryPoint"===a.geometryType&&!s}),h||(e=w.substitute("ChooseBestFacilities"===f?this.i18n.cblPointMsg:this.i18n.odPointMsg,
{toolName:t[d]}),k=!1);return f={isValid:k,validationMessage:e}},initI18n:function(){this.i18n||(this.i18n={},d.mixin(this.i18n,r.common),d.mixin(this.i18n,r.analysisTools),d.mixin(this.i18n,r.analysisMsgCodes),d.mixin(this.i18n,r.browseLayersDlg),d.mixin(this.i18n,r.driveTimes))},addBrowseAnalysisDialog:function(a){var c=[];if(a&&a.widget){this.i18n||this.initI18n();c.push({label:this.i18n.categoryAll,value:"analysis ready"});c.push({label:this.i18n.categoryBoundaries,value:"boundaries OR places"});
c.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryBoundaries,value:"boundaries"});c.push({label:"\x26nbsp;\x26nbsp;\x26nbsp;\x26nbsp;"+this.i18n.subCategoryPlaces,value:"places"});c.push({label:this.i18n.categoryHexBins,value:"hex"});c.push({label:this.i18n.categoryTransportation,value:"transportation"});var b=D.doc.createDocumentFragment(),b=y.create("div",{style:"width:100%;height:100%;"},b),h=y.create("div",{style:"width:100%;height:10%;","class":""},b),t=y.create("div",
{style:"width:100%"},b),s=new H({portalUrl:a.widget.get("portalUrl"),message:"",plugin:"esri/dijit/analysis/PluginAnalysisLayers",sortDescending:!0,sort:"title",self:a.widget.get("portalSelf"),categories:c,categoryType:"tags",selectedCategory:"boundaries OR places",pagingLinks:3,itemsPerPage:6,"class":"esriBrowseAnalysisLayers itemsGallery esriFloatLeading",closePopupPerRow:!1,extent:a.widget.get("map").extent,useExtent:!0,fetchTimeout:600,galleryTemplate:'\x3cdiv style\x3d\'opacity:1;\' class\x3d\'grid-item gallery-view galleryNode\'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3cdiv class\x3d"linksDiv" style\x3d\'display:none;\'\x3e\x3cdiv class\x3d"esriItemLinks"\x3e\x3cdiv class\x3d"esriFloatLeading"\x3e\x3ca style\x3d"text-decoration: none;"\x3e\x3cspan\x3eAdd layer to analysis\x3c/span\x3e\x3cdiv class\x3d"dijitReset dijitInline esriArrows"\x3e\x3c/div\x3e\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item galleryThumbnail' width\x3d'120px' height\x3d'80px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},formatItemTitle:function(a){return'\x3cdiv class\x3d"galleryLabelContainer"\x3e\x3cspan alt\x3d\''+(a.title||a.name||"\x3cNo Title\x3e")+"'\x3e"+(a.title.replace(/_/g," ")||a.name.replace(/_/g," ")||"\x3cNo Title\x3e")+"\x3c/span\x3e\x3c/div\x3e"},style:"width:600px;height:90%;clear:both;"},
t),t=y.toDom('\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"esriFloatTrailing"\x3e');y.place(t,h);var e,h=y.create("tr",null,t),c=y.create("td",null,h);y.create("td",{innerHTML:"\x26nbsp;"},h);h=y.create("td",null,h);e=y.create("tr",null,t);t=y.create("td",{style:"padding-bottom: 0.5em"},e);y.create("td",{style:"padding-bottom: 0.5em",innerHTML:"\x26nbsp;"},e);e=y.create("td",{style:"padding-bottom: 0.5em"},e);y.create("label",{"for":a.widget.id+"_addlayercheck","class":"",innerHTML:this.i18n.addLayer},
h);c=new G({name:"addlayer",id:a.widget.id+"_addlayercheck","class":"",value:!1,checked:!1},y.create("input",{},c));y.create("label",{"for":a.widget.id+"_addextentcheck","class":"",innerHTML:this.i18n.withinMapArea},e);new G({name:"extentcheck",id:a.widget.id+"_addextentcheck","class":"",value:!0,checked:!0,onChange:d.hitch(this,function(a){s.set("useExtent",a)})},y.create("input",{},t));b=new f({title:this.i18n.browseAnalysisTitle,content:b,doLayout:!0,browseItems:s,addlayerCheckBox:c,style:"padding:.75em 0;background-color: #fff;"});
a.widget.own(a.widget.get("map").on("extent-change",d.hitch(a.widget,function(f){console.log("new extent",a.widget.get("map").extent);s.set("extent",a.widget.get("map").extent)})));return b}},addAnalysisReadyLayer:function(a){if(z.isDefined(a)&&z.isDefined(a.item)&&z.isDefined(a.layersSelect)&&z.isDefined(a.layers)&&z.isDefined(a.browseDialog)){a.browseDialog.browseItems._closePopup();a.browseDialog.hide();var f={url:a.item.url&&-1!==window.location.protocol.indexOf("https:")?a.item.url.replace("http:",
"https:")+"/0":a.item.url+"/0",itemId:a.item.id,title:a.item.title,analysisReady:!0},c,b=p.some(a.layers,function(a,s){var b=a.analysisReady&&f.analysisReady&&a.itemId===f.itemId;b&&(c=s);return b}),h,s,t,e=new B,k;b?(a.posIncrement&&(c+=a.posIncrement),a.browseDialog.addlayerCheckBox.get("checked")&&(a.posIncrement||(a.posIncrement=0),k=a.layers[c-a.posIncrement],a.widget.map.getLayer(k.lyr.id)||(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",
d.hitch(this,function(s){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",{layer:s.layer,layerInfo:k.linfo,item:k})})),a.widget.map.addLayer(k.lyr))),a.layersSelect.set("value",c),a.browseDialog.browseItems.clear(),e.resolve()):(e=I({url:f.url,content:{f:"json"}}),e.then(d.hitch(this,function(c){var b=new M(f.url,{outFields:["*"]});d.mixin(f,b);d.mixin(f,c);f.id=f.title+"_"+c.id;f.title=f.title.replace(/_/g," ");f.name=f.title;f.version=f.currentVersion;t=a.layersSelect.getOptions();
h=t.splice(t.length-2,2);a.layersSelect.removeOption(h);s=a.layers.length;a.posIncrement&&(s+=a.posIncrement);h.unshift({value:s,label:f.title,selected:!0});a.layersSelect.addOption(h);a.layersSelect.set("value",s);f.lyr=b;f.linfo=c;a.layers.push(f);b.name=f.name;a.browseDialog.addlayerCheckBox.get("checked")&&(this._addLayerHandle&&this._addLayerHandle.remove(),this._addLayerHandle=a.widget.map.on("layer-add",d.hitch(this,function(s){this._addLayerHandle.remove();a.widget.emit("add-ready-to-use-layer",
{layer:s.layer,layerInfo:c,item:f})})),a.widget.map.addLayer(b));a.browseDialog.browseItems.clear()})));return e.promise}},addReadyToUseLayerOption:function(a,f){a&&a.showReadyToUseLayers&&(f||(f=[]),a.signInPromise.then(d.hitch(this,function(){p.forEach(f,function(f){f.addOption({type:"separator",value:""});f.addOption({value:"browse",label:a.i18n.browseAnalysisTitle})},this);z.isDefined(a._browsedlg)||(a._browsedlg=this.addBrowseAnalysisDialog({widget:a}),a.own(a._browsedlg.browseItems.on("select-change",
d.hitch(a,a._handleBrowseItemsSelect)),a._browsedlg.on("hide",d.hitch(a,function(){a._browsedlg.browseItems._closePopup();p.forEach(f,function(a){"browse"===a.get("value")&&a.reset()})}))))})))},getMaxInputByMode:function(a){var f;if(a&&a.units&&a.type){if("StraightLine"===a.type)"Miles"===a.units?f=1E3:"Yards"===a.units?f=176E4:"Kilometers"===a.units?f=C.format(1609.34,{places:2}):"Meters"===a.units?f=C.format(1609340,{places:2}):"Feet"===a.units&&(f=528E4);else if("DrivingDistance"===a.type||"TruckingDistance"===
a.type||"WalkingDistance"===a.type)"Miles"===a.units?f=300:"Yards"===a.units?f=528E3:"Kilometers"===a.units?f=C.format(482.802,{places:2}):"Meters"===a.units?f=C.format(482802,{places:2}):"Feet"===a.units&&(f=1584E3);else if("DrivingTime"===a.type||"TruckingTime"===a.type||"WalkingTime"===a.type)"Minutes"===a.units?f=300:"Seconds"===a.units?f=18E3:"Hours"===a.units&&(f=5);return f}},updateModeConstraints:function(a){var f;a&&(a.validateWidget&&a.units&&a.type)&&(f=a.validateWidget.get("constraints"),
f.max=this.getMaxInputByMode(a),a.validateWidget.set(f))},getTravelModes:function(a){var f=new B,b,h,t,s;z.isDefined(this.travelModes)&&0<this.travelModes.length?f.resolve(this.travelModes):!a||!a.widget?f.reject(Error("Missing parameter: params.widget required parameter")):a.widget.signInPromise.then(d.hitch(this,function(e){(s=a.widget.get("helperServices"))&&s.routingUtilities?(t=s.routingUtilities.url,b="sync"):b=a.widget._getSelf(a.widget.portalUrl);F(b,d.hitch(this,function(a){var s={};a&&(a.helperServices&&
a.helperServices.routingUtilities)&&(t=a.helperServices.routingUtilities.url);z.isDefined(t)?(h=new K(t+"/GetTravelModes"),h.execute(s).then(d.hitch(this,function(a){this.travelModes=p.map(a[0].value&&a[0].value.features,function(a){return c.fromJson(a.attributes.TravelMode)});a[1]&&(a[1].paramName&&"defaultTravelMode"===a[1].paramName)&&(this.defaultTravelModeId=a[1].value);f.resolve(this.travelModes)}),d.hitch(this,function(a){f.reject(a)}))):f.reject(Error("Missing Routing Utility Service to get Travel Modes"))}),
function(a){f.reject(a)})}));return f.promise},populateTravelModes:function(a){if(a&&a.selectWidget&&a.widget){var f=[],c=a.allowmode||"all";this.initI18n();a.addStraightLine&&f.push({value:"StraightLine",label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esriStraightLineDistanceIcon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+this.i18n.straightLineDistance+"\x3c/div\x3e"});this.getTravelModes({widget:a.widget}).then(d.hitch(this,function(b){p.forEach(b,
function(b,s){var d=b.name,h=d.replace(/\s/g,a.separator||""),t="AUTOMOBILE"===b.type?"Driving":"TRUCK"===b.type?"Trucking":"WALK"===b.type?"Walking":"Other",e=t.toLowerCase(),k=b.units||d.split(/\s/)[1],l=z.isDefined(a.enableTravelModes)&&!a.enableTravelModes,k=b.impedanceAttributeName===b.timeAttributeName?"Time":b.impedanceAttributeName===b.distanceAttributeName?"Distance":"Other",d={label:'\x3cdiv class\x3d"esriFloatLeading bufferIcon esri'+t+k+'Icon"\x3e\x3c/div\x3e\x3cdiv class\x3d"esriLeadingMargin4" style\x3d"height:20px;margin-top:10px;"\x3e'+
d+"\x3c/div\x3e",value:h,travelMode:b,disabled:l,modei18nKey:e,units:k};if("all"===c||c===k.toLowerCase())"all"!==c&&(d.value=d.value.replace(k,"")),a.selectDefaultMode&&(this.defaultTravelModeId&&this.defaultTravelModeId===b.id)&&(d.selected=!0),f.push(d)},this);a.selectWidget.removeOption();a.selectWidget.addOption(f);a.selectWidget.set("value",a.value);a.widget.emit("travelmodes-added",{travelOptions:f})}),d.hitch(this,function(b){f&&0<f.length&&(a.selectWidget.removeOption(),a.selectWidget.addOption(f),
a.selectWidget.set("value",a.value),a.widget.emit("travelmodes-added",{travelOptions:f}))}))}}});return m})},"esri/dijit/analysis/HelpWindow":function(){define("require dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/event dojo/_base/kernel dojo/aspect dojo/has dojo/dom-construct dojo/dom-class dojo/dom-attr dojo/dom-style dojo/query dojo/window dojo/dom-geometry dijit/_Widget dijit/TooltipDialog dijit/popup ../../kernel ../../lang ../../request ../_EventedWidget dojo/i18n!../../nls/jsapi".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a,t){return p([h],{declaredClass:"esri.dijit.analysis.HelpWindow",i18n:null,onlineHelpMap:null,showLearnMore:!1,"class":"esriAnalyisHelpWindow",postMixInProperties:function(){this.inherited(arguments);this.i18n={};g.mixin(this.i18n,t.common);g.mixin(this.i18n,t.analysisHelp)},postCreate:function(){this.inherited(arguments);var a=["ar","he"],b,c;this.onlineHelpMap={};for(b=0;b<a.length;b+=1)c=a[b],u.locale&&-1!==u.locale.indexOf(c)&&(-1!==u.locale.indexOf("-")?
-1!==u.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);a=m.toUrl("./help/helpmap.json");F({url:a}).then(g.hitch(this,function(a){this.onlineHelpMap=a.map}))},_getAbsoluteUrl:function(a){if(/^https?\:/i.test(a))return a;if(/^\/\//i.test(a))return window.location.protocol+a;if(/^\//i.test(a))return window.location.protocol+"//"+window.location.host+a},_computeSize:function(a){var b={w:400,h:200};l("esri-mobile")?b={w:"50%",h:"90%"}:-1!==a.indexOf("Category")?(b.w=400,b.h=320):
-1!==a.indexOf("Tool")?(b.w=400,b.h=320):-1!==a.indexOf("toolDescription")&&(b.w=400,b.h=520);return b},_setHelpTopicAttr:function(a){this.tooltipHelpDlg&&(B.close(this.tooltipHelpDlg),this.tooltipHelpDlg.destroy(),this.tooltipHelpDlg=null);var b,c,h,t,e="";this.showLearnMore=!1;c=this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("dev")?"dev":this._analysisGpServer&&-1!==this._analysisGpServer.indexOf("qa")?"uat":"";e=this.isPortal?"-PortalOnly":"-OnlineOnly";b=g.clone(u.locale);"nb"===
b&&(b="no");h=m.toUrl("esri/dijit/analysis/help/"+this.helpFileName+".html");D.isDefined(this.onlineHelpMap[this.helpFileName])&&D.isDefined(this.onlineHelpMap[this.helpFileName][a])&&(this.showLearnMore=!0,t="http://doc"+c+".arcgis.com/en/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);-1!==d.indexOf("ar cs da de es el et fi fr it ja ko lt lv ru nl no pl pt-br pt-pt ro sv th tr vi zh-cn zh-hk zh-tw".split(" "),b)&&(-1!==b.indexOf("-")&&(h=b.split("-"),b=h[0]+"-"+h[1].toUpperCase()),
h=m.toUrl("esri/dijit/analysis/help/"+b+"/"+this.helpFileName+".html"));-1!==d.indexOf("ar de es fr it ja ko ru nl pl pt-br pt-pt ro zh-cn zh-hk zh-tw".split(" "),b)&&this.showLearnMore&&(t="http://doc"+c+".arcgis.com/"+b+"/arcgis-online/use-maps/"+this.onlineHelpMap[this.helpFileName][a]);this._size=c=this._computeSize(a);this.tooltipHelpDlg=new y({preload:!0,content:"\x3cdiv class\x3d'' style\x3d'position:relative'\x3cdiv class\x3d'sizer content'\x3e\x3cdiv class\x3d'contentPane'\x3e\x3cdiv class\x3d'esriFloatTrailing' style\x3d'padding:0;'\x3e\x3ca href\x3d'#' class\x3d'esriAnalysisCloseIcon' title\x3d'"+
this.i18n.close+"'\x3e\x3c/a\x3e\x3c/div\x3e\x3ciframe frameborder\x3d'0'  id\x3d'"+a+"' src\x3d'"+h+"#"+a+e+"' width\x3d'"+c.w+"' height\x3d'"+c.h+"' marginheight\x3d'0' marginwidth\x3d'0'\x3e\x3c/iframe\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'actionsPane'\x3e\x3cdiv class\x3d'actionList"+(this.showLearnMore?"'\x3e":" hidden'\x3e")+"\x3ca class\x3d'action zoomTo' href\x3d'"+(this.showLearnMore?t:"#")+"' target\x3d'_help'\x3e"+this.i18n.learnMore+"\x3c/a\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
"class":"esriHelpPopup esriHelpPopupWrapper esriAnalyisHelpWindow"});this.tooltipHelpDlg.startup()},show:function(a,b){this.helpFileName=b.helpFileName;this._analysisGpServer=b.analysisGpServer;this.isPortal=b.isPortal;this.set("helpTopic",b.helpId);var c=n.after(B,"open",g.hitch(this,function(){k(".esriAnalysisCloseIcon",this.tooltipHelpDlg.domNode).on("click",g.hitch(this,this.close));c.remove()})),d=a.pageX,h=v.getBox(),t,e,l;l=!1;b.helpParentNode&&(t=b.helpParentNode);t&&(e=A.position(t));e&&
h.w-a.pageX<e.w?(l=!0,d=e.x-this._size.w-10,this._isRightToLeft&&(d-=10)):this._isRightToLeft&&d-40<this._size.w&&(d=e.w+this._size.w+80);B.open({popup:this.tooltipHelpDlg,x:!0===this._isRightToLeft||l?d-40:d+40,y:a.screenY-a.pageY+10,onCancel:g.hitch(this,function(){this.close()}),onExecute:function(){this.close()}});this.tooltipHelpDlg.domNode.parentNode&&w.set(this.tooltipHelpDlg.domNode.parentNode,"overflowY","hidden")},close:function(a,b){B.close(this.tooltipHelpDlg)}})})},"esri/dijit/BrowseItems":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/dom-class dojo/dom-style dojo/dom-attr dojo/string dojo/on dojo/aspect dojo/has dojo/dom dojo/dom-construct dojo/mouse dojo/query dojo/parser dijit/registry dijit/TooltipDialog dijit/popup dojo/promise/all dojo/Deferred dgrid/Grid dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/util/mouse dgrid/util/touch put-selector/put dojo/store/Observable dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_FocusMixin dijit/form/Select ../arcgis/Portal ../Evented ../PluginTarget dojo/i18n!../nls/jsapi ./_RefreshMixin ../kernel ../lang ../config ../geometry/webMercatorUtils ../tasks/GeometryService ../SpatialReference".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a,t,f,G,x,z,I,L,J,H,M,E,K,O,P,N,U,Q,R,s,Y,S,V,T,W,Z){var X=m(null,{idProperty:"id",constructor:function(a){m.safeMixin(this,a)},get:function(a,s){return N.PortalUtil.request(this.portalUrl+"content/items/"+a,s).then(function(a){return new N.PortalItem(d.mixin(a,{portal:this.portal}))})},getIdentity:function(a){return a[this.idProperty]},query:function(a,s){var f=d.isObject(a)?a:{q:a};if(s&&(f=d.mixin(f,{num:s.count,start:(s.start||0)+1}),s.sort&&
s.sort.length))var b=s.sort[0],f=d.mixin(f,{sortField:encodeURIComponent("created"===b.attribute?"uploaded":b.attribute),sortOrder:b.descending?"desc":"asc"});s.useExtent&&s.extent&&(f.bbox=s.extent);f=this.portal.queryItems(f,!0).then(function(a){a.results.total=a.total;return a.results});return N.PortalResult(f)}});return m([M,E,K,Q,O],{templateString:'\x3cdiv\x3e\x3cp data-dojo-attach-point\x3d"messageNode" class\x3d"hide"\x3e\x3c/p\x3e\x3cdiv style\x3d"width:100%" class\x3d"esriLeadingMargin1"\x3e\x3cselect id\x3d"${id}_categorySelect"class\x3d"categorySelect"\x3e\x3c/select\x3e\x3cdiv id\x3d"${id}_search"class\x3d"esriTrailingMargin2 esriFloatTrailing searchBar"\x3e\x3cinput class\x3d"esriSearchBox dijitTextBox" type\x3d"text" placeholder:\'${i18n.searchFor}\'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv id\x3d"${id}_grid"class\x3d"dgrid-autoheight"\x3e\x3c/div\x3e\x3cbr /\x3e\x3c/div\x3e',
_galleryTemplate:"\x3cdiv style\x3d'opacity:1;' class\x3d'grid-item gallery-view'\x3e${item:_formatItemTitle}${item:_formatThumbnail}\x3c/div\x3e",_popupTemplate:'\x3cdiv class\x3d"esriBrowsePopup quiet-scroll"\x3e\x3cp\x3e{summary}\x3c/p\x3e\x3c/div\x3e',baseClass:"esriBrowseItemsCtr",closePopupPerRow:!0,postMixInProperties:function(){this.inherited(arguments);this.i18n={};d.mixin(this.i18n,R.gallery)},postCreate:function(){this.inherited(arguments);this.self?(this._portal=new N.Portal({url:this.portalUrl,
self:this.self}),this._portal.on("load",d.hitch(this,this._fetchData))):(this._portal=new N.Portal(this.portalUrl),this._portal.signIn().then(d.hitch(this,this._fetchData)))},destroy:function(){this.inherited(arguments);this._grid&&this._grid.destroy();this._img_connect.remove();this._img_connect_error.remove();this._queryTimer&&clearTimeout(this._queryTimer);this._grid=this._portal=null},_setPortalUrlAttr:function(a){this.portalUrl=a},_setSelfAttr:function(a){this.self=a},_setPluginAttr:function(a){this.addPlugin(a)},
_setMessageAttr:function(a){u.set(this.messageNode,"innerHTML",a);b.remove(this.messageNode,"hide")},_setCategoriesAttr:function(a){this.categories=a},_setDisabledAttr:function(a){var s=h.findWidgets(this.domNode).concat(h.findWidgets(this._content));p.forEach(s,function(s){s.set("disabled",a)});b[a?"add":"remove"](this._interval.domNode,"dijitTextBoxDisabled")},_setSortAttr:function(a){this.sortAttribute=a},_setSortDescendingAttr:function(a){this.sortDescending=a},_getSelectionAttr:function(){var a=
this._grid.selection,s;for(s in a)if(a.hasOwnProperty(s))break;return s&&this._grid.row(s).data},_setGalleryTemplateAttr:function(a){S.isDefined(a)&&(this._galleryTemplate=a)},_setFormatThumbnailAttr:function(a){S.isDefined(a)&&"function"===typeof a&&(this._formatThumbnail=a)},_setFormatItemTitleAttr:function(a){S.isDefined(a)&&"function"===typeof a&&(this._formatItemTitle=a)},_setItemsPerPageAttr:function(a){this._set("itemsPerPage",a)},_setPagingLinksAttr:function(a){this._set("pagingLinks",a)},
_setCategoryTypeAttr:function(a){this._set("categoryType",a)},_getQueryAttr:function(){return this._grid&&this._grid.get("query")},_setQueryAttr:function(a){this._grid&&(this._grid.set("query",a),this.reset())},_setSelectedCategoryAttr:function(a){this._set("selectedCategory",a)},_setClosePopupPerRowAttr:function(a){this._set("closePopupPerRow",a)},_setExtentAttr:function(a){a&&this._set("extent",this._extentToString(a))},_setUseExtentAttr:function(a){this._set("useExtent",a)},_setFetchTimeoutAttr:function(a){this._set("fetchTimeout",
a)},_validate:function(){return!!this.get("selection")},reset:function(){this._grid&&(this._categorySelect&&(this._categorySelect.reset(),this.get("selectedCategory")?(this._origQuery=null,this._categorySelect.set("value",this.get("selectedCategory"))):(this._origQuery=null,this._categorySelect.set("value",this.categories[0].value))),v(".esriSearchBox",q.byId(this.id+"_search")).forEach(function(a){u.set(a,"value","")}))},_showPopup:function(a){if(!this._isInsideTooltipDialog){this._closePopup();
var s=this._grid.row(a),f=v("img",s.element)[0];if((s={summary:s.data.snippet})&&s.summary)this._tooltip=new y({content:d.replace(this._popupTemplate,s),onMouseEnter:d.hitch(this,function(){this._isInsideTooltipDialog=!0}),onMouseLeave:d.hitch(this,function(){this._isInsideTooltipDialog=!1;this._closePopup(a)})}),B.open({className:"esriBrowsePopupCtr",popup:this._tooltip,around:f,orient:["after-centered","before-centered"]}),this._onCloseConnect=v(".dijitDialogCloseIcon",this._tooltip.domNode).on("click",
d.hitch(this,function(a){a.preventDefault();this._closePopup()}))}},_closePopup:function(){this._tooltip&&(this._onCloseConnect.remove(),B.close(this._tooltip),this._tooltip.destroyRecursive(),this._tooltip=this._onCloseConnect=void 0)},_clearQueryTimeout:function(){clearTimeout(this._queryTimer)},_createGrid:function(){var f=m([F,a,G,s,t]),b=new H(new X({portal:this._portal})),c=this._currentFilter,h=d.hitch(this,function(a){a.snippet=a.snippet||"";var s=J("div");a=n.substitute(this._galleryTemplate,
{item:a,i18n:this.i18n},null,this);w.place(a,s);return s}),e={};this.get("useExtent")&&(e.extent=this.get("extent"),e.useExtent=this.get("useExtent"));this._grid=new f({store:b,className:"dgrid-autoheight",query:c,selectionMode:"single",pagingLinks:this.get("pagingLinks")||2,rowsPerPage:this.get("itemsPerPage")||6,loadingMessage:"Loading items...",showLoadingMessage:!1,renderRow:h,noDataMessage:this.i18n.noItemsToDisplay,sort:[{attribute:"title"}],queryOptions:e},this.id+"_grid");this._grid.startup();
this.categories&&0<this.categories.length&&(this._categorySelect=new P({options:this.categories,sortByLabel:!1,"class":"categorySelect"},this.id+"_categorySelect"),this.own(this._categorySelect.on("change",d.hitch(this,function(a){var s;this._closePopup();this._origQuery||(this._origQuery=this._grid.get("query"));s=this._origQuery;a&&(s+=" AND ("+this.get("categoryType")+":"+a+")");this._fetchItems(s)}))));this.own(this._grid.on(I.enterRow,d.hitch(this,function(a){this._showPopup(a)})),this._grid.on(I.leaveRow,
d.hitch(this,function(a){this.get("closePopupPerRow")&&this._closePopup(a)})),l(v(".dgrid-footer,.dgrid-header",this._grid.domNode),k.leave,d.hitch(this,function(a){this._closePopup(a)})),this._grid.on("dgrid-refresh-complete",d.hitch(this,function(a){this._closePopup(a);v(".dgrid-footer",this.domNode)[this._grid._total<=this._grid.rowsPerPage?"addClass":"removeClass"]("hide")})),this._grid.on("refresh",d.hitch(this,function(){this._img_connect&&(this._img_connect.remove(),this._img_connect_error.remove(),
this._img_connect_error=this._img_connect=null);this._img_connect=v(".grid-item-thumb",this._grid.domNode).on("load",d.hitch(this,function(a){(a=this._grid.row(a))&&a.element&&v(".grid-item",a.element).addClass("fadeIn").style("opacity","1")}));this._img_connect_error=v(".grid-item-thumb",this._grid.domNode).on("error",d.hitch(this,function(a){u.set(a.target,"src",this._portal.staticImagesUrl+"/desktopapp.png")}))})),this._grid.on("dgrid-select,dgrid-deselect",d.hitch(this,function(){var a={selection:this.get("selection")};
this.emit("select-change",a)})),l(q.byId(this.id+"_search"),"keyup",d.hitch(this,function(a){a.preventDefault();this._closePopup();this._clearQueryTimeout();this._queryTimer=setTimeout(d.hitch(this,function(){this._fetchItems(this._currentFilter,u.get(a.target,"value"))}),this.searchKeypressDelay||250)})),this.watch("extent",d.hitch(this,function(a,s,f){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=this.get("useExtent");this._grid.refresh()})),this.watch("useExtent",
d.hitch(this,function(a,s,f){this._grid.queryOptions.extent=this.get("extent");this._grid.queryOptions.useExtent=f;this._grid.refresh()})))},_fetchData:function(){this._user=this._portal.getPortalUser();return this.plugIn.fetchData()},_fetchItems:function(a,s){var f={sort:[{attribute:this.sortAttribute||"title",descending:this.sortDescending||!1}]},b=s?" title:"+s+"* ":"",c=new D;this.get("extent")&&(f.extent=this.extent);f.useExtent=this.get("useExtent");setTimeout(d.hitch(this,function(){this._currentFilter=
a;this._grid?this._grid.set("query",this._currentFilter+b,f):this._createGrid();c.resolve(this._grid)}),this.fetchTimeout||60);return c},_formatThumbnail:function(a){return"\x3cimg class\x3d'grid-item-thumb' width\x3d'187px' height\x3d'125px' alt\x3d'' src\x3d'"+(a.thumbnailUrl||this._portal.staticImagesUrl+"/desktopapp.png")+"'\x3e"},_formatItemTitle:function(a){return"\x3ch5\x3e"+(a.title||a.name||"\x3cNo Title\x3e")+"\x3c/h5\x3e"},clear:function(){this._grid.clearSelection()},doProject:function(a,
s){var f=[102113,102100,3857],b=new D,c,d,h;c=function(a,s){a&&0<a.length&&a[0]&&"extent"==a[0].type&&!isNaN(a[0].xmin)&&!isNaN(a[0].ymin)&&!isNaN(a[0].xmax)&&!isNaN(a[0].ymax)?b.resolve(a,s):a&&(0<a.length&&a[0]&&"point"==a[0].type&&!isNaN(a[0].x)&&!isNaN(a[0].y))&&b.resolve(a,s)};if(null!=a.spatialReference.wkid&&4326==a.spatialReference.wkid&&null!=s.wkid&&this.contains(f,s.wkid)){a.ymin=Math.max(a.ymin,-89.99);a.ymax=Math.min(a.ymax,89.99);f=T.geographicToWebMercator(a);if((c=f.spatialReference._getInfo())&&
f.xmin>f.xmax)d=c.valid[1]-f.xmin,h=f.xmax-c.valid[0],d>h?f.xmax=c.valid[1]+h:f.xmin=c.valid[0]-d;f.spatialReference.wkid=s.wkid;b.resolve([f])}else if(null!=a.spatialReference.wkid&&this.contains(f,a.spatialReference.wkid)&&null!=s.wkid&&4326==s.wkid){f=T.webMercatorToGeographic(a);if((c=f.spatialReference._getInfo())&&f.xmin>f.xmax)d=c.valid[1]-f.xmin,h=f.xmax-c.valid[0],d>h?f.xmax=c.valid[1]+h:f.xmin=c.valid[0]-d;b.resolve([f])}else this.geometryService||(this.geometryService=new W(V.defaults.geometryService)),
this.geometryService.project([a],s,c);return b},contains:function(a,s){for(var f=a.length;f--;)if(a[f]===s)return!0;return!1},_extentToGCS:function(a){a=a.shiftCentralMeridian(!0);return T.webMercatorToGeographic(a)},_extentToString:function(a){var s="";null!=a&&(a=this._extentToGCS(a),s=this._roundValue(a.xmin,1E4)+","+this._roundValue(a.ymin,1E4)+","+this._roundValue(a.xmax,1E4)+","+this._roundValue(a.ymax,1E4));return s},_roundValue:function(a,s){return Math.round(a*s)/s}})})},"dgrid/extensions/Pagination":function(){define("../_StoreMixin dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Deferred dojo/on dojo/query dojo/string dojo/has put-selector/put ../util/misc dojo/i18n!./nls/pagination dojo/_base/sniff xstyle/css!../css/extensions/Pagination.css".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q){function w(b){b.noDataNode?(e(b.noDataNode,"!"),delete b.noDataNode):b.cleanup();b.contentNode.innerHTML=""}function k(b){if(b.loadingNode)e(b.loadingNode,"!"),delete b.loadingNode;else if(b._oldPageNodes){for(var c in b._oldPageNodes)b.removeRow(b._oldPageNodes[c]);delete b._oldPageNodes;b._oldPageObserver&&(b._oldPageObserver.cancel(),b._numObservers--,delete b._oldPageObserver)}delete b._isLoading}return d("dgrid.extensions.Pagination",m,{rowsPerPage:10,pagingTextBox:!1,
previousNextArrows:!0,firstLastArrows:!1,pagingLinks:2,pageSizeOptions:null,showLoadingMessage:!0,i18nPagination:q,showFooter:!0,_currentPage:1,_total:0,buildRendering:function(){this.inherited(arguments);var b=this,d=this.paginationNode=e(this.footerNode,"div.dgrid-pagination"),h=this.paginationStatusNode=e(d,"div.dgrid-status"),k=this.i18nPagination;h.tabIndex=0;this._updatePaginationSizeSelect();this._updateRowsPerPageOption();h.innerHTML=n.substitute(k.status,{start:1,end:1,total:0});d=this.paginationNavigationNode=
e(d,"div.dgrid-navigation");this.firstLastArrows&&(h=this.paginationFirstNode=e(d,"span.dgrid-first.dgrid-page-link","\u00ab"),h.setAttribute("aria-label",k.gotoFirst),h.tabIndex=0);this.previousNextArrows&&(h=this.paginationPreviousNode=e(d,"span.dgrid-previous.dgrid-page-link","\u2039"),h.setAttribute("aria-label",k.gotoPrev),h.tabIndex=0);this.paginationLinksNode=e(d,"span.dgrid-pagination-links");this.previousNextArrows&&(h=this.paginationNextNode=e(d,"span.dgrid-next.dgrid-page-link","\u203a"),
h.setAttribute("aria-label",k.gotoNext),h.tabIndex=0);this.firstLastArrows&&(h=this.paginationLastNode=e(d,"span.dgrid-last.dgrid-page-link","\u00bb"),h.setAttribute("aria-label",k.gotoLast),h.tabIndex=0);this._listeners.push(c(d,".dgrid-page-link:click,.dgrid-page-link:keydown",function(c){if(!("keydown"===c.type&&13!==c.keyCode)){c=this.className;var d,h;b._isLoading||-1<c.indexOf("dgrid-page-disabled")||(d=b._currentPage,h=Math.ceil(b._total/b.rowsPerPage),this===b.paginationPreviousNode?b.gotoPage(d-
1):this===b.paginationNextNode?b.gotoPage(d+1):this===b.paginationFirstNode?b.gotoPage(1):this===b.paginationLastNode?b.gotoPage(h):"dgrid-page-link"===c&&b.gotoPage(+this.innerHTML))}}))},destroy:function(){this.inherited(arguments);this._pagingTextBoxHandle&&this._pagingTextBoxHandle.remove()},_updatePaginationSizeSelect:function(){var b=this.pageSizeOptions,d=this.paginationSizeSelect,h;if(b&&b.length){d||(d=this.paginationSizeSelect=e(this.paginationNode,"select.dgrid-page-size[aria-label\x3d"+
this.i18nPagination.rowsPerPage+"]"),h=this._paginationSizeChangeHandle=c(d,"change",g.hitch(this,function(){this.set("rowsPerPage",+this.paginationSizeSelect.value)})),this._listeners.push(h));for(h=d.options.length=0;h<b.length;h++)e(d,"option",b[h],{value:b[h],selected:this.rowsPerPage===b[h]});this._updateRowsPerPageOption()}else if((!b||!b.length)&&d)e(d,"!"),this.paginationSizeSelect=null,this._paginationSizeChangeHandle.remove()},_setPageSizeOptions:function(b){this.pageSizeOptions=b&&b.sort(function(b,
c){return b-c});this._updatePaginationSizeSelect()},_updateRowsPerPageOption:function(){var b=this.rowsPerPage,c=this.pageSizeOptions,d=this.paginationSizeSelect;d&&(0>p.indexOf(c,b)?this._setPageSizeOptions(c.concat([b])):d.value=""+b)},_setRowsPerPage:function(b){this.rowsPerPage=b;this._updateRowsPerPageOption();this.gotoPage(1)},_updateNavigation:function(){function b(d,t){var r,g;h.pagingTextBox&&d==n&&1<a?(r=e(l,"input.dgrid-page-input[type\x3dtext][value\x3d$]",n),r.setAttribute("aria-label",
k.jumpPage),h._pagingTextBoxHandle=c(r,"change",function(){var f=+this.value;!isNaN(f)&&(0<f&&f<=a)&&h.gotoPage(+this.value)}),f&&"INPUT"===f.tagName&&r.focus()):(g=d===n,r=e(l,"span"+(g?".dgrid-page-disabled":"")+".dgrid-page-link",d+(t?" ":"")),r.setAttribute("aria-label",k.gotoPage),r.tabIndex=g?-1:0,G===d&&(g?d<a?G++:x.focus():r.focus()),g||(x=r))}function d(a,f){e(a,(f?".":"!")+"dgrid-page-disabled");a.tabIndex=f?-1:0}var h=this,k=this.i18nPagination,l=this.paginationLinksNode,n=this._currentPage,
g=this.pagingLinks,q=this.paginationNavigationNode,a=Math.ceil(this._total/this.rowsPerPage),t=this._pagingTextBoxHandle,f=document.activeElement,G,x;!f||!r.contains(this.paginationNavigationNode,f)?f=null:"dgrid-page-link"===f.className&&(G=+f.innerHTML);t&&t.remove();l.innerHTML="";u(".dgrid-first, .dgrid-previous",q).forEach(function(a){d(a,1===n)});u(".dgrid-last, .dgrid-next",q).forEach(function(f){d(f,n>=a)});if(g&&0<a){b(1,!0);q=n-g;for(2<q?e(l,"span.dgrid-page-skip","..."):q=2;q<Math.min(n+
g+1,a);q++)b(q,!0);n+g+1<a&&e(l,"span.dgrid-page-skip","...");1<a&&b(a)}else h.pagingTextBox&&b(n);f&&-1===f.tabIndex&&(g=u("[tabindex\x3d'0']",this.paginationNavigationNode),f===this.paginationPreviousNode||f===this.paginationFirstNode?f=g[0]:g.length&&(f=g[g.length-1]),f&&f.focus())},refresh:function(){var b=this;this.inherited(arguments);if(this.store)return this.gotoPage(1).then(function(d){setTimeout(function(){c.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b,results:d})},
0);return d});console.warn("Pagination requires a store to operate.")},_onNotification:function(b){b.length!==this._rowsOnPage&&this.gotoPage(this._currentPage)},renderArray:function(c,d){var h=this,e=this.inherited(arguments);this._lastCollection=null;d||(this._topLevelRequest&&this._topLevelRequest!==c&&(this._topLevelRequest.cancel(),delete this._topLevelRequest),"function"===typeof c.cancel&&(this._topLevelRequest=c),b.when(c,function(){h._topLevelRequest&&delete h._topLevelRequest}));return e},
insertRow:function(){var b=this._oldPageNodes,c=this.inherited(arguments);b&&c===b[c.id]&&delete b[c.id];return c},gotoPage:function(c){var d=this,h=new b;this._trackError(function(){var r=d.rowsPerPage,q=(c-1)*r,u=g.mixin(d.get("queryOptions"),{start:q,count:r}),p,m=d.contentNode,a,t,f;if(d.showLoadingMessage)w(d),a=d.loadingNode=e(m,"div.dgrid-loading"),a.innerHTML=d.loadingMessage;else{d._oldPageNodes=a={};m=m.children;t=0;for(f=m.length;t<f;t++)a[m[t].id]=m[t];d._oldPageObserver=d.observers.pop()}d._isLoading=
!0;p=d.store.query(d.query,u);b.when(d.renderArray(p,null,u),function(a){k(d);d.scrollTo({y:0});b.when(p.total,function(f){f||(d.noDataNode&&(e(d.noDataNode,"!"),delete d.noDataNode),d.noDataNode=e(d.contentNode,"div.dgrid-no-data"),d.noDataNode.innerHTML=d.noDataMessage);d.paginationStatusNode.innerHTML=n.substitute(d.i18nPagination.status,{start:Math.min(q+1,f),end:Math.min(f,q+r),total:f});d._total=f;d._currentPage=c;d._rowsOnPage=a.length;d._updateNavigation()});(7>l("ie")||l("ie")&&l("quirks"))&&
d.resize();h.resolve(p)},function(a){k(d);h.reject(a)});return h.promise})||h.reject();return h.promise}})})},"dgrid/extensions/DijitRegistry":function(){define(["dojo/_base/declare","dojo/dom-geometry","dijit/registry"],function(m,d,p){return m("dgrid.extensions.DijitRegistry",null,{minSize:0,maxSize:Infinity,layoutPriority:0,showTitle:!0,buildRendering:function(){p.add(this);this.inherited(arguments);this.domNode.setAttribute("widgetId",this.id)},startup:function(){if(!this._started){this.inherited(arguments);
var d=p.getEnclosingWidget(this.domNode.parentNode);d&&d.isLayoutContainer&&this._resizeHandle.remove()}},destroyRecursive:function(){this.destroy()},destroy:function(){this.inherited(arguments);p.remove(this.id)},getChildren:function(){return[]},isLeftToRight:function(){return!this.isRTL},resize:function(g){g&&d.setMarginBox(this.domNode,g);this.inherited(arguments)},_set:function(d,b){this[d]=b},watch:function(){},getParent:function(){return p.getEnclosingWidget(this.domNode.parentNode)}})})},"dgrid/selector":function(){define("dojo/_base/kernel dojo/_base/array dojo/_base/lang dojo/on dojo/aspect dojo/_base/sniff put-selector/put".split(" "),
function(m,d,p,g,b,c,u){p.getObject("dgrid.selector",!0);return dgrid.selector=function(n,l){function e(b){return!v.allowSelect(v.row(b))}function r(b){return function(c){var d=c.rows,h=d.length;c="false";var e;for(e=0;e<h;e++){var a=v.cell(d[e],n.id).element;if(a&&(a=(a.contents||a).input)&&!a.disabled)a.checked=b,a.setAttribute("aria-checked",b)}if("checkbox"==A.type){d=v.selection;h=!1;for(e in d)if(d[e]!=v.allSelected){h=!0;break}A.indeterminate=h;A.checked=v.allSelected;h?c="mixed":v.allSelected&&
(c="true");A.setAttribute("aria-checked",c)}}}function g(b){if("click"==b.type||32==b.keyCode||!c("opera")&&13==b.keyCode||0===b.keyCode){var d=v.row(b);v._selectionTriggerEvent=b;if(d){if(v.allowSelect(d)){var h=v._lastSelected&&v.row(v._lastSelected);if("radio"==l){if(!h||h.id!=d.id)v.clearSelection(),v.select(d,null,!0),v._lastSelected=d.element}else d&&(b.shiftKey?r(!0)({rows:[d]}):h=null,h=b.shiftKey?h:null,v.select(h||d,d,h?void 0:null),v._lastSelected=d.element)}}else u(this,(v.allSelected?
"!":".")+"dgrid-select-all"),v[v.allSelected?"clearSelection":"selectAll"]();v._selectionTriggerEvent=null}}function p(){v._hasSelectorInputListener=!0;k.push(v.on(".dgrid-selector:click,.dgrid-selector:keydown",g));var b=v._handleSelect;v._handleSelect=function(c){this.cell(c).column!=n&&b.apply(this,arguments)};if("function"==typeof n.disabled){var c=v.allowSelect,d=n.disabled;v.allowSelect=function(b){var h=c.call(this,b);return d===e?h:h&&!d.call(n,b.data)}}n.disabled=e;k.push(v.on("dgrid-select",
r(!0)));k.push(v.on("dgrid-deselect",r(!1)))}var k=[],v,A;n||(n={});n.type&&(n.selectorType=n.type,m.deprecated("columndef.type","use columndef.selectorType instead","dgrid 0.4"));n.selectorType=l=l||n.selectorType||"checkbox";n.sortable=!1;var h="function"==typeof l?l:function(b,c,d){var h=c.parentNode,e;v._hasSelectorInputListener||p();e=n.disabled;u(h&&h.contents?h:c,".dgrid-selector");c=c.input||(c.input=u(c,"input[type\x3d"+l+"]",{tabIndex:isNaN(n.tabIndex)?-1:n.tabIndex,disabled:e&&("function"==
typeof e?e.call(n,d):e),checked:b}));c.setAttribute("aria-checked",!!b);return c};b.after(n,"init",function(){v=n.grid});b.after(n,"destroy",function(){d.forEach(k,function(b){b.remove()});v._hasSelectorInputListener=!1});n.renderCell=function(b,c,d,e,k){c=(c=b&&v.row(b))&&v.selection[c.id];h(c,d,b)};n.renderHeaderCell=function(b){var c="label"in n?n.label:n.field||"";"radio"==l||!v.allowSelectAll?(b.appendChild(document.createTextNode(c)),v._hasSelectorInputListener||p()):h(!1,b,{});A=b.lastChild};
return n}})},"dgrid/Keyboard":function(){define("dojo/_base/declare dojo/aspect dojo/on dojo/_base/lang dojo/has put-selector/put ./util/misc dojo/_base/Deferred dojo/_base/sniff".split(" "),function(m,d,p,g,b,c,u,n){function l(a){a.preventDefault()}var e={checkbox:1,radio:1,button:1},r=/\bdgrid-cell\b/,q=/\bdgrid-row\b/,w=m("dgrid.Keyboard",null,{pageSkip:10,tabIndex:0,keyMap:null,headerKeyMap:null,postMixInProperties:function(){this.inherited(arguments);this.keyMap||(this.keyMap=g.mixin({},w.defaultKeyMap));
this.headerKeyMap||(this.headerKeyMap=g.mixin({},w.defaultHeaderKeyMap))},postCreate:function(){function a(b){var f=b.target;return f.type&&(!e[f.type]||32==b.keyCode)}function b(h){function t(){c._focusedHeaderNode&&(c._focusedHeaderNode.tabIndex=-1);if(c.showHeader){if(e)for(var a=0,b,f=c.headerNode.getElementsByTagName("th");b=f[a];++a){if(k.test(b.className)){c._focusedHeaderNode=g=b;break}}else c._focusedHeaderNode=g=c.headerNode;g&&(g.tabIndex=c.tabIndex)}}var e=c.cellNavigation,k=e?r:q,l=h===
c.headerNode,g=h;l?(t(),d.after(c,"renderHeader",t,!0)):d.after(c,"renderArray",function(a){return n.when(a,function(a){var b=c._focusedNode||g;if(k.test(b.className)&&u.contains(h,b))return a;for(var f=0,d=h.getElementsByTagName("*"),t;t=d[f];++f)if(k.test(t.className)){b=c._focusedNode=t;break}b.tabIndex=c.tabIndex;return a})});c._listeners.push(p(h,"mousedown",function(b){a(b)||c._focusOnNode(b.target,l,b)}));c._listeners.push(p(h,"keydown",function(b){if(!b.metaKey&&!b.altKey){var d=c[l?"headerKeyMap":
"keyMap"][b.keyCode];d&&!a(b)&&d.call(c,b)}}))}this.inherited(arguments);var c=this;this.tabableHeader&&(b(this.headerNode),p(this.headerNode,"dgrid-cellfocusin",function(){c.scrollTo({x:this.scrollLeft})}));b(this.contentNode);this._debouncedEnsureRowScroll=u.debounce(this._ensureRowScroll,this)},removeRow:function(a){if(!this._focusedNode)return this.inherited(arguments);var b=this,c=document.activeElement===this._focusedNode,d=this[this.cellNavigation?"cell":"row"](this._focusedNode),h=d.row||
d,t;a=a.element||a;if(a===h.element){t=this.down(h,!0);if(!t||t.element===a)t=this.up(h,!0);this._removedFocus={active:c,rowId:h.id,columnId:d.column&&d.column.id,siblingId:!t||t.element===a?void 0:t.id};setTimeout(function(){b._removedFocus&&b._restoreFocus(h.id)},0);this._focusedNode=null}this.inherited(arguments)},insertRow:function(a){var b=this.inherited(arguments);this._removedFocus&&!this._removedFocus.wait&&this._restoreFocus(b);return b},_restoreFocus:function(a){var b=this._removedFocus,
d;if((a=(a=a&&this.row(a))&&a.element&&a.id===b.rowId?a:"undefined"!==typeof b.siblingId&&this.row(b.siblingId))&&a.element){if(!a.element.parentNode.parentNode){b.wait=!0;return}"undefined"!==typeof b.columnId&&(d=this.cell(a,b.columnId))&&d.element&&(a=d);b.active&&0!==a.element.offsetHeight?this._focusOnNode(a,!1,null):(c(a.element,".dgrid-focus"),a.element.tabIndex=this.tabIndex,this._focusedNode=a.element)}delete this._removedFocus},addKeyHandler:function(a,b,c){return d.after(this[c?"headerKeyMap":
"keyMap"],a,b,!0)},_ensureRowScroll:function(a){var b=this.getScrollPosition().y;b>a.offsetTop?this.scrollTo({y:a.offsetTop}):b+this.contentNode.offsetHeight<a.offsetTop+a.offsetHeight&&this.scrollTo({y:a.offsetTop-this.contentNode.offsetHeight+a.offsetHeight})},_focusOnNode:function(a,d,h){var t="_focused"+(d?"Header":"")+"Node",e=this[t],k=this.cellNavigation?"cell":"row",l=this[k](a),n,u,y,v,m;if(a=l&&l.element){if(this.cellNavigation){n=a.getElementsByTagName("input");m=0;for(y=n.length;m<y;m++)if(u=
n[m],(-1!=u.tabIndex||"_dgridLastValue"in u)&&!u.disabled){8>b("ie")&&(u.style.position="relative");u.focus();8>b("ie")&&(u.style.position="");v=!0;break}}null!==h&&(h=g.mixin({grid:this},h),h.type&&(h.parentType=h.type),h.bubbles||(h.bubbles=!0));e&&(c(e,"!dgrid-focus[!tabIndex]"),8>b("ie")&&(e.style.position=""),h&&(h[k]=this[k](e),p.emit(e,"dgrid-cellfocusout",h)));e=this[t]=a;h&&(h[k]=l);t=this.cellNavigation?r:q;!v&&t.test(a.className)&&(8>b("ie")&&(a.style.position="relative"),a.tabIndex=this.tabIndex,
a.focus());c(a,".dgrid-focus");h&&p.emit(e,"dgrid-cellfocusin",h);this.cellNavigation&&((this.columnSets||1<this.subRows.length)&&!d)&&this._debouncedEnsureRowScroll(l.row.element)}},focusHeader:function(a){this._focusOnNode(a||this._focusedHeaderNode,!0)},focus:function(a){(a=a||this._focusedNode)?this._focusOnNode(a,!1):this.contentNode.focus()}}),k=w.moveFocusVertical=function(a,b){var c=this.cellNavigation,d=this[c?"cell":"row"](a),d=c&&d.column.id,h=this.down(this._focusedNode,b,!0);c&&(h=this.cell(h,
d));this._focusOnNode(h,!1,a);a.preventDefault()};m=w.moveFocusUp=function(a){k.call(this,a,-1)};var v=w.moveFocusDown=function(a){k.call(this,a,1)},A=w.moveFocusPageUp=function(a){k.call(this,a,-this.pageSkip)},h=w.moveFocusPageDown=function(a){k.call(this,a,this.pageSkip)},y=w.moveFocusHorizontal=function(a,b){if(this.cellNavigation){var c=!this.row(a);this._focusOnNode(this.right(this["_focused"+(c?"Header":"")+"Node"],b),c,a);a.preventDefault()}},B=w.moveFocusLeft=function(a){y.call(this,a,-1)},
C=w.moveFocusRight=function(a){y.call(this,a,1)},D=w.moveHeaderFocusEnd=function(a,b){var c;this.cellNavigation&&(c=this.headerNode.getElementsByTagName("th"),this._focusOnNode(c[b?0:c.length-1],!0,a));a.preventDefault()},F=w.moveHeaderFocusHome=function(a){D.call(this,a,!0)},a=w.moveFocusEnd=function(a,c){var h=this,t=this.cellNavigation,e=this.contentNode,k=e.scrollTop+(c?0:e.scrollHeight),e=e[c?"firstChild":"lastChild"],l=-1<e.className.indexOf("dgrid-preload"),r=l?e[(c?"next":"previous")+"Sibling"]:
e,q=r.offsetTop+(c?0:r.offsetHeight),u;if(l){for(;r&&0>r.className.indexOf("dgrid-row");)r=r[(c?"next":"previous")+"Sibling"];if(!r)return}!l||1>e.offsetHeight?(t&&(r=this.cell(r,this.cell(a).column.id)),this._focusOnNode(r,!1,a)):(b("dom-addeventlistener")||(a=g.mixin({},a)),u=d.after(this,"renderArray",function(b){u.remove();return n.when(b,function(b){b=b[c?0:b.length-1];t&&(b=h.cell(b,h.cell(a).column.id));h._focusOnNode(b,!1,a)})}));k===q&&a.preventDefault()},t=w.moveFocusHome=function(b){a.call(this,
b,!0)};w.defaultKeyMap={32:l,33:A,34:h,35:a,36:t,37:B,38:m,39:C,40:v};w.defaultHeaderKeyMap={32:l,35:D,36:F,37:B,39:C};return w})},"dgrid/util/mouse":function(){define(["dojo/_base/lang","dojo/on","dojo/dom","dojo/query"],function(m,d,p){function g(b,g){return function(n,l){return d(n,b+":"+g,function(b){if(!p.isDescendant(b.relatedTarget,this))return l.call(this,b)})}}var b={enterRow:g(".dgrid-content .dgrid-row","mouseover"),enterCell:g(".dgrid-content .dgrid-cell","mouseover"),enterHeaderCell:g(".dgrid-header .dgrid-cell",
"mouseover"),leaveRow:g(".dgrid-content .dgrid-row","mouseout"),leaveCell:g(".dgrid-content .dgrid-cell","mouseout"),leaveHeaderCell:g(".dgrid-header .dgrid-cell","mouseout"),createDelegatingHandler:g};m.getObject("dgrid.util.mouse",!0);m.mixin(dgrid.util.mouse,b);return b})},"dgrid/util/touch":function(){define(["dojo/on","dojo/query"],function(m,d){function p(b,c,d,n){if(!(1<d.targetTouches.length)){var l=d.changedTouches[0],e=l.screenX,r=l.screenY;n&&d.preventDefault();var q=m(b,"touchend",function(b){var d=
b.changedTouches[0];b.targetTouches.length||(Math.abs(d.screenX-e)<g.tapRadius&&Math.abs(d.screenY-r)<g.tapRadius&&(n&&b.preventDefault(),c.call(this,b)),q.remove())})}}var g={tapRadius:10,dbltapTime:250,selector:function(b,c,g){return function(n,l){var e=c.bubble;e?c=e:!1!==g&&(g=!0);return m(n,c,function(c){var e=c.target;3==e.nodeType&&(e=e.parentNode);for(;!d.matches(e,b,n);)if(e==n||!g||!(e=e.parentNode))return;return l.call(e,c)})}},countCurrentTouches:function(b,c){if(!("touches"in b))return-1;
var d,n,l;for(n=d=0;l=b.touches[d];++d)c.contains(l.target)&&++n;return n},tap:function(b,c){return m(b,"touchstart",function(d){p(b,c,d)})},dbltap:function(b,c){var d,n;return m(b,"touchstart",function(l){d?p(b,function(b){if(d){var l=b.changedTouches[0];Math.abs(l.screenX-d.screenX)<g.tapRadius&&Math.abs(l.screenY-d.screenY)<g.tapRadius&&(n&&clearTimeout(n),d=n=null,c.call(this,b))}},l,!0):p(b,function(b){d=b.changedTouches[0];n=setTimeout(function(){d=n=null},g.dbltapTime)},l)})}};return g})},
"dojo/store/Observable":function(){define(["../_base/kernel","../_base/lang","../when","../_base/array"],function(m,d,p,g){m=function(b){function c(c,d){var l=b[c];l&&(b[c]=function(k){var n;"put"===c&&(n=b.getIdentity(k));if(e)return l.apply(this,arguments);e=!0;try{var g=l.apply(this,arguments);p(g,function(b){d("object"==typeof b&&b||k,n)});return g}finally{e=!1}})}var u=[],n=0;b=d.delegate(b);b.notify=function(b,c){n++;for(var d=u.slice(),e=0,l=d.length;e<l;e++)d[e](b,c)};var l=b.query;b.query=
function(c,e){e=e||{};var m=l.apply(this,arguments);if(m&&m.forEach){var k=d.mixin({},e);delete k.start;delete k.count;var v=b.queryEngine&&b.queryEngine(c,k),A=n,h=[],y;m.observe=function(c,d){1==h.push(c)&&u.push(y=function(c,a){p(m,function(t){var f=t.length!=e.count,k,l;if(++A!=n)throw Error("Query is out of date, you must observe() the query prior to any data modifications");var r,u=-1,m=-1;if(void 0!==a){k=0;for(l=t.length;k<l;k++){var p=t[k];if(b.getIdentity(p)==a){r=p;u=k;(v||!c)&&t.splice(k,
1);break}}}if(v){if(c&&(v.matches?v.matches(c):v([c]).length))k=-1<u?u:t.length,t.splice(k,0,c),m=g.indexOf(v(t),c),t.splice(k,1),e.start&&0==m||!f&&m==t.length?m=-1:t.splice(m,0,c)}else c&&(void 0!==a?m=u:e.start||(m=b.defaultIndex||0,t.splice(m,0,c)));if((-1<u||-1<m)&&(d||!v||u!=m)){f=h.slice();for(k=0;t=f[k];k++)t(c||r,u,m)}})});var k={};k.remove=k.cancel=function(){var b=g.indexOf(h,c);-1<b&&(h.splice(b,1),h.length||u.splice(g.indexOf(u,y),1))};return k}}return m};var e;c("put",function(c,d){b.notify(c,
d)});c("add",function(c){b.notify(c)});c("remove",function(c){b.notify(void 0,c)});return b};d.setObject("dojo.store.Observable",m);return m})},"esri/arcgis/Portal":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/kernel dojo/_base/Deferred dojo/_base/array dojo/_base/sniff require ../kernel ../lang ../request ../Evented ../IdentityManager".split(" "),function(m,d,p,g,b,c,u,n,l,e,r){var q={options:{disableIdentityLookup:!0},requestParams:{f:"json"}},w=function(a){function c(d){a[d]||
(a[d]=function(){var c=arguments;return g.when(a,function(a){Array.prototype.unshift.call(c,a.results||a);return w(b[d].apply(b,c))})})}if(!a)return a;a.then&&(a=d.delegate(a));a.total||(a.total=g.when(a,function(a){return l.isDefined(a.total)?a.total:a.length||0}));c("forEach");c("filter");c("map");c("some");c("every");return a},k={useSSL:function(a,b){var c=q&&q.self||{};if(c&&!c.isPortal)return-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b;var d=k.getLocation(b);if(-1<c.portalHostname.toLowerCase().indexOf(d.hostname.toLowerCase())&&
d.port&&"80"!==d.port&&"443"!==d.port){var h=d.pathname,h=0===h.indexOf("/")?h:"/"+h;return c.allSSL||-1<a.indexOf("https:")?"https://"+d.hostname+(c.httpsPort&&"443"!==c.httpsPort?":"+c.httpsPort:"")+h+d.search:"http://"+d.hostname+(c.httpPort&&"80"!==c.httpPort?":"+c.httpPort:"")+h+d.search}return-1!==a.indexOf("https:")||c.allSSL?b.replace("http:","https:"):b},formatUrl:function(a){var b=q.currentToken;return-1!==a.indexOf("null")?null:k.useSSL(window.location.protocol,b?a+(-1!==a.indexOf("?")?
"\x26":"?")+("token\x3d"+b):a)},getLocation:function(a){var b=document.createElement("a");b.href=a;return{protocol:b.protocol,hostname:b.hostname,port:b.port,pathname:b.pathname,search:b.search,hash:b.hash,host:b.host}},resultsToTypedArray:function(a,c,f){f=f?f.listings||f.notifications||f.userInvitations||f.tags||f.items||f.groups||f.comments||f.provisions||f.results||f:[];return b.map(f,function(b){b=d.mixin(b,c||{});return a?new a(b):b})},clearFieldsFromObject:function(a,b){var c,h=a.length;if(d.isArray(a))for(c=
0;c<h;c++)delete b[a[c]];else for(c in a)delete b[c];return b},requestToTypedArray:function(a,b,c,h,e){return w(k.request(a,b,c).then(d.partial(k.resultsToTypedArray,h,e)))},request:function(a,b,c){var h;b&&b.portal&&delete b.portal;b&&b.form&&(h=b.form,delete b.form);b=d.mixin(d.mixin({},b||{}),q.requestParams);c=d.mixin(c||{},q.options);return e({url:k.useSSL(window.location.protocol,a.url||a),content:b,callbackParamName:"callback",timeout:c&&c.timeout||0,form:h},c)},formatQueryParams:function(a,
b,c){a=d.mixin(d.mixin({},a),d.isString(b)?{q:b}:b||{});a.q=!c&&q.extraQuery?"("+a.q+")"+q.extraQuery:a.q;return a}},v=m([],{declaredClass:"esri.arcgis.PortalComment",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/comments/"+this.id;this.created=this.created?new Date(this.created):null}}),A=m([],{declaredClass:"esri.arcgis.PortalRating",constructor:function(a){d.mixin(this,a);this.url=this.item.itemUrl+"/rating";this.created=this.created?new Date(this.created):null}}),h=m([],
{declaredClass:"esri.arcgis.PortalItem",constructor:function(a){d.mixin(this,a);this.folderId=this.ownerFolder||this.folderId;this.itemUrl=(this.portal&&this.portal.portalUrl)+"content/items/"+this.id;this.userItemUrl=this.hasOwnProperty("ownerFolder")?this.itemUrl.replace("content","content/users/"+this.owner+(this.folderId?"/"+this.folderId:"")):null;this.itemDataUrl=k.formatUrl(this.itemUrl+"/data");this.thumbnailUrl=k.formatUrl(this.itemUrl+"/info/"+this.thumbnail);this.displayName=this._getDisplayName();
this.iconUrl=this._getIconUrl();this.isPremiumContent=this._getIsPremiumContent();this.created=this.created?new Date(this.created):null;this.uploaded=this.uploaded?new Date(this.uploaded):null;this.modified=this.modified?new Date(this.modified):null},getTypeInfo:function(){var a=this.type;return{source:-1<b.indexOf(this.typeKeywords||[],"ArcGIS Server")||"Feature Collection"===a?a:null,displayName:this.displayName,iconUrl:this.iconUrl,isPremiumContent:this.isPremiumContent,premiumIconUrl:this._getPremiumIconUrl()}},
addComment:function(a){var b=d.isString(a)?{comment:a}:a;return k.request(this.itemUrl+"/addComment",b,{usePost:!0}).then(d.hitch(this,function(a){return new v(d.mixin(b,{id:a.commentId,item:this}))}))},updateComment:function(a){if(a&&a.url&&a.comment)return k.request(a.url+"/update",{comment:a.comment},{usePost:!0}).then(function(b){a.id=b.commentId;return a});throw Error();},getComments:function(){return k.requestToTypedArray(this.itemUrl+"/comments",null,null,v,{item:this})},deleteComment:function(a){if(a&&
a.url)return k.request(a.url+"/delete",null,{usePost:!0});throw Error();},addRating:function(a){var b=d.isObject(a)?a:{rating:parseFloat(a)};return k.request(this.itemUrl+"/addRating",b,{usePost:!0}).then(d.hitch(this,function(a){return new A(d.mixin(b,{id:a.ratingId,item:this}))}))},getRating:function(){return k.request(this.itemUrl+"/rating").then(d.hitch(this,function(a){return new A(d.mixin(a,{item:this}))}))},deleteRating:function(){return k.request(this.itemUrl+"/deleteRating",null,{usePost:!0})},
_getDisplayName:function(){var a=this.type,c=this.typeKeywords||[],d=a;"Feature Service"===a||"Feature Collection"===a?d=-1<b.indexOf(c,"Table")?"Table":"Feature Layer":"Image Service"===a?d=-1<b.indexOf(c,"Elevation 3D Layer")?"Elevation Layer":"Imagery Layer":"Scene Service"===a?d="Scene Layer":"Stream Service"===a?d="Feature Layer":"Microsoft Powerpoint"===a?d="Microsoft PowerPoint":"GeoJson"===a?this.type=d="GeoJSON":"Globe Service"===a?d="Globe Layer":"Vector Tile Service"===a?d="Tile Layer":
"Map Service"===a?d=-1<b.indexOf(c,"Hosted Service")||-1<b.indexOf(c,"Tiled")?"Tile Layer":"Map Image Layer":a&&-1<a.toLowerCase().indexOf("add in")&&(d=a.replace(/(add in)/ig,"Add-In"));return d},_getIconUrl:function(){var a=this.type&&this.type.toLowerCase()||"",c=this.typeKeywords||[],d=!1,h=!1;0<a.indexOf("service")||"feature collection"===a||"kml"===a||"wms"===a||"wmts"===a?(d=-1<b.indexOf(c,"Hosted Service"),a="feature service"===a||"feature collection"===a||"kml"===a?(h=-1<b.indexOf(c,"Table"))?
"table":d?"featureshosted":"features":"map service"===a||"wms"===a||"wmts"===a?d||-1<b.indexOf(c,"Tiled")?"maptiles":"mapimages":"scene service"===a?"sceneweblayer":"image service"===a?-1<b.indexOf(c,"Elevation 3D Layer")?"elevationlayer":"imagery":"stream service"===a?"streamlayer":"vector tile service"===a?"vectortile":"datastore catalog service"===a?"datastorecollection":"layers"):a="web map"===a||"cityengine web scene"===a?"maps":"web scene"===a?-1<b.indexOf(c,"ViewingMode-Local")?"webscenelocal":
"websceneglobal":"web mapping application"===a||"mobile application"===a||"application"===a||"operation view"===a||"desktop application"===a?"apps":"map document"===a||"map package"===a||"published map"===a||"scene document"===a||"globe document"===a||"basemap package"===a||"mobile basemap package"===a||"mobile map package"===a||"project package"===a||"project template"===a||"pro map"===a||"layout"===a||"layer"===a&&-1<b.indexOf(c,"ArcGIS Pro")||"explorer map"===a&&b.indexOf(c,"Explorer Document")?
"mapsgray":"service definition"===a||"csv"===a||"shapefile"===a||"cad drawing"===a||"geojson"===a?"datafiles":"explorer add in"===a||"desktop add in"===a||"windows viewer add in"===a||"windows viewer configuration"===a?"appsgray":"rule package"===a||"file geodatabase"===a||"csv collection"===a||"kml collection"===a||"windows mobile package"===a||"map template"===a||"desktop application template"===a||"arcpad package"===a||"code sample"===a||"form"===a||"document link"===a||"tile package"===a||"vector tile package"===
a||"scene package"===a||"operations dashboard add in"===a||"rules package"===a||"image"===a||"workflow manager package"===a||"desktop style"===a||"explorer map"===a&&-1<b.indexOf(c,"Explorer Mapping Application")||-1<b.indexOf(c,"Document")?"datafilesgray":"geocoding service"===a||"network analysis service"===a||"geoprocessing service"===a||"geodata service"===a||"geometry service"===a||"geoprocessing package"===a||"locator package"===a||"geoprocessing sample"===a||"workflow manager service"===a||
"raster function template"===a?"toolsgray":"layer"===a||"layer package"===a||"explorer layer"===a?"layersgray":"task file"===a?"taskfile":"report template"===a?"report-template":"maps";return a?u.toUrl("../css/images/item_type_icons/"+a+"16.png"):null},_getIsPremiumContent:function(){var a=this.typeKeywords,c=!1;if(-1<b.indexOf(a,"Service")&&(-1<b.indexOf(a,"Requires Subscription")||-1<b.indexOf(this.typeKeywords,"Requires Credits")))c=!0;return c},_getPremiumIconUrl:function(){var a=this.typeKeywords,
c;this.isPremiumContent&&(c=-1<b.indexOf(a,"Requires Credits")?"premiumcredits":"premiumitem");return c?u.toUrl("../css/images/item_type_icons/"+c+"16.png"):null}}),y=m([],{declaredClass:"esri.arcgis.PortalListing",constructor:function(a){d.mixin(this,a);this.id=this.itemId;this.url=(this.portal&&this.portal.portalUrl)+"content/"+(this.userItemUrl?"items/":"listings/")+this.itemId;this.commentsUrl=this.url+"/comments";this.created=this.created?new Date(this.created):null;this.banner=this.banner?k.formatUrl(this.url+
"/info/"+this.banner):"";this.thumbnail=this.thumbnail?k.formatUrl(this.url+"/info/"+this.thumbnail):"";this.largeThumbnail=this.largeThumbnail?k.formatUrl(this.url+"/info/"+this.largeThumbnail):"";this.avgRating=this.avgRating||0;this.numRatings=this.numRatings||0;this.numComments=this.numComments||0;this.listingProperties=this.listingProperties||{priceDesc:"",creditsPerTransaction:0,licenseType:"free",trialSupported:!1,trialDuration:0,listingAccess:"private"};for(var c in this.listingProperties)this[c]&&
(this.listingProperties[c]=this[c]);this.properties=this.properties||{systemRequirements:"",termsAndConditions:"",version:"1.0"};this.screenshots=b.map(this.screenshots,d.hitch(this,function(a){return k.formatUrl(this.url+"/info/"+a)}));this.vendorName=this.vendor.name;this.vendor.thumbnail=this.vendor.thumbnail?this.userItemUrl?k.formatUrl(this.portal.portalUrl+"/portals/self/resources/"+this.vendor.thumbnail):k.formatUrl(this.url+"/vendorinfo/"+this.vendor.thumbnail):""},getComments:function(){return k.requestToTypedArray(this.commentsUrl,
null,null,v,{item:this})},getVendor:function(){return this.vendor}}),B=m([],{declaredClass:"esri.arcgis.PortalProvision",constructor:function(a){d.mixin(this,a);this.created=this.created?new Date(this.created):null;this.startDate=this.startDate?new Date(this.startDate):null;this.endDate=this.endDate&&-1!==this.endDate?new Date(this.endDate):null;this.listing=a.listing?new y(d.mixin(a.listing,{portal:this.portal})):null}}),C=m([],{declaredClass:"esri.arcgis.PortalGroup",constructor:function(a){d.mixin(this,
a);this.url=(this.portal&&this.portal.portalUrl)+"community/groups/"+this.id;this.thumbnailUrl=k.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getMembers:function(){return k.request(this.url+"/users")},queryItems:function(a,b){a=k.formatQueryParams({},a,b);a.q="group:"+this.id+(a.q?" "+a.q:"");return this.portal.queryItems(a)}}),D=m([],{declaredClass:"esri.arcgis.PortalFolder",constructor:function(a){d.mixin(this,
a);this.url=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username+"/"+this.id;this.created=this.created?new Date(this.created):null},getItems:function(){return k.requestToTypedArray(this.url,null,null,h,{portal:this.portal,folderId:this.id})}}),F=m([],{declaredClass:"esri.arcgis.PortalUser",constructor:function(a){d.mixin(this,a);this.url=(this.portal&&this.portal.portalUrl)+"community/users/"+this.username;this.userContentUrl=(this.portal&&this.portal.portalUrl)+"content/users/"+this.username;
this.thumbnailUrl=k.formatUrl(this.url+"/info/"+this.thumbnail);this.modified=this.modified?new Date(this.modified):null;this.created=this.created?new Date(this.created):null},getGroups:function(){return w(k.request(this.url).then(d.hitch(this,function(a){return k.resultsToTypedArray(C,{portal:this.portal},a.groups)})))},getNotifications:function(){return k.requestToTypedArray(this.url+"/notifications",null,null,null,{portal:this.portal})},getGroupInvitations:function(){return k.requestToTypedArray(this.url+
"/invitations",null,null,null,{portal:this.portal})},getTags:function(){return k.requestToTypedArray(this.url+"/tags",null,null,null,{portal:this.portal})},getFolders:function(){return w(this.getContent().then(function(a){return a.folders}))},getItems:function(a){return w(this.getContent(a).then(function(a){return a.items}))},getItem:function(a){return k.request(this.portal.portalUrl+"content/items/"+a).then(d.hitch(this,function(a){return new h(d.mixin(a,{portal:this.portal}))}))},getContent:function(a){var b=
this.url.replace("community","content")+(a?"/"+a:"");return k.request(b).then(d.hitch(this,function(b){b.folders=k.resultsToTypedArray(D,{portal:this.portal},b.folders);b.items=k.resultsToTypedArray(h,{portal:this.portal,folderId:a},b.items);return b}))}});return{Portal:m([r],{declaredClass:"esri.arcgis.Portal",onLoad:function(){},onError:function(){},constructor:function(a){a=d.isObject(a)?a:{url:a};this.registerConnectEvents();q={options:{disableIdentityLookup:!0},requestParams:{f:"json"}};a.self?
(q.self=a.self,d.mixin(this,{url:a.url||window.location.protocol+"//"+(a.self.urlKey?a.self.urlKey+"."+a.self.customBaseUrl:a.self.portalHostname)}),this.portalUrl=-1!==this.url.indexOf("/sharing")?this.url+"/":this.url+"/sharing/rest/",a=a.self.user?this.signIn():this.init(this.url)):(a.url&&d.mixin(this,{url:a.url}),a=this.init(this.url));a.then(d.hitch(this,function(){this.emit("ready",this);this.onLoad(this)}))},init:function(a,b){a=(a||this.portalUrl).replace(/\/+$/,"");this.portalUrl=-1!==a.indexOf("/sharing")?
a+"/":a+"/sharing/rest/";return this._getSelf(this.portalUrl).then(d.hitch(this,function(a){q.self=d.mixin({},a);if((a=a.user)&&b)q.currentToken=b&&b.token,q.loggedInUser=new F(d.mixin(a,{portal:this,credential:b}));q.self.id&&!1===q.self.canSearchPublic&&(q.extraQuery=" AND orgid:"+q.self.id);d.mixin(this,q.self);this.thumbnailUrl=k.formatUrl(this.portalUrl+"portals/self/resources/"+this.thumbnail);this.isOrganization=this.access&&this.access.length||!1;this.created=this.created?new Date(this.created):
null;this.modified=this.modified?new Date(this.modified):null;return this}),d.hitch(this,function(a){this.onError(a);throw a;}))},signIn:function(){var a=new g,b=d.hitch(this,function(){this._onSignIn().then(d.hitch(this,function(){a.resolve(q.loggedInUser)}),d.hitch(this,function(b){a.reject(b)}))});if(!q||!q.self)this.on("load",d.hitch(this,function(){b()}));else q&&q.loggedInUser?setTimeout(function(){a.resolve(q.loggedInUser)},0):b();return a},signOut:function(){q.loggedInUser.credential&&q.loggedInUser.credential.destroy();
q.loggedInUser=null;q.options.disableIdentityLookup=!0;k.clearFieldsFromObject(q.self,this);q.self=null;return this.init(this.url)},getPortalUser:function(){return q.loggedInUser},addResource:function(a,b){return k.request(this.portalUrl+"portals/self/addResource",{key:a,text:b},{usePost:!0})},update:function(a){return k.request(this.portalUrl+"portals/self/update",a,{usePost:!0})},queryGroups:function(a,b){return this._queryPortal(this.portalUrl+"community/groups",k.formatQueryParams({},a,b),C)},
queryItems:function(a,b){return this._queryPortal(this.portalUrl+"search",k.formatQueryParams({},a,b),h)},queryListings:function(a){a=k.formatQueryParams({},a,!0);var b="";a.q&&-1<a.q.toLowerCase().indexOf("mylistings:true")?(a.q=a.q.toLowerCase().replace("mylistings:true",""),b="?mylistings\x3dtrue"):a.q||(a.q='""');return this._queryPortal(this.portalUrl+"content/listings"+b,a,y)},queryCustomerList:function(a,b){var c=k.formatQueryParams({},a,!0);return this._queryPortal(this.portalUrl+"portals/self/customersList",
c)},getProvisions:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.purchases}))},getInterests:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.interests}))},getTrials:function(){return this.getCustomers().then(d.hitch(this,function(a){return a.trials}))},getCustomers:function(a){return k.request(this.portalUrl+"portals/self/customers",{status:a||"all"})},getMyPurchases:function(){return this.getPurchases().then(function(a){return a.purchases})},
getMyInterests:function(){return this.getPurchases().then(function(a){return a.interests})},getPurchases:function(){return k.request(this.portalUrl+"portals/self/purchases").then(d.hitch(this,function(a){a.interests=b.map(a.interests,function(a){return d.mixin(a.provision,{listing:a.listing})});a.purchases=b.map(a.purchases,function(a){return d.mixin(a.provision,{listing:a.listing})});a.trials=b.map(a.trials,function(a){return d.mixin(a.provision,{listing:a.listing})});a.interests=k.resultsToTypedArray(B,
{portal:this},a.interests);a.trials=k.resultsToTypedArray(B,{portal:this},a.trials);a.purchases=k.resultsToTypedArray(B,{portal:this},a.purchases);return a}))},queryUsers:function(a,b){return this._queryPortal(this.portalUrl+"community/users",k.formatQueryParams({sortField:"username"},a,b),F)},_onSignIn:function(){q.options.disableIdentityLookup=!1;if(!q.self||!q.self.user)q.self=null;return n.id.getCredential(this.portalUrl).then(d.hitch(this,"init",this.url)).then(function(){return q.loggedInUser},
d.hitch(this,function(a){q.options.disableIdentityLookup=!0;this.onError(a);throw a;}))},_getSelf:function(a){var b;a+="portals/self";q.self?(b=new g,setTimeout(function(){b.resolve(q.self)},0)):b=k.request(a,{culture:p.locale});return b},_queryPortal:function(a,b,c){var h=d.mixin({num:10,start:0,sortField:"title",sortOrder:"asc"},b),e=["start","query","num","nextStart"];a=k.request(a,h).then(d.hitch(this,function(a){a.results=k.resultsToTypedArray(c,{portal:this},a);a.queryParams=d.mixin({},h);a.nextQueryParams=
d.mixin(h,{start:a.nextStart});return k.clearFieldsFromObject(e,a)}));a=d.delegate(a);a.queryParams=d.mixin({},h);a.nextQueryParams=g.when(a,function(a){return a.nextQueryParams});return w(a)}}),PortalFolder:D,PortalGroup:C,PortalItem:h,PortalComment:v,PortalRating:A,PortalUtil:k,PortalResult:w,PortalListing:y}})},"esri/dijit/_RefreshMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/has ../kernel".split(" "),function(m,d,p,g,b,c){function u(b){"object"!==
typeof b&&(b=Error(b));b.grid=this;g.emit(this.domNode,"dgrid-error",{grid:this,error:b,cancelable:!0,bubbles:!0})&&console.error(b)}return m(null,{_trackError:function(b){var c;"string"===typeof b&&(b=d.hitch(this,b));try{c=b()}catch(e){u.call(this,e)}return p.when(c,d.hitch(this,function(){g.emit(this.domNode,"refresh",{cancelable:!0,bubbles:!0})}),d.hitch(this,u))}})})},"esri/dijit/analysis/PluginAnalysisLayers":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/promise/all dojo/has ../../kernel".split(" "),
function(m,d,p,g,b,c){var u=m(null,{constructor:function(b){d.mixin(this,b)},fetchData:function(){this._portal=this.parent._portal;var b;return this._fetchGroups().then(d.hitch(this,function(c){b=p.map(c||[],function(b){if(b)return'group:"'+b.id+'"'}).join(" OR ");return this._fetchGroupItems(b)}))},_fetchGroup:function(b,c){this._groups=this._groups||[];return this._groups[b]||this._portal.queryGroups(c,!0).then(d.hitch(this,function(c){0<c.total&&c.results&&(this._groups[b]=c.results);return this._groups[b]||
[]}))},_fetchGroupItems:function(b,c){var d='(type:"Map Service" OR type:"Feature Service") typekeywords:"Analysis Ready" ('+b+")"+(c?" "+c:"");this._portal.user.demographics||(d+=' -typekeywords:"Requires Credits"');return this.parent._fetchItems(d)},_fetchGroups:function(){return this._fetchEsriAnalysisLayers()},_fetchEsriAnalysisLayers:function(){var b;this._portal&&this._portal.livingAtlasGroupQuery&&(b=this._portal.livingAtlasGroupQuery.replace('title:"Featured Maps And Apps"','title:"Living Atlas Analysis Layers"'));
return this._fetchGroup("esriAnalysisLayers",{q:b,num:100,start:0}).then(d.hitch(this,function(b){return b}))}});d.mixin(u,{add:function(b,c){if(!b.plugIn){var d=c||{};d.parent=b;b.plugIn=new u(d)}},remove:function(b){b.plugIn&&(b.plugIn.destroy(),delete b.plugIn)}});return u})},"esri/tasks/Geoprocessor":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has dojo/io-query ../kernel ../request ../deferredUtils ../geometry/normalizeUtils ./Task ./FeatureSet ./JobInfo ./GPMessage ./LinearUnit ./DataFile ./RasterData ./Date ./ParameterValue ./GPResultImageLayer ../layers/ArcGISDynamicMapServiceLayer ../layers/MapImage".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a){m=m(q,{declaredClass:"esri.tasks.Geoprocessor",_eventMap:{"execute-complete":["results","messages"],"get-result-data-complete":["result"],"get-result-image-complete":["mapImage"],"get-result-image-layer-complete":["layer"],"job-cancel":["jobInfo"],"job-complete":["jobInfo"],"status-update":["jobInfo"]},constructor:function(a){this._jobUpdateHandler=d.hitch(this,this._jobUpdateHandler);this._getJobStatus=d.hitch(this,this._getJobStatus);this._getResultDataHandler=
d.hitch(this,this._getResultDataHandler);this._getResultImageHandler=d.hitch(this,this._getResultImageHandler);this._executeHandler=d.hitch(this,this._executeHandler);this._updateTimers=[];this.registerConnectEvents()},updateDelay:1E3,processSpatialReference:null,outputSpatialReference:null,outSpatialReference:null,setUpdateDelay:function(a){this.updateDelay=a},setProcessSpatialReference:function(a){this.processSpatialReference=a},setOutputSpatialReference:function(a){this._setOutSR(a)},setOutSpatialReference:function(a){this._setOutSR(a)},
__msigns:[{n:"execute",c:3,a:[{i:0,p:["*"]}],e:2,f:1},{n:"submitJob",c:4,a:[{i:0,p:["*"]}],e:3}],_setOutSR:function(a){this.outSpatialReference=this.outputSpatialReference=a},_getOutSR:function(){return this.outSpatialReference||this.outputSpatialReference},_gpEncode:function(a,c,h){for(var e in a){var k=a[e];d.isArray(k)?a[e]=b.toJson(p.map(k,function(a){return this._gpEncode({item:a},!0).item},this)):k instanceof Date&&(a[e]=k.getTime())}return this._encode(a,c,h)},_decode:function(b){var c=b.dataType,
e=new C(b);if(-1!==p.indexOf(["GPBoolean","GPDouble","GPLong","GPString"],c))return e;if("GPLinearUnit"===c)e.value=new A(e.value);else if("GPFeatureRecordSetLayer"===c||"GPRecordSet"===c)e.value=new w(e.value);else if("GPDataFile"===c)e.value=new h(e.value);else if("GPDate"===c)b=e.value,d.isString(b)?e.value=new B({date:b}):e.value=new Date(b);else if("GPRasterData"===c||"GPRasterDataLayer"===c)b=b.value.mapImage,e.value=b?new a(b):new y(e.value);else if(-1!==c.indexOf("GPMultiValue:")){var k=c.split(":")[1];
b=e.value;e.value=p.map(b,function(a){return this._decode({paramName:"_name",dataType:k,value:a}).value},this)}else console.log(this.declaredClass+" : GP Data type not handled. : "+e.dataType),e=null;return e},submitJob:function(a,c,h,e,k){var g=this._getOutSR(),r=k.assembly;a=this._gpEncode(d.mixin({},this._url.query,{f:"json","env:outSR":g?g.wkid||b.toJson(g.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||b.toJson(this.processSpatialReference.toJson()):
null},a),null,r&&r[0]);var n=this._jobUpdateHandler,q=this._errorHandler;return l({url:this._url.path+"/submitJob",content:a,callbackParamName:"callback",load:function(a,b){n(a,b,!1,c,h,k.dfd)},error:function(a){q(a,e,k.dfd)}})},_jobUpdateHandler:function(a,b,c,d,h,e){var l=a.jobId;b=new k(a);this._successHandler([b],"onStatusUpdate",h,c&&e);if(!c)switch(clearTimeout(this._updateTimers[l]),this._updateTimers[l]=null,e&&e.progress(b),a.jobStatus){case k.STATUS_SUBMITTED:case k.STATUS_EXECUTING:case k.STATUS_WAITING:case k.STATUS_NEW:var g=
this._getJobStatus;this._updateTimers[l]=setTimeout(function(){g(l,c,d,h,e)},this.updateDelay);break;default:this._successHandler([b],"onJobComplete",d,e)}},_getJobStatus:function(a,b,c,h,e){var k=this._jobUpdateHandler;l({url:this._url.path+"/jobs/"+a,content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,d){k(a,d,b,c,h,e)},error:this._errorHandler})},_getResultDataHandler:function(a,b,c,d,h){try{var e=this._decode(a);this._successHandler([e],"onGetResultDataComplete",
c,h)}catch(k){this._errorHandler(k,d,h)}},getResultData:function(a,b,c,h){var k=this._getResultDataHandler,r=this._errorHandler,n=new g(e._dfdCanceller);n._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/results/"+b,content:d.mixin({},this._url.query,{f:"json",returnType:"data"}),callbackParamName:"callback",load:function(a,b){k(a,b,c,h,n)},error:function(a){r(a,h,n)}});return n},checkJobStatus:function(a,b,c){var h=this._jobUpdateHandler,k=this._errorHandler,r=new g(e._dfdCanceller);r._pendingDfd=
l({url:this._url.path+"/jobs/"+a,content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:function(a,c){h(a,c,!0,null,b,r)},error:function(a){k(a,c,r)}});return r},cancelJob:function(a,b,c){var h=this._errorHandler,k=new g(e._dfdCanceller);k._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/cancel",content:d.mixin({},this._url.query,{f:"json"}),callbackParamName:"callback",load:d.hitch(this,function(a,c){this._successHandler([a],"onJobCancel",b,k)}),error:function(a){h(a,c,k)}});
return k},execute:function(a,c,h,e){var k=this._getOutSR(),g=e.assembly;a=this._gpEncode(d.mixin({},this._url.query,{f:"json","env:outSR":k?k.wkid||b.toJson(k.toJson()):null,"env:processSR":this.processSpatialReference?this.processSpatialReference.wkid||b.toJson(this.processSpatialReference.toJson()):null},a),null,g&&g[0]);var r=this._executeHandler,n=this._errorHandler;return l({url:this._url.path+"/execute",content:a,callbackParamName:"callback",load:function(a,b){r(a,b,c,h,e.dfd)},error:function(a){n(a,
h,e.dfd)}})},_executeHandler:function(a,b,c,d,h){try{var e=a.results,k,l,g=a.messages;k=0;for(l=e.length;k<l;k++)e[k]=this._decode(e[k]);k=0;for(l=g.length;k<l;k++)g[k]=new v(g[k]);this._successHandler([e,g],"onExecuteComplete",c,h)}catch(r){this._errorHandler(r,d,h)}},_getResultImageHandler:function(a,b,c,d,h){try{var e=this._decode(a);this._successHandler([e],"onGetResultImageComplete",c,h)}catch(k){this._errorHandler(k,d,h)}},getResultImage:function(a,b,c,h,k){var r=this._getResultImageHandler,
n=this._errorHandler;c=this._gpEncode(d.mixin({},this._url.query,{f:"json"},c.toJson()));var q=new g(e._dfdCanceller);q._pendingDfd=l({url:this._url.path+"/jobs/"+a+"/results/"+b,content:c,callbackParamName:"callback",load:function(a,b){r(a,b,h,k,q)},error:function(a){n(a,k,q)}});return q},cancelJobStatusUpdates:function(a){clearTimeout(this._updateTimers[a]);this._updateTimers[a]=null},getResultImageLayer:function(a,b,c,d){if(null==b){var h=this._url.path.indexOf("/GPServer/");a=this._url.path.substring(0,
h)+"/MapServer/jobs/"+a}else a=this._url.path+"/jobs/"+a+"/results/"+b;this._url.query&&(a+="?"+u.objectToQuery(this._url.query));b=null==b?new F(a,{imageParameters:c}):new D(a,{imageParameters:c},!0);this.onGetResultImageLayerComplete(b);d&&d(b);return b},onStatusUpdate:function(){},onJobComplete:function(){},onExecuteComplete:function(){},onGetResultDataComplete:function(){},onGetResultImageComplete:function(){},onGetResultImageLayerComplete:function(){},onJobCancel:function(){}});r._createWrappers(m);
return m})},"esri/tasks/LinearUnit":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){return m(null,{declaredClass:"esri.tasks.LinearUnit",constructor:function(b){b&&d.mixin(this,b)},distance:0,units:null,toJson:function(){var b={};this.distance&&(b.distance=this.distance);this.units&&(b.units=this.units);return b}})})},"esri/tasks/DataFile":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){return m(null,
{declaredClass:"esri.tasks.DataFile",constructor:function(b){b&&d.mixin(this,b)},url:null,itemID:null,toJson:function(){var b={};this.url&&(b.url=this.url);this.itemID&&(b.itemID=this.itemID);return b}})})},"esri/tasks/RasterData":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){return m(null,{declaredClass:"esri.tasks.RasterData",constructor:function(b){b&&d.mixin(this,b)},url:null,format:null,itemID:null,toJson:function(){var b={};this.url&&(b.url=
this.url);this.format&&(b.format=this.format);this.itemID&&(b.itemID=this.itemID);return b}})})},"esri/tasks/Date":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/date/locale","dojo/has","../kernel"],function(m,d,p,g,b){return m(null,{declaredClass:"esri.tasks.Date",constructor:function(b){b&&(b.format&&(this.format=b.format),this.date=p.parse(b.date,{selector:"date",datePattern:this.format}))},date:new Date,format:"EEE MMM dd HH:mm:ss zzz yyyy",toJson:function(){return{date:p.format(this.date,
{selector:"date",datePattern:this.format}),format:this.format}}})})},"esri/tasks/ParameterValue":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){return m(null,{declaredClass:"esri.tasks.ParameterValue",constructor:function(b){d.mixin(this,b)}})})},"esri/tasks/GPResultImageLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has dojo/io-query ../kernel ../layers/ArcGISDynamicMapServiceLayer".split(" "),function(m,d,p,
g,b,c,u){return m(u,{declaredClass:"esri.tasks._GPResultImageLayer",constructor:function(b,c){c&&(c.imageParameters&&c.imageParameters.extent)&&(this.initialExtent=this.fullExtent=c.imageParameters.extent,this.spatialReference=this.initialExtent.spatialReference);this.getImageUrl=d.hitch(this,this.getImageUrl);this.loaded=!0;this.onLoad(this)},getImageUrl:function(c,l,e,g){var q=c.spatialReference.wkid;g(this._url.path+"?"+b.objectToQuery(d.mixin(this._params,{f:"image",bbox:p.toJson(c.toJson()),
bboxSR:q,imageSR:q,size:l+","+e})))}})})},"esri/dijit/SingleFilter":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/has dojo/json dojo/string dojo/number dojo/dom dojo/dom-style dojo/dom-attr dojo/dom-construct dojo/query dojo/dom-class dojo/_base/event dojo/Evented dojo/data/ItemFileWriteStore dojo/date/locale dojo/parser dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_OnDijitClickMixin dijit/_FocusMixin dijit/registry dijit/form/TextBox dijit/form/FilteringSelect dijit/form/RadioButton dijit/form/DateTextBox dijit/form/NumberTextBox ../kernel ../lang ../tasks/GenerateRendererTask ../tasks/UniqueValueDefinition ../tasks/GenerateRendererParameters ../layers/FeatureLayer ../layers/GeoRSSLayer dojo/i18n!../nls/jsapi dojo/text!./templates/SingleFilter.html".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a,t,f,G,x,z,I,L,J,H,M,E,K,O,P,N,U,Q,R){return d([F,a,t,f,G,y],{declaredClass:"esri.dijit.SingleFilter",widgetsInTemplate:!0,templateString:R,valueHandlers:[],onFieldChangeEnabled:!0,onOperatorChangeEnabled:!0,onPromptChangeHandler:null,onHintChangeHandler:null,fieldDomains:{},fieldsStore:null,fieldsInfo:{stringFieldsCount:0,numberFieldsCount:0,dateFieldsCount:0},stringOperatorStore:null,dateOperatorStore:null,numberOperatorStore:null,uniqueValuesStore:null,
isEnableInteractiveFilter:!0,uniqueValuesResults:{},partsObj:null,dayInMS:86399E3,allowAllDateTypes:!1,postMixInProperties:function(){this.inherited(arguments);this.i18n={};this.i18n=p.mixin(this.i18n,Q.filterDlg)},parseExpressionTemplate:function(){var a=function(a,s){r.byId(s).className="attributeValueContainer";"field_dropdown"===a?r.byId(s).innerHTML=b:"operator_dropdown"===a?r.byId(s).innerHTML=c:"values_input"===a?r.byId(s).innerHTML=d+h:console.error("problem with expressionTemplate from localization file")},
b='\x3cselect id\x3d"'+this.id+'.fieldsList" class\x3d"attributeField" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"true"\x3e\x3c/select\x3e',c='\x3cselect id\x3d"'+this.id+'.operatorList" class\x3d"operator" data-dojo-type\x3d"dijit/form/FilteringSelect" maxHeight\x3d"150" sortByLabel\x3d"false"\x3e\x3c/select\x3e',d='\x3cdiv id\x3d"'+this.id+'.attributeValueContainer"\x3e\x3c/div\x3e',h='\x3cdiv class\x3d"attributeValueOptions"\x3e\x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e  \x3ctbody\x3e    \x3ctr\x3e      \x3ctd nowrap\x3d"nowrap"\x3e        \x3cinput id\x3d"'+
this.id+'.radioValue" class\x3d"radioValue attributeValueRadio" checked\x3d"checked" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.valueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.valueTooltip+'"\x3e'+this.i18n.value+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioFields" class\x3d"radioFields attributeValueRadio" name\x3d"'+
this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+this.i18n.fieldTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.fieldTooltip+'"\x3e'+this.i18n.field+'        \x3c/label\x3e      \x3c/td\x3e      \x3ctd id\x3d"'+this.id+'.radioUniqueColumn" nowrap\x3d"nowrap" class\x3d"esriLeadingPadding05"\x3e        \x3cinput id\x3d"'+this.id+'.radioUnique" class\x3d"radioUnique attributeValueRadio" name\x3d"'+this.id+'.inputOption" data-dojo-type\x3d"dijit/form/RadioButton" title\x3d"'+
this.i18n.uniqueValueTooltip+'"/\x3e        \x3clabel class\x3d"labels" title\x3d"'+this.i18n.uniqueValueTooltip+'"\x3e'+this.i18n.uniqueValues+"        \x3c/label\x3e      \x3c/td\x3e    \x3c/tr\x3e  \x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e",e=this.i18n.expressionTemplate,k=e.indexOf("${"),f=e.substring(0,k).trim();r.byId(this.id+".column1").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";var f=e.indexOf("}",k+1),l=e.substring(k+2,f);a(l,this.id+".column2");k=e.indexOf("${",
k+1);f=e.substring(f+1,k).trim();r.byId(this.id+".column3").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";f=e.indexOf("}",k+1);l=e.substring(k+2,f);a(l,this.id+".column4");k=e.indexOf("${",k+1);f=e.substring(f+1,k).trim();r.byId(this.id+".column5").innerHTML=f.length?"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":"";f=e.indexOf("}",k+1);l=e.substring(k+2,f);a(l,this.id+".column6");f=e.substring(f+1,e.length).trim();r.byId(this.id+".column7").innerHTML=f.length?
"\x3cdiv class\x3d'attributeText'\x3e"+f+"\x3c/div\x3e":""},postCreate:function(){this.inherited(arguments);this.parseExpressionTemplate();this.createOperatorStores();this.createFieldsStore(this.fields);this.readCodedValues();D.parse(r.byId(this.id+".exprTable")).then(p.hitch(this,function(a){b.connect(this.getFieldsList(),"onChange",this,"onChangeField");b.connect(this.getOperatorList(),"onChange",this,"onChangeOperator");b.connect(x.byId(this.id+".radioValue"),"onClick",this,"showValueInput");b.connect(x.byId(this.id+
".radioFields"),"onClick",this,"showFields");b.connect(x.byId(this.id+".radioUnique"),"onClick",this,"showUniqueList");this.version&&10.1>this.version&&q.set(r.byId(this.id+".radioUniqueColumn"),"display","none");b.connect(r.byId(this.id+".deleteExpression"),"onclick",this,"onClickDeleteExpression");b.connect(this.interactiveCheck,"onclick",this,"onInteractiveClick");b.connect(this.interactiveArrow,"onclick",this,"onClickShowHideInteractive");this.enableInteractiveHandlers();this.isEnableInteractiveFilter||
q.set(this._interactiveFilterRow,"display","none")}))},constructor:function(a,b){this.id=a.id||"";this.owner=a.owner;this.version=a.version;this.part=a.part;this.fields=a.fields;this.mapLayer=a.mapLayer;!1===a.enableEvents&&(this.onOperatorChangeEnabled=this.onFieldChangeEnabled=!1)},init:function(a){a.part||(this.clearAttributeValueDijits(),this.mapLayer=a.mapLayer,this.version=a.version,this.fields=a.fields,this.createOperatorStores(),this.createFieldsStore(this.fields),this.readCodedValues(),this.fillFieldsList(this.fieldsStore),
this.onChangeField());a.part&&(this.part=a.part,this.buildEditUIField(this.part,this))},destroy:function(){this.clearAttributeValueDijits();g.forEach(x.findWidgets(r.byId(this.id)),function(a){a.destroyRecursive()});this.inherited(arguments)},toJson:function(){var a=null;this.isInteractiveChecked()&&(a={prompt:this.promptText.attr("value"),hint:this.hintText.attr("value")});return{fieldObj:this.getField(),operator:this.getOperator(),valueObj:this.getValue(),interactiveObj:a}},buildFriendlyTextExpr:function(a){var b=
this.i18n.expressionTemplate,c=function(a,c,d){return l.substitute(b,{field_dropdown:a,operator_dropdown:c,values_input:d})};if(!1===a.valueObj.isValid)return"\x26lt;expression is missing value\x26gt;";var d="";if("string"===a.fieldObj.shortType)a.operator===this.i18n.stringOperatorIsBlank||a.operator===this.i18n.stringOperatorIsNotBlank?d=c(a.fieldObj.label,a.operator,""):"field"===a.valueObj.type?d=c(a.fieldObj.label,a.operator,a.valueObj.label):(d=this.getDecodedValue(a.interactiveObj?a.interactiveObj.value:
a.valueObj.value,a.fieldObj.name),d=c(a.fieldObj.label,a.operator,"'"+d+"'"));else if("number"===a.fieldObj.shortType)if(a.operator===this.i18n.numberOperatorIsBetween||a.operator===this.i18n.numberOperatorIsNotBetween)d=a.interactiveObj?a.interactiveObj.value2:a.valueObj.value2,d=c(a.fieldObj.label,a.operator,e.format(a.interactiveObj?a.interactiveObj.value1:a.valueObj.value1,{pattern:"#####0.##########"})+" "+this.i18n.andBetweenValues+" "+e.format(d,{pattern:"#####0.##########"}));else if(a.operator===
this.i18n.numberOperatorIsBlank||a.operator===this.i18n.numberOperatorIsNotBlank)d=c(a.fieldObj.label,a.operator,"");else if("field"===a.valueObj.type)d=c(a.fieldObj.label,a.operator,a.valueObj.label);else var d=a.interactiveObj?a.interactiveObj.value:a.valueObj.value,h=this.getDecodedValue(d,a.fieldObj.name),d=c(a.fieldObj.label,a.operator,d!==h?"'"+h+"'":e.format(d,{pattern:"#####0.##########"}));else E.isDefined(a.valueObj.value)&&("field"!==a.valueObj.type&&"string"===typeof a.valueObj.value)&&
(a.valueObj.value=new Date(a.valueObj.value)),d=a.operator===this.i18n.dateOperatorIsBetween||a.operator===this.i18n.dateOperatorIsNotBetween?c(a.fieldObj.label,a.operator,(a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value1):this.formatFriendlyDate(a.valueObj.value1))+" "+this.i18n.andBetweenValues+" "+(a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value2):this.formatFriendlyDate(this.addDay(a.valueObj.value2)))):a.operator===this.i18n.dateOperatorIsBlank||a.operator===this.i18n.dateOperatorIsNotBlank?
c(a.fieldObj.label,a.operator,""):"field"===a.valueObj.type?c(a.fieldObj.label,a.operator,a.valueObj.label):c(a.fieldObj.label,a.operator,a.interactiveObj?this.formatFriendlyDate(a.interactiveObj.value):this.formatFriendlyDate(a.valueObj.value));return d},builtSingleFilterString:function(a,b){if(E.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};var c=a.valueObj.value,d=a.valueObj.value1,h=a.valueObj.value2,e=!1;if(a.interactiveObj){if(!a.interactiveObj.prompt||!a.interactiveObj.hint)return{whereClause:null};
E.isDefined(b)&&(e=!0,E.isDefined(a.valueObj.value)&&(c="{"+b+"}"),E.isDefined(a.valueObj.value1)&&(d="{"+b+"}"),E.isDefined(a.valueObj.value2)&&(h="{"+(b+1)+"}"))}var f="";if("string"===a.fieldObj.shortType)switch(d="",c&&"field"!==a.valueObj.type&&this.isHostedService(this.mapLayer.url)&&this.containsNonLatinCharacter(c)&&(d="N"),a.operator){case this.i18n.stringOperatorIs:f="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:a.fieldObj.name+" \x3d "+d+"'"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorIsNot:f=
"field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:a.fieldObj.name+" \x3c\x3e "+d+"'"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorStartsWith:f=a.fieldObj.name+" LIKE "+d+"'"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorEndsWith:f=a.fieldObj.name+" LIKE "+d+"'%"+c.replace(/\'/g,"''")+"'";break;case this.i18n.stringOperatorContains:f=a.fieldObj.name+" LIKE "+d+"'%"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorDoesNotContain:f=a.fieldObj.name+
" NOT LIKE "+d+"'%"+c.replace(/\'/g,"''")+"%'";break;case this.i18n.stringOperatorIsBlank:f=a.fieldObj.name+" IS NULL";break;case this.i18n.stringOperatorIsNotBlank:f=a.fieldObj.name+" IS NOT NULL"}else if("number"===a.fieldObj.shortType)switch(a.operator){case this.i18n.numberOperatorIs:f=a.fieldObj.name+" \x3d "+c;break;case this.i18n.numberOperatorIsNot:f=a.fieldObj.name+" \x3c\x3e "+c;break;case this.i18n.numberOperatorIsAtLeast:f=a.fieldObj.name+" \x3e\x3d "+c;break;case this.i18n.numberOperatorIsLessThan:f=
a.fieldObj.name+" \x3c "+c;break;case this.i18n.numberOperatorIsAtMost:f=a.fieldObj.name+" \x3c\x3d "+c;break;case this.i18n.numberOperatorIsGreaterThan:f=a.fieldObj.name+" \x3e "+c;break;case this.i18n.numberOperatorIsBetween:f=a.fieldObj.name+" BETWEEN "+d+" AND "+h;break;case this.i18n.numberOperatorIsNotBetween:f=a.fieldObj.name+" NOT BETWEEN "+d+" AND "+h;break;case this.i18n.numberOperatorIsBlank:f=a.fieldObj.name+" IS NULL";break;case this.i18n.numberOperatorIsNotBlank:f=a.fieldObj.name+" IS NOT NULL"}else switch(E.isDefined(c)&&
("field"!==a.valueObj.type&&"string"===typeof c)&&(c=this.parseFriendlyDate(c)),a.operator){case this.i18n.dateOperatorIsOn:f="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+c:e?a.fieldObj.name+" BETWEEN '{"+b+"}' AND '{"+(b+1)+"}'":a.fieldObj.name+" BETWEEN '"+this.formatDate(c)+"' AND '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsNotOn:f="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+c:e?a.fieldObj.name+" NOT BETWEEN '{"+b+"}' AND '{"+(b+1)+"}'":a.fieldObj.name+
" NOT BETWEEN '"+this.formatDate(c)+"' AND '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsBefore:f="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+c:a.fieldObj.name+" \x3c '"+this.formatDate(c)+"'";break;case this.i18n.dateOperatorIsAfter:f="field"===a.valueObj.type?a.fieldObj.name+" \x3e "+c:a.fieldObj.name+" \x3e '"+this.formatDate(this.addDay(c))+"'";break;case this.i18n.dateOperatorIsBetween:f=e?a.fieldObj.name+" BETWEEN '"+d+"' AND '"+h+"'":a.fieldObj.name+" BETWEEN '"+
this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(h))+"'";break;case this.i18n.dateOperatorIsNotBetween:f=e?a.fieldObj.name+" NOT BETWEEN '"+d+"' AND '"+h+"'":a.fieldObj.name+" NOT BETWEEN '"+this.formatDate(d)+"' AND '"+this.formatDate(this.addDay(h))+"'";break;case this.i18n.dateOperatorIsBlank:f=a.fieldObj.name+" IS NULL";break;case this.i18n.dateOperatorIsNotBlank:f=a.fieldObj.name+" IS NOT NULL"}return{whereClause:f}},showDeleteIcon:function(){q.set(r.byId(this.id+".deleteExpression"),
"display","block")},hideDeleteIcon:function(){q.set(r.byId(this.id+".deleteExpression"),"display","none")},createFieldsStore:function(a){if(a&&a.length){a=p.clone(a);a=a.sort(function(a,b){a.label=a.alias||a.name;b.label=b.alias||b.name;return a.label<b.label?-1:a.label>b.label?1:0});var b=this.isHostedService(this.mapLayer.url),c=10.2<=this.version;a=g.filter(a,function(a,d){return"esriFieldTypeString"===a.type||"esriFieldTypeDouble"===a.type||"esriFieldTypeSingle"===a.type||"esriFieldTypeInteger"===
a.type||"esriFieldTypeSmallInteger"===a.type||"esriFieldTypeDate"===a.type&&(this.allowAllDateTypes||b||c)?!0:!1},this);a=g.map(a,function(a,b){var c;switch(a.type){case "esriFieldTypeString":c="string";this.fieldsInfo.stringFieldsCount++;break;case "esriFieldTypeDate":c="date";this.fieldsInfo.dateFieldsCount++;break;default:c="number",this.fieldsInfo.numberFieldsCount++}return{id:b,label:a.label,shortType:c,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);a.length&&
(this.fieldsStore=new B({data:{identifier:"id",label:"label",items:a}}))}},createOperatorStores:function(){var a=[];a.push({name:this.i18n.stringOperatorIs,name_:this.i18n.stringOperatorIs,id:0});a.push({name:this.i18n.stringOperatorIsNot,name_:this.i18n.stringOperatorIsNot,id:1});a.push({name:this.i18n.stringOperatorStartsWith,name_:this.i18n.stringOperatorStartsWith,id:2});a.push({name:this.i18n.stringOperatorEndsWith,name_:this.i18n.stringOperatorEndsWith,id:3});a.push({name:this.i18n.stringOperatorContains,
name_:this.i18n.stringOperatorContains,id:4});a.push({name:this.i18n.stringOperatorDoesNotContain,name_:this.i18n.stringOperatorDoesNotContain,id:5});a.push({name:this.i18n.stringOperatorIsBlank,name_:this.i18n.stringOperatorIsBlank,id:6});a.push({name:this.i18n.stringOperatorIsNotBlank,name_:this.i18n.stringOperatorIsNotBlank,id:7});this.stringOperatorStore=new B({data:{label:"name",identifier:"id",items:a}});a=[];a.push({name:this.i18n.dateOperatorIsOn,id:0});a.push({name:this.i18n.dateOperatorIsNotOn,
id:1});a.push({name:this.i18n.dateOperatorIsBefore,id:2});a.push({name:this.i18n.dateOperatorIsAfter,id:3});a.push({name:this.i18n.dateOperatorIsBetween,id:6});a.push({name:this.i18n.dateOperatorIsNotBetween,id:7});a.push({name:this.i18n.dateOperatorIsBlank,id:8});a.push({name:this.i18n.dateOperatorIsNotBlank,id:9});this.dateOperatorStore=new B({data:{label:"name",identifier:"id",items:a}});a=[];a.push({name:this.i18n.numberOperatorIs,name_:this.i18n.numberOperatorIs,id:0});a.push({name:this.i18n.numberOperatorIsNot,
name_:this.i18n.numberOperatorIsNot,id:1});a.push({name:this.i18n.numberOperatorIsAtLeast,name_:this.i18n.numberOperatorIsAtLeast,id:2});a.push({name:this.i18n.numberOperatorIsLessThan,name_:this.i18n.numberOperatorIsLessThan,id:3});a.push({name:this.i18n.numberOperatorIsAtMost,name_:this.i18n.numberOperatorIsAtMost,id:4});a.push({name:this.i18n.numberOperatorIsGreaterThan,name_:this.i18n.numberOperatorIsGreaterThan,id:5});a.push({name:this.i18n.numberOperatorIsBetween,name_:this.i18n.numberOperatorIsBetween,
id:6});a.push({name:this.i18n.numberOperatorIsNotBetween,name_:this.i18n.numberOperatorIsNotBetween,id:7});a.push({name:this.i18n.numberOperatorIsBlank,name_:this.i18n.numberOperatorIsBlank,id:8});a.push({name:this.i18n.numberOperatorIsNotBlank,name_:this.i18n.numberOperatorIsNotBlank,id:9});this.numberOperatorStore=new B({data:{label:"name",identifier:"id",items:a}})},readCodedValues:function(){g.forEach(this.mapLayer.fields,function(a){a.domain&&a.domain.codedValues&&(this.fieldDomains[a.name]=
a.domain.codedValues)},this)},getDecodedValue:function(a,b){var c=this.getCodedValues(b),d,h;if(c)for(d=0;d<c.length;d+=1)if(h=c[d],h.code===a)return h.name;return a},getCodedValues:function(a){return this.fieldDomains[a]},getFieldsList:function(){return x.byId(this.id+".fieldsList")},getOperatorList:function(){return x.byId(this.id+".operatorList")},getValueFieldsList:function(){return x.byId(this.id+".valueFields")},getAttrValContNode:function(){return r.byId(this.id+".attributeValueContainer")},
getField:function(){var a=this.getFieldsList();return{name:a.store.getValue(a.item,"name"),label:a.store.getValue(a.item,"label"),shortType:a.store.getValue(a.item,"shortType"),type:a.store.getValue(a.item,"type")}},getOperator:function(){var a=this.getOperatorList();return!a.item?"":a.store.getValue(a.item,"name")},getValue:function(){return{}},isInteractiveChecked:function(){return this.interactiveCheck.checked},setInteractiveSection:function(a,b,c){this.disableInteractiveHandlers();this.interactiveCheck.checked=
a;this.promptText.attr("value",b);this.hintText.attr("value",c);q.set(this.interactiveSpace,"display","block");this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;";this.enableInteractiveHandlers()},enableInteractiveHandlers:function(){this.onPromptChangeHandler=b.connect(this.promptText,"onChange",this,"onChangeInteractive");this.onHintchangeHandler=b.connect(this.hintText,"onChange",this,"onChangeInteractive")},disableInteractiveHandlers:function(){b.disconnect(this.onPromptChangeHandler);b.disconnect(this.onHintChangeHandler)},
fillFieldsList:function(a){var b=this.getFieldsList();b.set("labelAttr","label");b.set("searchAttr","label");b.set("store",a);b.set("value",0)},fillOperatorList:function(a,b,c){var d=this.getOperatorList();d.set("labelAttr","name");d.set("searchAttr","name");d.set("query",c?c:{});d.set("store",a);if(b){var h=!1;for(c=0;20>c&&!(a.fetchItemByIdentity({identity:c,onItem:p.hitch(this,function(a){a&&a.name[0]===b&&(d.set("value",a.id[0]),h=!0)})}),h);c++);}else d.set("value",0)},createValueString:function(a){var c=
this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(c);if(a){var c=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},k.create("div",{},c)),d=this.buildCodedValuesStore(a);c.set("store",d);c.set("value",0)}else c=new z({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0},k.create("div",{},c));this.valueHandlers.push(b.connect(c,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var b=
x.byId(this.id+".value"),c=!0;a?b.item?b=b.item.code[0]:(b="",c=!1):c=b=b.get("value");return{value:b,isValid:c}}},createValueDate:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(a);a=new J({id:this.id+".value","class":"attributeValue",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},k.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(b.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=x.byId(this.id+
".value").get("value");return{value:a,isValid:E.isDefined(a)}}},createValueNumber:function(a){var c=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(c);if(a){var c=new I({id:this.id+".value","class":"attributeValue",maxHeight:150,sortByLabel:!0},k.create("div",{},c)),d=this.buildCodedValuesStore(a);c.set("store",d);c.set("value",0)}else c=new H({id:this.id+".value","class":"attributeValue",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},
k.create("div",{},c));this.valueHandlers.push(b.connect(c,"onChange",this,"onValueChange"));this.checkDefaultOption();this.getValue=function(){var b=x.byId(this.id+".value"),c=!0;a?b.item?b=b.item.code[0]:(b="",c=!1):(b=b.get("value"),c=E.isDefined(b)&&!isNaN(b));return{value:b,isValid:c}}},createValueBetweenDate:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(a);var c=new J({id:this.id+".value1","class":"attributeValue1",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},
k.create("div",{},a));k.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},a);a=new J({id:this.id+".value2","class":"attributeValue2",trim:!0,required:!0,placeHolder:"",constraints:{formatLength:"short"}},k.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(b.connect(c,"onChange",this,"onValueChange"));this.valueHandlers.push(b.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=x.byId(this.id+".value1").get("value"),b=x.byId(this.id+
".value2").get("value");return{value1:a,value2:b,isValid:E.isDefined(a)&&E.isDefined(b)}}},createValueBetweenNumber:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(a);var c=new H({id:this.id+".value1","class":"attributeValue1",required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},k.create("div",{},a));k.create("span",{innerHTML:this.i18n.andBetweenValues,"class":"attributeBetweenValues"},a);a=new H({id:this.id+".value2","class":"attributeValue2",
required:!0,placeHolder:"",intermediateChanges:!0,constraints:{pattern:"#####0.##########"}},k.create("div",{},a));this.checkDefaultOption();this.valueHandlers.push(b.connect(c,"onChange",this,"onValueChange"));this.valueHandlers.push(b.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=x.byId(this.id+".value1").get("value"),b=x.byId(this.id+".value2").get("value");return{value1:a,value2:b,isValid:E.isDefined(a)&&E.isDefined(b)&&!isNaN(a)&&!isNaN(b)&&a<=b}}},createValueInTheLastDate:function(){},
createValueIsBlank:function(){var a=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(a);a.innerHTML="\x3cinput id\x3d'"+this.id+".value' class\x3d'attributeValue' type\x3d'text' disabled\x3d'true'/\x3e";this.checkDefaultOption();this.getValue=function(){return{value:null,isValid:!0}}},createValueFields:function(a,c,d){var h=this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(h);var e=new I({id:this.id+".valueFields","class":"attributeValue",maxHeight:150,labelAttr:"label",
searchAttr:"label",store:a,query:c},k.create("div",{},h));if(d)for(var f=!1,h=0;100>h&&!(a.fetchItemByIdentity({identity:h,onItem:p.hitch(this,function(a){a&&(a.shortType[0]===c.shortType&&a.name[0]!==d)&&(e.set("value",a.id),f=!0)})}),f);h++);this.valueHandlers.push(b.connect(e,"onChange",this,"onValueChange"));this.getValue=function(){var a=x.byId(this.id+".valueFields");return{value:a.store.getValue(a.item,"name"),label:a.store.getValue(a.item,"label"),type:"field",isValid:!0}}},createValueUnique:function(a){var c=
this.getAttrValContNode();this.clearAttributeValueDijits();k.empty(c);a=new I({id:this.id+".valueUnique","class":"attributeValue",maxHeight:150,store:a},k.create("div",{},c));a.set("value",0);this.valueHandlers.push(b.connect(a,"onChange",this,"onValueChange"));this.getValue=function(){var a=x.byId(this.id+".valueUnique");return{value:a.store.getValue(a.item,"value"),isValid:!0}}},setValue:function(a,b){if(b)for(var c=0;c<b.length;c++){if(a===b[c].code){x.byId(this.id+".value").set("value",c);break}}else"date"===
this.part.fieldObj.shortType?x.byId(this.id+".value").set("value",new Date(a)):("number"===this.part.fieldObj.shortType&&(a=Number(a)),x.byId(this.id+".value").set("value",a))},setValue1:function(a){"date"===this.part.fieldObj.shortType?a=new Date(a):"number"===this.part.fieldObj.shortType&&(a=Number(a));x.byId(this.id+".value1").set("value",a)},setValue2:function(a){"date"===this.part.fieldObj.shortType?a=new Date(a):"number"===this.part.fieldObj.shortType&&(a=Number(a));x.byId(this.id+".value2").set("value",
a)},setValueFieldById:function(a){this.getValueFieldsList().set("value",a)},enableOnFieldChange:function(){this.onFieldChangeEnabled=!0},enableOnOperatorChange:function(){this.onOperatorChangeEnabled=!0},onChangeField:function(a){this.onFieldChangeEnabled&&this._onChangeField(this.getFieldsList(),this)},onChangeOperator:function(a){this.onOperatorChangeEnabled&&this._onChangeOperator(this.getOperatorList(),this)},onClickDeleteExpression:function(a){this._deleteExpression(this)},_onChangeField:function(a,
c,d){var h=c.getOperatorList();switch(this.fieldsStore.getValue(a.item,"type")){case "esriFieldTypeString":var e=null;a=this.fieldsStore.getValue(a.item,"name");this.getCodedValues(a)&&(e=this.i18n.stringOperatorStartsWith,e+="|"+this.i18n.stringOperatorEndsWith,e+="|"+this.i18n.stringOperatorContains,e+="|"+this.i18n.stringOperatorDoesNotContain,e={name_:RegExp("^(?!("+e+")$)")});h.attr("value")===this.i18n.stringOperatorIs?(c.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,
e),this.onChangeOperator(h,c,d)):c.fillOperatorList(this.stringOperatorStore,this.i18n.stringOperatorIs,e);c.createValueString(this.getCodedValues(a));break;case "esriFieldTypeDate":c.fillOperatorList(this.dateOperatorStore,this.i18n.dateOperatorIsOn);c.createValueDate();break;default:e=null,a=this.fieldsStore.getValue(a.item,"name"),this.getCodedValues(a)&&(e=this.i18n.numberOperatorIsBetween,e+="|"+this.i18n.numberOperatorIsNotBetween,e+="|"+this.i18n.numberOperatorIsAtLeast,e+="|"+this.i18n.numberOperatorIsLessThan,
e+="|"+this.i18n.numberOperatorIsAtMost,e+="|"+this.i18n.numberOperatorIsGreaterThan,e={name_:RegExp("^(?!("+e+")$)")}),h.attr("value")===this.i18n.numberOperatorIs?(c.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,e),this.onChangeOperator(h,c,d)):c.fillOperatorList(this.numberOperatorStore,this.i18n.numberOperatorIs,e),c.createValueNumber(this.getCodedValues(a))}"date"===this.fieldsStore.getValue(c.getFieldsList().item,"shortType")?c.disableInteractiveCheck():c.enableInteractiveCheck();
b.publish("filter-expression-change",this)},_onChangeOperator:function(a,c,d){a=a.item?a.item.name[0]:a.value;d=this.fieldsStore.getValue(c.getFieldsList().item,"shortType");var h=this.fieldsStore.getValue(c.getFieldsList().item,"name");c.enableOptions();if(("date"===d||"number"===d)&&(a===this.i18n.dateOperatorIsBetween||a===this.i18n.numberOperatorIsBetween||a===this.i18n.dateOperatorIsNotBetween||a===this.i18n.numberOperatorIsNotBetween))"date"===d?c.createValueBetweenDate():c.createValueBetweenNumber();
else if("date"===d&&(a===this.i18n.dateOperatorInTheLast||a===this.i18n.dateOperatorNotInTheLast))c.createValueInTheLastDate();else if(a===this.i18n.stringOperatorIsBlank||a===this.i18n.dateOperatorIsBlank||a===this.i18n.numberOperatorIsBlank||a===this.i18n.stringOperatorIsNotBlank||a===this.i18n.dateOperatorIsNotBlank||a===this.i18n.numberOperatorIsNotBlank)c.createValueIsBlank(),c.disableOptions();else switch(d){case "string":c.createValueString(this.getCodedValues(h));break;case "date":c.createValueDate();
break;default:c.createValueNumber(this.getCodedValues(h))}b.publish("filter-expression-change",this)},onInteractiveClick:function(a){this.isInteractiveChecked()?(q.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(q.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;");b.publish("filter-expression-change",this)},onClickShowHideInteractive:function(a){this.interactiveCheck.disabled||("none"===q.set(this.interactiveSpace,
"display")?(q.set(this.interactiveSpace,"display","block"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9650;"):(q.set(this.interactiveSpace,"display","none"),this.interactiveArrow.innerHTML="\x26nbsp;\x26#9660;"))},onChangeInteractive:function(){b.publish("filter-expression-change",this)},showValueInput:function(a){this._showValueInput(x.byNode(a.target),this)},showFields:function(a){this._showFields(x.byNode(a.target),this)},showUniqueList:function(a){this._showUniqueList(x.byNode(a.target),this)},
onValueChange:function(){this.onValueChangeHandler&&clearTimeout(this.onValueChangeHandler);this.onValueChangeHandler=setTimeout(p.hitch(this,function(){this.onValueChangeHandler=null;b.publish("filter-expression-change",this)}),800)},_showValueInput:function(a,b,c){b.onChangeOperator(a,b,c);b.enableInteractiveCheck()},_showFields:function(a,b,c){c=b.getFieldsList().item;a=this.fieldsStore.getValue(c,"shortType");c=this.fieldsStore.getValue(c,"name");b.createValueFields(this.fieldsStore,{shortType:a,
name:RegExp("^(?!"+c+"$)")},c);b.disableInteractiveCheck()},_showUniqueList:function(a,b,c){this.uniqueValuesStore&&delete this.uniqueValuesStore;c=this.fieldsStore.getValue(b.getFieldsList().item,"name");if(10.1<=this.version){var d=null;this.mapLayer.queryServiceUrl?d=this.mapLayer.queryServiceUrl:this.mapLayer.itemLayers&&g.forEach(this.mapLayer.itemLayers,function(a){a.id===this.layerInfo.id&&a.layerUrl&&(d=a.layerUrl)},this);d||(d=this.mapLayer.url);if(this.uniqueValuesResults[this.mapLayer.id+
"_"+c])this.onGenerateRendererResults(b,a,this.uniqueValuesResults[this.mapLayer.id+"_"+c]);else this.generateRendererUniqueValues(c,d,p.hitch(this,"onGenerateRendererResults",b,a),p.hitch(this,function(){this.showValueInput(a,b)}))}else a&&this.showValueInput(a,b)},onGenerateRendererResults:function(a,b,c){var d=this.fieldsStore.getValue(a.getFieldsList().item,"name"),h=this.fieldsStore.getValue(a.getFieldsList().item,"shortType"),f=this.fieldsStore.getValue(a.getFieldsList().item,"type");this.uniqueValuesResults[this.mapLayer.id+
"_"+d]=c;var k=null;g.forEach(this.mapLayer.fields,function(a){a.name===d&&a.domain&&(k=a.domain)});c=g.filter(c,function(a,b){return"string"===h?"\x3cNull\x3e"!==a&&""!==a.trim():"\x3cNull\x3e"!==a&&""!==a});c.length?("date"===h?(c=g.map(c,function(a){return new Date(a)}),c=c.sort(function(a,b){var c=a.getTime(),d=b.getTime();return c<d?-1:c>d?1:0}),c=g.map(c,function(a){return this.formatFriendlyDate(a)},this)):"number"===h?(c=g.map(c,function(a){return"esriFieldTypeDouble"===f||"esriFieldTypeSingle"===
f?parseFloat(a):parseInt(a,10)}),c=c.sort(function(a,b){return a<b?-1:a>b?1:0})):c=c.sort(function(a,b){return a<b?-1:a>b?1:0}),b=g.map(c,function(a,b){var c=a;"string"===h&&(c=""===a?"\x3c"+this.i18n.emptyString+"\x3e":a);if(k&&k.codedValues){for(var d=0;d<k.codedValues.length;d++){var l=k.codedValues[d];if(a===l.code)return{id:b,name:l.name||c,value:a}}return{id:b,name:""+c,value:a}}if("esriFieldTypeDouble"===f||"esriFieldTypeSingle"===f)c=e.format(a,{pattern:"#####0.##########"});return{id:b,name:""+
c,value:a}},this),this.uniqueValuesStore=new B({data:{label:"name",identifier:"id",items:b}}),a.createValueUnique(this.uniqueValuesStore)):this.showValueInput(b,a)},generateRendererUniqueValues:function(a,b,c,d){a instanceof Array&&(a=a.toString());var h=new O;h.attributeField=a;a=new P;a.classificationDefinition=h;this.mapLayer instanceof U?b=new K(this.mapLayer):this.mapLayer instanceof N&&!this.mapLayer.url?b=new K(this.mapLayer):this.hasDynamicLayers(this.mapLayer)?(h=this.mapLayer.layerDefinitions&&
this.mapLayer.layerDefinitions[this.mapLayer.id]?this.mapLayer.layerDefinitions[this.mapLayer.id]:null,a.where=h?h:null,b=new K(this.mapLayer.url+"/dynamicLayer",{source:this.layerInfo.source})):(h=this.mapLayer.getDefinitionExpression(),a.where=h?h:null,b=new K(b));M.config.defaults.io.timeout=1E4;b.execute(a,function(a){M.config.defaults.io.timeout=6E4;a=g.map(a.infos,function(a){return a.value});c(a)},p.hitch(this,function(a){M.config.defaults.io.timeout=6E4;d()}))},hasDynamicLayers:function(a){return a&&
a.supportsDynamicLayers?!0:!1},formatDate:function(a){return C.format(a,{datePattern:"yyyy-MM-dd",selector:"date"})+" "+C.format(a,{selector:"time",timePattern:"HH:mm:ss"})},formatFriendlyDate:function(a){return C.format(a,{formatLength:"short",selector:"date"})},parseFriendlyDate:function(a){return C.parse(a,{formatLength:"short",selector:"date"})},parseDate:function(a){var b=C.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});b||(b=C.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",
timePattern:"HH:mm:ss"}))||(b=C.parse(a.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return b},addDay:function(a){return new Date(a.getTime()+this.dayInMS)},subtractDay:function(a){return new Date(a.getTime()-this.dayInMS)},containsNonLatinCharacter:function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1},buildCodedValuesStore:function(a){a=g.map(a,function(a,b){return{name:a.name,code:a.code,id:b}});return new B({data:{label:"name",identifier:"id",
items:a}})},clearAttributeValueDijits:function(){this.valueHandlers&&0!==this.valueHandlers.length&&(g.forEach(this.valueHandlers,p.hitch(this,function(a){b.disconnect(a)})),this.valueHandlers=[],x.byId(this.id+".value")?x.byId(this.id+".value").destroy():r.byId(this.id+".value")&&this.getAttrValContNode().removeChild(r.byId(this.id+".value")),x.byId(this.id+".value1")?x.byId(this.id+".value1").destroy():r.byId(this.id+".value1")&&this.getAttrValContNode().removeChild(r.byId(this.id+".value1")),x.byId(this.id+
".value2")?x.byId(this.id+".value2").destroy():r.byId(this.id+".value2")&&this.getAttrValContNode().removeChild(r.byId(this.id+".value2")),x.byId(this.id+".valueFields")&&x.byId(this.id+".valueFields").destroy(),x.byId(this.id+".valueUnique")&&x.byId(this.id+".valueUnique").destroy())},checkDefaultOption:function(){v(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(a){x.byNode(a).set("checked",-1<a.className.indexOf("radioValue"))})},disableOptions:function(){v(".attributeValueOptions .attributeValueRadio",
this.domNode).forEach(function(a){x.byNode(a).set("disabled",!0)})},enableOptions:function(){v(".attributeValueOptions .attributeValueRadio",this.domNode).forEach(function(a){x.byNode(a).set("disabled",!1)})},checkFieldOption:function(){x.byId(this.id+".radioFields").set("checked",!0)},disableFieldOption:function(){x.byId(this.id+".radioFields").set("disabled",!0)},disableUniqueOption:function(){x.byId(this.id+".radioUnique").set("disabled",!0)},enableInteractiveCheck:function(){this.interactiveCheck.disabled=
!1},disableInteractiveCheck:function(){this.interactiveCheck.checked=!1;this.interactiveCheck.disabled=!0},isHostedService:function(a){if(!a)return!1;var b=-1!==a.indexOf(".arcgis.com/");a=-1!==a.indexOf("//services")||-1!==a.indexOf("//tiles")||-1!==a.indexOf("//features");return b&&a},buildEditUIField:function(a,b,c){this.getFieldItemByName({name:a.fieldObj.name},p.hitch(this,function(d){b.getFieldsList().set("value",d.id[0]);this.buildEditUIOperator(a,b,c)}),p.hitch(this,function(){b.getFieldsList().set("value",
0);this.buildEditUIOperator(a,b,c)}))},buildEditUIOperator:function(a,b,c){switch(a.fieldObj.shortType){case "string":b.fillOperatorList(this.stringOperatorStore,a.operator);break;case "date":b.fillOperatorList(this.dateOperatorStore,a.operator);break;default:b.fillOperatorList(this.numberOperatorStore,a.operator)}this.getOperatorItemByName(b.getOperatorList().store,{name:a.operator},p.hitch(this,function(d){b.getOperatorList().set("value",d.id[0]);this.buildEditUIValue(a,b,c)}),p.hitch(this,function(){b.getOperatorList().set("value",
0);this.buildEditUIValue(a,b,c)}))},buildEditUIValue:function(a,b,c){c=a.operator;this.onChangeOperator(b.getOperatorList(),b);b.enableOptions();c===this.i18n.stringOperatorIsBlank||c===this.i18n.dateOperatorIsBlank||c===this.i18n.numberOperatorIsBlank||c===this.i18n.stringOperatorIsNotBlank||c===this.i18n.dateOperatorIsNotBlank||c===this.i18n.numberOperatorIsNotBlank?(b.createValueIsBlank(),b.disableOptions()):"field"===a.valueObj.type?(b.createValueFields(this.fieldsStore,{shortType:a.fieldObj.shortType,
name:RegExp("^(?!"+a.fieldObj.name+"$)")}),b.checkFieldOption(),this.getFieldItemByName({name:a.valueObj.value},p.hitch(this,function(a){b.setValueFieldById(a.id[0])}),p.hitch(this,function(){b.setValueFieldById(0)}))):E.isDefined(a.valueObj.value1)?(b.setValue1(a.valueObj.value1),b.setValue2(a.valueObj.value2)):b.setValue(a.valueObj.value,this.getCodedValues(a.fieldObj.name))},getFieldItemByName:function(a,b,c){this.fieldsStore.fetch({query:a,onComplete:p.hitch(this,function(a){a&&a.length?b(a[0]):
c()})})},getOperatorItemByName:function(a,b,c,d){a.fetch({query:b,onComplete:p.hitch(this,function(a){a&&a.length?c(a[0]):d()})})}})})},"dijit/form/FilteringSelect":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/when","./MappedTextBox","./ComboBoxMixin"],function(m,d,p,g,b){return m("dijit.form.FilteringSelect",[g,b],{required:!0,_lastDisplayedValue:"",_isValidSubset:function(){return this._opened},isValid:function(){return!!this.item||!this.required&&""==this.get("displayedValue")},
_refreshState:function(){this.searchTimer||this.inherited(arguments)},_callbackSetLabel:function(b,d,g,l){d&&d[this.searchAttr]!==this._lastQuery||!d&&b.length&&this.store.getIdentity(b[0])!=this._lastQuery||(b.length?this.set("item",b[0],l):this.set("value","",l||void 0===l&&!this.focused,this.textbox.value,null))},_openResultList:function(b,d,g){d[this.searchAttr]===this._lastQuery&&(this.inherited(arguments),void 0===this.item&&this.validate(!0))},_getValueAttr:function(){return this.valueNode.value},
_getValueField:function(){return"value"},_setValueAttr:function(b,g,n,l){this._onChangeActive||(g=null);if(void 0===l){if(null===b||""===b)if(b="",!d.isString(n)){this._setDisplayedValueAttr(n||"",g);return}var e=this;this._lastQuery=b;p(this.store.get(b),function(b){e._callbackSetLabel(b?[b]:[],void 0,void 0,g)})}else this.valueNode.value=b,this.inherited(arguments,[b,g,n,l])},_setItemAttr:function(b,d,g){this.inherited(arguments);this._lastDisplayedValue=this.textbox.value},_getDisplayQueryString:function(b){return b.replace(/([\\\*\?])/g,
"\\$1")},_setDisplayedValueAttr:function(b,g){null==b&&(b="");if(!this._created){if(!("displayedValue"in this.params))return;g=!1}if(this.store){this.closeDropDown();var n=d.clone(this.query),l=this._getDisplayQueryString(b),e;this.store._oldAPI?e=l:(e=this._patternToRegExp(l),e.toString=function(){return l});this._lastQuery=n[this.searchAttr]=e;this._lastDisplayedValue=this.textbox.value=b;this._set("displayedValue",b);var r=this,q={queryOptions:{ignoreCase:this.ignoreCase,deep:!0}};d.mixin(q,this.fetchProperties);
this._fetchHandle=this.store.query(n,q);p(this._fetchHandle,function(b){r._fetchHandle=null;r._callbackSetLabel(b||[],n,q,g)},function(b){r._fetchHandle=null;r._cancelingQuery||console.error("dijit.form.FilteringSelect: "+b.toString())})}},undo:function(){this.set("displayedValue",this._lastDisplayedValue)}})})},"dijit/form/RadioButton":function(){define(["dojo/_base/declare","./CheckBox","./_RadioButtonMixin"],function(m,d,p){return m("dijit.form.RadioButton",[d,p],{baseClass:"dijitRadio"})})},"dijit/form/_RadioButtonMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/lang dojo/query!css2 ../registry".split(" "),
function(m,d,p,g,b,c){return d("dijit.form._RadioButtonMixin",null,{type:"radio",_getRelatedWidgets:function(){var d=[];b("input[type\x3dradio]",this.focusNode.form||this.ownerDocument).forEach(g.hitch(this,function(b){b.name==this.name&&b.form==this.focusNode.form&&(b=c.getEnclosingWidget(b))&&d.push(b)}));return d},_setCheckedAttr:function(b){this.inherited(arguments);this._created&&b&&m.forEach(this._getRelatedWidgets(),g.hitch(this,function(b){b!=this&&b.checked&&b.set("checked",!1)}))},_getSubmitValue:function(b){return null==
b?"on":b},_onClick:function(b){return this.checked||this.disabled?(b.stopPropagation(),b.preventDefault(),!1):this.readOnly?(b.stopPropagation(),b.preventDefault(),m.forEach(this._getRelatedWidgets(),g.hitch(this,function(b){p.set(this.focusNode||this.domNode,"checked",b.checked)})),!1):this.inherited(arguments)}})})},"dijit/form/DateTextBox":function(){define(["dojo/_base/declare","../Calendar","./_DateTimeTextBox"],function(m,d,p){return m("dijit.form.DateTextBox",p,{baseClass:"dijitTextBox dijitComboBox dijitDateTextBox",
popupClass:d,_selector:"date",maxHeight:Infinity,value:new Date("")})})},"dijit/Calendar":function(){define("dojo/_base/array dojo/date dojo/date/locale dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/_base/kernel dojo/keys dojo/_base/lang dojo/on dojo/sniff ./CalendarLite ./_Widget ./_CssStateMixin ./_TemplatedMixin ./form/DropDownButton".split(" "),function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h){var y=g("dijit.Calendar",[w,k,v],{baseClass:"dijitCalendar",cssStateNodes:{decrementMonth:"dijitCalendarArrow",
incrementMonth:"dijitCalendarArrow",previousYearLabelNode:"dijitCalendarPreviousYear",nextYearLabelNode:"dijitCalendarNextYear"},setValue:function(b){n.deprecated("dijit.Calendar:setValue() is deprecated.  Use set('value', ...) instead.","","2.0");this.set("value",b)},_createMonthWidget:function(){return new y._MonthDropDownButton({id:this.id+"_mddb",tabIndex:-1,onMonthSelect:e.hitch(this,"_onMonthSelect"),lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},postCreate:function(){this.inherited(arguments);
this.own(r(this.domNode,"keydown",e.hitch(this,"_onKeyDown")),r(this.dateRowsNode,"mouseover",e.hitch(this,"_onDayMouseOver")),r(this.dateRowsNode,"mouseout",e.hitch(this,"_onDayMouseOut")),r(this.dateRowsNode,"mousedown",e.hitch(this,"_onDayMouseDown")),r(this.dateRowsNode,"mouseup",e.hitch(this,"_onDayMouseUp")))},_onMonthSelect:function(b){var c=new this.dateClassObj(this.currentFocus);c.setDate(1);c.setMonth(b);b=this.dateModule.getDaysInMonth(c);var d=this.currentFocus.getDate();c.setDate(Math.min(d,
b));this._setCurrentFocusAttr(c)},_onDayMouseOver:function(b){if((b=c.contains(b.target,"dijitCalendarDateLabel")?b.target.parentNode:b.target)&&(b.dijitDateValue&&!c.contains(b,"dijitCalendarDisabledDate")||b==this.previousYearLabelNode||b==this.nextYearLabelNode))c.add(b,"dijitCalendarHoveredDate"),this._currentNode=b},_onDayMouseOut:function(b){this._currentNode&&!(b.relatedTarget&&b.relatedTarget.parentNode==this._currentNode)&&(b="dijitCalendarHoveredDate",c.contains(this._currentNode,"dijitCalendarActiveDate")&&
(b+=" dijitCalendarActiveDate"),c.remove(this._currentNode,b),this._currentNode=null)},_onDayMouseDown:function(b){if((b=b.target.parentNode)&&b.dijitDateValue&&!c.contains(b,"dijitCalendarDisabledDate"))c.add(b,"dijitCalendarActiveDate"),this._currentNode=b},_onDayMouseUp:function(b){(b=b.target.parentNode)&&b.dijitDateValue&&c.remove(b,"dijitCalendarActiveDate")},handleKey:function(b){var c=-1,d,h=this.currentFocus;switch(b.keyCode){case l.RIGHT_ARROW:c=1;case l.LEFT_ARROW:d="day";this.isLeftToRight()||
(c*=-1);break;case l.DOWN_ARROW:c=1;case l.UP_ARROW:d="week";break;case l.PAGE_DOWN:c=1;case l.PAGE_UP:d=b.ctrlKey||b.altKey?"year":"month";break;case l.END:h=this.dateModule.add(h,"month",1),d="day";case l.HOME:h=new this.dateClassObj(h);h.setDate(1);break;default:return!0}d&&(h=this.dateModule.add(h,d,c));this._setCurrentFocusAttr(h);return!1},_onKeyDown:function(b){this.handleKey(b)||(b.stopPropagation(),b.preventDefault())},onValueSelected:function(){},onChange:function(b){this.onValueSelected(b)},
getClassForDate:function(){}});y._MonthDropDownButton=g("dijit.Calendar._MonthDropDownButton",h,{onMonthSelect:function(){},postCreate:function(){this.inherited(arguments);this.dropDown=new y._MonthDropDown({id:this.id+"_mdd",onChange:this.onMonthSelect})},_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.dropDown.set("months",c);this.containerNode.innerHTML=(6==q("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+this.dropDown.domNode.innerHTML+
"\x3c/div\x3e")+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+c[b.getMonth()]+"\x3c/div\x3e"}});y._MonthDropDown=g("dijit.Calendar._MonthDropDown",[k,A,v],{months:[],baseClass:"dijitCalendarMonthMenu dijitMenu",templateString:"\x3cdiv data-dojo-attach-event\x3d'ondijitclick:_onClick'\x3e\x3c/div\x3e",_setMonthsAttr:function(b){this.domNode.innerHTML="";m.forEach(b,function(b,c){u.create("div",{className:"dijitCalendarMonthLabel",month:c,innerHTML:b},this.domNode)._cssState=
"dijitCalendarMonthLabel"},this)},_onClick:function(c){this.onChange(b.get(c.target,"month"))},onChange:function(){}});return y})},"dijit/CalendarLite":function(){define("dojo/_base/array dojo/_base/declare dojo/cldr/supplemental dojo/date dojo/date/locale dojo/date/stamp dojo/dom dojo/dom-class dojo/_base/lang dojo/on dojo/sniff dojo/string ./_WidgetBase ./_TemplatedMixin dojo/text!./templates/Calendar.html ./a11yclick ./hccss".split(" "),function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v){var A=d("dijit.CalendarLite",
[w,k],{templateString:v,dowTemplateString:'\x3cth class\x3d"dijitReset dijitCalendarDayLabelTemplate" role\x3d"columnheader" scope\x3d"col"\x3e\x3cspan class\x3d"dijitCalendarDayLabel"\x3e${d}\x3c/span\x3e\x3c/th\x3e',dateTemplateString:'\x3ctd class\x3d"dijitReset" role\x3d"gridcell" data-dojo-attach-point\x3d"dateCells"\x3e\x3cspan class\x3d"dijitCalendarDateLabel" data-dojo-attach-point\x3d"dateLabels"\x3e\x3c/span\x3e\x3c/td\x3e',weekTemplateString:'\x3ctr class\x3d"dijitReset dijitCalendarWeekTemplate" role\x3d"row"\x3e${d}${d}${d}${d}${d}${d}${d}\x3c/tr\x3e',
value:new Date(""),datePackage:"",dayWidth:"narrow",tabIndex:"0",currentFocus:new Date,_setSummaryAttr:"gridNode",baseClass:"dijitCalendar dijitCalendarLite",_isValidDate:function(b){return b&&!isNaN(b)&&"object"==typeof b&&b.toString()!=this.constructor.prototype.value.toString()},_getValueAttr:function(){var b=this._get("value");if(b&&!isNaN(b)){var c=new this.dateClassObj(b);c.setHours(0,0,0,0);c.getDate()<b.getDate()&&(c=this.dateModule.add(c,"hour",1));return c}return null},_setValueAttr:function(b,
d){"string"==typeof b&&(b=c.fromISOString(b));b=this._patchDate(b);if(this._isValidDate(b)&&!this.isDisabledDate(b,this.lang)){if(this._set("value",b),this.set("currentFocus",b),this._markSelectedDates([b]),this._created&&(d||"undefined"==typeof d))this.onChange(this.get("value"))}else this._set("value",null),this._markSelectedDates([])},_patchDate:function(b){b&&(b=new this.dateClassObj(b),b.setHours(1,0,0,0));return b},_setText:function(b,c){for(;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(b.ownerDocument.createTextNode(c))},
_populateGrid:function(){var b=new this.dateClassObj(this.currentFocus);b.setDate(1);var b=this._patchDate(b),c=b.getDay(),d=this.dateModule.getDaysInMonth(b),e=this.dateModule.getDaysInMonth(this.dateModule.add(b,"month",-1)),k=new this.dateClassObj,l=p.getFirstDayOfWeek(this.lang);l>c&&(l-=7);if(!this.summary){var a=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b);this.gridNode.setAttribute("summary",a[b.getMonth()])}this._date2cell={};m.forEach(this.dateCells,function(a,
f){var g=f+l,r=new this.dateClassObj(b),n="dijitCalendar",q=0;g<c?(g=e-c+g+1,q=-1,n+="Previous"):g>=c+d?(g=g-c-d+1,q=1,n+="Next"):(g=g-c+1,n+="Current");q&&(r=this.dateModule.add(r,"month",q));r.setDate(g);this.dateModule.compare(r,k,"date")||(n="dijitCalendarCurrentDate "+n);this.isDisabledDate(r,this.lang)?(n="dijitCalendarDisabledDate "+n,a.setAttribute("aria-disabled","true")):(n="dijitCalendarEnabledDate "+n,a.removeAttribute("aria-disabled"),a.setAttribute("aria-selected","false"));(q=this.getClassForDate(r,
this.lang))&&(n=q+" "+n);a.className=n+"Month dijitCalendarDateTemplate";n=r.valueOf();this._date2cell[n]=a;a.dijitDateValue=n;this._setText(this.dateLabels[f],r.getDateLocalized?r.getDateLocalized(this.lang):r.getDate())},this)},_populateControls:function(){var b=new this.dateClassObj(this.currentFocus);b.setDate(1);this.monthWidget.set("month",b);var c=b.getFullYear()-1,d=new this.dateClassObj;m.forEach(["previous","current","next"],function(b){d.setFullYear(c++);this._setText(this[b+"YearLabelNode"],
this.dateLocaleModule.format(d,{selector:"year",locale:this.lang}))},this)},goToToday:function(){this.set("value",new this.dateClassObj)},constructor:function(c){this.dateModule=c.datePackage?l.getObject(c.datePackage,!1):g;this.dateClassObj=this.dateModule.Date||Date;this.dateLocaleModule=c.datePackage?l.getObject(c.datePackage+".locale",!1):b},_createMonthWidget:function(){return A._MonthWidget({id:this.id+"_mddb",lang:this.lang,dateLocaleModule:this.dateLocaleModule},this.monthNode)},buildRendering:function(){var b=
this.dowTemplateString,c=this.dateLocaleModule.getNames("days",this.dayWidth,"standAlone",this.lang),d=p.getFirstDayOfWeek(this.lang);this.dayCellsHtml=q.substitute([b,b,b,b,b,b,b].join(""),{d:""},function(){return c[d++%7]});b=q.substitute(this.weekTemplateString,{d:this.dateTemplateString});this.dateRowsHtml=[b,b,b,b,b,b].join("");this.dateCells=[];this.dateLabels=[];this.inherited(arguments);u.setSelectable(this.domNode,!1);b=new this.dateClassObj(this.currentFocus);this.monthWidget=this._createMonthWidget();
this.set("currentFocus",b,!1)},postCreate:function(){this.inherited(arguments);this._connectControls()},_connectControls:function(){var b=l.hitch(this,function(b,c,d){this[b].dojoClick=!0;return e(this[b],"click",l.hitch(this,function(){this._setCurrentFocusAttr(this.dateModule.add(this.currentFocus,c,d))}))});this.own(b("incrementMonth","month",1),b("decrementMonth","month",-1),b("nextYearLabelNode","year",1),b("previousYearLabelNode","year",-1))},_setCurrentFocusAttr:function(b,c){var d=this.currentFocus,
e=this._getNodeByDate(d);b=this._patchDate(b);this._set("currentFocus",b);if(!this._date2cell||0!=this.dateModule.difference(d,b,"month"))this._populateGrid(),this._populateControls(),this._markSelectedDates([this.value]);d=this._getNodeByDate(b);d.setAttribute("tabIndex",this.tabIndex);(this.focused||c)&&d.focus();e&&e!=d&&(r("webkit")?e.setAttribute("tabIndex","-1"):e.removeAttribute("tabIndex"))},focus:function(){this._setCurrentFocusAttr(this.currentFocus,!0)},_onDayClick:function(b){b.stopPropagation();
b.preventDefault();for(b=b.target;b&&!b.dijitDateValue;b=b.parentNode);b&&!n.contains(b,"dijitCalendarDisabledDate")&&this.set("value",b.dijitDateValue)},_getNodeByDate:function(b){return(b=this._patchDate(b))&&this._date2cell?this._date2cell[b.valueOf()]:null},_markSelectedDates:function(b){function c(b,d){n.toggle(d,"dijitCalendarSelectedDate",b);d.setAttribute("aria-selected",b?"true":"false")}m.forEach(this._selectedCells||[],l.partial(c,!1));this._selectedCells=m.filter(m.map(b,this._getNodeByDate,
this),function(b){return b});m.forEach(this._selectedCells,l.partial(c,!0))},onChange:function(){},isDisabledDate:function(){},getClassForDate:function(){}});A._MonthWidget=d("dijit.CalendarLite._MonthWidget",w,{_setMonthAttr:function(b){var c=this.dateLocaleModule.getNames("months","wide","standAlone",this.lang,b),d=6==r("ie")?"":"\x3cdiv class\x3d'dijitSpacer'\x3e"+m.map(c,function(b){return"\x3cdiv\x3e"+b+"\x3c/div\x3e"}).join("")+"\x3c/div\x3e";this.domNode.innerHTML=d+"\x3cdiv class\x3d'dijitCalendarMonthLabel dijitCalendarCurrentMonthLabel'\x3e"+
c[b.getMonth()]+"\x3c/div\x3e"}});return A})},"dijit/form/_DateTimeTextBox":function(){define("dojo/date dojo/date/locale dojo/date/stamp dojo/_base/declare dojo/_base/lang ./RangeBoundTextBox ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(m,d,p,g,b,c,u,n){new Date("X");return g("dijit.form._DateTimeTextBox",[c,u],{templateString:n,hasDownArrow:!0,cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_unboundedConstraints:{},pattern:d.regexp,datePackage:"",postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},compare:function(b,c){var d=this._isInvalidDate(b),g=this._isInvalidDate(c);if(d||g)return d&&g?0:!d?1:-1;var d=this.format(b,this._unboundedConstraints),g=this.format(c,this._unboundedConstraints),n=this.parse(d,this._unboundedConstraints),k=this.parse(g,this._unboundedConstraints);return d==g?0:m.compare(n,k,this._selector)},autoWidth:!0,format:function(b,c){return!b?"":this.dateLocaleModule.format(b,c)},parse:function(b,c){return this.dateLocaleModule.parse(b,c)||(this._isEmpty(b)?
null:void 0)},serialize:function(b,c){b.toGregorian&&(b=b.toGregorian());return p.toISOString(b,c)},dropDownDefaultValue:new Date,value:new Date(""),_blankValue:null,popupClass:"",_selector:"",constructor:function(c){c=c||{};this.dateModule=c.datePackage?b.getObject(c.datePackage,!1):m;this.dateClassObj=this.dateModule.Date||Date;this.dateClassObj instanceof Date||(this.value=new this.dateClassObj(this.value));this.dateLocaleModule=c.datePackage?b.getObject(c.datePackage+".locale",!1):d;this._set("pattern",
this.dateLocaleModule.regexp);this._invalidDate=this.constructor.prototype.value.toString()},buildRendering:function(){this.inherited(arguments);this.hasDownArrow||(this._buttonNode.style.display="none");this.hasDownArrow||(this._buttonNode=this.domNode,this.baseClass+=" dijitComboBoxOpenOnClick")},_setConstraintsAttr:function(c){c.selector=this._selector;c.fullYear=!0;var d=p.fromISOString;"string"==typeof c.min&&(c.min=d(c.min),this.dateClassObj instanceof Date||(c.min=new this.dateClassObj(c.min)));
"string"==typeof c.max&&(c.max=d(c.max),this.dateClassObj instanceof Date||(c.max=new this.dateClassObj(c.max)));this.inherited(arguments);this._unboundedConstraints=b.mixin({},this.constraints,{min:null,max:null})},_isInvalidDate:function(b){return!b||isNaN(b)||"object"!=typeof b||b.toString()==this._invalidDate},_setValueAttr:function(b,c,d){void 0!==b&&("string"==typeof b&&(b=p.fromISOString(b)),this._isInvalidDate(b)&&(b=null),b instanceof Date&&!(this.dateClassObj instanceof Date)&&(b=new this.dateClassObj(b)));
this.inherited(arguments,[b,c,d]);this.value instanceof Date&&(this.filterString="");this.dropDown&&this.dropDown.set("value",b,!1)},_set:function(b,c){if("value"==b){c instanceof Date&&!(this.dateClassObj instanceof Date)&&(c=new this.dateClassObj(c));var d=this._get("value");if(d instanceof this.dateClassObj&&0==this.compare(c,d))return}this.inherited(arguments)},_setDropDownDefaultValueAttr:function(b){this._isInvalidDate(b)&&(b=new this.dateClassObj);this._set("dropDownDefaultValue",b)},openDropDown:function(c){this.dropDown&&
this.dropDown.destroy();var d=b.isString(this.popupClass)?b.getObject(this.popupClass,!1):this.popupClass,g=this,n=this.get("value");this.dropDown=new d({onChange:function(b){g.set("value",b,!0)},id:this.id+"_popup",dir:g.dir,lang:g.lang,value:n,textDir:g.textDir,currentFocus:!this._isInvalidDate(n)?n:this.dropDownDefaultValue,constraints:g.constraints,filterString:g.filterString,datePackage:g.datePackage,isDisabledDate:function(b){return!g.rangeCheck(b,g.constraints)}});this.inherited(arguments)},
_getDisplayedValueAttr:function(){return this.textbox.value},_setDisplayedValueAttr:function(b,c){this._setValueAttr(this.parse(b,this.constraints),c,b)}})})},"esri/tasks/GenerateRendererTask":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/number dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ../urlUtils ../renderers/jsonUtils ./StatisticDefinition ./Task ./QueryTask ./query require require require require require require require".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h){return d(v,{declaredClass:"esri.tasks.GenerateRendererTask",_eventMap:{complete:["renderer"]},constructor:function(b,c){p.isObject(b)&&("esri.layers.FeatureLayer"===b.declaredClass||"esri.layers.CSVLayer"===b.declaredClass)?b.url&&p.isString(b.url)&&"esri.layers.CSVLayer"!==b.declaredClass?(this.url=b.url,this._url=q.urlToObject(this.url),this._url.path+="/generateRenderer"):this._features=b.graphics:(this.url=b,this._url.path+="/generateRenderer");this._handler=
p.hitch(this,this._handler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.checkValueRange=c&&c.checkValueRange;this.registerConnectEvents()},_handler:function(b,c,d,e,g){try{var a;"esri.renderer.ClassBreaksRenderer"===b.declaredClass||"esri.renderer.UniqueValueRenderer"===b.declaredClass?a=b:(a=w.fromJson(b),"classBreaks"===b.type&&a.setMaxInclusive(!0));if(this.checkValueRange){var n=new A(this.url),f=new h,l=new k;l.statisticType="min";l.onStatisticField=this._field;var r=new k;r.statisticType=
"max";r.onStatisticField=this._field;f.outStatistics=[l,r];n.execute(f).then(p.hitch(this,function(b){b=b.features[0].attributes;for(var c in b)if(0===c.toLowerCase().indexOf("min"))var e=b[c];else var f=b[c];a=this._processRenderer(a,this._prefix,this._unitLabel,this._formatLabel,this._precision,e,f);this._successHandler([a],"onComplete",d,g)}))}else a=this._processRenderer(a,this._prefix,this._unitLabel,this._formatLabel,this._precision),this._successHandler([a],"onComplete",d,g)}catch(q){this._errorHandler(q,
e,g)}},_processRenderer:function(c,d,e,h,k,a,l){"esri.renderer.ClassBreaksRenderer"===c.declaredClass?g.forEach(c.infos,function(f,g){0===g&&(void 0!==a&&null!==a)&&(f.minValue=a);g===c.infos.length-1&&(void 0!==l&&null!==l)&&(f.classMaxValue=f.maxValue=l);k&&(f.classMaxValue=f.maxValue=Math.round(f.maxValue/k)*k,f.minValue=Math.round(f.minValue/k)*k);h&&(f.label=b.format(f.minValue)+" - "+b.format(f.maxValue));d&&(f.label=d+" "+f.label);e&&(f.label=f.label+" "+e)}):g.forEach(c.infos,function(f,k){0===
k&&(void 0!==a&&null!==a)&&(f.value=a);k===c.infos.length-1&&(void 0!==l&&null!==l)&&(f.value=l);h&&(f.label=b.format(f.value));d&&(f.label=d+" "+f.label);e&&(f.label=f.label+" "+e)});return c},execute:function(b,d,h){var k,g=this._handler,a=this._errorHandler;this._precision=b.precision;this._prefix=b.prefix;this._unitLabel=b.unitLabel;this._formatLabel=b.formatLabel;if(this._features=b.features||this._features){k=new u;var l=this._features;m(["./generateRenderer"],function(c){var e;"esri.tasks.ClassBreaksDefinition"===
b.classificationDefinition.declaredClass?e=c.createClassBreaksRenderer({features:l,definition:b.classificationDefinition}):"esri.tasks.UniqueValueDefinition"===b.classificationDefinition.declaredClass&&(e=c.createUniqueValueRenderer({features:l,definition:b.classificationDefinition}));e?g(e,null,d,h,k):a(null,h,k)})}else{var f=p.mixin(b.toJson(),{f:"json"});this._field="esri.tasks.ClassBreaksDefinition"===b.classificationDefinition.declaredClass?b.classificationDefinition.classificationField:b.classificationDefinition.attributeField;
if(this.source){var n={source:this.source.toJson()};f.layer=c.toJson(n)}this.gdbVersion&&(f.gdbVersion=this.gdbVersion);k=new u(r._dfdCanceller);k._pendingDfd=e({url:this._url.path,content:f,callbackParamName:"callback",load:function(a,b){g(a,b,d,h,k)},error:function(b){a(b,h,k)}})}return k},onComplete:function(){}})})},"esri/tasks/UniqueValueDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./ClassificationDefinition"],function(m,d,p,g,b){return m(b,{declaredClass:"esri.tasks.UniqueValueDefinition",
type:"uniqueValueDef",attributeField:null,attributeField2:null,attributeField3:null,fieldDelimiter:null,toJson:function(){var b=this.inherited(arguments);this.uniqueValueFields=[];this.attributeField&&this.uniqueValueFields.push(this.attributeField);this.attributeField2&&this.uniqueValueFields.push(this.attributeField2);this.attributeField3&&this.uniqueValueFields.push(this.attributeField3);d.mixin(b,{type:this.type,uniqueValueFields:this.uniqueValueFields});this.fieldDelimiter&&d.mixin(b,{fieldDelimiter:this.fieldDelimiter});
return b}})})},"esri/tasks/ClassificationDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(m,d,p,g){return m(null,{declaredClass:"esri.tasks.ClassificationDefinition",type:null,baseSymbol:null,colorRamp:null,toJson:function(){var b={};this.baseSymbol&&d.mixin(b,{baseSymbol:this.baseSymbol.toJson()});this.colorRamp&&!d.isString(this.colorRamp)&&d.mixin(b,{colorRamp:this.colorRamp.toJson()});return b}})})},"esri/tasks/GenerateRendererParameters":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/_base/json","dojo/has","../kernel"],function(m,d,p,g,b){return m(null,{declaredClass:"esri.tasks.GenerateRendererParameters",classificationDefinition:null,where:null,precision:null,prefix:null,unitLabel:null,formatLabel:null,toJson:function(){return{classificationDef:p.toJson(this.classificationDefinition.toJson()),where:this.where}}})})},"esri/layers/GeoRSSLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../config ../request ./ServiceGeneratedFeatureCollection".split(" "),
function(m,d,p,g,b,c,u,n){return m([n],{declaredClass:"esri.layers.GeoRSSLayer",serviceUrl:location.protocol+"//utility.arcgis.com/sharing/rss",constructor:function(b,d){c.defaults.geoRSSService&&(this.serviceUrl=c.defaults.geoRSSService);this._createLayer()},parse:function(){return this._io=u({url:this.serviceUrl,content:{url:this.url,refresh:this.loaded?!0:void 0,outSR:this._outSR?p.toJson(this._outSR.toJson()):void 0},callbackParamName:"callback"})},_initLayer:function(b){this.inherited(arguments);
this.loaded||(this.loaded=!0,this.onLoad(this))}})})},"esri/layers/ServiceGeneratedFeatureCollection":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-style dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/webMercatorUtils ../renderers/SimpleRenderer ./layer ./FeatureLayer ../dijit/PopupTemplate".split(" "),function(m,d,p,g,b,c,u,n,l,e,r,q,w,k,v){return m([w],{declaredClass:"esri.layers._ServiceGeneratedFeatureCollection",
constructor:function(b,c){this.pointSymbol=c&&c.pointSymbol;this.polylineSymbol=c&&c.polylineSymbol;this.polygonSymbol=c&&c.polygonSymbol;this._outSR=c&&(c.outSpatialReference||c.outSR)||new l({wkid:4326});this._options=p.mixin({},c)},parse:function(){console.error("parse function has not been implemented")},getFeatureLayers:function(){var b=[];this._fLayers&&(b=b.concat(this._fLayers));return b},onRefresh:function(){},onOpacityChange:function(){},refresh:function(){this.loaded&&(this._map&&!this._io&&
this.visible)&&this._createLayer()},_createLayer:function(b){var c=this;this._fireUpdateStart();b=this.parse(b);b.addCallback(function(b){c._io=null;c._initLayer(b)});b.addErrback(function(b){c._io=null;b=p.mixin(Error(),b);b.message="Unable to load resource: "+c.url+" "+(b.message||"");c._fireUpdateEnd(b);c.onError(b)})},_initLayer:function(b){this.loaded&&this._removeInternalLayers();this.name=b.name;this.description=b.description;this.snippet=b.snippet;this.defaultVisibility=void 0!==b.visibility?
this.visible=!!b.visibility:this.visible=!0;this.featureInfos=b.featureInfos;this.fullExtent=this.initialExtent=new e(b.lookAtExtent);this.copyright=b.author||b.copyright;var c;if((b=p.getObject("featureCollection.layers",!1,b))&&0<b.length)this._fLayers=[],g.forEach(b,function(b,d){var e=p.getObject("featureSet.features",!1,b);e&&0<e.length&&(c=p.mixin({outFields:["*"],infoTemplate:b.popupInfo?new v(b.popupInfo):null,editable:!1},this._options),c.id&&(c.id=c.id+"_"+d),b.layerDefinition.capabilities=
"Query,Data",e=new k(b,c),e.geometryType&&(this["_"+e.geometryType]=e),this._fLayers.push(e))},this),0===this._fLayers.length&&delete this._fLayers;this.items=[];this._esriGeometryPoint&&(this.items=this.items.concat(this._esriGeometryPoint.graphics),this.pointSymbol&&(b=new q(this.pointSymbol),this._esriGeometryPoint.setRenderer(b)));this._esriGeometryPolyline&&(this.items=this.items.concat(this._esriGeometryPolyline.graphics),this.polylineSymbol&&(b=new q(this.polylineSymbol),this._esriGeometryPolyline.setRenderer(b)));
this._esriGeometryPolygon&&(this.items=this.items.concat(this._esriGeometryPolygon.graphics),this.polygonSymbol&&(b=new q(this.polygonSymbol),this._esriGeometryPolygon.setRenderer(b)));this._fireUpdateEnd();this.loaded&&(this._addInternalLayers(),this.onRefresh())},_addInternalLayers:function(){var b=this._map;this._fireUpdateStart();var c=b.spatialReference,d=this._outSR,e;if(c.wkid)e=c._isWebMercator()&&d._isWebMercator()||c.wkid===d.wkid;else if(c.wkt)e=c.wkt===d.wkt;else{console.log("_setMap - map has invalid spatial reference");
return}if(!e)if(c._isWebMercator()&&4326===d.wkid)this._converter=r.geographicToWebMercator;else if(d._isWebMercator()&&4326===c.wkid)this._converter=r.webMercatorToGeographic;else{console.log("_setMap - unsupported workflow. Spatial reference of the map and layer do not match, and the conversion cannot be done on the client.");return}(c=this._fLayers)&&0<c.length&&g.forEach(c,function(c){if(this._converter){var d=c.graphics,e,a,k=d?d.length:0;for(e=0;e<k;e++)(a=d[e].geometry)&&d[e].setGeometry(this._converter(a))}b.addLayer(c)},
this);this.setVisibility(this.visible);this._fireUpdateEnd()},_removeInternalLayers:function(){var b=this._map;b&&g.forEach(this.getFeatureLayers(),b.removeLayer,b)},setScaleRange:function(b,c){this.inherited(arguments);g.forEach(this.getFeatureLayers(),function(d){d.setScaleRange(b,c)});this._options.minScale=this.minScale;this._options.maxScale=this.maxScale},setOpacity:function(b){this.opacity!=b&&(g.forEach(this.getFeatureLayers(),function(c){c.setOpacity(b)}),this.opacity=this._options.opacity=
b,this.onOpacityChange(b))},onVisibilityChange:function(b){this._fireUpdateStart();g.forEach(this.getFeatureLayers(),function(c){c.setVisibility(b)});this._fireUpdateEnd()},_setMap:function(d,e){this.inherited(arguments);this._map=d;var k=this._div=b.create("div",null,e);c.set(k,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return k},_unsetMap:function(c,e){this._io&&this._io.cancel();d.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();
var k=this._div;k&&(e.removeChild(k),b.destroy(k));this._div=null;this.inherited(arguments)}})})},"jimu/exportUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/json dojo/Deferred esri/tasks/query esri/tasks/QueryTask ./jsonConverters".split(" "),function(m,d,p,g,b,c,u,n){function l(b,c){var d="",e=c.length,g=b.length,l="",n="",r;try{p.forEach(b,function(a){d="string"===typeof a?d+l+a:d+l+(a.alias||a.name);l=","});for(var d=d+"\r\n",q=0;q<e;q++){l="";r=c[q];for(var a=
0;a<g;a++){var m=b[a],n=r["string"===typeof m?m:m.name];!n&&"number"!==typeof n&&(n="");n&&/[",\r\n]/g.test(n)&&(n='"'+n.replace(/(")/g,'""')+'"');d=d+l+n;l=","}d+="\r\n"}return d}catch(f){return""}}var e={createDataSource:function(b){return b.type===e.TYPE_TABLE?new w(b):b.type===e.TYPE_FEATURESET?new q(b):null},TYPE_TABLE:"table",TYPE_FEATURESET:"FeatureSet",FORMAT_CSV:"CSV",FORMAT_FEATURESET:"FeatureSet",FORMAT_GEOJSON:"GeoJSON"},r=m(null,{filename:void 0,suffix:".txt",format:void 0,nls:void 0,
constructor:function(){this.nls=window.jimuNls.exportTo},getExportString:function(){},getSupportExportFormats:function(){},setFormat:function(b){this.format=b},download:function(){this.getExportString().then(d.hitch(this,function(b){var c=this.filename+this.suffix,d;try{d=!!new Blob}catch(e){d=!1}d?(b=new Blob([b],{type:"text/plain;charset\x3dutf-8"}),saveAs(b,c)):saveTextAs(b,c,"utf-8")}))},exportToPortal:function(b,c){}}),q=m(r,{featureSet:null,constructor:function(b){this.inherited(arguments);
this.featureSet=b.data;this.url=b.url;this.filename=b.filename},getExportString:function(){if(this.format===e.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();if(this.format===e.FORMAT_FEATURESET)return this.suffix=".json",this._getAsFeatureSetString();if(this.format===e.FORMAT_GEOJSON)return this.suffix=".geojson",this._getAsGeoJsonString();var c=new b;c.resolve("");return c},getSupportExportFormats:function(){return[{value:e.FORMAT_CSV,label:this.nls.toCSV},{value:e.FORMAT_FEATURESET,
label:this.nls.toFeatureCollection},{value:e.FORMAT_GEOJSON,label:this.nls.toGeoJSON}]},_getFeatureSet:function(){var e=new b;if(this.featureSet)e.resolve(this.featureSet);else if(this.url){var g=new c;g.returnGeometry=!0;g.outFields=["*"];this.queryTask=new u(this.url);this.queryTask.execute(g,d.hitch(this,function(b){e.resolve(b)}),d.hitch(this,function(){e.resolve(null)}))}else e.resolve(null);return e},_getAsFeatureSetString:function(){return this._getFeatureSet().then(d.hitch(this,function(b){var c=
"";b&&(b=b.toJson())&&(c=g.stringify(b));return c}))},_getAsGeoJsonString:function(){return this._getFeatureSet().then(d.hitch(this,function(b){var c="";b&&(b=(new n.esriConverter).toGeoJson(b))&&(c=g.stringify(b));return c}))},_getAsCSVString:function(){return this._getFeatureSet().then(d.hitch(this,function(b){var c="";b&&(c=this._createCSVFromFeatureSet(b));return c}))},_createCSVFromFeatureSet:function(b){var c=b.features,d=[],e;if(b.fieldAliases)for(e in b.fieldAliases)b.fieldAliases.hasOwnProperty(e)&&
d.push({name:e,alias:b.fieldAliases[e]});else for(e in c=c[0].attributes,c)c.hasOwnProperty(e)&&d.push({name:e});b=p.map(b.features,function(b){return b.attributes});return l(d,b)}}),w=m(r,{table:null,constructor:function(b){this.inherited(arguments);this.table=b.data;this.url=b.url;this.filename=b.filename},getExportString:function(){if(this.format===e.FORMAT_CSV)return this.suffix=".csv",this._getAsCSVString();var c=new b;c.resolve("");return c},getSupportExportFormats:function(){return[{value:e.FORMAT_CSV,
label:this.nls.toCSV}]},_getTableData:function(){var e=new b;if(this.table)e.resolve(this.table);else if(this.url){var g=new c;g.outFields=["*"];this.queryTask=new u(this.url);this.queryTask.execute(g,d.hitch(this,function(b){var c={};c.fields=b.fields;c.datas=p.map(b.features,function(b){return b.attributes});e.resolve(c)}),d.hitch(this,function(){e.resolve(null)}))}else e.resolve(null);return e},_getAsCSVString:function(){return this._getTableData().then(d.hitch(this,function(b){var c="";b&&(c=
"\ufeff"+l(b.fields,b.datas));return c}))}});return e})},"jimu/jsonConverters":function(){(function(){function m(b){var d=0,g=0,l=b.length,e=b[g],r;for(g;g<l-1;g++)r=b[g+1],d+=(r[0]-e[0])*(r[1]+e[1]),e=r;return 0<=d}function d(){function b(c){var d,e,g;if(c){if((c.x&&"NaN"!==c.x||0===c.x)&&(c.y&&"NaN"!==c.y||0===c.y))g="Point",e=[c.x,c.y];else if(c.points&&c.points.length)g="MultiPoint",e=c.points;else if(c.paths&&c.paths.length)c=c.paths,1===c.length?(g="LineString",e=c[0]):(g="MultiLineString",
e=c);else if(c.rings&&c.rings.length){g=[];c=c.rings;for(d=0;d<c.length;d++)e=c[d],m(e)?g.push([e]):0<g.length&&g[g.length-1].push(e);1<g.length?(e=g,g="MultiPolygon"):(e=g.pop(),g="Polygon")}d=e&&g?{type:g,coordinates:e}:null}return d}function d(g){var l=null,e,r;if(g&&(l={type:"Feature"},g.geometry&&(l.geometry=b(g.geometry)),g.attributes)){r={};for(e in g.attributes)r[e]=g.attributes[e];l.properties=r}return l}return{toGeoJson:function(g){var l,e,r;if(g)if(g.features){l={type:"FeatureCollection",
features:[]};e=g.features;for(g=0;g<e.length;g++)(r=d(e[g]))&&l.features.push(r)}else l=g.geometry?d(g):b(g);return l}}}function p(){function b(c){var d,g;if("Point"===c)d="esriGeometryPoint";else if("MultiPoint"===c)d="esriGeometryMultipoint",g="points";else if("LineString"===c||"MultiLineString"===c)d="esriGeometryPolyline",g="paths";else if("Polygon"===c||"MultiPolygon"===c)d="esriGeometryPolygon",g="rings";return{type:d,geomHolder:g}}function d(b){var c,g,l=[],k;c=0;for(g=b.length;c<g;c++)k=b[c],
0===c!==m(k)&&(k=k.reverse()),l.push(k);return l}function g(e){var l,q,n,k,m;if("GeometryCollection"===e.type){q=[e.geometries.shift()];l=b(q[0].type);for(n=0;n<e.geometries.length;n++){k=l.type;m=e.geometries[n].type;var p=!1;if(("esriGeometryPoint"===k||"esriGeometryMultipoint"===k)&&("Point"===m||"MultiPoint"===m))p=!0;else if("esriGeometryPolyline"===k&&("LineString"===m||"MultiLineString"===m))p=!0;else if("esriGeometryPolygon"===k&&("Polygon"===m||"MultiPolygon"===m))p=!0;p&&q.push(e.geometries[n])}}else l=
b(e.type),q=[e];"esriGeometryPoint"===l.type&&1<q.length&&(l=b("MultiPoint"));e={spatialReference:{wkid:4326}};if("esriGeometryPoint"===l.type)0===q[0].coordinates.length?(e.x=null,e.y=null):(e.x=q[0].coordinates[0],e.y=q[0].coordinates[1]);else{e[l.geomHolder]=[];for(n=0;n<q.length;n++){k=q[n];var h=p=m=void 0;if("MultiPoint"===k.type||"MultiLineString"===k.type)h=k.coordinates;else if("Point"===k.type||"LineString"===k.type)h=[k.coordinates];else if("Polygon"===k.type)h=d(k.coordinates);else if("MultiPolygon"===
k.type){h=[];m=0;for(p=k.coordinates.length;m<p;m++)h.push(d(k.coordinates[m])[0])}m=h;for(k=0;k<m.length;k++)e[l.geomHolder].push(m[k])}}return e}function l(b){var c,d,l;if(b&&(c={},b.geometry&&(c.geometry=g(b.geometry)),b.properties)){l={};for(d in b.properties)l[d]=b.properties[d];c.attributes=l}return c}return{toEsri:function(b){var c,d,m;if(b)if("FeatureCollection"===b.type){c={features:[]};d=b.features;for(b=0;b<d.length;b++)(m=l(d[b]))&&c.features.push(m)}else c="Feature"===b.type?l(b):g(b);
return c}}}var g;g="undefined"!==typeof exports&&null!==exports?exports:this;if("function"===typeof define){var b={esriConverter:d,geoJsonConverter:p};define([],function(){return b})}else g.esriConverter=d,g.geoJsonConverter=p}).call(this)},"jimu/dijit/ExportChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/ExportChooser.html dojo/_base/lang dojo/_base/array dojo/dom-construct dojo/dom-class dojo/dom-style dojo/dom-geometry dojo/on".split(" "),
function(m,d,p,g,b,c,u,n,l,e,r,q){return m([d,p,g],{templateString:b,baseClass:"jimu-export-chooser",declaredClass:"jimu.dijit.ExportChooser",dataSource:null,nls:null,postMixInProperties:function(){this.nls=window.jimuNls.exportTo},postCreate:function(){this.inherited(arguments);if(this.dataSource){var b=this.dataSource.getSupportExportFormats();0<b.length&&(this.initFormats(b),this.own(q(this.exportFormats,"click",c.hitch(this,this._onFormatClick))),this.own(q(this.exportMask,"click",c.hitch(this,
this.hide))))}},initFormats:function(b){u.forEach(b,function(b){b=n.create("div",{"class":"export-item jimu-ellipsis","data-value":b.value,innerHTML:b.label});n.place(b,this.exportFormats)},this)},_onFormatClick:function(b){b.preventDefault();b.stopPropagation();b=b.target||b.srcElement;l.contains(b,"export-item")&&(this.hide(),b=b.getAttribute("data-value"),this.dataSource.setFormat(b),this.dataSource.download())},show:function(b,c){var d,g;e.set(this.domNode,{left:"-1000px",top:"0px",display:"block"});
d=r.getMarginSize(this.domNode);g=d.w/2;e.set(this.domNode,{left:(0>b-g?0:b+g>window.innerWidth?window.innerWidth-d.w:b-g)+"px",top:c+"px"})},hide:function(){e.set(this.domNode,"display","none")}})})},"widgets/Analysis/layerUtil":function(){define(["dojo/_base/array","dojo/promise/all","jimu/LayerInfos/LayerInfos"],function(m,d,p){return{getLayerObjects:function(g){return p.getInstance(g,g.itemInfo).then(function(b){var c=[];b.traversal(function(b){c.push(b)});var g=m.map(c,function(b){return b.getLayerObject()});
return d(g).then(function(d){var g=[];m.forEach(d,function(b,d){b.id=b.id||c[d].id;b&&"esri.layers.FeatureLayer"===b.declaredClass&&g.push(b)});return{layerInfosObject:b,layerInfos:c,layerObjects:g}})})}}})},"widgets/Analysis/toolValidate":function(){define(["dojo/_base/lang","dojo/_base/array"],function(m,d){function p(g,b,c){var p=null;d.some(g,m.hitch(this,function(d){if(d&&c!==d.id)if(1===b.length){if("*"===b[0]||b[0]===d.geometryType)return p=d.id,!0}else if(-1<b.indexOf(d.geometryType))return p=
d.id,!0}));return p}return{isValid:function(d,b,c){var m=!1,m=d.layerObjects;-1!==b.dijitID.indexOf("MergeLayers")?m=this.mergeAvailable(m):-1!==b.dijitID.indexOf("ExtractData")?m=this.extractAvailable(d,c):(d=null,"requiredParam"in b&&(d=b.requiredParam),m=this.paramAvailable(m,b.analysisLayer,d));return m},mergeAvailable:function(g){return d.some(g,function(b){return d.some(g,function(c){return c!==b&&c.geometryType===b.geometryType})})},extractAvailable:function(g,b){var c=b.getUser(),m=g.layerInfos,
n=g.layerInfosObject.getMapNotesLayerInfoArray(),l=!1;d.forEach(m,function(e){var g=this._isMapNotes(n,e),m="esri.layers.GeoRSSLayer"===e.layerObject.declaredClass,p="esri.layers.CSVLayer"===e.layerObject.declaredClass,k="FeatureCollection"===e.layerObject.type,u=k&&!g;k||m||p||g?m||p?l=this._addExtractCapability(e):g||u?(e=e.getSubLayers())&&0<e.length&&d.forEach(e,function(b){l=this._addExtractCapability(b)},this):l=this._addExtractCapability(e):b.isAdmin()&&(e.layerObject.url&&-1<e.layerObject.url.indexOf("/"+
c.orgId+"/"))&&(l=this._addExtractCapability(e))},this);return l},_isMapNotes:function(g,b){return d.some(g,function(c){return c.id===b.id})},_addExtractCapability:function(d){d.layerObject.capabilities?-1===d.layerObject.capabilities.indexOf("Extract")&&(d.layerObject.capabilities+=",Extract"):d.layerObject.capabilities="Extract";return!0},paramAvailable:function(d,b,c){var m;m=b.geomTypes;b=p(d,m);return null===b?!1:null!==c?(m=c.geomTypes,null!==p(d,m,b)):!0}}})},"widgets/Analysis/PrivilegeUtil":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred jimu/portalUtils jimu/portalUrlUtils jimu/Role esri/kernel ./PortalAnalysis".split(" "),
function(m,d,p,g,b,c,u,n){return m([],{userRole:null,userPortalUrl:null,portalAnalysis:null,portalSelf:null,portalUrl:null,constructor:function(b){this.portalUrl=b},_clearLoadedInfo:function(){this.portalUrl=this.portalSelf=this.portalAnalysis=this.userPortalUrl=this.userRole=null},loadPrivileges:function(b){b&&this.portalUrl!==b&&(this._clearLoadedInfo(),this.portalUrl=b);if(this._privilegeLoaded())return b=new p,b.resolve(!0),b;b=g.getPortal(b);return b.haveSignIn()?this._loadUserInfo(b):this._signIn(b)},
_signIn:function(b){return b.loadSelfInfo().then(d.hitch(this,function(b){var c=g.getPortal(b.portalHostname);return null===c?!1:c.signIn().then(d.hitch(this,function(b){return this._loadUserInfo(c,b)}))}))},_registerOrgCredential:function(c,e){e=b.getStandardPortalUrl(e);var g=d.clone(c.toJson()),m=e+"/sharing/rest";g.server=m;g.resources=[m];u.id.registerToken(g)},_loadUserInfo:function(b,e){return b.loadSelfInfo().then(d.hitch(this,function(b){this.userPortalUrl=b.urlKey?b.urlKey+"."+b.customBaseUrl:
this.portalUrl;return b&&b.user?(this.userRole=new c({id:b.user.roleId?b.user.roleId:b.user.role,role:b.user.role}),b.user.privileges&&this.userRole.setPrivileges(b.user.privileges),this.portalSelf=b,e&&this._registerOrgCredential(e,this.userPortalUrl),this.portalAnalysis=new n(this.userRole,this.portalSelf),!0):!1}))},_privilegeLoaded:function(){return null!==this.portalSelf},getUser:function(){return this._privilegeLoaded()?this.portalSelf.user:null},isAdmin:function(){return this._privilegeLoaded()?
this.userRole.isAdmin():null},getUserPortal:function(){return this._privilegeLoaded()?this.userPortalUrl:null},isPortal:function(){return null!==this.portalSelf&&!0===this.portalSelf.isPortal},canPerformAnalysis:function(){return this.portalAnalysis.canPerformAnalysis()},hasPrivileges:function(b){return this.portalAnalysis.hasPrivileges(b)}})})},"jimu/Role":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/json","esri/lang"],function(m,d,p,g,b){return m(null,{id:null,
baseRole:null,name:null,description:null,privileges:[],privilegeObj:null,constructor:function(b){b=b||{};this.id=b.id;this.baseRole=b.role;this.name=b.name;this.description=b.description},_initPrivilegesObject:function(){this.privilegeObj={portal:{admin:{inviteUsers:!1,disableUsers:!1,viewUsers:!1,updateUsers:!1,deleteUsers:!1,changeUserRoles:!1,viewGroups:!1,updateGroups:!1,deleteGroups:!1,reassignGroups:!1,assignToGroups:!1,manageEnterpriseGroups:!1,viewItems:!1,updateItems:!1,deleteItems:!1,reassignItems:!1,
manageLicenses:!1},publisher:{publishFeatures:!1,publishTiles:!1,publishScenes:!1},user:{createGroup:!1,joinGroup:!1,joinNonOrgGroup:!1,createItem:!1,shareToGroup:!1,shareToOrg:!1,shareToPublic:!1,shareGroupToOrg:!1,shareGroupToPublic:!1}},features:{user:{edit:!1,fullEdit:!1}},opendata:{user:{openDataAdmin:!1,designateGroup:!1}},premium:{user:{geocode:!1,networkanalysis:!1,spatialanalysis:!1,geoenrichment:!1,demographics:!1,elevation:!1}},marketplace:{admin:{manage:!1,purchase:!1,startTrial:!1}}}},
_readPrivileges:function(c){b.isDefined(c)&&c instanceof Array&&p.forEach(c,d.hitch(this,function(b){this._readPrivilege(b)}))},_readPrivilege:function(b){this._applyEffectToAction(!0,b)},_applyEffectToAction:function(b,d){switch(d){case "portal:admin:inviteUsers":this.privilegeObj.portal.admin.inviteUsers=b;break;case "portal:admin:disableUsers":this.privilegeObj.portal.admin.disableUsers=b;break;case "portal:admin:viewUsers":this.privilegeObj.portal.admin.viewUsers=b;break;case "portal:admin:updateUsers":this.privilegeObj.portal.admin.updateUsers=
b;break;case "portal:admin:deleteUsers":this.privilegeObj.portal.admin.deleteUsers=b;break;case "portal:admin:changeUserRoles":this.privilegeObj.portal.admin.changeUserRoles=b;break;case "portal:admin:viewGroups":this.privilegeObj.portal.admin.viewGroups=b;break;case "portal:admin:updateGroups":this.privilegeObj.portal.admin.updateGroups=b;break;case "portal:admin:deleteGroups":this.privilegeObj.portal.admin.deleteGroups=b;break;case "portal:admin:reassignGroups":this.privilegeObj.portal.admin.reassignGroups=
b;break;case "portal:admin:assignToGroups":this.privilegeObj.portal.admin.assignToGroups=b;break;case "portal:admin:manageEnterpriseGroups":this.privilegeObj.portal.admin.manageEnterpriseGroups=b;break;case "portal:admin:viewItems":this.privilegeObj.portal.admin.viewItems=b;break;case "portal:admin:updateItems":this.privilegeObj.portal.admin.updateItems=b;break;case "portal:admin:deleteItems":this.privilegeObj.portal.admin.deleteItems=b;break;case "portal:admin:reassignItems":this.privilegeObj.portal.admin.reassignItems=
b;break;case "portal:admin:manageLicenses":this.privilegeObj.portal.admin.manageLicenses=b;break;case "portal:publisher:publishFeatures":this.privilegeObj.portal.publisher.publishFeatures=b;break;case "portal:publisher:publishTiles":this.privilegeObj.portal.publisher.publishTiles=b;break;case "portal:publisher:publishScenes":this.privilegeObj.portal.publisher.publishScenes=b;break;case "portal:user:createGroup":this.privilegeObj.portal.user.createGroup=b;break;case "portal:user:joinGroup":this.privilegeObj.portal.user.joinGroup=
b;break;case "portal:user:joinNonOrgGroup":this.privilegeObj.portal.user.joinNonOrgGroup=b;break;case "portal:user:createItem":this.privilegeObj.portal.user.createItem=b;break;case "portal:user:shareToGroup":this.privilegeObj.portal.user.shareToGroup=b;break;case "portal:user:shareToOrg":this.privilegeObj.portal.user.shareToOrg=b;break;case "portal:user:shareToPublic":this.privilegeObj.portal.user.shareToPublic=b;break;case "portal:user:shareGroupToOrg":this.privilegeObj.portal.user.shareGroupToOrg=
b;break;case "portal:user:shareGroupToPublic":this.privilegeObj.portal.user.shareGroupToPublic=b;break;case "features:user:edit":this.privilegeObj.features.user.edit=b;break;case "features:user:fullEdit":this.privilegeObj.features.user.fullEdit=b;break;case "opendata:user:openDataAdmin":this.privilegeObj.opendata.user.openDataAdmin=b;break;case "opendata:user:designateGroup":this.privilegeObj.opendata.user.designateGroup=b;break;case "premium:user:geocode":this.privilegeObj.premium.user.geocode=b;
break;case "premium:user:networkanalysis":this.privilegeObj.premium.user.networkanalysis=b;break;case "premium:user:spatialanalysis":this.privilegeObj.premium.user.spatialanalysis=b;break;case "premium:user:geoenrichment":this.privilegeObj.premium.user.geoenrichment=b;break;case "premium:user:demographics":this.privilegeObj.premium.user.demographics=b;break;case "premium:user:elevation":this.privilegeObj.premium.user.elevation=b;break;case "marketplace:admin:purchase":this.privilegeObj.marketplace.admin.purchase=
b;break;case "marketplace:admin:manage":this.privilegeObj.marketplace.admin.manage=b;break;case "marketplace:admin:startTrial":this.privilegeObj.marketplace.admin.startTrial=b}},_applyToAll:function(b){this.privilegeObj.portal.admin.inviteUsers=b;this.privilegeObj.portal.admin.disableUsers=b;this.privilegeObj.portal.admin.viewUsers=b;this.privilegeObj.portal.admin.updateUsers=b;this.privilegeObj.portal.admin.deleteUsers=b;this.privilegeObj.portal.admin.changeUserRoles=b;this.privilegeObj.portal.admin.viewGroups=
b;this.privilegeObj.portal.admin.updateGroups=b;this.privilegeObj.portal.admin.deleteGroups=b;this.privilegeObj.portal.admin.reassignGroups=b;this.privilegeObj.portal.admin.assignToGroups=b;this.privilegeObj.portal.admin.manageEnterpriseGroups=b;this.privilegeObj.portal.admin.viewItems=b;this.privilegeObj.portal.admin.updateItems=b;this.privilegeObj.portal.admin.deleteItems=b;this.privilegeObj.portal.admin.reassignItems=b;this.privilegeObj.portal.admin.manageLicenses=b;this.privilegeObj.portal.publisher.publishFeatures=
b;this.privilegeObj.portal.publisher.publishTiles=b;this.privilegeObj.portal.publisher.publishScenes=b;this.privilegeObj.portal.user.createGroup=b;this.privilegeObj.portal.user.joinGroup=b;this.privilegeObj.portal.user.joinNonOrgGroup=b;this.privilegeObj.portal.user.createItem=b;this.privilegeObj.portal.user.shareToGroup=b;this.privilegeObj.portal.user.shareToOrg=b;this.privilegeObj.portal.user.shareToPublic=b;this.privilegeObj.portal.user.shareGroupToOrg=b;this.privilegeObj.portal.user.shareGroupToPublic=
b;this.privilegeObj.features.user.edit=b;this.privilegeObj.opendata.user.openDataAdmin=b;this.privilegeObj.opendata.user.designateGroup=b;this.privilegeObj.premium.user.geocode=b;this.privilegeObj.premium.user.networkanalysis=b;this.privilegeObj.premium.user.spatialanalysis=b;this.privilegeObj.premium.user.geoenrichment=b;this.privilegeObj.premium.user.demographics=b;this.privilegeObj.premium.user.elevation=b;this.privilegeObj.marketplace.admin.purchase=b;this.privilegeObj.marketplace.admin.manage=
b;this.privilegeObj.marketplace.admin.startTrial=b},_buildPrivilegesArray:function(){var b=[];!0===this.privilegeObj.portal.admin.inviteUsers&&b.push("portal:admin:inviteUsers");!0===this.privilegeObj.portal.admin.disableUsers&&b.push("portal:admin:disableUsers");!0===this.privilegeObj.portal.admin.viewUsers&&b.push("portal:admin:viewUsers");!0===this.privilegeObj.portal.admin.updateUsers&&b.push("portal:admin:updateUsers");!0===this.privilegeObj.portal.admin.deleteUsers&&b.push("portal:admin:deleteUsers");
!0===this.privilegeObj.portal.admin.changeUserRoles&&b.push("portal:admin:changeUserRoles");!0===this.privilegeObj.portal.admin.viewGroups&&b.push("portal:admin:viewGroups");!0===this.privilegeObj.portal.admin.updateGroups&&b.push("portal:admin:updateGroups");!0===this.privilegeObj.portal.admin.deleteGroups&&b.push("portal:admin:deleteGroups");!0===this.privilegeObj.portal.admin.reassignGroups&&b.push("portal:admin:reassignGroups");!0===this.privilegeObj.portal.admin.assignToGroups&&b.push("portal:admin:assignToGroups");
!0===this.privilegeObj.portal.admin.manageEnterpriseGroups&&b.push("portal:admin:manageEnterpriseGroups");!0===this.privilegeObj.portal.admin.viewItems&&b.push("portal:admin:viewItems");!0===this.privilegeObj.portal.admin.updateItems&&b.push("portal:admin:updateItems");!0===this.privilegeObj.portal.admin.deleteItems&&b.push("portal:admin:deleteItems");!0===this.privilegeObj.portal.admin.reassignItems&&b.push("portal:admin:reassignItems");!0===this.privilegeObj.portal.admin.manageLicenses&&b.push("portal:admin:manageLicenses");
!0===this.privilegeObj.portal.publisher.publishFeatures&&b.push("portal:publisher:publishFeatures");!0===this.privilegeObj.portal.publisher.publishTiles&&b.push("portal:publisher:publishTiles");!0===this.privilegeObj.portal.publisher.publishScenes&&b.push("portal:publisher:publishScenes");!0===this.privilegeObj.portal.user.createGroup&&b.push("portal:user:createGroup");!0===this.privilegeObj.portal.user.joinGroup&&b.push("portal:user:joinGroup");!0===this.privilegeObj.portal.user.joinNonOrgGroup&&
b.push("portal:user:joinNonOrgGroup");!0===this.privilegeObj.portal.user.createItem&&b.push("portal:user:createItem");!0===this.privilegeObj.portal.user.shareToGroup&&b.push("portal:user:shareToGroup");!0===this.privilegeObj.portal.user.shareToOrg&&b.push("portal:user:shareToOrg");!0===this.privilegeObj.portal.user.shareToPublic&&b.push("portal:user:shareToPublic");!0===this.privilegeObj.portal.user.shareGroupToOrg&&b.push("portal:user:shareGroupToOrg");!0===this.privilegeObj.portal.user.shareGroupToPublic&&
b.push("portal:user:shareGroupToPublic");!0===this.privilegeObj.features.user.edit&&b.push("features:user:edit");!0===this.privilegeObj.features.user.fullEdit&&b.push("features:user:fullEdit");!0===this.privilegeObj.opendata.user.openDataAdmin&&b.push("opendata:user:openDataAdmin");!0===this.privilegeObj.opendata.user.designateGroup&&b.push("opendata:user:designateGroup");!0===this.privilegeObj.premium.user.geocode&&b.push("premium:user:geocode");!0===this.privilegeObj.premium.user.networkanalysis&&
b.push("premium:user:networkanalysis");!0===this.privilegeObj.premium.user.spatialanalysis&&b.push("premium:user:spatialanalysis");!0===this.privilegeObj.premium.user.geoenrichment&&b.push("premium:user:geoenrichment");!0===this.privilegeObj.premium.user.demographics&&b.push("premium:user:demographics");!0===this.privilegeObj.premium.user.elevation&&b.push("premium:user:elevation");!0===this.privilegeObj.marketplace.admin.purchase&&b.push("marketplace:admin:purchase");!0===this.privilegeObj.marketplace.admin.manage&&
b.push("marketplace:admin:manage");!0===this.privilegeObj.marketplace.admin.startTrial&&b.push("marketplace:admin:startTrial");return b},isUser:function(){return b.isDefined(this.id)&&("org_user"===this.id||"account_user"===this.id)},isPublisher:function(){return b.isDefined(this.id)&&("org_publisher"===this.id||"account_publisher"===this.id)},isAdmin:function(){return b.isDefined(this.id)&&("org_admin"===this.id||"account_admin"===this.id)},isBasedOnUser:function(){return this.isUser()||b.isDefined(this.baseRole)&&
("org_user"===this.baseRole||"account_user"===this.baseRole)},isBasedOnPublisher:function(){return this.isPublisher()||b.isDefined(this.baseRole)&&("org_publisher"===this.baseRole||"account_publisher"===this.baseRole)},isBasedOnAdmin:function(){return this.isAdmin()||b.isDefined(this.baseRole)&&("org_admin"===this.baseRole||"account_admin"===this.baseRole)},isCustom:function(){return!this.isUser()&&!this.isPublisher()&&!this.isAdmin()&&b.isDefined(this.id)&&0<this.id.length},canInviteUsers:function(){return this.privilegeObj&&
this.privilegeObj.portal.admin.inviteUsers},canDisableUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.disableUsers},canViewUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewUsers},canUpdateUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateUsers},canDeleteUsers:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteUsers},canChangeUserRoles:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.changeUserRoles},
canViewOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewGroups},canUpdateOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateGroups},canDeleteOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteGroups},canReassignOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignGroups},canAssignUsersToOrgGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.assignToGroups},
canManageEnterpriseGroups:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageEnterpriseGroups},canViewOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.viewItems},canUpdateOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.updateItems},canDeleteOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.deleteItems},canReassignOrgItems:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.reassignItems},
canManageLicenses:function(){return this.privilegeObj&&this.privilegeObj.portal.admin.manageLicenses},canCreateGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createGroup},canJoinOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinGroup},canJoinNonOrgGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.joinNonOrgGroup},canPublishFeatures:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishFeatures},
canPublishTiles:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishTiles},canPublishScenes:function(){return this.privilegeObj&&this.privilegeObj.portal.publisher.publishScenes},canCreateItem:function(){return this.privilegeObj&&this.privilegeObj.portal.user.createItem},canShareItemToGroup:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToGroup},canShareItemToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareToOrg},canShareItemToPublic:function(){return this.privilegeObj&&
this.privilegeObj.portal.user.shareToPublic},canShareGroupToOrg:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToOrg},canShareGroupToPublic:function(){return this.privilegeObj&&this.privilegeObj.portal.user.shareGroupToPublic},canEditFeatures:function(){return this.privilegeObj&&this.privilegeObj.features.user.edit},canEditFeaturesFullControl:function(){return this.privilegeObj&&this.privilegeObj.features.user.fullEdit},canManageOpenData:function(){return this.privilegeObj&&
this.privilegeObj.opendata.user.openDataAdmin},canDesignateOpenDataGroups:function(){return this.privilegeObj&&this.privilegeObj.opendata.user.designateGroup},canUseGeocode:function(){return this.privilegeObj&&this.privilegeObj.premium.user.geocode},canUseNetworkAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.networkanalysis},canUseSpatialAnalysis:function(){return this.privilegeObj&&this.privilegeObj.premium.user.spatialanalysis},canUseGeoenrichment:function(){return this.privilegeObj&&
this.privilegeObj.premium.user.geoenrichment},canUseDemographics:function(){return this.privilegeObj&&this.privilegeObj.premium.user.demographics},canUseElevation:function(){return this.privilegeObj&&this.privilegeObj.premium.user.elevation},canPurchaseMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.purchase},canManageMarketplace:function(){return this.privilegeObj&&this.privilegeObj.marketplace.admin.manage},canTrialMarketplace:function(){return this.privilegeObj&&
this.privilegeObj.marketplace.admin.startTrial},setPrivileges:function(c){this.privileges=c;this._initPrivilegesObject();b.isDefined(c)&&this._readPrivileges(c)},stringify:function(){return g.stringify({id:this.id,name:this.name,description:this.description,privileges:this._buildPrivilegesArray()})},stringifyRole:function(){return g.stringify({id:this.id,name:this.name,description:this.description})},stringifyPrivileges:function(){return g.stringify({privileges:this._buildPrivilegesArray()})},stringifyPretty:function(){return g.stringify({id:this.id,
name:this.name,description:this.description,privileges:this._buildPrivilegesArray()},null,"  ")}})})},"widgets/Analysis/PortalAnalysis":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","esri/lang"],function(m,d,p,g){return m([],{userRole:null,portalSelf:null,constructor:function(b,c){this.userRole=b;this.portalSelf=c},canPerformAnalysis:function(){var b=!1;this.userRole&&(this.userRole.isAdmin()||this.userRole.isPublisher())?b=!0:this.userRole&&this.userRole.isCustom()&&
(b=this.userRole.canCreateItem()&&this.userRole.canPublishFeatures()&&this.userRole.canUseSpatialAnalysis());this.portalSelf&&this.portalSelf.isPortal&&(b=b&&g.isDefined(this.portalSelf.helperServices.analysis)&&g.isDefined(this.portalSelf.helperServices.analysis.url));return b},hasPrivileges:function(b){return d.isArray(b)?p.every(b,function(b){return"networkanalysis"===b?this._canPerformNetworkAnalysis():"geoenrichment"===b?this._canPerformGeoEnrichment():"elevation"===b?this._canPerformElevationAnalysis():
"drivetimearea"===b?this._canPerformDriveAnalysis():"planroutes"===b?this._canPerformPlanRoutesAnalysis():"od"===b?this._canPerformODAnalysis():!1},this):!0},_canPerformNetworkAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.asyncClosestFacility)&&g.isDefined(this.portalSelf.helperServices.asyncServiceArea)&&g.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&b&&this.userRole.canUseNetworkAnalysis()},_canPerformGeoEnrichment:function(){var b=
g.isDefined(this.portalSelf.helperServices.geoenrichment);return this.canPerformAnalysis()&&b&&this.userRole.canUseGeoenrichment()},_canPerformElevationAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.elevation);return this.canPerformAnalysis()&&b&&this.userRole.canUseElevation()},_canPerformPlanRoutesAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.routingUtilities)&&g.isDefined(this.portalSelf.helperServices.asyncVRP);return this.canPerformAnalysis()&&b&&
this.userRole.canUseNetworkAnalysis()},_canPerformODAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.routingUtilities)&&g.isDefined(this.portalSelf.helperServices.asyncRoute);return this.canPerformAnalysis()&&b&&this.userRole.canUseNetworkAnalysis()},_canPerformDriveAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.routingUtilities)&&g.isDefined(this.portalSelf.helperServices.asyncServiceArea);return this.canPerformAnalysis()&&b&&this.userRole.canUseNetworkAnalysis()},
_canPerformNearestAnalysis:function(){var b=g.isDefined(this.portalSelf.helperServices.routingUtilities)&&g.isDefined(this.portalSelf.helperServices.asyncClosestFacility);return this.canPerformAnalysis()&&b&&this.userRole.canUseNetworkAnalysis()}})})},"widgets/Analysis/toolSettings":function(){define(["dojo/_base/lang","dojo/_base/array"],function(m,d){var p={},g="AggregatePoints CalculateDensity ChooseBestFacilities ConnectOriginsToDestinations CreateBuffers CreateDriveTimeAreas CreateViewshed CreateWatersheds DeriveNewLocations DissolveBoundaries EnrichLayer ExtractData FindExistingLocations FindHotSpots FindNearest FindSimilarLocations InterpolatePoints MergeLayers OverlayLayers PlanRoutes SummarizeNearby SummarizeWithin TraceDownstream".split(" "),
b=0,c=[{id:b++,dijitID:"esri/dijit/analysis/AggregatePoints",title:"aggregateTool",imgDisplay:"images/aggregate-points.png",usage:"aggregatePointsUsage",analysisLayer:{name:"pointLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},requiredParam:{name:"polygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},icon:"images/AggregatePoints32.png"},{id:b++,dijitID:"esri/dijit/analysis/CalculateDensity",title:"calculateDensity",imgDisplay:"images/calculate-density.png",usage:"calculateDensityUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolyline"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/CreateDensitySurface32.png"},{id:b++,dijitID:"esri/dijit/analysis/ChooseBestFacilities",title:"chooseBestFacilities",imgDisplay:"images/choose-best-facilities.png",analysisLayer:{name:"demandLocationLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"demandLocationLayers",
isArray:!0,geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ChooseBestFacilities32.png"},{id:b++,dijitID:"esri/dijit/analysis/ConnectOriginsToDestinations",title:"connectOriginsToDestinations",imgDisplay:"images/connect-origins-to-destinations.png",usage:"connectOriginsToDestinationsUsage",analysisLayer:{name:"originsLayer",geomTypes:["esriGeometryPoint"]},requiredParam:{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]},
icon:"images/ConnectOriginstoDestinations32.png",privileges:["od"]},{id:b++,dijitID:"esri/dijit/analysis/CreateBuffers",title:"createBuffers",imgDisplay:"images/create-buffers.png",usage:"createBuffersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/CreateBuffers32.png"},{id:b++,dijitID:"esri/dijit/analysis/CreateDriveTimeAreas",title:"createDriveTimeAreas",imgDisplay:"images/create-drivetime.png",usage:"createDriveTimeAreasUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},
icon:"images/CreateDriveTimeAreas32.png",cannotCancel:!0,privileges:["drivetimearea"]},{id:b++,dijitID:"esri/dijit/analysis/CreateViewshed",title:"createViewshed",imgDisplay:"images/create-viewshed.png",usage:"createViewshedUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Viewshed32.png",privileges:["elevation"]},{id:b++,dijitID:"esri/dijit/analysis/CreateWatersheds",title:"createWatershed",imgDisplay:"images/create-watersheds.png",usage:"createWatershedsUsage",
analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},icon:"images/Watershed32.png",privileges:["elevation"]},{id:b++,dijitID:"esri/dijit/analysis/DeriveNewLocations",title:"deriveNewLocations",imgDisplay:"images/derive-new-locations.png",usage:"deriveNewLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindNewLocations32.png"},{id:b++,dijitID:"esri/dijit/analysis/DissolveBoundaries",title:"dissolveBoundaries",
imgDisplay:"images/dissolve-boundaries.png",usage:"dissolveBoundariesUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPolygon"]},icon:"images/DissolveBoundaries32.png"},{id:b++,dijitID:"esri/dijit/analysis/EnrichLayer",title:"enrichLayer",imgDisplay:"images/enrich-layer.png",usage:"enrichLayerUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},icon:"images/GeoenrichFeatures32.png",privileges:["geoenrichment"]},{id:b++,dijitID:"esri/dijit/analysis/ExtractData",title:"extractData",
imgDisplay:"images/extract-data.png",usage:"extractDataDesc",optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["*"]}],icon:"images/ClipAndShip32.png"},{id:b++,dijitID:"esri/dijit/analysis/FindExistingLocations",title:"findExistingLocations",imgDisplay:"images/find-existing-locations.png",usage:"findExistingLocationsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},optionalParams:[{name:"inputLayers",isArray:!0,geomTypes:["*"]}],icon:"images/FindExistingLocations32.png"},{id:b++,
dijitID:"esri/dijit/analysis/FindHotSpots",title:"findHotSpots",imgDisplay:"images/find-hot-spots.png",usage:"findHotSpotsUsage",analysisLayer:{name:"analysisLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint","esriGeometryPolygon"]},optionalParams:[{name:"aggregationPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/FindHotSpots32.png"},{id:b++,dijitID:"esri/dijit/analysis/FindNearest",
title:"findNearest",imgDisplay:"images/find-nearest.png",usage:"findNearestUsage",analysisLayer:{name:"analysisLayer",geomTypes:["*"]},requiredParam:{name:"nearLayers",isArray:!0,geomTypes:["*"]},icon:"images/FindNearest32.png",cannotCancel:!0},{id:b++,dijitID:"esri/dijit/analysis/FindSimilarLocations",title:"findSimilarLocations",imgDisplay:"images/find-similar-locations.png",usage:"findSimilarLocationsUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},optionalParams:[{name:"searchLayers",
isArray:!0,geomTypes:["*"]}],icon:"images/FindSimilarLocations32.png"},{id:b++,dijitID:"esri/dijit/analysis/InterpolatePoints",title:"interpolatePoints",imgDisplay:"images/interpolate-points.png",usage:"interpolatePointsUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint","esriGeometryMultipoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]},{name:"predictAtPointLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/CreateInterpolatedSurface32.png"},
{id:b++,dijitID:"esri/dijit/analysis/MergeLayers",title:"mergeLayers",imgDisplay:"images/merge-layers.png",usage:"mergeLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"mergeLayers",isArray:!0,geomTypes:["*"]},icon:"images/MergeLayers32.png"},{id:b++,dijitID:"esri/dijit/analysis/OverlayLayers",title:"overlayLayers",imgDisplay:"images/overlay-layers.png",usage:"overlayLayersUsage",analysisLayer:{name:"inputLayer",geomTypes:["*"]},requiredParam:{name:"overlayLayer",
isArray:!0,geomTypes:["*"]},icon:"images/OverlayLayers32.png"},{id:b++,dijitID:"esri/dijit/analysis/PlanRoutes",title:"planRoutes",imgDisplay:"images/plan-routes.png",usage:"planRoutesUsage",analysisLayer:{name:"stopsLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"featureLayers",isArray:!0,geomTypes:["esriGeometryPoint"]}],icon:"images/PlanRoutes32.png",cannotCancel:!0,privileges:["planroutes"]},{id:b++,dijitID:"esri/dijit/analysis/SummarizeNearby",title:"summarizeNearby",imgDisplay:"images/summarize-nearby.png",
usage:"summarizeNearbyUsage",analysisLayer:{name:"sumNearbyLayer",geomTypes:["*"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeNearby32.png"},{id:b++,dijitID:"esri/dijit/analysis/SummarizeWithin",title:"summarizeWithin",imgDisplay:"images/summarize-within.png",usage:"summarizeWithinUsage",analysisLayer:{name:"sumWithinLayer",geomTypes:["esriGeometryPolygon"]},requiredParam:{name:"summaryLayers",isArray:!0,geomTypes:["*"]},icon:"images/SummarizeWithin32.png"},
{id:b++,dijitID:"esri/dijit/analysis/TraceDownstream",title:"traceDownstream",imgDisplay:"images/trace-downstream.png",usage:"traceDownstreamUsage",analysisLayer:{name:"inputLayer",geomTypes:["esriGeometryPoint"]},optionalParams:[{name:"boundingPolygonLayers",isArray:!0,geomTypes:["esriGeometryPolygon"]}],icon:"images/TraceDownstream32.png",privileges:["elevation"]}];p.findToolSetting=function(b){b=d.indexOf(g,b);return-1!==b?m.clone(c[b]):null};p.getToolName=function(b){return"id"in b&&0<=b.id&&
b.id<g.length?g[b.id]:null};p.getAllSettings=function(){return m.clone(c)};return p})},"widgets/Analysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:dijit/templates/Calendar.html":'\x3ctable cellspacing\x3d"0" cellpadding\x3d"0" class\x3d"dijitCalendarContainer" role\x3d"grid" aria-labelledby\x3d"${id}_mddb ${id}_year" data-dojo-attach-point\x3d"gridNode"\x3e\r\n\t\x3cthead\x3e\r\n\t\t\x3ctr class\x3d"dijitReset dijitCalendarMonthContainer" valign\x3d"top"\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset dijitCalendarArrow\' data-dojo-attach-point\x3d"decrementMonth" scope\x3d"col"\x3e\r\n\t\t\t\t\x3cspan class\x3d"dijitInline dijitCalendarIncrementControl dijitCalendarDecrease" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"decreaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e-\x3c/span\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset\' colspan\x3d"5" scope\x3d"col"\x3e\r\n\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"monthNode"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\t\x3cth class\x3d\'dijitReset dijitCalendarArrow\' scope\x3d"col" data-dojo-attach-point\x3d"incrementMonth"\x3e\r\n\t\t\t\t\x3cspan class\x3d"dijitInline dijitCalendarIncrementControl dijitCalendarIncrease" role\x3d"presentation"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3cspan data-dojo-attach-point\x3d"increaseArrowNode" class\x3d"dijitA11ySideArrow"\x3e+\x3c/span\x3e\r\n\t\t\t\x3c/th\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\t\x3ctr role\x3d"row"\x3e\r\n\t\t\t${!dayCellsHtml}\r\n\t\t\x3c/tr\x3e\r\n\t\x3c/thead\x3e\r\n\t\x3ctbody data-dojo-attach-point\x3d"dateRowsNode" data-dojo-attach-event\x3d"ondijitclick: _onDayClick" class\x3d"dijitReset dijitCalendarBodyContainer"\x3e\r\n\t\t\t${!dateRowsHtml}\r\n\t\x3c/tbody\x3e\r\n\t\x3ctfoot class\x3d"dijitReset dijitCalendarYearContainer"\x3e\r\n\t\t\x3ctr\x3e\r\n\t\t\t\x3ctd class\x3d\'dijitReset\' valign\x3d"top" colspan\x3d"7" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dijitCalendarYearLabel"\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"previousYearLabelNode" class\x3d"dijitInline dijitCalendarPreviousYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"currentYearLabelNode" class\x3d"dijitInline dijitCalendarSelectedYear" role\x3d"button" id\x3d"${id}_year"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"nextYearLabelNode" class\x3d"dijitInline dijitCalendarNextYear" role\x3d"button"\x3e\x3c/span\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n\t\t\x3c/tr\x3e\r\n\t\x3c/tfoot\x3e\r\n\x3c/table\x3e\r\n',
"url:esri/dijit/templates/SingleFilter.html":'\x3cdiv class\x3d"esriSingleFilterForm singleFilter" id\x3d"${id}.singleFilter"\x3e\r\n  \x3cdiv\x3e\r\n    \x3ctable id\x3d"${id}.exprTable" class\x3d"rowTable" cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column1"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column2"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column3"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column4"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column5"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column6"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3cdiv id\x3d"${id}.column7"\x3e\r\n            \x3c/div\x3e\r\n          \x3c/td\x3e\r\n          \x3ctd valign\x3d"top" nowrap\x3e\r\n            \x3ca id\x3d"${id}.deleteExpression" href\x3d"JavaScript:void(0);" style\x3d"margin:0 5px;display:none;" class\x3d"esriAGOFilterRemoveIcon" title\x3d"${i18n.deleteExpression}"\x3e\x3c/a\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"_interactiveFilterRow"\x3e\r\n          \x3ctd colspan\x3d"8"\x3e\r\n            \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"interactiveFilter"\x3e\r\n              \x3ctbody\x3e\r\n                \x3ctr\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3cinput dojoAttachPoint\x3d"interactiveCheck" type\x3d"checkbox" class\x3d"promptCheckBox" title\x3d"${i18n.promptMsg}"/\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            \x3clabel class\x3d"labels" for\x3d"promptCheckBox"\x3e\r\n                              \x26nbsp;\x26nbsp;${i18n.askForValues}\r\n                            \x3c/label\x3e\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cspan dojoAttachPoint\x3d"interactiveArrow" style\x3d"color:#cbcbcb;cursor:pointer;" class\x3d"showHidePromptDiv"\x3e\x26nbsp;\x26#9660;\x3c/span\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n                \x3ctr dojoAttachPoint\x3d"interactiveSpace" style\x3d"display:none"\x3e\r\n                  \x3ctd nowrap\x3d"nowrap"\x3e\r\n                    \x3ctable cellpadding\x3d"0" cellspacing\x3d"0"\x3e\r\n                      \x3ctbody\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.prompt}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"promptText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                        \x3ctr\x3e\r\n                          \x3ctd nowrap\x3d"nowrap"\x3e\r\n                            ${i18n.hint}\r\n                          \x3c/td\x3e\r\n                          \x3ctd width\x3d"10"\x3e\r\n                            \x26nbsp;\r\n                          \x3c/td\x3e\r\n                          \x3ctd\x3e\r\n                            \x3cdiv dojoAttachPoint\x3d"hintText" dojotype\x3d"dijit.form.TextBox" intermediateChanges\x3d"true" style\x3d"width:250px;"\x3e\r\n                            \x3c/div\x3e\r\n                          \x3c/td\x3e\r\n                        \x3c/tr\x3e\r\n                      \x3c/tbody\x3e\r\n                    \x3c/table\x3e\r\n                  \x3c/td\x3e\r\n                \x3c/tr\x3e\r\n              \x3c/tbody\x3e\r\n            \x3c/table\x3e\r\n          \x3c/td\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"promptDiv" style\x3d"display:none;padding:10px 0px;"\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtPrompt"\x3e\r\n      ${i18n.prompt}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtPrompt" type\x3d"text"/\x3e\r\n    \x3cbr/\x3e\r\n    \x3clabel class\x3d"labels promptLabels" for\x3d"txtHint"\x3e\r\n      ${i18n.hint}\r\n    \x3c/label\x3e\r\n    \x3cinput class\x3d"promptFields txtHint" type\x3d"text" /\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/ExportChooser.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"export-mask" data-dojo-attach-point\x3d"exportMask"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"export-format jimu-corner-all" data-dojo-attach-point\x3d"exportFormats"\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:widgets/Analysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"widgetContent" class\x3d"analysis-widget-content"\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"toolListPanel" class\x3d"tool-list"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolsSection" class\x3d"toolsSection"\x3e\r\n        \x3cdiv class\x3d"execute-tip"\x3e\r\n          ${nls.executeAnalysisTip}\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"tools-table-container"\x3e\r\n          \x3ctable cellpadding\x3d"0" cellspacing\x3d"0" class\x3d"tools-table" onselectstart\x3d"return false;"\x3e\r\n            \x3ctbody data-dojo-attach-point\x3d"toolsTbody"\x3e\r\n            \x3c/tbody\x3e\r\n          \x3c/table\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"noQueryTipSection" class\x3d"jimu-widget"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"toolPanel" class\x3d"tool-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolCtr" style\x3d"width:100%;height:90%"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"toolLoadErrorNode" class\x3d"analysis-error-tip" style\x3d"display:none"\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n\r\n    \x3cdiv data-dojo-attach-point\x3d"messagePanel" class\x3d"message-panel"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"inputHeader" class\x3d"input-header esriAnalysis"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"smallIcon" class\x3d"small-icon"/\x3e\r\n        \x3cspan data-dojo-attach-point\x3d"toolTitle" class\x3d"tool-title"\x3e\x3c/span\x3e\r\n      \x3c/div\x3e\r\n      \x3chr\x3e\r\n      \x3cdiv class\x3d"message-title"\x3e${nls.messages}\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"messageSection" class\x3d\'message-section\'\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultSection" style\x3d"display:none" \x3e\r\n        \x3cdiv class\x3d"message-title outputs"\x3e${nls.outputs}\x3c/div\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"outputSection" class\x3d\'result-section\'\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv class\x3d"job-message outputtip" data-dojo-attach-point\x3d"outputtip"\x3e${nls.outputtip}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"resultLoading" class\x3d"result-loading" style\x3d"display:none"\x3e\x3c/div\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"buttonSection" style\x3d"display:none" class\x3d"buttonNode"\x3e\r\n        \x3cdiv class\x3d"jimu-btn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToPrevious"\x3e${nls.back}\x3c/div\x3e\r\n        \x3cdiv class\x3d"jimu-btn" data-dojo-attach-point\x3d"homeBtn"\r\n            data-dojo-attach-event\x3d"onclick: _switchToHome"\x3e${nls.home}\x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\r\n  \x3cdiv data-dojo-attach-point\x3d"shelter" data-dojo-type\x3d"jimu/dijit/LoadingShelter" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Analysis/css/style.css":".esriAnalysis .dijitComboBox{height: 30px !important;}.jimu-widget-analysis{position: relative; width: 100%; height: 100%; min-width: 300px; min-height: 237px; overflow-x: hidden; -ms-overflow-x: hidden; overflow-y: auto; -ms-overflow-y: auto;}.jimu-widget-analysis .execute-tip{font-size: 14px; color: #66699c; font-weight: bold;}.jimu-widget-analysis .tools-table-container{width: 100%;}.jimu-widget-analysis .tools-table{margin: 0 auto; padding-top: 10px; width: 100%; border-collapse: collapse;}.jimu-widget-analysis .tool-name{font-size: 14px; margin-left: 10px; margin-top: 10px; color: #686868;}.jimu-rtl .jimu-widget-analysis .tool-name{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .tools-table-tr{height:107px; display: block; cursor: pointer;}.jimu-widget-analysis .tools-table-tr.even{background-color: #ffffff;}.jimu-widget-analysis .tools-table-tr.odd{background-color: #f0f0f0;}.jimu-widget-analysis .tools-table-tr.disabled{background-color: #979797; cursor: default; border-bottom: 1px solid #ffffff;}.jimu-widget-analysis .tools-table-tr .icon-div{margin: 10px; width: 220px;}.jimu-widget-analysis .tools-table-tr .icon-div .tool-icon{height: 60px; width: auto;}.jimu-widget-analysis .tools-table-tr .tooltip-td{margin: 10px;}.jimu-widget-analysis .tooltip-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 30px;}.jimu-rtl .jimu-widget-analysis .tooltip-icon{margin-left: auto; margin-right: 30px;}.jimu-widget-analysis .tools-table-tr:hover{background: #d9dde0;}.jimu-widget-analysis .tools-table-tr.disabled:hover{background-color: #979797;}.jimu-widget-analysis .tool-params{width: 100%; height: 100%;}.jimu-widget-analysis .input-header{position: relative; width: 100%;}.jimu-widget-analysis .input-header .small-icon{margin-left: 15px;}.jimu-rtl .jimu-widget-analysis .input-header .small-icon{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .tool-title{margin-left: 15px; margin-bottom: 15px; font-size: 16px;}.jimu-rtl .jimu-widget-analysis .input-header .tool-title{margin-left: auto; margin-right: 15px;}.jimu-widget-analysis .input-header .help-icon{margin-top: 15px; cursor: pointer;}.jimu-widget-analysis .input-tip{width: 100%; height: auto; margin-top: 20px; font-size: 14px;}.jimu-widget-analysis .layerNode{position: relative; width:100%; margin: 0 auto; margin-top: 10px;}.jimu-widget-analysis .layerNode .param-name{margin-top: 15px; margin-bottom: 10px;}.jimu-widget-analysis .layer-name {height: 30px; line-height: 30px; width: 100%; border: solid 1px rgba(0,0,0,0.1); cursor: pointer;}.jimu-widget-analysis .tool-params .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .switch-button{margin-left: 20px;}.jimu-rtl .jimu-widget-analysis .switch-button{margin-left: auto; margin-right: 20px;}.jimu-widget-analysis .tool-panel{width: 100%; height: auto; position: relative; top:-20px;}.jimu-widget-analysis .tool-panel .esriAnalysisCloseIcon{display:none !important;}.jimu-widget-analysis .jimu-btn{margin-left: 10px; margin-right: 10px;}.jimu-widget-analysis .toolpanel-button{text-align: center;}.jimu-widget-analysis .analysis-error-tip{width: 100%; min-height: 150px; margin-top: 30px; margin-left: 15px; margin-right: 15px; color:#ff0000; font-size: 14px;}.jimu-widget-analysis .message-panel{width: 100%; margin-bottom: 15px; position: relative;}.jimu-widget-analysis .message-panel .message-title{margin-top: 20px; font-size: 14px; color: #66696c; font-weight: bold;}.jimu-widget-analysis .message-panel .message-title.outputs{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message{margin-top: 10px; font-size: 12px; color: #686868;}.jimu-widget-analysis .message-panel .job-message.outputtip{margin-top: 30px;}.jimu-widget-analysis .message-panel .job-message.success{color: #00B050;}.jimu-widget-analysis .message-panel .job-message.failed{color:#E84B4B;}.jimu-widget-analysis .message-panel .job-message.cancelled{color: #51B1FE;}.jimu-widget-analysis .message-panel .job-running-icon{width: 16px; height: 16px; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-running-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .job-cancel-icon{width: 16px; height: 16px; cursor: pointer; margin-left: 10px;}.jimu-rtl .jimu-widget-analysis .message-panel .job-cancel-icon{margin-left: auto; margin-right: 10px;}.jimu-widget-analysis .message-panel .output-item{margin-top: 10px; color: #51B1FE; font-size: 12px; display: inline-block;}.jimu-widget-analysis .message-panel .output-item\x3ea{color: #51B1FE;}.jimu-widget-analysis .message-panel .button-section{width: 100%; margin-top: 20px;}.jimu-widget-analysis .message-panel .buttonNode{width: 100%; height: auto; margin-top: 20px; text-align: center;}.jimu-widget-analysis .result-section{width: 100%; margin-top: 15px; margin-bottom: 15px; font-size: 14px; color: #66699c;}.jimu-widget-analysis .result-loading{width: 100%; height: 40px; margin-top: 15px; margin-bottom: 15px; background-image: url(images/loading.gif); background-repeat: no-repeat; background-position: center;}.jimu-widget-analysis .hidden{display: none;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-left: 0px;}.jimu-rtl .jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton{margin-right: 0px; margin-left: auto;}.jimu-widget-analysis .esriAnalysis .dijitButton.calcite {display: inline-block !important;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButton\x3espan.dijitButtonNode,.jimu-widget-analysis .esriAnalysis .dijitButton.calcite \x3e span.dijitButtonNode{cursor:pointer; min-width: 70px; display:inline-block; padding:6px; font-size:15px; text-align:center; background:#485566; vertical-align:middle; color:#ffffff; -webkit-border-radius:5px; -moz-border-radius:5px; -o-border-radius:5px; -ms-border-radius:5px; border-radius: 5px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;}.jimu-widget-analysis .esriAnalysis .esriAnalysisSubmitButton.dijitButtonHover\x3espan.dijitButtonNode,.jimu-widget-analysis .esriAnalysis .dijitButton.calcite.dijitButtonHover\x3espan.dijitButtonNode{background-color: #596d87; color: #ffffff;}.dijitDialog .esriAnalysis{overflow: hidden;}.dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: 10px;}.jimu-rtl .dijitDialog .esriAnalysis .esriAnalysisSubmitButton{margin-left: auto; margin-right: 10px;}.dijitDialog .esriAnalysis .esriAnalysisCloseIcon{display: none !important;}.itemsGallery .galleryNode .galleryLabelContainer {height: 2.7em; text-align: left; line-height: 15px;}.jimu-widget-analysis .export-node {width: 16px; height: 16px; background-image: url(images/download.png); cursor: pointer; margin: 10px 10px 0 10px; display: inline-block;}.jimu-widget-analysis .export-node:hover {background-image: url(images/download_hover.png);}.esriAnalysis .dijitReset.dijitRight.dijitButtonNode.dijitArrowButton.dijitDownArrowButton.dijitArrowButtonContainer{width: 18px !important;}.esriAnalysis .esriAnalysisExpressionGrid .dijitButtonNode {height: auto;}",
"url:widgets/Analysis/config.json":'{\r\n  "analysisTools": []\r\n}\r\n',"*now":function(m){m(['dojo/i18n!*preload*widgets/Analysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/_base/array dojo/dom-style dojo/dom-attr dojo/dom-class dojo/Deferred dojo/on dojo/query dojo/promise/all dojo/dom-construct dojo/i18n!esri/nls/jsapi dojo/json dijit/_WidgetsInTemplateMixin esri/request esri/tasks/JobInfo esri/tasks/FeatureSet esri/tasks/query esri/tasks/QueryTask esri/layers/FeatureLayer esri/dijit/PopupTemplate esri/dijit/analysis/utils esri/geometry/Extent jimu/BaseWidget jimu/dijit/ViewStack jimu/dijit/Message jimu/utils jimu/portalUtils jimu/portalUrlUtils jimu/LayerInfos/LayerInfos jimu/exportUtils jimu/dijit/ExportChooser ./layerUtil ./toolValidate ./PrivilegeUtil ./toolSettings dojo/i18n!./setting/nls/strings dijit/form/Button".split(" "),function(m,
d,p,g,b,c,u,n,l,e,r,q,w,k,v,A,h,y,B,C,D,F,a,t,f,G,x,z,I,L,J,H,M,E,K,O,P,N){return m([f,v],{baseClass:"jimu-widget-analysis esriAnalysis",_hasContent:null,privilegeUtil:null,currentStack:0,toolCountInList:0,postMixInProperties:function(){this.inherited(arguments);d.mixin(this.nls,w.analysisTools);this.nls.toolNotAvailable=N.toolNotAvailable},postCreate:function(){this.inherited(arguments);this.privilegeUtil=new O;this.viewStack=new G({viewType:"dom",views:[this.toolListPanel,this.toolPanel,this.messagePanel]});
p.place(this.viewStack.domNode,this.widgetContent);0===this.config.analysisTools.length&&this._noPrivilegeHandler(this.nls.noToolTip);this._switchView(0)},_closeHelpDialog:function(){a._helpDialog&&"function"===typeof a._helpDialog.close&&a._helpDialog.close()},onClose:function(){this._closeHelpDialog();this._deactiveDrawTool();this._setDrawingLayersVisibility(!1)},onOpen:function(){this._setDrawingLayersVisibility(!0)},onDeActive:function(){this._deactiveDrawTool()},_checkValidation:function(){q.empty(this.toolsTbody);
0!==this.config.analysisTools.length&&(this.shelter.show(),this.privilegeUtil.loadPrivileges(this._getPortalUrl()).then(d.hitch(this,function(a){!a||!this.privilegeUtil.canPerformAnalysis()?this._noPrivilegeHandler(this.nls.privilegeError):(b.set(this.toolsSection,"display","block"),b.set(this.noQueryTipSection,"display","none"),1===this.config.analysisTools.length?this._initSingleTool().then(d.hitch(this,function(){this.shelter.hide()})):this._initToolList().then(d.hitch(this,function(){this.shelter.hide()})))}),
d.hitch(this,function(){this._noPrivilegeHandler(this.nls.privilegeError);this.shelter.hide()})))},_clearContent:function(){q.empty(this.toolsTbody);this.currentAnalysisDijit&&(this.currentAnalysisDijit=null,q.empty(this.toolCtr));this.currentToolSetting=null},_noPrivilegeHandler:function(a){this.shelter.hide();b.set(this.toolsSection,"display","none");c.set(this.noQueryTipSection,"innerHTML",z.stripHTML(a));b.set(this.noQueryTipSection,"display","block")},_initSingleTool:function(){b.set(this.homeBtn,
"display","none");this.currentToolSetting=P.findToolSetting(this.config.analysisTools[0].name);if(null===this.currentToolSetting)this._noPrivilegeHandler(this.nls.noToolTip);else{this.currentToolSetting=d.mixin(this.currentToolSetting,this.config.analysisTools[0]);this.currentToolSetting.toolLabel||(this.currentToolSetting.toolLabel=this.nls[this.currentToolSetting.title]);if(this.privilegeUtil.hasPrivileges(this.currentToolSetting.privileges))return E.getLayerObjects(this.map).then(d.hitch(this,
function(){this._setIconAndLink(this.currentToolSetting);this.toolCountInList=1;this._switchToAnalysisTool()}));this._noPrivilegeHandler(this.nls.privilegeError)}},_initToolList:function(){b.set(this.homeBtn,"display","");this.toolCountInList=0;var a=null;return E.getLayerObjects(this.map).then(d.hitch(this,function(b){g.forEach(this.config.analysisTools,d.hitch(this,function(c,e){var f=P.findToolSetting(c.name);if(null!==f&&(f=d.mixin(f,this.config.analysisTools[e]),f.toolLabel||(f.toolLabel=this.nls[f.title]),
this.privilegeUtil.hasPrivileges(f.privileges))){var g=K.isValid(b,f,this.privilegeUtil);this._addTool(f,e,g);this.toolCountInList+=1;a=f}}));0===this.toolCountInList?this._noPrivilegeHandler(this.nls.privilegeError):1===this.toolCountInList&&(this._setIconAndLink(a),this._switchToAnalysisTool())}),d.hitch(this,function(){console.error("layerUtil: getLayerObjects error")}))},destroy:function(){this._clearContent();this.inherited(arguments)},_addTool:function(b,e,f){var g=q.create("tr",{"class":"tools-table-tr"},
this.toolsTbody);0===e%2?u.add(g,"even"):u.add(g,"odd");g.rowData=b;e=q.create("td",{"class":"icon-td"},g);q.create("div",{"class":"tool-name",innerHTML:z.stripHTML(b.toolLabel)},e);e=q.create("div",{"class":"icon-div"},e);q.create("img",{src:this.folderUrl+b.imgDisplay,"class":"tool-icon"},e);e=q.create("td",{"class":"tooltip-td esriAnalysis"},g);if(b.showHelp){e=q.create("a",{href:"#",esriHelpTopic:"toolDescription"},e);q.create("img",{src:this.folderUrl+"images/helpIcon.png",title:b.toolLabel,
"class":"tooltip-icon"},e);e=b.dijitID.lastIndexOf("/");e=b.dijitID.substring(e+1);var h=!L.isOnline(this._getPortalUrl());a.initHelpLinks(g,!0,{helpFileName:e,isSingleTenant:h})}!0===f?(c.set(g,"title",""),this.own(l(g,"click",d.hitch(this,function(){this._setIconAndLink(b);this.currentToolSetting=b;this._switchToAnalysisTool()})))):(c.set(g,"title",this.nls.toolNotAvailable),u.remove(g,"even"),u.remove(g,"odd"),u.add(g,"disabled"))},_setIconAndLink:function(b){c.set(this.smallIcon,"src",this.folderUrl+
b.icon);c.set(this.toolTitle,"innerHTML",z.stripHTML(b.toolLabel));var d=b.dijitID.lastIndexOf("/"),d=b.dijitID.substring(d+1);this.helpLink&&(q.destroy(this.helpLink),this.helpLink=null);b.showHelp&&(this.helpLink=q.create("a",{href:"#",esriHelpTopic:"toolDescription"},this.inputHeader),q.create("img",{height:16,width:16,"class":"help-icon jimu-float-trailing",src:this.folderUrl+"images/helpIcon.png"},this.helpLink),a.initHelpLinks(this.inputHeader,!0,{helpFileName:d}))},_switchToAnalysisTool:function(){b.set(this.toolLoadErrorNode,
"display","none");this.shelter.show();require([this.currentToolSetting.dijitID],d.hitch(this,function(a){this.currentAnalysisDijit&&("function"===typeof this.currentAnalysisDijit.clear&&this.currentAnalysisDijit.clear(),this.currentAnalysisDijit=null,q.empty(this.toolCtr));var f=!L.isOnline(this._getPortalUrl()),g={map:this.map,showSelectFolder:!0,portalUrl:this._getPortalUrl(this.privilegeUtil.getUserPortal()),showCredits:this.currentToolSetting.showCredits,showHelp:this.currentToolSetting.showHelp,
showChooseExtent:this.currentToolSetting.showChooseExtent,returnFeatureCollection:this.currentToolSetting.returnFeatureCollection,showReadyToUseLayers:this.currentToolSetting.showReadyToUseLayers,isSingleTenant:f,disableRunAnalysis:!0===this.currentToolSetting.disableRunAnalysis};f&&(g.showReadyToUseLayers=!1);if("findNearest"===this.currentToolSetting.title||"summarizeNearby"===this.currentToolSetting.title||"enrichLayer"===this.currentToolSetting.title)g.enableTravelModes=this.privilegeUtil.hasPrivileges(["networkanalysis"]);
"returnFeatureCollection"in this.currentToolSetting&&(g.showSelectFolder=!this.currentToolSetting.returnFeatureCollection);this._getLayerObjects().then(d.hitch(this,function(f){this.currentToolSetting.analysisLayer&&(g.showSelectAnalysisLayer=!0,g[this.currentToolSetting.analysisLayer.name+"s"]=this._prepareLayers(f,this.currentToolSetting.analysisLayer.geomTypes));f=this._prepareLayerParams(f);d.mixin(g,f);try{if(-1!==this.currentToolSetting.dijitID.indexOf("DeriveNewLocations")||-1!==this.currentToolSetting.dijitID.indexOf("FindExistingLocations")||
-1!==this.currentToolSetting.dijitID.indexOf("FindSimilarLocations"))g.primaryActionButttonClass="esriAnalysisSubmitButton";this.currentAnalysisDijit=new a(g,q.create("div",{style:{width:"100%"}},this.toolCtr));this.currentAnalysisDijit._setTitleAttr(this.currentToolSetting.toolLabel);this._bindAnalysisEvents(this.currentAnalysisDijit);this.currentAnalysisDijit.startup();this.currentDijitID=this.currentToolSetting.dijitID;var h;if(1<this.toolCountInList&&(h=e(".esriAnalysis .esriAnalysisSubmitButton",
this.toolPanel)[0],"undefined"!==typeof h)){u.add(h,"multiTool");var k=q.create("div",{"class":"toolpanel-button"}),m=q.create("div",{"class":"jimu-btn",innerHTML:this.nls.back},k);q.place(k,h,"before");q.place(h,k);this.currentAnalysisDijit.own(l(m,"click",d.hitch(this,this._switchToPrevious)))}}catch(n){console.error(n.message||n),c.set(this.toolLoadErrorNode,"innerHTML",z.stripHTML(n.message||n)),b.set(this.toolLoadErrorNode,"display","")}this.shelter.hide()}))}),d.hitch(this,function(a){c.set(this.toolLoadErrorNode,
"innerHTML",z.stripHTML(a));b.set(this.toolLoadErrorNode,"display","");this.shelter.hide()}));this._switchView(1)},_prepareLayerParams:function(a){var b={};if("optionalParams"in this.currentToolSetting||"requiredParam"in this.currentToolSetting){var c;"requiredParam"in this.currentToolSetting&&(c=this._prepareLayers(a,this.currentToolSetting.requiredParam.geomTypes),b[this.currentToolSetting.requiredParam.name]=this.currentToolSetting.requiredParam.isArray?c:0<c.length?c[0]:null);"optionalParams"in
this.currentToolSetting&&g.forEach(this.currentToolSetting.optionalParams,function(d){c=this._prepareLayers(a,d.geomTypes);b[d.name]=d.isArray?c:0<c.length?c[0]:null},this)}return b},_prepareLayers:function(a,b){var c,d=["point","polyline","polygon"],e=[];"*"!==b[0]&&(d=g.map(b,function(a){return z.getTypeByGeometryType(a)}));g.forEach(a,function(a){"esri.layers.FeatureLayer"===a.declaredClass&&(c=z.getTypeByGeometryType(a.geometryType),0<=d.indexOf(c)&&(a.url||0<a.graphics.length)&&e.push(a))},this);
return e},_getLayerObjects:function(){var a=new n;J.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(b){var c=[];b.traversal(function(a){c.push(a)});b=g.map(c,function(a){return a.getLayerType().then(function(b){"GeoRSSLayer"===b&&(a.isLeaf()||g.forEach(a.getSubLayers(),function(a){a.layerObject.name||(a.layerObject.name=a.title)}));return a.getLayerObject()})});r(b).then(d.hitch(this,function(b){var c=[];g.forEach(b,function(a){a&&c.push(a)});a.resolve(c)}),function(b){a.resolve([])})}));
return a},_deactivateGenerator:function(a){var b=this.currentAnalysisDijit;return function(){g.forEach(a,function(a){b[a]&&b[a].set("checked",!1)})}},_deactiveDrawTool:function(){if(this.currentAnalysisDijit){var a={calculateDensity:this._deactivateGenerator(["_bndgPolyDrawBtn"]),createViewshed:this._deactivateGenerator(["_analysisPointDrawBtn"]),createWatershed:this._deactivateGenerator(["_analysisPointDrawBtn"]),extractData:d.hitch(this,function(){this.currentAnalysisDijit._drawExtentBtn&&this.currentAnalysisDijit._drawExtentBtn.set("checked",
!1);this.currentAnalysisDijit._toolbar&&this.currentAnalysisDijit._toolbar.deactivate()}),findHotSpots:this._deactivateGenerator(["_boundingDrawBtn"]),findSimilarLocations:d.hitch(this,function(){this.currentAnalysisDijit._selectBtn&&this.currentAnalysisDijit._selectBtn.set("checked",!1);this.currentAnalysisDijit.selectionLayer&&this.currentAnalysisDijit.selectionLayer.clearSelection()}),interpolatePoints:this._deactivateGenerator(["_bndgPolyDrawBtn","_predictPointDrawBtn"]),planRoutes:this._deactivateGenerator(["_startPointDrawBtn",
"_endPointDrawBtn"]),traceDownstream:this._deactivateGenerator(["_analysisPointDrawBtn","_bndgPolyDrawBtn"])};"function"===typeof a[this.currentToolSetting.title]&&(a[this.currentToolSetting.title].apply(this),this.map.setInfoWindowOnClick(!0))}},_setDrawingLayersVisibility:function(a){this.currentAnalysisDijit&&"function"===typeof this.currentAnalysisDijit._getDrawLayerAttr&&g.forEach(this.currentAnalysisDijit._getDrawLayerAttr(),function(b){a?b.show():b.hide()})},_bindAnalysisEvents:function(a){this.own(l(a,
"start",d.hitch(this,this._onJobStart)));this.own(l(a,"job-submit",d.hitch(this,this._onJobSubmitted)));this.own(l(a,"job-cancel",d.hitch(this,this._onJobCancelled)));this.own(l(a,"job-fail",d.hitch(this,this._onJobFailed)));this.own(l(a,"job-success",d.hitch(this,this._onJobSucceed)));this.own(l(a,"job-status",d.hitch(this,this._onJobStatusChange)));this.own(l(a,"job-result",d.hitch(this,this._onJobResultData)));this.own(l(a,"drawtool-activate",d.hitch(this,function(){this.map.setInfoWindowOnClick(!1)})));
this.own(l(a,"drawtool-deactivate",d.hitch(this,function(){this.map.setInfoWindowOnClick(!0)})))},_onJobStart:function(){this._clearMessageLogs();this.shelter.show();this._switchView(2)},_onJobSubmitted:function(a){this.shelter.hide();this.outputProperties=null;a.OutputName&&(this.outputProperties=k.parse(a.OutputName,!0));this._appendMessage(this.nls[this.currentToolSetting.title]+" "+this.nls.jobSubmitted);a=q.create("div",{"class":"job-message waiting"},this.messageSection);q.create("img",{"class":"job-running-icon",
src:this.folderUrl+"images/loading.gif"},a)},_onJobCancelled:function(a){a.jobStatus?this._appendMessage(this.nls.jobCancelled+": "+a.jobStatus,"cancelled"):this._appendMessage(this.nls.jobCancelled,"cancelled");this._onJobDone();b.set(this.buttonSection,"display","")},_onJobFailed:function(a){this.shelter.hide();"warning"===a.type?(this.currentAnalysisDijit.set("disableRunAnalysis",!1),this._switchView(1),new x({message:a.message})):(2!==this.currentStack&&(this._clearMessageLogs(),this._switchView(2)),
this._appendMessage(this.nls.jobFailed+": "+(a.analysisReport||a.message),"failed"),this._onJobDone(),b.set(this.buttonSection,"display",""))},_onJobSucceed:function(a){this._appendMessage(this.nls.jobSuccess,"success");this._onJobDone();0<=this.currentToolSetting.dijitID.indexOf("ExtractData")&&(b.set(this.resultSection,"display",""),c.set(this.outputtip,"innerHTML",z.stripHTML(this.nls.outputSaveInPortal)));b.set(this.buttonSection,"display","");b.set(this.resultLoading,"display","")},_onJobDone:function(){e("img.job-executing",
this.messagePanel).forEach(function(a){q.destroy(a)})},_onJobStatusChange:function(a){this.shelter.hide();a.jobId&&a.jobId!==this.currentToolJobId&&(this.currentToolJobId=a.jobId);if(a.jobStatus===h.STATUS_EXECUTING)this._appendExecutingMessage();else switch(a.jobStatus){case h.STATUS_FAILED:case h.STATUS_CANCELLED:case h.STATUS_DELETED:case h.STATUS_TIMED_OUT:this.shelter.hide();"string"===typeof a.message&&this._appendMessage(a.message,"failed");this._onJobDone();b.set(this.buttonSection,"display",
"");break;case h.STATUS_SUCCEEDED:"string"===typeof a.message&&this._appendMessage(a.message),this._onJobDone(),b.set(this.buttonSection,"display","")}},_onJobResultData:function(a){c.set(this.outputtip,"innerHTML",z.stripHTML(this.nls.outputtip));b.set(this.resultSection,"display","");b.set(this.buttonSection,"display","");var e=this._appendResultMessage(a);if(0>this.currentToolSetting.dijitID.indexOf("ExtractData")){var f;if(a.value.itemId)f=null,"layerInfo"in a.value&&(f=a.value.layerInfo.popupInfo),
this._fetchResultByItemId(e,a.value.itemId,f).then(d.hitch(this,function(){b.set(this.resultLoading,"display","none")}));else if("layerDefinition"in a.value){var h={title:e?e:"output",fieldInfos:[]};g.forEach(a.value.layerDefinition.fields,function(b){b.name!==a.value.layerDefinition.objectIdField&&h.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});f=new F(h);f=new D(a.value,{infoTemplate:f});f.title=e?e:"output";this.map.addLayer(f);this.currentToolSetting.allowToExport&&
this._createExportNode(f.title,new y(a.value.featureSet),H.TYPE_FEATURESET);b.set(this.resultLoading,"display","none")}}},_fetchResultByItemId:function(a,b,c){return I.getPortal(this._getPortalUrl(this.privilegeUtil.getUserPortal())).getItemById(b).then(d.hitch(this,function(e){var f=e.url;return A({url:f,content:{f:"json"},handleAs:"json"}).then(d.hitch(this,function(e){var h=[],k,l=e.tables||[],m=e.layers||[];l.reverse();m.reverse();g.forEach(l,function(b){var c=f+"/"+b.id;k=J.getInstance(this.map,
this.map.itemInfo).then(d.hitch(this,function(d){d.addTable({url:c,title:a+" - "+b.name,options:{outFields:["*"]}});this.currentToolSetting.allowToExport&&h.push(this._createExportNodeForUrl(b.name,c,H.TYPE_TABLE))}));h.push(k)},this);g.forEach(m,function(a){var e=f+"/"+a.id,g=null;1===m.length&&(g=c);k=this._buildFeatureLayer(a.name,e,g,b).then(d.hitch(this,function(a){this.map.addLayer(a)}));this.currentToolSetting.allowToExport&&h.push(this._createExportNodeForUrl(a.name,e,H.TYPE_FEATURESET));
h.push(k)},this);e.initialExtent&&this.map.setExtent(new t(e.initialExtent));return r(h)}))}))},_buildFeatureLayer:function(a,b,c,e){if(null!==c){var f=new n;c.title=a;c=new D(b,{mode:D.MODE_SNAPSHOT,infoTemplate:new F(c),outFields:["*"]});c._itemId=e;f.resolve(c);return f}return A({url:b,content:{f:"json"},handleAs:"json"}).then(d.hitch(this,function(c){var d={title:a,fieldInfos:[]};g.forEach(c.fields,function(a){a.name!==c.objectIdField&&d.fieldInfos.push({fieldName:a.name,visible:!0,label:a.alias,
isEditable:!1})});var f=new D(b,{mode:D.MODE_SNAPSHOT,infoTemplate:new F(d),outFields:["*"]});f._itemId=e;return f}),d.hitch(this,function(){var a=new D(b);a._itemId=e;return a}))},_clearMessageLogs:function(){q.empty(this.messageSection);q.empty(this.outputSection);b.set(this.resultSection,"display","none");b.set(this.buttonSection,"display","none")},_appendMessage:function(a,b){q.create("div",{"class":"job-message "+(b?b:""),innerHTML:z.stripHTML(a)},this.messageSection)},_appendExecutingMessage:function(){e("div.waiting",
this.messagePanel).forEach(function(a){q.destroy(a)});if(0===e("div.job-executing",this.messagePanel).length){var a=q.create("div",{"class":"job-message job-executing"},this.messageSection);q.create("span",{innerHTML:z.stripHTML(this.nls.executing)},a);q.create("img",{"class":"job-running-icon job-executing",src:this.folderUrl+"images/loading.gif"},a);var b=!1;!0===this.currentToolSetting.cannotCancel?b=!0:0<=this.currentToolSetting.dijitID.indexOf("EnrichLayer")&&this.currentAnalysisDijit&&this.currentAnalysisDijit.enableTravelModes&&
(b=!0);b||(a=q.create("img",{"class":"job-cancel-icon job-executing",src:this.folderUrl+"images/cancel.png",title:this.nls.cancelJob},a),this.own(l(a,"click",d.hitch(this,this._cancelTask))))}},_appendResultMessage:function(a){if(a.paramName){var b=a.paramName,d=q.create("div",{"class":"output-item"},this.outputSection);if(a.value&&a.value.itemId){var e=L.getItemDetailsPageUrl(this._getPortalUrl(this.privilegeUtil.getUserPortal()),a.value.itemId);"object"===typeof this.outputProperties&&a.value.itemId===
this.outputProperties.itemProperties.itemId&&(b=this.outputProperties.serviceProperties.name);q.create("a",{href:e,target:"_blank",innerHTML:z.stripHTML(b)},d)}else c.set(d,"innerHTML",a.paramName);return b}return null},_createExportNodeForUrl:function(a,b,c){var e=new B;e.returnGeometry=c===H.TYPE_FEATURESET;e.outSpatialReference=this.map.spatialReference;e.outFields=["*"];e.where="1\x3d1";return(new C(b)).execute(e).then(d.hitch(this,function(b){var d=q.create("div",{},this.outputSection);q.create("div",
{"class":"output-item",innerHTML:a},d);if(c===H.TYPE_FEATURESET)this._createExportNode(a,b,c,d);else if(c===H.TYPE_TABLE){var e=g.map(b.features,function(a){return a.attributes}),f=[];if(b.fields)f=b.fields;else if(b.features&&0<b.features.length)for(var h in b.features[0].attributes)f.push({name:h});this._createExportNode(a,{fields:f,datas:e},c,d)}}),function(a){console.error(a.message?a.message:a)})},_createExportNode:function(a,b,c,e){e||(e=this.outputSection);a=H.createDataSource({type:c,data:b,
filename:a});var f=new M({dataSource:a});f.hide();p.place(f.domNode,this.domNode);e=q.create("div",{"class":"export-node"},e);this.own(l(e,"click",d.hitch(this,function(a){a.preventDefault();a.stopPropagation();f.show(a.clientX,a.clientY)})))},_getPortalUrl:function(a){return a?L.getStandardPortalUrl(a):L.getStandardPortalUrl(this.appConfig.portalUrl)},_cancelTask:function(){this.currentToolJobId&&this.currentAnalysisDijit&&this.currentAnalysisDijit.cancel({jobId:this.currentToolJobId})},_switchToPrevious:function(){this._deactiveDrawTool();
2===this.currentStack?this._switchToAnalysisTool():this._switchView(0)},_switchToHome:function(){this._deactiveDrawTool();1<this.toolCountInList?this._switchView(0):this._switchToAnalysisTool()},_switchView:function(a){this._closeHelpDialog();0===a&&this._checkValidation();this.currentStack=a;this.viewStack.switchView(a)}})});