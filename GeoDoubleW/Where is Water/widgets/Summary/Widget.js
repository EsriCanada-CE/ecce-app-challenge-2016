// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"widgets/Summary/ClusterLayer":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/Color esri/layers/GraphicsLayer esri/graphic esri/geometry/geometryEngine esri/geometry/Extent esri/geometry/Point esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol".split(" "),function(e,d,b,a,g,h,w,y,m,z,n,v){return e("ClusterLayer",[a],{constructor:function(a){this.name=a.id;this.displayOnPan=a.displayOnPan||!1;this._map=a.map;this.clusterSize=
a.clusterSize||100;this.color=a.color||"#ff0000";this.countField=a.countField;this._features=[];try{this.setFeatures(a.features)}catch(b){console.log(b)}this.loaded=!0;this.onLoad(this)},setFeatures:function(a){this._map.infoWindow.isShowing&&this._map.infoWindow.hide();this._features=a;this._clusterFeatures()},setColor:function(a){this.color=a;this._clusterFeatures()},_clusterFeatures:function(){this.clear();var a=this._features;if(0<a.length){var d=this.clusterSize,e=[],A=this._map.spatialReference,
s=this._map.extent,p=s.normalize();1<p.length&&(s=h.union(p).getExtent());for(var p=new y(s.xmin,s.ymax,A),r=Math.ceil(this._map.height/d),x=Math.ceil(this._map.width/d),q=s.getWidth()/this._map.width*d,d=s.getHeight()/this._map.height*d,s=0;s<r;s++)for(var B=0;B<x;B++){var t=p.x+q*B,u=p.y-d*s,u=new w(t,u-d,t+q,u,A),t=[],k;for(k in a){var f=a[k];u.contains(f.geometry)&&t.push(f)}0<t.length&&(u=this._getClusterCenter(t),e.push({center:u,graphics:t}))}for(var c in e)a=e[c],A=this._getClusterCount(a),
p=a.graphics,r=A.toString(),x=19*r.length,q=this._getSymbolColor(),d=new z(z.STYLE_NULL,new b(0,0,0,0),0),k=new m(m.STYLE_CIRCLE,1.6*x,d,new b([q[0],q[1],q[2],0.4])),x=new m(m.STYLE_CIRCLE,x,d,new b([q[0],q[1],q[2],0.8])),q=new n,q.family="Arial",q.size="12px",r=new v(r,q,"#ffffff"),r.setOffset(0,-4),p={Count:A,Data:p},1<A?(this.add(new g(a.center,k,p)),this.add(new g(a.center,x,p)),this.add(new g(a.center,r,p))):(a=a.graphics[0].geometry,this.add(new g(a,x,p)),this.add(new g(a,r,p)))}},_getSymbolColor:function(){var a=
b.fromString(this.color),d=b.fromString("#000000");return b.blendColors(a,d,0.1).toRgb()},_getClusterCount:function(a){for(var b=0,d=0;d<a.graphics.length;d++)var g=a.graphics[d],b=this.countField&&g.attributes[this.countField]?b+g.attributes[this.countField]:b+1;return b},_getClusterCenter:function(a){var b=0,g=0,e=a.length;d.forEach(a,function(a){b+=a.geometry.x;g+=a.geometry.y},this);return new y(b/e,g/e,a[0].geometry.spatialReference)}})})},"widgets/Summary/c":function(){define(function(){function e(d,
b){this.wrapper=d;this.wrapperId=d.id;this.timeoutTimerId=this.intervalTimerId=null;this.isAnimating=!1;this.animationProgress=this.animationStep=0;this.beforeAnimation=[];this.afterAnimation=[];this.digitsNumber=b.digitsNumber||6;this.direction=b.direction||e.ScrollDirection.Mixed;this.value=b.value||"";this.characterSet=b.characterSet||e.DefaultCharacterSets.allCharacters;this.characterNumber=this.characterSet.length;this.animationDuration=b.animationDuration||50;var a=["wrapper","left","inner",
"right","marker"];this.extraClassName={};for(var g=0;g<a.length;g++)this.extraClassName[a[g]]=b.extraClassName?"string"===typeof b.extraClassName?b.extraClassName:b.extraClassName[a[g]]||"":"";this.onLoad=b.onLoad||null;this.onValueChanged=b.onValueChanged||null;var h=this;this.imageLoadCounter=0;this.charsImage=new Image;this.charsImage.onload=function(){h.finishLoading()};this.charsImage.src=b.charsImageUrl;this.markerImage=new Image;this.markerImage.onload=function(){h.finishLoading()};this.markerImage.src=
b.markerImageUrl}e.DefaultCharacterSets={numericUp:"0123456789",numericDown:"9876543210",alphabeticUp:" ABCDEFGHIJKLMNOPQRSTUVWXYZ",alphabeticDown:"ZYXWVUTSRQPONMLKJIHGFEDCBA ",alphanumericUp:"0123456789 ABCDEFGHIJKLMNOPQRSTUVWXYZ",alphanumericDown:"9876543210ZYXWVUTSRQPONMLKJIHGFEDCBA ",calculator:"0123456789.,+-*/\x3d ",qwertyKeybord:" QWERTYUIOPASDFGHJKLZXCVBNM1234567890-\x3d[]\\;',./~`!@#$%^\x26*()_+{}|:\"\x3c\x3e?",allCharacters:" ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-\x3d[]\\;',./~`!@#$%^\x26*()_+{}|:\"\x3c\x3e?"};
e.ScrollDirection={Downwards:-1,Mixed:0,Upwards:1};e.prototype.finishLoading=function(){this.imageLoadCounter++;if(!(2!==this.imageLoadCounter||!this.charsImage.width||!this.markerImage.width)){this.digitWidth=this.charsImage.width;this.digitHeight=Math.ceil(this.charsImage.height/this.characterNumber);this.offsetHeight=(this.markerImage.height-this.digitHeight)/2;this.makrer=document.createElement("DIV");this.makrer.className="counter_marker"+(this.extraClassName.marker?" ":"")+this.extraClassName.marker;
this.makrer.style.backgroundImage="url('"+this.markerImage.src+"')";this.makrer.style.width=this.digitWidth*this.digitsNumber+this.digitsNumber+"px";this.makrer.style.height=this.markerImage.height+"px";this.wrapper.className=this.wrapper.className+(this.extraClassName.marker?" ":"")+this.extraClassName.marker;this.wrapper.style.width=this.makrer.style.width;this.wrapper.style.height=this.makrer.style.height;this.wrapper.appendChild(this.makrer);for(var d=0,b=0,d=0;d<this.digitsNumber;d++){var a=
document.createElement("DIV");a.id=this.wrapperId+"_"+d;a.className="counter_character";a.className=0===d?a.className+(" counter_character_left"+(this.extraClassName.left?" ":"")+this.extraClassName.left):d===this.digitsNumber-1?a.className+(" counter_character_right"+(this.extraClassName.right?" ":"")+this.extraClassName.right):a.className+(" counter_character_inner"+(this.extraClassName.inner?" ":"")+this.extraClassName.inner);a.style.backgroundImage="url('"+this.charsImage.src+"')";a.style.width=
this.digitWidth+"px";a.style.height=this.markerImage.height+"px";a.style.top=-this.markerImage.height+"px";this.wrapper.appendChild(a);b+=e._parseInt(e._elementCurrentStyle(a,"margin-left"));b+=e._parseInt(e._elementCurrentStyle(a,"margin-right"));b+=e._parseInt(e._elementCurrentStyle(a,"border-left-width"));b+=e._parseInt(e._elementCurrentStyle(a,"border-right-width"));b+=this.digitWidth}this.makrer.style.width=b+"px";this.wrapper.style.width=b+"px";if(null!==this.onLoad)this.onLoad();this.setValue(this.value,
100)}};e.prototype.animate=function(d){this.animationProgress=d?1:this.animationProgress+this.animationStep;1<=this.animationProgress&&(this.animationProgress=1,this.timeoutTimerId&&clearTimeout(this.timeoutTimerId),this.intervalTimerId&&clearTimeout(this.intervalTimerId),this.isAnimating=!1,this.intervalTimerId=this.timeoutTimerId=null);d=0;var b=this.wrapper.id+"_";for(d=0;d<this.beforeAnimation.length;d++){var a=e._getDijitById(this,b+(this.digitsNumber-d-1));if(a){var g=0,g=1>this.animationProgress?
this.beforeAnimation[d]+(this.afterAnimation[d]-this.beforeAnimation[d])*this.animationProgress:this.afterAnimation[d];a.style.backgroundPosition="0px "+e._parseInt(g)+"px"}}};e.prototype.setValue=function(d,b){if(2!==this.imageLoadCounter||!this.charsImage.width||!this.markerImage.width){if(this.value=d,null!==this.onValueChanged)this.onValueChanged()}else{this.timeoutTimerId&&clearTimeout(this.timeoutTimerId);this.intervalTimerId&&clearTimeout(this.intervalTimerId);var a=0,g=this.wrapper.id+"_",
h;this.beforeAnimation=[];this.afterAnimation=[];for(a=this.digitsNumber-1;0<=a;a--)h=e._getDijitById(this,g+(this.digitsNumber-a-1)),this.beforeAnimation[a]=Number(h.style.backgroundPosition.substr(4).replace("px",""));for(var w=this.value.toString?this.value.toString():String(this.value),y=d.toString?d.toString():String(d),a=this.digitsNumber-1;0<=a;a--){h=e._getDijitById(this,g+(this.digitsNumber-a-1));h=-1;0<=w.length-a-1&&(h=w.charAt(w.length-a-1).toUpperCase(),h=this.characterSet.indexOf(h));
-1===h&&(h=this.characterSet.indexOf(" "));-1===h&&(h=this.characterSet.indexOf("0"));-1===h&&(h=0);var m=-1;0<=y.length-a-1&&(m=y.charAt(y.length-a-1).toUpperCase(),m=this.characterSet.indexOf(m));-1===m&&(m=this.characterSet.indexOf(" "));-1===m&&(m=this.characterSet.indexOf("0"));-1===m&&(m=0);this.afterAnimation[a]=Math.round(-this.digitHeight*m+this.offsetHeight);0===this.direction?Math.abs(h-m)>this.characterNumber/2&&(this.beforeAnimation[a]=m<h?this.beforeAnimation[a]+this.digitHeight*this.characterNumber:
this.beforeAnimation[a]-this.digitHeight*this.characterNumber):-1===this.direction?this.beforeAnimation[a]>this.afterAnimation[a]&&(this.beforeAnimation[a]-=this.digitHeight*this.characterNumber):1===this.direction&&this.beforeAnimation[a]<this.afterAnimation[a]&&(this.beforeAnimation[a]+=this.digitHeight*this.characterNumber)}this.value=d;if(null!==this.onValueChanged)this.onValueChanged();b&&0<parseInt(b,10)||(b=1E3);this.isAnimating=!0;a=this.animationDuration;this.animationStep=a/b;this.animationProgress=
0;var z=this;b>a&&(this.intervalTimerId=setInterval(function(){z.animate(!1)},a));this.timeoutTimerId=setTimeout(function(){z.animate(!0)},b)}};e._parseInt=function(d){d=parseInt(d,10);isNaN(d)&&(d=0);return d};e._elementCurrentStyle=function(d,b){if(d.currentStyle){for(var a=0,g="",e=!1,a=0;a<b.length;a++)b.charAt(a)&&("-"!==b.charAt(a)||"-"!==b.charAt(a).toString())?(g=b.charAt(a).toString?g+(e?b.charAt(a).toString().toUpperCase():b.charAt(a).toString()):g+(e?b.charAt(a).toUpperCase():b.charAt(a)),
e=!1):e=!0;return d.currentStyle[g]}return getComputedStyle(d,null).getPropertyValue(b)};e._getDijitById=function(d,b){for(var a=d.wrapper.childNodes,g=0;g<a.length;g++){var e=a[g];if(e.id===b)return e}return null};return e})},"widgets/Summary/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:widgets/Summary/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"panelBottom"\x3e\r\n    \x3c!-- Panel Main --\x3e\r\n    \x3cdiv id\x3d"panelMain"\x3e\r\n      \x3c!-- Panel Container --\x3e\r\n      \x3cdiv id\x3d"panelContainer" data-dojo-attach-point\x3d"containerNode"\x3e\r\n        \x3cdiv id\x3d"panel0" class\x3d"col" data-dojo-attach-point\x3d"panel0Node"\x3e\r\n          \x3cdiv id\x3d"title0" class\x3d"titleCounter" data-dojo-attach-point\x3d"title0Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"counter0" class\x3d"counter" data-dojo-attach-point\x3d"counter0Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"units0" class\x3d"units" data-dojo-attach-point\x3d"units0Node"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"panel1" class\x3d"col line" data-dojo-attach-point\x3d"panel1Node"\x3e\r\n          \x3cdiv id\x3d"title1" class\x3d"titleCounter" data-dojo-attach-point\x3d"title1Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"counter1" class\x3d"counter" data-dojo-attach-point\x3d"counter1Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"units1" class\x3d"units" data-dojo-attach-point\x3d"units1Node"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"panel2" class\x3d"col line" data-dojo-attach-point\x3d"panel2Node"\x3e\r\n          \x3cdiv id\x3d"title2" class\x3d"titleCounter" data-dojo-attach-point\x3d"title2Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"counter2" class\x3d"counter" data-dojo-attach-point\x3d"counter2Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"units2" class\x3d"units" data-dojo-attach-point\x3d"units2Node"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3cdiv id\x3d"panel3" class\x3d"col line" data-dojo-attach-point\x3d"panel3Node"\x3e\r\n          \x3cdiv id\x3d"title3" class\x3d"titleCounter" data-dojo-attach-point\x3d"title3Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"counter3" class\x3d"counter" data-dojo-attach-point\x3d"counter3Node"\x3e\x3c/div\x3e\r\n          \x3cdiv id\x3d"units3" class\x3d"units" data-dojo-attach-point\x3d"units3Node"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Nav --\x3e\r\n    \x3cdiv id\x3d"panelNav"\x3e\r\n      \x3cul class\x3d"navigation" data-dojo-attach-point\x3d"pagesListNode"\x3e\x3c/ul\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv id\x3d"panelMessage" data-dojo-attach-point\x3d"messageNode"\x3e\r\n      \x3cspan id\x3d"msgText" data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv id\x3d"panelFooter" data-dojo-attach-point\x3d"footerNode"\x3e\r\n      \x3cdiv id\x3d"panelLabel" data-dojo-attach-point\x3d"labelNode"\x3e\x3c/div\x3e\r\n      \x3cdiv id\x3d"panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n      \x3cdiv id\x3d"panelFooterContent" data-dojo-attach-point\x3d"footerContentNode"\x3e\r\n        \x3cspan id\x3d"labelFilter"\x3e${nls.filter}\x3c/span\x3e\r\n        \x3cdiv id\x3d"panelFilter"\x3e\r\n          \x3cselect id\x3d"selFilter" data-dojo-attach-point\x3d"filterNode"\x3e\x3c/select\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/Summary/css/style.css":".jimu-widget-summary {color: #ffffff !important; background-color: #4c4c4c; left: 0px !important; right: 0px !important; bottom: 0px; height: 140px !important; display: block; z-index: 100 !important;}.jimu-widget-summary .panelBottom {position: absolute; width: 100%; height: 140px; left: 0px; top: 0px; text-align: center; padding: 0px;}.jimu-widget-summary #panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-summary #panelMain {position: absolute; width: 100%; height: 80px; left: 0px; top: 0px; text-align: center; padding: 0px;}.jimu-widget-summary #panelContainer {margin: auto; width: 100%; max-width: 880px; height: 80px; overflow: hidden; padding-top: 0px;}.jimu-widget-summary .col {position: relative; width: 219px; height: 80px; padding: 0px; margin-top: 10px; margin-bottom: 0px; display: none; text-align: center; float: left;}.jimu-rtl .jimu-widget-summary .col {float: right;}.jimu-widget-summary .line {border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5);}.jimu-rtl .jimu-widget-summary .line {border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5);}.jimu-widget-summary .titleCounter {position: absolute; top: 0px; left: 10px; right: 10px; height: 15px; font-weight: bold; line-height: 15px; letter-spacing: 1px; text-align: right; display: block; overflow: hidden;}.jimu-widget-summary .counter {position: absolute; top: 20px; left: 7px; width: 204px; height: 40px; display: block;}.jimu-widget-summary .units {position: absolute; bottom: 0px; left: 10px; right: 109px; height: 15px; font-weight: normal; line-height: 15px; letter-spacing: 1px; text-align: right; display: block;}.jimu-widget-summary .counter_character {display: inline; float: left; position: relative; margin-left: 0px; margin-right: 0px;}.jimu-widget-summary .counter_character_left {margin-left: 0px; margin-right: 0px;}.jimu-widget-summary .counter_character_inner {margin-left: 0px; margin-right: 0px;}.jimu-widget-summary .counter_character_right {margin-left: 0px; margin-right: 0px;}.jimu-widget-summary .counter_marker {position: relative; z-index: 10;}.jimu-widget-summary #panelNav {position: absolute; width: 100%; height: 20px; left: 0px; bottom: 40px; padding: 0px; line-height: 20px;}.jimu-widget-summary .navigation {list-style-type: none; width: 60px; height: 20px; margin: auto; padding: 0px;}.jimu-widget-summary .navigation li {width: 20px; height: 20px; float: left; background: url(images/dot.png);}.jimu-rtl .jimu-widget-summary .navigation li {float: right;}.jimu-widget-summary .navigation li:hover {background: url(images/doton.png);}.jimu-widget-summary .navigation li.active {background: url(images/doton.png);}.jimu-widget-summary #panelFooter {position: absolute; bottom: 0px; left: 0px; right: 0px; height: 40px; line-height: 40px; background-color: #3d3d3d; background-color: rgba(0, 0, 0, 0.2); border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-summary #panelLabel {position: absolute; height: 40px; line-height: 40px; padding: 0 0 0 10px; text-align: left; display: block; font-size: 16px;}.jimu-rtl .jimu-widget-summary #panelLabel {text-align: right; padding: 0 10px 0;}.jimu-widget-summary #panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 40px; line-height: 40px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 18px;}.jimu-rtl .jimu-widget-summary #panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-summary #panelFooterContent {position: absolute; left: auto; right: 24px; height: 40px; line-height: 40px; text-align: right; display: none;}.jimu-rtl .jimu-widget-summary #panelFooterContent {position: absolute; left: 24px; right: auto; text-align: left;}.jimu-widget-summary #panelFilter {float: right; position: relative; margin: 5px 10px 5px 10px; width: 200px; height: 30px; overflow: hidden; background-color: #353535; background-color: rgba(0, 0, 0, 0.3); z-index: 2; border-radius: 4px;}.jimu-rtl .jimu-widget-summary #panelFilter {float: left;}#labelFilter {display: inline-block;}.jimu-widget-summary #selFilter {position: absolute; left: 0px; top: 0px; margin: 0px; color: #ffffff; outline: transparent; background: transparent; width: 200px; padding: 0px 0px 0px 5px; font-size: 14px; line-height: 1; border: none; border-radius: 0; height: 30px;}.jimu-widget-summary option {background-color: #ffffff; color: #000000;}@media only screen and (max-width: 500px) {#panelLabel {display: none !important;} #labelFilter {display: none !important;}}",
"url:widgets/Summary/config.json":'{\r\n  "displayCluster": true,\r\n  "showFeatureCount": true,\r\n  "featureCountLabel": "",\r\n  "summaryLayer": {}\r\n}\r\n',"*now":function(e){e(['dojo/i18n!*preload*widgets/Summary/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare jimu/BaseWidget jimu/utils dojo/dom dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/event dojo/_base/html dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query esri/geometry/geometryEngine esri/graphic esri/layers/FeatureLayer esri/tasks/query dojo/number esri/tasks/StatisticDefinition ./ClusterLayer esri/graphicsUtils dojo/on widgets/Summary/c".split(" "),function(e,d,b,a,g,h,w,y,m,z,n,v,D,C,E,A,s,p,r,x,q,B,t,u){return e([d],{baseClass:"jimu-widget-summary",
name:"Summary",clusterLayer:null,counter0:null,counter1:null,counter2:null,counter3:null,fieldCount:0,pageCount:0,page:0,visCount:4,summaryIds:[],summaryFeatures:[],postCreate:function(){this.inherited(arguments);this.config.summaryLayer?(this.showFeatureCount=this.config.showFeatureCount,this.featureCountLabel=this.config.featureCountLabel,this.displayCluster=this.config.displayCluster,this.filterField=this.config.summaryLayer.filterField):this._showMessage(this.nls.missingSummaryLayerInConfig)},
startup:function(){this.inherited(arguments);this._updateUI();this._loadCounters();""!==this.filterField&&g.set(this.footerContentNode,"display","block");var k=new q({id:this.label,displayOnPan:!0,map:this.map,clusterSize:120,color:"#6e6e6e",countField:null,features:[]});this.map.addLayer(k);this.clusterLayer=k;this.own(t(this.clusterLayer,"click",n.hitch(this,this._clusterClick)));this.labelNode.innerHTML=b.sanitizeHTML(this.label?this.label:"");this._getStyleColor(null);this.opLayers=this.map.itemInfo.itemData.operationalLayers;
this._processOperationalLayers();this.own(t(this.filterNode,"change",n.hitch(this,this._setFilter)))},destroy:function(){this.clusterLayer&&(this.map.removeLayer(this.clusterLayer),w.destroy(this.clusterLayer));this.inherited(arguments)},onOpen:function(){this.inherited(arguments);this._updateLayerVisibility();this._summarize()},onClose:function(){this._updateLayerVisibility();this.inherited(arguments)},resize:function(){"closed"!==this.state&&(this.inherited(arguments),this.resizeTimer&&(clearTimeout(this.resizeTimer),
this.resizeTimer=null),this.resizeTimer=setTimeout(n.hitch(this,this._loadPages),600))},onAppConfigChanged:function(k,a,c){switch(a){case "styleChange":this._updateUI(c)}},_updateUI:function(k){this._getStyleColor(k)},setPosition:function(k,a){if("BoxTheme"===this.appConfig.theme.name||"DartTheme"===this.appConfig.theme.name||"LaunchpadTheme"===this.appConfig.theme.name)this.inherited(arguments);else{this.position={left:"0px",right:"0px",bottom:"0px",height:"140px"};var c=b.getPositionStyle(this.position);
c.position="absolute";a=this.map.id;z.place(this.domNode,a);z.setStyle(this.domNode,c);this.started&&this.resize();"TabTheme"===this.appConfig.theme.name&&(c=this.widgetManager.getControllerWidgets()[0],this.widgetManager.minimizeWidget(c.id))}},_getStyleColor:function(k){var a=this.appConfig.theme.name,c=this.appConfig.theme.styles[0];k&&(c=k);D.get({url:"./themes/"+a+"/manifest.json",handleAs:"json",load:n.hitch(this,function(k){k=k.styles;for(var a=0;a<k.length;a++){var f=k[a];f.name===c&&(g.set(this.footerNode,
"background-color",f.styleColor),this.clusterLayer.setColor(f.styleColor))}})})},_clusterClick:function(k){var a=k.graphic,c=a.attributes.Count,l=a.attributes.Data,a=c+" Features";1===c&&(a=c+" Feature");for(var c=this._summarizeAttributes(l),l="",b=0;b<this.fieldCount;b++)if(0!==b||this.config.showFeatureCount)l+=this.aliases[b]+": "+c[b]+"\x3cbr/\x3e\x3cbr/\x3e";this.map.infoWindow.setTitle(a);this.map.infoWindow.setContent(l);this.map.infoWindow.show(k.mapPoint);m.stop(k)},_loadCounters:function(){var a=
{digitsNumber:17,direction:u.ScrollDirection.Upwards,characterSet:"0123456789.,- ",charsImageUrl:"widgets/Summary/images/c.png",markerImageUrl:"widgets/Summary/images/m.png"};this.counter0=new u(this.counter0Node,a);this.counter0.value=0;this.counter1=new u(this.counter1Node,a);this.counter1.value=0;this.counter2=new u(this.counter2Node,a);this.counter2.value=0;this.counter3=new u(this.counter3Node,a);this.counter3.value=0},_processOperationalLayers:function(){if(this.opLayers){var a=this.config.summaryLayer.id;
""!==a?v.some(this.opLayers,n.hitch(this,function(f){if("ArcGISFeatureLayer"===f.layerType){if(f.layerObject&&f.id===a){var c=[];v.forEach(this.config.summaryLayer.fields,function(a){c.push(a.field)});this.targetLayer=f.layerObject;this.opLayer=new s(f.layerObject.url,{outFields:c,infoTemplate:f.layerObject.infoTemplate});this._setLayer();return!0}if(f.featureCollection)for(;0<f.featureCollection.layers.length;)return f=f.featureCollection.layers[0].layerObject,f.id===a&&(this.opLayer=this.targetLayer=
f,this.opLayerIsFeatureCollection=!0),this._setLayer(),!0}})):this._showMessage(this.nls.missingSummaryLayerInConfig)}else this._showMessage(this.nls.missingLayerInWebMap)},_setLayer:function(){this.map.infoWindow.isShowing&&this.map.infoWindow.hide();this._closeMessage();this.targetLayerVisibility=this.targetLayer.visible?!0:!1;this.own(t(this.map,"extent-change",n.hitch(this,this._summarize)));this._configureFields();this._populateFilterValues();this._loadPages();"esriGeometryPoint"===this.opLayer.geometryType&&
this.displayCluster&&this.clusterLayer.setVisibility(!0);n.hitch(this,this._summarize)},_configureFields:function(){if(this.config.summaryLayer&&this.config.summaryLayer.fields){var a=[this.featureCountLabel],f=[];v.forEach(this.config.summaryLayer.fields,n.hitch(this,function(c){f.push(c);var l=c.label;0===l.length&&(l=this._getFieldAlias(c.field));a.push(l)}));this.fields=[{field:"",type:"COUNT",label:this.featureCountLabel}].concat(f);this.aliases=a;this.fieldCount=this.fields.length}},_populateFilterValues:function(){var a=
this.filterField;if(a){var f=[],c=this._getFilterField(a);if(c&&c.domain&&"codedValue"===c.domain.type){for(var c=c.domain.codedValues,l=0;l<c.length;l++){var b=c[l];f.push({value:b.code,label:b.name})}this.populateOptions(f)}else if(this.opLayerIsFeatureCollection){var d={};v.forEach(this.opLayer.graphics,function(c){c=c.attributes[a];d[c]||(d[c]=!0,f.push({value:c,label:c}))});f.sort(function(a,c){return a.value<c.value?-1:a.value>c.value?1:0});this._populateOptions(f)}else c=new p,l=new x,l.statisticType=
"count",l.onStatisticField=a,l.outStatisticFieldName="STAT_COUNT",c.returnGeometry=!1,c.where="1\x3d1",c.orderByFields=[a],c.groupByFieldsForStatistics=[a],c.outStatistics=[l],this.opLayer.queryFeatures(c,n.hitch(this,function(c){for(var b=0;b<c.features.length;b++){var l=c.features[b].attributes[a];null!==l&&f.push({value:l,label:l})}this._populateOptions(f)}))}},_getFilterField:function(a){var f;v.some(this.opLayer.fields,function(c){if(c.name===a)return f=c,!0});return f},_getFieldAlias:function(a){if(this.opLayer.infoTemplate)for(var f=
this.opLayer.infoTemplate.info.fieldInfos,c=0;c<f.length;c++){var b=f[c];if(b.fieldName===a)return b.label}return a},_loadPages:function(){if(this.fields)try{var a=y.getContentBox(this.containerNode).w;this.visCount=Math.floor(a/220);var f=this.fieldCount=this.fields.length;this.config.showFeatureCount||(f-=1);this.pageCount=Math.ceil(f/this.visCount);var c=this.pagesListNode;c.innerHTML="";if(1<this.pageCount){g.set(c,"width",20*this.pageCount+"px");for(a=0;a<this.pageCount;a++){var b=w.create("li",
{id:"pageSum"+a},c);this.own(t(b,"click",n.hitch(this,this._setPage,a)))}}this.page=0;this._setPage(0)}catch(d){console.log(d)}},_setPage:function(a){var f=C("\x3e li",this.pagesListNode);v.forEach(f,function(c){c.id==="pageSum"+a?h.add(c,"active"):h.remove(c,"active")});this.page=a;var f=C("\x3e div",this.containerNode),c=0;v.forEach(f,function(a){c<this.visCount?g.set(a,"display","block"):g.set(a,"display","none");c+=1});this._updateCounters()},_summarize:function(){this.sumTimer&&(clearTimeout(this.sumTimer),
this.sumTimer=null);this.sumTimer=setTimeout(n.hitch(this,this._summarizeFeatures),600)},_summarizeFeatures:function(){if(!(0<this.summaryIds.length)&&(this.summaryIds=[],this.summaryFeatures=[],this.opLayer)){var a=this.map.extent,f=a.normalize();1<f.length&&(a=E.union(f).getExtent());if(this.opLayerIsFeatureCollection){var f=[],c=this.filterField,b;c&&(b=this.filterNode,b=b.options[b.selectedIndex].value);for(var d=0;d<this.opLayer.graphics.length;d++){var e=this.opLayer.graphics[d];a.intersects(e.geometry)&&
(c?(e.attributes[c].toString()===b||""===b)&&f.push(e):f.push(e))}this.summaryFeatures=f;this.displayCluster&&"esriGeometryPoint"===this.targetLayer.geometryType&&this.clusterLayer.setFeatures(f);this.sumData=this._summarizeAttributes(f);this._updateCounters()}else this._queryFeatures(a)}},_queryFeatures:function(a){this.summaryIds=[];this.summaryFeatures=[];var f=new p;f.geometry=a;this.defQuery&&(this.defQuery.cancel("new"),this.defQuery=null);this.defQuery=this.opLayer.queryIds(f,n.hitch(this,
function(a){this.summaryIds=a;0<this.summaryIds.length?this._queryFeaturesByIds():(this.sumData=this._summarizeAttributes(this.summaryFeatures),this._updateCounters())}))},_queryFeaturesByIds:function(){var a=this.opLayer.maxRecordCount||1E3,f=this.summaryIds.slice(0,a);this.summaryIds.splice(0,a);a=new p;a.outSpatialReference=this.map.spatialReference;a.returnGeometry=this.displayCluster&&"esriGeometryPoint"===this.targetLayer.geometryType?!0:!1;a.objectIds=f;this.opLayer.queryFeatures(a,n.hitch(this,
function(a){this.summaryFeatures=this.summaryFeatures.concat(a.features);this.displayCluster&&"esriGeometryPoint"===this.targetLayer.geometryType&&this.clusterLayer.setFeatures(this.summaryFeatures);this.sumData=this._summarizeAttributes(this.summaryFeatures);this._updateCounters();0<this.summaryIds.length&&setTimeout(n.hitch(this,this._queryFeaturesByIds),900)}))},_showMessage:function(a){g.set(this.containerNode,"display","none");this.messageTextNode.innerHTML=a;g.set(this.messageNode,"display",
"block")},_summarizeAttributes:function(a){var f=[];v.forEach(this.fields,n.hitch(this,function(c){var b=c.field.replace(/^\s+|\s+$/g,"");"SUM"===c.type?f.push(this._calculateSum(a,b)):"AVG"===c.type?f.push(this._calculateAvg(a,b)):"MAX"===c.type?f.push(this._calculateMax(a,b)):"MIN"===c.type?f.push(this._calculateMin(a,b)):"COUNT"===c.type&&f.push(a.length)}));return f},_calculateSum:function(a,b){for(var c=0,d=0;d<a.length;d++){var e=a[d].attributes[b];isNaN(e)||(c+=e)}return c},_calculateAvg:function(a,
b){for(var c=a.length,d=0,e=0;e<a.length;e++){var g=a[e].attributes[b];isNaN(g)||(d+=g)}return d/c},_calculateMax:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d].attributes[b];isNaN(e)||(0===d?c=e:e>c&&(c=e))}return c},_calculateMin:function(a,b){for(var c,d=0;d<a.length;d++){var e=a[d].attributes[b];isNaN(e)||(0===d?c=e:e<c&&(c=e))}return c},_updateCounters:function(){for(var a=this.visCount,b=0;b<a;b++){var c=this.page*a+b;this.config.showFeatureCount||(c+=1);var d=this["panel"+b+"Node"];
c<this.fieldCount?(g.set(d,"display","block"),this.sumData&&this._updateCounter(b,c)):g.set(d,"display","none")}},_updateCounter:function(a,d){var c=this.sumData[d],e=c,g="";1E13<=c&&(e=Math.floor(10*c/1E12)/10,g="TRILLIONS");c=this["counter"+a];e=this._formatNumber(e);null!==c&&null!==e&&c.setValue(e);this["title"+a+"Node"].innerHTML=b.sanitizeHTML(this.aliases[d]?this.aliases[d]:"");this["units"+a+"Node"].innerHTML=g},_formatNumber:function(a){var b;-1E3<a&&1E3>a?(b=a.toFixed(2),a=r.format(b,{places:2}),
0===a%1&&(a=r.format(b,{places:0}))):(b=r.round(a),a=r.format(b,{places:0}));return a},_closeMessage:function(){g.set(this.messageNode,"display","none");g.set(this.containerNode,"display","block")},_populateOptions:function(a){if(0<a.length){var b=this.filterNode;null===b&&console.log("Filter search drop down not configured");w.create("option",{value:"",innerHTML:this.nls.all},b);for(var c=0;c<a.length;c++){var d=a[c];w.create("option",{value:d.value,innerHTML:d.label},b)}}},_setFilter:function(){var a=
this.filterNode,b=this.filterField,c=a.options[a.selectedIndex].value,d;if(this.opLayerIsFeatureCollection){var e=[];v.forEach(this.opLayer.graphics,function(a){if(a.attributes[b].toString()===c||""===c){var d=new A(a.geometry,a.symbol,a.attributes);a.show();e.push(d)}else a.hide()});0<e.length&&((d=B.graphicsExtent(e))?this.map.setExtent(d.expand(2)):0<e.length&&this.map.centerAt(e[0].geometry))}else{var g=this._getFilterField(b),a=b+" \x3d "+c;g&&"esriFieldTypeString"===g.type&&(a=b+" \x3d '"+c+
"'");""===c&&(a="1\x3d1");this.opLayer.setDefinitionExpression(a);this.targetLayer.setDefinitionExpression(a);a&&(g=new p,g.returnGeometry=!0,g.where=a,this.opLayer.queryFeatures(g,n.hitch(this,function(a){d=B.graphicsExtent(a.features);this.map.setExtent(d.expand(1.5))})))}},_close:function(){this.widgetManager.closeWidget(this.id)},_updateLayerVisibility:function(){this.targetLayer&&("closed"===this.state?(this.displayCluster&&"esriGeometryPoint"===this.targetLayer.geometryType&&this.targetLayer.setVisibility(this.targetLayerVisibility),
this.clusterLayer&&this.clusterLayer.setVisibility(!1)):(this.displayCluster&&"esriGeometryPoint"===this.targetLayer.geometryType&&this.targetLayer.setVisibility(!1),this.clusterLayer&&this.clusterLayer.setVisibility(!0)))}})});