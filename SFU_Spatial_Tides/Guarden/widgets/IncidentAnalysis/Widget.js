// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/tasks/locator":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ./Task ./AddressCandidate".split(" "),function(e,m,q,n,r,p,c,f,g,w,b){return e(w,{declaredClass:"esri.tasks.Locator",_eventMap:{"address-to-locations-complete":["addresses"],"addresses-to-locations-complete":["addresses"],"location-to-address-complete":["address"],"suggest-locations-complete":["suggestions"]},
constructor:function(a){this._geocodeHandler=m.hitch(this,this._geocodeHandler);this._geocodeAddressesHandler=m.hitch(this,this._geocodeAddressesHandler);this._reverseGeocodeHandler=m.hitch(this,this._reverseGeocodeHandler);this.registerConnectEvents()},outSpatialReference:null,setOutSpatialReference:function(a){this.outSpatialReference=a},_geocodeHandler:function(a,u,d,c,h){try{var y=a.candidates,f;u=[];var g,l=y.length,s=a.spatialReference,k;for(g=0;g<l;g++){f=y[g];if(k=f.location)k.spatialReference=
s;u[g]=new b(f)}this._successHandler([u],"onAddressToLocationsComplete",d,h)}catch(F){this._errorHandler(F,c,h)}},_geocodeAddressesHandler:function(a,u,d,c,h){try{var y=a.locations;u=[];var g,f=y.length,l=a.spatialReference,s;for(g=0;g<f;g++){if(s=y[g].location)s.spatialReference=l;u[g]=new b(y[g])}this._successHandler([u],"onAddressesToLocationsComplete",d,h)}catch(k){this._errorHandler(k,c,h)}},addressToLocations:function(a,b,d,c,h){var y,p,e,l,s,k,F;a.address&&(c=d,d=b,b=a.outFields,h=a.searchExtent,
F=a.countryCode,y=a.magicKey,p=a.distance,k=a.categories,a.location&&this.normalization&&(e=a.location.normalize()),l=a.maxLocations,s=a.forStorage,a=a.address);h&&(h=h.shiftCentralMeridian());var G=this.outSpatialReference;a=this._encode(m.mixin({},this._url.query,a,{f:"json",outSR:G&&r.toJson(G.toJson()),outFields:b&&b.join(",")||null,searchExtent:h&&r.toJson(h.toJson()),category:k&&k.join(",")||null,countryCode:F||null,magicKey:y||null,distance:p||null,location:e||null,maxLocations:l||null,forStorage:s||
null}));var H=this._geocodeHandler,v=this._errorHandler,q=new n(g._dfdCanceller);q._pendingDfd=f({url:this._url.path+"/findAddressCandidates",content:a,callbackParamName:"callback",load:function(a,k){H(a,k,d,c,q)},error:function(a){v(a,c,q)}});return q},suggestLocations:function(a){var b;b=new n(g._dfdCanceller);a.hasOwnProperty("location")&&this.normalization&&(a.location=a.location.normalize());a.searchExtent&&(a.searchExtent=a.searchExtent.shiftCentralMeridian());a=this._encode(m.mixin({},this._url.query,
{f:"json",text:a.text,maxSuggestions:a.maxSuggestions,searchExtent:a.searchExtent&&r.toJson(a.searchExtent.toJson()),category:a.categories&&a.categories.join(",")||null,countryCode:a.countryCode||null,location:a.location||null,distance:a.distance||null},{f:"json"}));a=f({url:this._url.path+"/suggest",content:a,callbackParamName:"callback"});b._pendingDfd=a;a.then(m.hitch(this,function(a){a=a.suggestions||[];this.onSuggestLocationsComplete(a);b.resolve(a)}),m.hitch(this,function(a){this._errorHandler(a);
b.reject(a)}));return b},addressesToLocations:function(a,b,c){var t=this.outSpatialReference,h=[],y=a.categories,p=a.countryCode;q.forEach(a.addresses,function(a,b){h.push({attributes:a})});a=this._encode(m.mixin({},this._url.query,{category:y&&y.join(",")||null,sourceCountry:p||null},{addresses:r.toJson({records:h})},{f:"json",outSR:t&&r.toJson(t.toJson())}));var e=this._geocodeAddressesHandler,l=this._errorHandler,s=new n(g._dfdCanceller);s._pendingDfd=f({url:this._url.path+"/geocodeAddresses",
content:a,callbackParamName:"callback",load:function(a,l){e(a,l,b,c,s)},error:function(a){l(a,c,s)}});return s},_reverseGeocodeHandler:function(a,c,d,t,h){try{var g=new b({address:a.address,location:a.location,score:100});this._successHandler([g],"onLocationToAddressComplete",d,h)}catch(f){this._errorHandler(f,t,h)}},locationToAddress:function(a,b,c,t){a&&this.normalization&&(a=a.normalize());var h=this.outSpatialReference;a=this._encode(m.mixin({},this._url.query,{outSR:h&&r.toJson(h.toJson()),location:a&&
r.toJson(a.toJson()),distance:b,f:"json"}));var y=this._reverseGeocodeHandler,p=this._errorHandler,e=new n(g._dfdCanceller);e._pendingDfd=f({url:this._url.path+"/reverseGeocode",content:a,callbackParamName:"callback",load:function(a,b){y(a,b,c,t,e)},error:function(a){p(a,t,e)}});return e},onSuggestLocationsComplete:function(){},onAddressToLocationsComplete:function(){},onAddressesToLocationsComplete:function(){},onLocationToAddressComplete:function(){}})})},"esri/tasks/AddressCandidate":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../geometry/Point"],function(e,m,q,n,r){return e(null,{declaredClass:"esri.tasks.AddressCandidate",constructor:function(e){m.mixin(this,e);this.location=new r(this.location)}})})},"esri/tasks/BufferParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../geometry/Polygon ../geometry/jsonUtils".split(" "),function(e,m,q,n,r,p,c,f){return e(null,{declaredClass:"esri.tasks.BufferParameters",geometries:null,
outSpatialReference:null,bufferSpatialReference:null,distances:null,unit:null,unionResults:!1,geodesic:!1,toJson:function(){var g={unit:this.unit,unionResults:this.unionResults,geodesic:this.geodesic},e=this.distances,b=this.outSpatialReference,a=this.bufferSpatialReference,u=q.map(this.geometries,function(a){a="extent"===a.type?c.fromExtent(a):a;return a.toJson()},this),d=this.geometries;if(d&&0<d.length){var t="extent"===d[0].type?"esriGeometryPolygon":f.getJsonType(d[0]);g.geometries=n.toJson({geometryType:t,
geometries:u});g.inSR=d[0].spatialReference.wkid?d[0].spatialReference.wkid:n.toJson(d[0].spatialReference.toJson())}e&&(g.distances=e.join(","));b&&(g.outSR=b.wkid?b.wkid:n.toJson(b.toJson()));a&&(g.bufferSR=a.wkid?a.wkid:n.toJson(a.toJson()));return g}})})},"widgets/IncidentAnalysis/js/SummaryInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/Color dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-style dojo/number dojo/on dojo/has dijit/form/Button jimu/dijit/Popup jimu/CSVUtils jimu/utils esri/config esri/geometry/geometryEngine esri/geometry/mathUtils esri/geometry/Point esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(e,m,q,n,r,p,c,f,g,w,b,a,u,d,t,h,y,E,A,l,s,k,F,G,H,v,I){return e("SummaryInfo",null,{summaryLayer:null,summaryFields:[],summaryIds:[],summaryFeatures:[],constructor:function(a,b,l){this.tab=a;this.container=b;this.parent=l;this.config=l.config},updateForIncident:function(a,b){this.container.innerHTML="";p.add(this.container,"loading");this.summaryIds=[];this.summaryFeatures=[];if(0<this.tab.tabLayers.length)if("undefined"!==typeof this.tab.tabLayers[0].infoTemplate)this.summaryLayer=this.tab.tabLayers[0],
this.summaryFields=this._getFields(this.summaryLayer),q.hitch(this,this._queryFeatures(b.geometry));else{var l=new k(this.tab.tabLayers[0].url);w(l,"load",q.hitch(this,function(){this.summaryLayer=l;this.summaryFields=this._getFields(this.summaryLayer);q.hitch(this,this._queryFeatures(b.geometry))}))}},_queryFeatures:function(a){var b=new I;b.geometry=a;this.summaryLayer.queryIds(b,q.hitch(this,function(a){a?(this.summaryIds=a,0<this.summaryIds.length?this._queryFeaturesByIds():this._processResults()):
this._processResults()}))},_queryFeaturesByIds:function(){var a=this.summaryLayer.maxRecordCount||1E3,b=this.summaryIds.slice(0,a);this.summaryIds.splice(0,a);var a=new I,l=!1;m.some(this.summaryFields,function(a){if("area"===a.type||"length"===a.type)return l=!0});a.returnGeometry=l;var k=[];m.forEach(this.summaryFields,function(a){k.push(a.field)});a.outFields=k;a.objectIds=b;this.summaryLayer.queryFeatures(a,q.hitch(this,function(a){this.summaryFeatures=this.summaryFeatures.concat(a.features);
this._processResults();0<this.summaryIds.length?(r.byId("IMT_download")&&p.replace(r.byId("IMT_download"),"processing","download"),setTimeout(q.hitch(this,this._queryFeaturesByIds),900)):r.byId("IMT_download")&&p.replace(r.byId("IMT_download"),"download","processing")}))},_prepResults:function(){for(var a=0;a<this.summaryFields.length;a++){var b=this.summaryFields[a],l=b.field,k=b.value;switch(b.type){case "count":k=this.summaryFeatures.length;break;case "area":k=this._getArea();break;case "length":k=
this._getLength();break;case "sum":k=this._getSum(l);break;case "avg":k=this._getSum(l)/this.summaryFeatures.length;break;case "min":k=this._getMin(l);break;case "max":k=this._getMax(l)}b.value=k}},_sortResults:function(a){return function(b,l){return b.attributes[a]<l.attributes[a]?-1:b.attributes[a]>l.attributes[a]?1:0}},_getSum:function(a){var b=0;m.forEach(this.summaryFeatures,function(l){b+=l.attributes[a]});return b},_getMin:function(a){this.summaryFeatures.sort(this._sortResults(a));return this.summaryFeatures[0].attributes[a]},
_getMax:function(a){this.summaryFeatures.sort(this._sortResults(a));this.summaryFeatures.reverse();return this.summaryFeatures[0].attributes[a]},_getArea:function(){var a=0,b=q.clone(this.config.distanceSettings);b.miles=109413;b.kilometers=109414;b.feet=109405;b.meters=109404;b.yards=109442;b.nauticalMiles=109409;var l=b[this.config.distanceUnits];m.forEach(this.summaryFeatures,function(b){a+=y.geodesicArea(b.geometry,l)});return a},_getLength:function(){var a=0,b=this.config.distanceSettings[this.config.distanceUnits];
m.forEach(this.summaryFeatures,function(l){a+=y.geodesicLength(l.geometry,b)});return a},_processResults:function(){this._prepResults();this.container.innerHTML="";p.remove(this.container,"loading");var a=this.summaryFields,b=0,l=c.create("div",{id:"tpc",style:"width:"+220*(a.length+1)+"px;"},this.container);p.add(l,"IMT_tabPanelContent");var k=c.create("div",{},l);p.add(k,"IMTcol");k=c.create("div",{id:"IMT_download",innerHTML:this.parent.nls.downloadCSV},k);p.add(k,["btnExport","download"]);w(k,
"click",q.hitch(this,this._exportToCSV));for(k=0;k<a.length;k++){var b=a[k],s=t.sanitizeHTML(b.alias?b.alias:"")+"\x3cbr/\x3e",b=b.alias===this.parent.nls.area||b.alias===this.parent.nls.length?b.value:Math.round(b.value);isNaN(b)&&(b=0);s+="\x3cdiv class\x3d'colSummary'\x3e"+g.format(b)+"\x3c/div\x3e\x3cbr/\x3e";s=c.create("div",{id:"Demographics_"+k,innerHTML:s},l);p.add(s,"IMTcol")}},_exportToCSV:function(){if(0===this.summaryFeatures.length)return!1;console.log(this.tab);var a=this.tab.layers,
b=[],l=[];m.forEach(this.summaryFeatures,function(a){b.push(a.attributes)});for(var k in b[0])l.push(k);d.exportCSV(a,b,l)},_getFields:function(a){var b=[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)return m.forEach(this.tab.advConfig.fields,q.hitch(this,function(a){var l="";"count"!==a.type&&("area"!==a.type&&"length"!==a.type)&&(l=" (\x3cspan style\x3d'font-size:7pt;'\x3e"+this.parent.nls[a.type]+"\x3c/span\x3e)");b.push({field:a.expression,alias:a.label+
l,type:a.type,value:0})})),b;var l;l=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var k=0;k<l.length;k++){var c=l[k],s=c.fieldName||c.name,d=this._getFieldType(a.fields,s),u=null;if(s!==a.objectIdField&&("esriFieldTypeDouble"===d||"esriFieldTypeInteger"===d||"esriFieldTypeSmallInteger"===d))"undefined"!==typeof c.visible?c.visible&&(u={field:c.fieldName,alias:c.label,type:"sum",value:0}):u={field:c.name,alias:c.alias,type:"sum",value:0},u&&b.push(u)}return b},_getFieldType:function(a,
b){var l;m.some(a,function(a){if(a.name===b)return l=a.type,!0});return l}})})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(e,m,q,n,r,p,c,f,g,w){e.exportCSV=function(b,a,c){return e._createCSVStr(a,c).then(function(a){return e._download(b+".csv",a)})};e.exportCSVFromFeatureLayer=function(b,a,c){c=c||{};return e._getExportData(a,{datas:c.datas,fromClient:c.fromClient,
outFields:c.outFields,filterExpression:c.filterExpression}).then(function(d){return e._formattedData(a,d,{formatNumber:c.formatNumber,formatDate:c.formatDate,formatCodedValue:c.formatCodedValue,popupInfo:c.popupInfo}).then(function(a){return e.exportCSV(b,a.datas,a.columns)})})};e.exportCSVByAttributes=function(b,a,c,d){d=m.mixin({},d);d.datas=c;return e.exportCSVFromFeatureLayer(b,a,d)};e.exportCSVByGraphics=function(b,a,c,d){c=q.map(c,function(a){return a.attributes});return e.exportCSVByAttributes(b,
a,c,d)};e._createCSVStr=function(b,a){var c=new p,d="",g=0,h=0,e="",f="";try{q.forEach(a,function(a){d=d+e+a;e=","});for(var d=d+"\r\n",g=b.length,h=a.length,m=0;m<g;m++){for(var e="",l=0;l<h;l++)f=b[m][a[l]],!f&&"number"!==typeof f&&(f=""),f&&/[",\r\n]/g.test(f)&&(f='"'+f.replace(/(")/g,'""')+'"'),d=d+e+f,e=",";d+="\r\n"}c.resolve(d)}catch(s){console.error(s),c.resolve("")}return c};e._isIE11=function(){return 11===c.has("ie")};e._isEdge=function(){return c.has("edge")};e._getDownloadUrl=function(b){return window.Blob&&
window.URL&&window.URL.createObjectURL?(b=new Blob(["\ufeff"+b],{type:"text/csv"}),URL.createObjectURL(b)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(b)};e._download=function(b,a){var c=new p;try{if(r("ie")&&10>r("ie")){var d=window.top.open("about:blank","_blank");d.document.write("sep\x3d,\r\n"+a);d.document.close();d.document.execCommand("SaveAs",!0,b);d.close()}else if(10===r("ie")||e._isIE11()||e._isEdge()){var f=new Blob(["\ufeff"+a],{type:"text/csv"});navigator.msSaveBlob(f,
b)}else{var h=n.create("a",{href:e._getDownloadUrl(a),target:"_blank",download:b},document.body);if(r("safari")){var g=document.createEvent("MouseEvents");g.initEvent("click",!0,!0);h.dispatchEvent(g)}else h.click();n.destroy(h)}c.resolve()}catch(q){c.reject(q)}return c};e._getExportData=function(b,a){var c=new p,d=null,g=a.datas,d=a.outFields;if(!d||!d.length)d=b.fields;g&&0<g.length?c.resolve({data:g||[],outFields:d}):a.fromClient?(g=q.map(b.graphics,function(a){return a.attributes}),c.resolve({data:g||
[],outFields:d})):e._getExportDataFromServer(b,d,a).then(function(a){c.resolve({data:a||[],outFields:d})});return c};e._getExportDataFromServer=function(b,a,c){var d=new p;if("esri.layers.FeatureLayer"!==b.declaredClass)return d.resolve([]),d;var f=new g(b.url),h=new w;h.where=c.filterExpression||b.getDefinitionExpression&&b.getDefinitionExpression()||"1\x3d1";0<a.length?(b=q.map(a,function(a){return a.name}),h.outFields=b):h.outFields=["*"];h.returnGeometry=!1;f.execute(h,function(a){a=q.map(a.features,
function(a){return a.attributes});d.resolve(a)},function(a){console.error(a);d.resolve([])});return d};e._formattedData=function(b,a,c){var d=new p,g=[],f=a.data;a=a.outFields;for(var m=0,n=f.length;m<n;m++){for(var r={},l=0;l<a.length;l++){var s=a[l];r[s.alias||s.name]=e._getExportValue(f[m][s.name],s,b.objectIdField,b.typeIdField,f[m][b.typeIdField],b.types,c)}g.push(r)}b=q.map(a,function(a){return a.alias||a.name});d.resolve({datas:g,columns:b});return d};e._getExportValue=function(b,a,g,d,e,h,
m){function p(a){if(n&&f.isDefined(n.fieldInfos))for(var b=0,l=n.fieldInfos.length;b<l;b++){var c=n.fieldInfos[b];if(c.fieldName===a)return c.format}return null}var n=m.popupInfo,l=!!a.domain&&m.formatCodedValue;m="esriFieldTypeDate"===a.type&&m.formatDate;var s=g&&a.name===g;d=d&&a.name===d;return m?c.fieldFormatter.getFormattedDate(b,p(a.name)):d?c.fieldFormatter.getTypeName(b,h):l?c.fieldFormatter.getCodedValue(a.domain,b):!l&&!m&&!s&&!d?(l=null,g&&h&&0<h.length&&(g=(g=q.filter(h,function(a){return a.id===
e}))&&g[0])&&(g.domains&&g.domains[a.name]&&g.domains[a.name].codedValues)&&(l=c.fieldFormatter.getFormattedCodedValue(g.domains[a.name],b)),null!==l?l:b):b}})},"widgets/IncidentAnalysis/js/WeatherInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct esri/geometry/webMercatorUtils esri/request".split(" "),function(e,m,q,n,r,p){return e("WeatherInfo",null,{constructor:function(c,f,g){this.tab=c;this.container=f;this.parent=g;this.weatherURL=c.url;this.weatherDict=
{119:["Cloudy","cloudy5.png","cloudy5.png"],377:["Moderate or heavy showers of ice pellets","hail.png","hail.png"],374:["Light showers of ice pellets","hail.png","hail.png"],350:["Ice pellets","hail.png","hail.png"],353:["Light rain shower","light_rain.png","light_rain.png"],302:["Moderate rain","light_rain.png","light_rain.png"],296:["Light rain","light_rain.png","light_rain.png"],293:["Patchy light rain","light_rain.png","light_rain.png"],266:["Light drizzle","light_rain.png","light_rain.png"],
263:["Patchy light drizzle","light_rain.png","light_rain.png"],122:["Overcast","overcast.png","overcast.png"],359:["Torrential rain shower","shower3.png","shower3.png"],308:["Heavy rain","shower3.png","shower3.png"],365:["Moderate or heavy sleet showers","sleet.png","sleet.png"],362:["Light sleet showers","sleet.png","sleet.png"],320:["Moderate or heavy sleet","sleet.png","sleet.png"],317:["Light sleet","sleet.png","sleet.png"],314:["Moderate or Heavy freezing rain","sleet.png","sleet.png"],311:["Light freezing rain",
"sleet.png","sleet.png"],284:["Heavy freezing drizzle","sleet.png","sleet.png"],281:["Freezing drizzle","sleet.png","sleet.png"],185:["Patchy freezing drizzle nearby","sleet.png","sleet.png"],182:["Patchy sleet nearby","sleet.png","sleet.png"],395:["Moderate or heavy snow in area with thunder","snow4.png","snow4.png"],335:["Patchy heavy snow","snow4.png","snow4.png"],230:["Blizzard","snow4.png","snow4.png"],227:["Blowing snow","snow4.png","snow4.png"],371:["Moderate or heavy snow showers","snow5.png",
"snow5.png"],338:["Heavy snow","snow5.png","snow5.png"],389:["Moderate or heavy rain in area with thunder","tstorm3.png","tstorm3.png"],392:["Patchy light snow in area with thunder","snow2.png","snow2_night.png"],386:["Patchy light rain in area with thunder","tstorm1.png","tstorm1_night.png"],368:["Light snow showers","snow2.png","snow2_night.png"],356:["Moderate or heavy rain shower","shower2.png","shower2_night.png"],332:["Moderate snow","snow3.png","snow3_night.png"],329:["Patchy moderate snow",
"snow2.png","snow2_night.png"],326:["Light snow","snow1.png","snow1_night.png"],323:["Patchy light snow","snow1.png","snow1_night.png"],305:["Heavy rain at times","shower2.png","shower2_night.png"],299:["Moderate rain at times","shower2.png","shower2_night.png"],260:["Freezing fog","fog.png","fog_night.png"],248:["Fog","fog.png","fog_night.png"],200:["Thundery outbreaks in nearby","tstorm1.png","tstorm1_night.png"],179:["Patchy snow nearby","snow1.png","snow1_night.png"],176:["Patchy rain nearby",
"shower1.png","shower1_night.png"],143:["Mist","mist.png","mist_night.png"],116:["Partly Cloudy","cloudy3.png","cloudy3_night.png"],113:["Clear/Sunny","sunny.png","sunny_night.png"]}},updateForIncident:function(c){this.container.innerHTML="";q.add(this.container,"loading");var f=c=c.geometry;"point"!==c.type&&(f=c.getExtent().getCenter());c=r.webMercatorToGeographic(f);p({url:this.weatherURL+"\x26callbackNode\x3d"+this.parent.domNode.id+"\x26q\x3d"+(c.y+","+c.x),callbackParamName:"callback"},{useProxy:!1}).then(m.hitch(this,
function(c){return this._resultsHandler(c)}),m.hitch(this,function(c){c=this._errorHandler(c);console.log(c)}))},_resultsHandler:function(c){c=c.data;console.log(c);var f=c.current_condition;c=c.weather;var g=1;this.container.innerHTML="";q.remove(this.container,"loading");var e=n.create("div",{id:"tpc",style:"width:"+165*(c.length+3)+"px;"},this.container);q.add(e,"IMT_tabPanelContent");var b,a;if(0<f.length){f=f[0];b=f.localObsDateTime.split(" ");a=b[2];b=b[1].split(":");b=parseInt(b[0],10);if("AM"===
a){if(6>b||12===b)g=2}else 6<b&&12>b&&(g=2);a=f.temp_F;b=f.weatherCode;b=this.weatherDict[parseInt(b,10)];b=this.parent.nls.now+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+b[g]+"' /\x3e\x3cbr/\x3e"+a+"\x26deg;";a=n.create("div",{innerHTML:b},e);q.add(a,"IMTcolSmall");b=this.parent.nls.wind+"\x3cbr/\x3e\x3cspan style\x3d'font-size: 30px; line-height:47px'\x3e"+f.winddir16Point+"\x3c/span\x3e\x3cbr/\x3e"+f.windspeedMiles+" MPH";f=n.create("div",{innerHTML:b},
e);q.add(f,"IMTcolSmall")}for(a=0;a<c.length;a++){var f=c[a],m=this._getDay(f.date),d=f.tempMaxF||f.maxtempF,p=f.tempMinF||f.mintempF;b=f.weatherCode||f.hourly[0].weatherCode;b=this.weatherDict[parseInt(b,10)];b=m+"\x3cbr/\x3e\x3cimg style\x3d'height:45px' src\x3d'"+this.parent.folderUrl+"images/w/"+b[g]+"' /\x3e\x3cbr/\x3e"+d+"\x26deg; | "+p+"\x26deg;";f=n.create("div",{innerHTML:b},e);q.add(f,"IMTcolSmall")}c=n.create("div",{innerHTML:'\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cspan style\x3d"font-size:11px;color:#6e6e6e"\x3ePowered by\x3cbr/\x3e\x3ca style\x3d"color:#6e6e6e;text-decoration:none" href\x3d"http://www.worldweatheronline.com/" title\x3d"Free Weather API" target\x3d"_blank"\x3eWorld Weather Online\x3c/a\x3e\x3c/span\x3e'},
e);q.add(c,"IMTcolSmall");q.add(c,"IMTcolLast")},_getDay:function(c){c=c.split("-");c="SUN MON TUE WED THU FRI SAT".split(" ")[(new Date(c[0],c[1]-1,c[2])).getDay()];return this.parent.nls[c]},_errorHandler:function(c){console.log(c.message);c=n.create("div",{innerHTML:c.message},this.container);q.add(c,"IMTcolSmall")}})})},"widgets/IncidentAnalysis/js/ClosestInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/geometry/webMercatorUtils esri/geometry/Polyline esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query".split(" "),
function(e,m,q,n,r,p,c,f,g,w,b,a,u,d,t,h,y,E,A){return e("ClosestInfo",null,{constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.map=c.map;this.specialFields={}},updateForIncident:function(a,b,c){n.forEach(this.tab.tabLayers,m.hitch(this,function(f){if("undefined"!==typeof f.empty){var e=new d(f.url);g(e,"load",m.hitch(this,function(){this.tab.tabLayers=[e];this.processIncident(a,b,c)}))}else this.processIncident(a,b,c)}))},processIncident:function(a,
b,c){this.container.innerHTML="";p.add(this.container,"loading");var d=[];this.incident=a;b=w.buffer(a.geometry,b,this.parent.config.distanceSettings[this.parent.config.distanceUnits]);this.graphicsLayer=c;this.graphicsLayer.clear();var g=this.tab.tabLayers;c=[];for(var f=0;f<g.length;f++){var e=g[f],h=new A;h.returnGeometry=!0;h.geometry=b;h.outFields=this._getFields(e);h.outSpatialReference=this.parent.map.spatialReference;c.push(e.queryFeatures(h))}(new r(c)).then(m.hitch(this,function(b){for(var c=
0;c<b.length;c++){var k=b[c][1],s=this._getFields(g[c]),k=k.features;if(0<k.length){for(var f=0;f<k.length;f++){for(var e=k[f],h={DISTANCE:this._getDistance(a.geometry,e.geometry)},m=0;m<s.length;m++)h[s[m]]=e.attributes[s[m]];e.attributes=h}k.sort(this._compareDistance);d.push(k[0])}}this._processResults(d)}))},_processResults:function(b){this.container.innerHTML="";p.remove(this.container,"loading");0===b.length&&(this.container.innerHTML=this.parent.nls.noFeaturesFound);var s=c.create("div",{id:"tpc",
style:"width:"+220*b.length+"px;"},this.container);p.add(s,"IMT_tabPanelContent");for(var k=this.parent.nls[this.parent.config.distanceUnits],d=0;d<b.length;d++){var e=d+1,n=b[d],v=n.geometry,r=v;"point"!==v.type&&(r=v.getExtent().getCenter());var n=n.attributes,z=k+": "+Math.round(100*n.DISTANCE)/100,v="",x=0,w;for(w in n)"DISTANCE"!==w&&3>x&&(v+=this._getFieldValue(w,n[w])+"\x3cbr/\x3e",x+=1);x=c.create("div",{id:"Feature_"+e},s);p.add(x,"IMTcolRec");var B=c.create("div",{},x);p.add(B,"IMTcolRecBar");
var D=c.create("div",{innerHTML:e},B);p.add(D,"IMTcolRecNum");f.set(D,"backgroundColor",this.parent.config.color);g(D,"click",m.hitch(this,this._zoomToLocation,r));z=c.create("div",{innerHTML:z},B);p.add(z,"IMTcolDistance");this.parent.config.enableRouting&&(z=c.create("div",{},B),p.add(z,"IMTcolDir"),g(z,"click",m.hitch(this,this._routeToIncident,r)));v=c.create("div",{innerHTML:v},x);p.add(v,"IMTcolInfo");v=new h(h.STYLE_SOLID,new q.fromString(this.parent.config.color),1);v=new t(t.STYLE_CIRCLE,
24,v,new q.fromString(this.parent.config.color));x=new y;x.family="Arial";x.size="12px";e=new E(e,x,"#ffffff");e.setOffset(0,-4);null===n.OUTSIDE_POLYGON&&(x=new h(h.STYLE_SOLID,new q([0,0,0,1]),1),z=new a(r.spatialReference),B=this.incident.geometry,"point"!==this.incident.geometry.type&&(B=this.incident.geometry.getExtent().getCenter()),z.addPath([r,B]),this.graphicsLayer.add(new u(z,x,{})));this.graphicsLayer.add(new u(r,v,n));this.graphicsLayer.add(new u(r,e,n))}},_getFields:function(a){var b=
[];if(this.tab.advConfig&&this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)n.forEach(this.tab.advConfig.fields,function(a){b.push(a.expression)});else{var c;c=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var d=0;d<c.length;d++){var e=c[d];"undefined"!==typeof e.visible?e.visible&&b.push(e.fieldName):b.push(e.name)}}var g={};n.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)g[a.name]=a});this.specialFields=g;return b},_getFieldValue:function(a,b){var c=
b;if(this.specialFields[a]){var d=this.specialFields[a];"esriFieldTypeDate"===d.type?c=(new Date(b)).toLocaleString():n.some(d.domain.codedValues,function(a){if(a.code===b)return c=a.name,!0})}return c},_getDistance:function(a,c){var k=0;4326===a.spatialReference.wkid&&(a=b.geographicToWebMercator(a));4326===c.spatialReference.wkid&&(c=b.geographicToWebMercator(c));var d=this.parent.config.distanceUnits,k=w.distance(a,c,9001);switch(d){case "miles":k*=6.21371E-4;break;case "kilometers":k*=0.0010;
break;case "feet":k*=3.28084;break;case "yards":k*=1.09361;break;case "nauticalMiles":k*=5.39957E-4}return k},_compareDistance:function(a,b){return a.attributes.DISTANCE<b.attributes.DISTANCE?-1:a.attributes.DISTANCE>b.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/js/ProximityInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Color dojo/_base/array dojo/DeferredList dojo/dom-class dojo/dom-construct dojo/dom-style dojo/on esri/geometry/geometryEngine esri/geometry/webMercatorUtils esri/graphic esri/layers/FeatureLayer esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/Font esri/symbols/TextSymbol esri/tasks/query jimu/CSVUtils".split(" "),
function(e,m,q,n,r,p,c,f,g,w,b,a,u,d,t,h,y,E,A){return e("ProximityInfo",null,{constructor:function(a,b,c){this.tab=a;this.container=b;this.parent=c;this.graphicsLayer=this.incident=null;this.specialFields={}},updateForIncident:function(a,b,c){n.forEach(this.tab.tabLayers,m.hitch(this,function(d){if("undefined"!==typeof d.empty){var e=new u(d.url);g(e,"load",m.hitch(this,function(){this.tab.tabLayers=[e];this.processIncident(a,b,c)}))}else this.processIncident(a,b,c)}))},processIncident:function(a,
b,c){this.container.innerHTML="";p.add(this.container,"loading");var d=[];this.incident=a;this.graphicsLayer=c;var e=this.tab.tabLayers;c=[];for(var g=0;g<e.length;g++){var f=e[g],h=new E;h.returnGeometry=!0;h.geometry=b.geometry;h.outFields=this._getFields(f);h.outSpatialReference=this.parent.map.spatialReference;c.push(f.queryFeatures(h))}(new r(c)).then(m.hitch(this,function(b){for(var c=0;c<b.length;c++)for(var k=b[c][1],g=this._getFields(e[c]),k=k.features,f=0;f<k.length;f++){for(var h=k[f],
m={DISTANCE:this._getDistance(a.geometry,h.geometry)},s=0;s<g.length;s++)m[g[s]]=h.attributes[g[s]];h.attributes=m;d.push(h)}this._processResults(d)}))},_processResults:function(b){this.container.innerHTML="";p.remove(this.container,"loading");this.graphicsLayer.clear();if(0===b.length)this.container.innerHTML=this.parent.nls.noFeaturesFound;else{b.sort(this._compareDistance);var e=c.create("div",{id:"tpc",style:"width:"+220*(b.length+1)+"px;"},this.container);p.add(e,"IMT_tabPanelContent");var k=
c.create("div",{},e);p.add(k,"IMTcol");k=c.create("div",{innerHTML:this.parent.nls.downloadCSV},k);p.add(k,"btnExport");g(k,"click",m.hitch(this,this._exportToCSV,b));for(var k=this.parent.nls[this.parent.config.distanceUnits],n=0;n<b.length;n++){var r=n+1,u=b[n],v=u.geometry,w=v;"point"!==v.type&&(w=v.getExtent().getCenter());var u=u.attributes,z=k+": "+Math.round(100*u.DISTANCE)/100,v="",x=0,A;for(A in u)"DISTANCE"!==A&&3>x&&(v+=this._getFieldValue(A,u[A])+"\x3cbr/\x3e",x+=1);x=c.create("div",{id:"Feature_"+
r},e);p.add(x,"IMTcolRec");var B=c.create("div",{},x);p.add(B,"IMTcolRecBar");var D=c.create("div",{innerHTML:r},B);p.add(D,"IMTcolRecNum");f.set(D,"backgroundColor",this.parent.config.color);g(D,"click",m.hitch(this,this._zoomToLocation,w));z=c.create("div",{innerHTML:z},B);p.add(z,"IMTcolDistance");this.parent.config.enableRouting&&(z=c.create("div",{},B),p.add(z,"IMTcolDir"),g(z,"click",m.hitch(this,this._routeToIncident,w)));v=c.create("div",{innerHTML:v},x);p.add(v,"IMTcolInfo");v=new t(t.STYLE_SOLID,
new q.fromString(this.parent.config.color),1);v=new d(d.STYLE_CIRCLE,24,v,new q.fromString(this.parent.config.color));x=new h;x.family="Arial";x.size="12px";r=new y(r,x,"#ffffff");r.setOffset(0,-4);this.graphicsLayer.add(new a(w,v,u));this.graphicsLayer.add(new a(w,r,u))}}},_exportToCSV:function(a){if(0===a.length)return!1;var b=this.tab.layers,c=[],d=[];n.forEach(a,function(a){c.push(a.attributes)});for(var e in c[0])d.push(e);A.exportCSV(b,c,d)},_getFields:function(a){var b=[];if(this.tab.advConfig&&
this.tab.advConfig.fields&&0<this.tab.advConfig.fields.length)n.forEach(this.tab.advConfig.fields,function(a){b.push(a.expression)});else{var c;c=a.infoTemplate?a.infoTemplate.info.fieldInfos:a.fields;for(var d=0;d<c.length;d++){var e=c[d];"undefined"!==typeof e.visible?e.visible&&b.push(e.fieldName):b.push(e.name)}}var g={};n.forEach(a.fields,function(a){if("esriFieldTypeDate"===a.type||a.domain)g[a.name]=a});this.specialFields=g;return b},_getFieldValue:function(a,b){var c=b;if(this.specialFields[a]){var d=
this.specialFields[a];"esriFieldTypeDate"===d.type?c=(new Date(b)).toLocaleString():n.some(d.domain.codedValues,function(a){if(a.code===b)return c=a.name,!0})}return c},_getDistance:function(a,c){var d=0;4326===a.spatialReference.wkid&&(a=b.geographicToWebMercator(a));4326===c.spatialReference.wkid&&(c=b.geographicToWebMercator(c));var e=this.parent.config.distanceUnits,d=w.distance(a,c,9001);switch(e){case "miles":d*=6.21371E-4;break;case "kilometers":d*=0.0010;break;case "feet":d*=3.28084;break;
case "yards":d*=1.09361;break;case "nauticalMiles":d*=5.39957E-4}return d},_compareDistance:function(a,b){return a.attributes.DISTANCE<b.attributes.DISTANCE?-1:a.attributes.DISTANCE>b.attributes.DISTANCE?1:0},_zoomToLocation:function(a){this.parent.zoomToLocation(a)},_routeToIncident:function(a){this.parent.routeToIncident(a)}})})},"widgets/IncidentAnalysis/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],
function(){})},"url:widgets/IncidentAnalysis/Widget.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"panelBottom" class\x3d"panelBottom"\x3e\r\n    \x3c!--Panel Container --\x3e\r\n    \x3cdiv data-dojo-attach-point\x3d"panelContainer" class\x3d"panelContainer"\x3e\r\n      \x3c!-- Panel Incident --\x3e\r\n      \x3cdiv id\x3d"tabPanel0" class\x3d"IMT_tabPanel"\x3e\r\n        \x3cdiv class\x3d"IMT_tabPanelContent" style\x3d"width: 660px"\x3e\r\n          \x3cdiv id\x3d"incidentsLocate" class\x3d"IMTcol"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.locate_incident}\r\n            \x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn0"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn1"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32"\x3e \x3cimg id\x3d"btn2"\x3e \x3c/img\x3e \x3c/span\x3e\r\n              \x3cspan class\x3d"btn32 btnClear" data-dojo-attach-event\x3d"onclick:_clear"\x3e \x3cimg id\x3d"btn3"\x3e \x3c/img\x3e \x3c/span\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv id\x3d"incidentsDistance" class\x3d"IMTcol"\x3e\r\n            \x3cdiv class\x3d"label" data-dojo-attach-point\x3d"buffer_lbl"\x3e\x3c/div\x3e\r\n            \x3cbr/\x3e\r\n            \x3cdiv class\x3d"colBar"\x3e\r\n              \x3cdiv id\x3d"horizontalSliderDiv" data-dojo-attach-point\x3d"horizontalSliderDiv"\x3e\x3c/div\x3e\r\n              \x3cdiv style\x3d"text-align:center; margin-top: -4px;"\x3e\r\n                \x3cinput data-dojo-type\x3d"dijit/form/TextBox" style\x3d"width:60px;align:left;" data-dojo-attach-point\x3d"sliderValue" name\x3d"sliderValue" value\x3d"15" /\x3e\r\n              \x3c/div\x3e\r\n            \x3c/div\x3e\r\n          \x3c/div\x3e\r\n          \x3cdiv data-dojo-attach-point\x3d"div_reverse_geocoding" class\x3d"IMTcol" style\x3d"visibility:hidden"\x3e\r\n            \x3cdiv class\x3d"label"\x3e\r\n              ${nls.reverse_geocoded_address}\r\n            \x3c/div\x3e\r\n            \x3c/br\x3e\r\n            \x3cdiv class\x3d"label" style\x3d"width:100%;" data-dojo-attach-point\x3d"div_reversed_address"\x3e\x3c/div\x3e\r\n          \x3c/div\x3e\r\n        \x3c/div\x3e\r\n      \x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Message --\x3e\r\n    \x3cdiv id\x3d"panelMessage" data-dojo-attach-point\x3d"messageNode"\x3e\r\n      \x3cspan id\x3d"msgText" data-dojo-attach-point\x3d"messageTextNode"\x3e\x3c/span\x3e\r\n    \x3c/div\x3e\r\n    \x3c!-- Panel Footer --\x3e\r\n    \x3cdiv id\x3d"panelFooter" data-dojo-attach-point\x3d"footerNode"\x3e\r\n      \x3cdiv id\x3d"panelFooterContent" data-dojo-attach-point\x3d"footerContentNode"\x3e\r\n        \x3c!-- Tabs --\x3e\r\n        \x3cdiv id\x3d"IMT_tabs" data-dojo-attach-point\x3d"tabsNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv id\x3d"panelClose" data-dojo-attach-event\x3d"onclick:_close"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e\r\n',
"url:widgets/IncidentAnalysis/css/style.css":".jimu-widget-IMT {color: #ffffff !important; background-color: #4c4c4c; left: 0px !important; right: 0px !important; bottom: 0px; height: 140px !important; display: block; z-index: 100 !important;}.jimu-widget-IMT .rounded {-moz-border-radius: 5px 5px 5px 5px; -webkit-border-radius: 5px 5px 5px 5px; border-radius: 5px 5px 5px 5px;}.jimu-widget-IMT .roundedL {-moz-border-radius: 5px 0px 0px 5px; -webkit-border-radius: 5px 0px 0px 5px; border-radius: 5px 0px 0px 5px;}.jimu-widget-IMT .roundedR {-moz-border-radius: 0px 5px 5px 0px; -webkit-border-radius: 0px 5px 5px 0px; border-radius: 0px 5px 5px 0px;}.jimu-widget-IMT .panelBottom {position: absolute; width: 100%; height: 140px; left: 0px; top: 0px; text-align: center; color: #ffffff; padding: 0px;}.jimu-widget-IMT #panelMessage {position: absolute; top: 0px; text-align: center; width: 100%; height: 40px; line-height: 40px; display: none;}.jimu-widget-IMT #panelFooter {position: absolute; bottom: 0px; left: 0px; right: 0px; height: 40px; line-height: 40px; overflow: hidden; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-bottom: 1px solid #353535; border-bottom: 1px solid rgba(0, 0, 0, 0.3);}.jimu-widget-IMT #panelFooterContent {position: absolute; left: 0px; right: 24px; height: 90px; overflow-x: auto; overflow-y: hidden; display: block;}.jimu-rtl .jimu-widget-IMT #panelFooterContent {position: absolute; left: 24px; right: 0px;}.jimu-widget-IMT #panelClose {position: absolute; left: auto; right: 0px; width: 24px; height: 40px; line-height: 40px; text-align: center; display: block; cursor: pointer; background-image: url('images/x.png'); background-repeat: no-repeat; background-position: center center; background-size: 18px;}.jimu-rtl .jimu-widget-IMT #panelClose {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .panelContainer {position: absolute; width: 100%; height: 100px; overflow: hidden; display: block;}.jimu-widget-IMT .IMT_tabPanel {position: absolute; top: 10px; left: 0px; right: 0px; height: 90px; display: none; overflow-x: auto !important; overflow-y: hidden !important;}.jimu-widget-IMT .IMT_tabPanelContent {position: absolute; top: 0px; width: auto; height: 80px; white-space: nowrap; display: block; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT #IMT_tabs {position: absolute; white-space: nowrap; height: 40px; padding: 0px; overflow-x: visible; overflow-y: hidden;}.jimu-widget-IMT .IMTTab {width: auto; max-width: 220px; overflow: hidden; text-overflow: ellipsis; height: 40px; float: left; line-height: 40px; font-size: 13px; padding: 0 35px 0 10px; background-image: url('images/tab.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTTab {float: right;}.jimu-widget-IMT .active {color: #ffffff; background-color: #353535; background-color: rgba(0, 0, 0, 0.3); background-image: url('images/tabon.png'); background-position: right center; background-repeat: no-repeat;}.jimu-widget-IMT .IMTcol {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcol {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolSmall {float: left; height: 80px; width: 165px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolSmall {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none;}.jimu-widget-IMT .IMTcolLast {border-left: none; border-right: none;}.jimu-widget-IMT .IMTcol .label,.jimu-widget-IMT .IMTcolSmall .label {font-size: 13px; padding: 2px 0;}.jimu-widget-IMT .IMTcol .colBar {position: relative; height: 32px; display: block;}.jimu-widget-IMT .btn32 {float: left; width: 32px; height: 32px; padding: 0; color: #ffffff; background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; display: block; margin-right: 8px; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .btn32 {float: right;}.jimu-widget-IMT .btn32:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btnOn {border: 1px solid #ffffff; border: 1px solid rgba(255, 255, 255, 0.75); background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .btn32 img {padding: 8px;}.jimu-widget-IMT .btnClear {background-color: #bb0000; margin-left: 16px;}.jimu-rtl .jimu-widget-IMT .btnClear {margin-right: 16px; margin-left: 0;}.jimu-widget-IMT .btnClear:hover {background-color: #ff0000;}.jimu-widget-IMT .dijitTextBox,.jimu-widget-IMT .dijitTextBoxHover,.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitTextBoxHoverFocused {background-color: #393939; background-color: rgba(0, 0, 0, 0.25) !important; color: #ffffff !important; border: 1px solid #a6a6a6; border: 1px solid rgba(255, 255, 255, 0.5) !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitTextBoxFocused,.jimu-widget-IMT .dijitInputInner,.jimu-widget-IMT .dijitInputContainer {background: transparent !important; color: #ffffff !important; height: 26px !important; line-height: 26px !important;}.jimu-widget-IMT .dijitInputField {padding: 0px 10px !important;}.jimu-widget-IMT .btnExport {background-color: #393939; background-color: rgba(0, 0, 0, 0.25); border-radius: 2px; padding: 10px 44px 10px 10px; background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right center; cursor: pointer;}.jimu-widget-IMT .btnExport:hover {background-color: #262626; background-color: rgba(0, 0, 0, 0.5);}.jimu-widget-IMT .download {background-image: url('images/download.png'); background-repeat: no-repeat; background-position: right 0px center;}.jimu-widget-IMT .processing {background-image: url('images/processing.gif'); background-repeat: no-repeat; background-position: right 10px center;}.jimu-widget-IMT .loading {background-image: url('images/loading.gif'); background-repeat: no-repeat; background-position: center 10px;}.jimu-widget-IMT .colSummary {height: 36px; line-height: 36px; font-size: 28px; padding-top: 25px;}.jimu-widget-IMT .IMTcolRec {float: left; height: 80px; width: 220px; border-left: none; border-right: 1px solid #ffffff; border-right: 1px solid rgba(255, 255, 255, 0.5); margin-left: 0; padding: 0 20px; overflow: hidden; text-align: left; text-overflow: ellipsis;}.jimu-rtl .jimu-widget-IMT .IMTcolRec {float: right; border-left: 1px solid #ffffff; border-left: 1px solid rgba(255, 255, 255, 0.5); border-right: none; text-align: right;}.jimu-widget-IMT .IMTcolRecBar {position: relative; height: 26px; width: 100%; display: block;}.jimu-widget-IMT .IMTcolRecNum {position: absolute; width: 26px; height: 26px; background-color: #4c4c4c; color: #ffffff; line-height: 26px; text-align: center; border-radius: 13px; font-size: 11px; cursor: pointer;}.jimu-widget-IMT .IMTcolDir {position: absolute; right: 0px; width: 26px; height: 26px; background-image: url('images/car.png'); background-repeat: no-repeat; background-position: center center; cursor: pointer;}.jimu-rtl .jimu-widget-IMT .IMTcolDir {position: absolute; left: 0px; right: auto;}.jimu-widget-IMT .IMTcolDistance {position: absolute; left: 30px; right: 30px; height: 26px; font-size: 11px; line-height: 26px;}.jimu-widget-IMT .IMTcolInfo {position: relative; margin-top: 10px; height: 64px; width: 100%; display: block; overflow: hidden;}.claro .dijitSlider {background: transparent; border: 0 none; -webkit-border-radius: 3px; border-radius: 3px; padding: 0;}.claro .dijitSliderBar {border-style: solid; outline: 1px;}.claro .dijitRuleLabelsContainer {color: #2b2e34;}.claro .dijitSliderDisabled {opacity: 0.65; -ms-filter: \"progid:DXImageTransform.Microsoft.Alpha(Opacity\x3d65)\"; filter: alpha(opacity\x3d65);}.claro .dijitRuleLabelsContainerH {padding: 8px 0 !important; color: #6e6e6e !important;}.claro .dijitSliderBarH,.claro .dijitSliderBumperH {height: 4px;}.claro .dijitSlider .dijitSliderLeftBumper {-webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px; border-width: 1px 0 1px 1px; margin-left: 4px;}.claro .dijitSlider .dijitSliderRightBumper {-webkit-border-radius: 0 2px 2px 0; border-radius: 0 2px 2px 0; border-width: 1px 1px 1px 0; margin-left: -2px; margin-right: 4px;}.claro .dijitSlider .dijitSliderProgressBarH {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSlider .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none; -webkit-border-radius: 2px 0 0 2px; border-radius: 2px 0 0 2px;}.claro .dijitSlider .dijitSliderRemainingBarH,.claro .dijitSlider .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-border-radius: 2px; border-radius: 2px;}.claro .dijitSliderHover .dijitSliderProgressBarH,.claro .dijitSliderHover .dijitSliderLeftBumper {border-color: #ebebeb; background-color: #ebebeb; background-image: none; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderFocused .dijitSliderProgressBarH,.claro .dijitSliderFocused .dijitSliderLeftBumper {border-color: #ebebeb;}.claro .dijitSliderFocused .dijitSliderRemainingBarH,.claro .dijitSliderFocused .dijitSliderRightBumper {border-color: #878787; background-color: #878787; -webkit-box-shadow: none; box-shadow: none;}.claro .dijitSliderImageHandle {background: #ffffff; -webkit-border-radius: 50%; border-radius: 50%; border: 0 none; width: 16px; height: 16px; margin-top: -2px; position: absolute;}.claro .dijitSliderImageHandle:after {content: \"\"; display: block; background: #6e6e6e; -webkit-border-radius: 50%; border-radius: 50%; height: 8px; width: 8px; left: 4px; top: 4px; position: absolute;}.claro .dijitSliderDisabled.dijitSliderFocused .dijitSliderImageHandle:after {display: none; outline: none;}.claro .dijitSliderDecrementIconH,.claro .dijitSliderIncrementIconH {padding: 0; height: 20px; width: 20px; background-color: transparent; border: 0 none;}.IMT_tabPanel::-webkit-scrollbar {width: 6px; height: 6px; background-color: rgba(0, 0, 0, 0.1);}.IMT_tabPanel::-webkit-scrollbar-thumb {background-color: rgba(0, 0, 0, 0.4);}.IMT_tabPanel {scrollbar-base-color: #4c4c4c; scrollbar-3dlight-color: #4c4c4c; scrollbar-highlight-color: #4c4c4c; scrollbar-track-color: #444444; scrollbar-arrow-color: #2e2e2e; scrollbar-shadow-color: #4c4c4c; scrollbar-dark-shadow-color: #4c4c4c; scrollbar-face-color: #2e2e2e;}",
"url:widgets/IncidentAnalysis/config.json":'{\r\n  "comment": "Do not change lyr_types unless you have the widget JS code to support them",\r\n  "geocodeService": {\r\n    "url": "https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer"\r\n  },\r\n  "enableRouting": true,\r\n  "special_layer": {\r\n    "label": "Weather",\r\n    "value": "weather",\r\n    "url": "http://coolmaps.esri.com/Weather/info.php?v\x3d1"\r\n  },\r\n  "bufferLabel": "",\r\n  "bufferRange": {\r\n    "minimum": 0,\r\n    "maximum": 100\r\n  },\r\n  "distanceUnits": "miles",\r\n  "distanceSettings": {\r\n    "miles": 9035,\r\n    "kilometers": 9036,\r\n    "feet": 9002,\r\n    "meters": 9001,\r\n    "yards": 9037,\r\n    "nauticalMiles": 9030\r\n  },\r\n  "maxDistance": "80",\r\n  "defaultZoomLevel": 13,\r\n  "tabs": [{\r\n    "label": "Weather",\r\n    "type": "weather",\r\n    "layers": "",\r\n    "url": "http://coolmaps.esri.com/Weather/info.php?v\x3d1"\r\n  }]\r\n}\r\n',
"*now":function(e){e(['dojo/i18n!*preload*widgets/IncidentAnalysis/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget jimu/dijit/Message jimu/utils jimu/LayerInfos/LayerInfos dojo/_base/Color dojo/_base/html dojo/dom dojo/on dojo/dom-style dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/_base/lang dojo/_base/array dojo/_base/xhr dojo/query dojo/json dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels esri/geometry/Extent esri/geometry/geometryEngine esri/geometry/Polygon esri/geometry/Point esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/webMercatorUtils esri/graphic esri/layers/GraphicsLayer esri/symbols/Font esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/SimpleMarkerSymbol esri/symbols/TextSymbol esri/tasks/locator esri/tasks/BufferParameters esri/toolbars/draw ./js/SummaryInfo ./js/WeatherInfo ./js/ClosestInfo ./js/ProximityInfo dojo/keys dojo/domReady!".split(" "),function(e,
m,q,n,r,p,c,f,g,w,b,a,u,d,t,h,y,E,A,l,s,k,F,G,H,v,I,z,x,J,B,D,K,N,P,O,V,L,Q,R,S,T,U){return e([q,m],{baseClass:"jimu-widget-IMT",name:"IncidentAnalysis",opLayers:null,curTab:0,lyrBuffer:null,lyrIncidents:null,lyrClosest:null,lyrProximity:null,tabLayersVisibility:{},toolbar:null,tool:-1,symPoint:null,symLine:null,symPoly:null,symBuffer:null,symRoute:null,incident:null,buffer:null,locator:null,stops:[],Incident_Local_Storage_Key:"IMT_Incident",SLIDER_MAX_VALUE:1E4,postCreate:function(){this.inherited(arguments)},
startup:function(){this.inherited(arguments);this._getStyleColor();this._createUI();this._loadUI();this._initLayers();this._verifyRouting();this.config.enableRouting&&(this.config.enableRouting=!1,h.forEach(this.appConfig.widgetPool.widgets,t.hitch(this,function(a){"Directions"===a.name&&(this.config.enableRouting=!0)})));this.SLIDER_MAX_VALUE=this.config.bufferRange.maximum;this.opLayers=this.map.itemInfo.itemData.operationalLayers;this._mapLoaded();this._restoreIncidents()},onOpen:function(){this.inherited(arguments);
this._getTabLayersVisibility();this._addActionLink();this._clickTab(0)},onClose:function(){this._clear();this._toggleTabLayersOld();this._setTabLayersVisibility();this._removeActionLink();this.inherited(arguments)},onDeActive:function(){this._clickIncidentsButton(-1)},destroy:function(){this._clear();this._toggleTabLayersOld();this.lyrBuffer&&this.map.removeLayer(this.lyrBuffer);this.lyrIncidents&&this.map.removeLayer(this.lyrIncidents);this.lyrClosest&&this.map.removeLayer(this.lyrClosest);this.lyrProximity&&
this.map.addLayer(this.lyrProximity);this.inherited(arguments)},onAppConfigChanged:function(a,b,c){switch(b){case "styleChange":this._updateUI(c);break;case "widgetPoolChange":this._verifyRouting()}},_addActionLink:function(){var a=this.nls.actionLabel,b=E(".actionList",this.map.infoWindow.domNode);if(0<b.length){var c=E("#actionLink",b[0]),a=0<c.length?c[0]:u.create("a",{"class":"action",id:"actionLink",innerHTML:a,href:"javascript: void(0);"},b[0]);this.own(w(a,"click",t.hitch(this,this._setEventLocation)))}},
_removeActionLink:function(){g.byId("actionLink")&&u.destroy(g.byId("actionLink"))},_updateUI:function(a){this._getStyleColor(a)},_getStyleColor:function(a){var c=this.appConfig.theme.name,d=this.appConfig.theme.styles[0];a&&(d=a);y.get({url:"./themes/"+c+"/manifest.json",handleAs:"json",load:t.hitch(this,function(a){a=a.styles;for(var c=0;c<a.length;c++){var M=a[c];M.name===d&&(b.set(this.footerNode,"background-color",M.styleColor),this.config.color=M.styleColor,this._setupSymbols(),this._bufferIncident())}})})},
setPosition:function(a,b){if("BoxTheme"===this.appConfig.theme.name||"DartTheme"===this.appConfig.theme.name||"LaunchpadTheme"===this.appConfig.theme.name)this.inherited(arguments);else{this.position={left:"0px",right:"0px",bottom:"0px",height:"140px"};var c=r.getPositionStyle(this.position);c.position="absolute";b=this.map.id;f.place(this.domNode,b);f.setStyle(this.domNode,c);this.started&&this.resize();"TabTheme"===this.appConfig.theme.name&&(c=this.widgetManager.getControllerWidgets()[0],this.widgetManager.minimizeWidget(c.id))}},
disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},_setEventLocation:function(){var a={eventType:"IncidentLocation",dataValue:this.map.infoWindow.getSelectedFeature()};this.onReceiveData("","",a)},_initLayers:function(){this.locator=new O(this.config.geocodeService.url);this.own(w(this.locator,"location-to-address-complete",t.hitch(this,this._showIncidentAddress)));this.own(w(this.locator,"error",t.hitch(this,
this._onAddressError)));this.lyrBuffer=new J;this.map.addLayer(this.lyrBuffer);this.lyrIncidents=new J;this.map.addLayer(this.lyrIncidents);this.lyrClosest=new J;this.lyrClosest.setVisibility(!1);this.map.addLayer(this.lyrClosest);this.lyrProximity=new J;this.lyrProximity.setVisibility(!1);this.map.addLayer(this.lyrProximity)},_mapLoaded:function(){E("[data-reference]").style("z-index",0);this.map.itemId&&p.getInstance(this.map,this.map.itemInfo).then(t.hitch(this,function(a){this.opLayers=a;this._processOperationalLayers()}));
this._clickTab(0)},_processOperationalLayers:function(){for(var a=0;a<this.config.tabs.length;a++){var b=this.config.tabs[a];b.layers&&""!==b.layers&&(b.tabLayers=this._getTabLayers(b.layers))}},_createUI:function(){var c=this.config.distanceUnits,C=r.sanitizeHTML(this.config.bufferLabel?this.config.bufferLabel:""),C=C+(" ("+this.nls[c]+")");this.buffer_lbl.innerHTML=C;c=g.byId("horizontalSliderDiv");C=document.createElement("div");c.appendChild(C);C=document.createElement("div");c.appendChild(C);
var C=new s({container:"bottomDecoration",minimum:this.config.bufferRange.minimum,maximum:this.config.bufferRange.maximum,labels:[this.config.bufferRange.minimum,this.config.bufferRange.maximum],style:"height:2em;font-size:75%;color:#fff"},C),e=Math.abs(Math.round(this.config.bufferRange.maximum-this.config.bufferRange.minimum))+1,f=this.config.bufferRange.minimum+10;f>this.config.bufferRange.maximum&&(f=this.config.bufferRange.minimum);this.horizontalSlider=new l({value:f,minimum:this.config.bufferRange.minimum,
maximum:this.config.bufferRange.maximum,discreteValues:e,intermediateChanges:!1,showButtons:!1,style:"width:180px;"},c);this.own(w(this.horizontalSlider,"change",t.hitch(this,this._sliderChange)));this.horizontalSlider.startup();C.startup();this.sliderValue.set("value",f);this.config.tabs.splice(0,0,{type:"incidents",label:this.nls.incident,color:this.config.color});c=this.panelContainer;C=g.byId("IMT_tabs");for(f=e=0;f<this.config.tabs.length;f++){var h=this.config.tabs[f],k=h.label;"weather"===
h.type&&(k=this.nls.weather);if(!k||""===k)k=h.layers;k=u.create("div",{id:"tab"+f,innerHTML:r.sanitizeHTML(k?k:"")},C);a.add(k,"IMTTab");e+=d.position(k).w;w(k,"click",t.hitch(this,this._clickTab,f));0<f&&(k=u.create("div",{id:"tabPanel"+f,innerHTML:this.nls.defaultTabMsg},c),a.add(k,"IMT_tabPanel"),"summary"===h.type&&(h.summaryInfo=new Q(h,k,this)),"weather"===h.type&&(h.weatherInfo=new R(h,k,this)),"closest"===h.type&&(h.closestInfo=new S(h,k,this)),"proximity"===h.type&&(h.proximityInfo=new T(h,
k,this)))}b.set(C,"width",e+10+"px")},_loadUI:function(){for(var a=0;4>a;a++){var b=g.byId("btn"+a);f.setAttr(b,"src",this.folderUrl+"images/btn"+a+".png");this.own(w(b,"click",t.hitch(this,this._clickIncidentsButton,a)))}this.toolbar=new L(this.map,{tooltipOffset:20,drawTime:90});this.toolbar.on("draw-end",t.hitch(this,this._drawIncident));this.own(w(this.horizontalSlider,"change",t.hitch(this,this._sliderChange)));this.own(w(this.sliderValue,"keyup",t.hitch(this,function(a){a.keyCode===U.ENTER?
this._updateSliderValue():(a=this.sliderValue.get("value"),isNaN(a)?this.sliderValue.set("value",this.horizontalSlider.value):(a<this.config.bufferRange.minimum&&this.sliderValue.set("value",this.config.bufferRange.minimum),a>this.SLIDER_MAX_VALUE&&this.sliderValue.set("value",this.SLIDER_MAX_VALUE)))})))},_locateBuffer:function(a){if(null!==a&&(a="extent"===a.type?a:a.geometry.getExtent(),null!==a)){a=a.expand(1.5);var b=80/this.map.height,c=a.getHeight();a.update(a.xmin,a.ymin-c*b,a.xmax,a.ymax-
c*b,this.map.spatialReference);this.map.setExtent(a,!0)}},_clickIncidentsButton:function(b){var c;if(3>b){for(var d=0;3>d;d++)c=g.byId("btn"+d),a.remove(c,"btnOn");-1<b&&b!==this.tool?(c=g.byId("btn"+b),a.add(c,"btnOn"),this.tool=b):this.tool=-1;switch(this.tool){case -1:this.toolbar.deactivate();this.enableWebMapPopup();break;case 0:this._clear();this.toolbar.activate(L.POINT);this.disableWebMapPopup();break;case 1:this._clear();this.toolbar.activate(L.POLYLINE);this.disableWebMapPopup();break;case 2:this._clear(),
this.toolbar.activate(L.POLYGON),this.disableWebMapPopup()}}else this._clear()},_clear:function(){this.map.graphics.clear();this.lyrIncidents.clear();this.lyrBuffer.clear();this.lyrProximity.clear();this.lyrClosest.clear();this.buffer=this.incident=null;this.div_reversed_address.innerHTML="";f.setStyle(this.div_reverse_geocoding,"visibility","hidden");for(var a=1;a<this.config.tabs.length;a++)g.byId("tabPanel"+a)&&(g.byId("tabPanel"+a).innerHTML=this.nls.defaultTabMsg)},_sliderChange:function(){this.sliderValue.set("value",
this.horizontalSlider.value);this._bufferIncident()},_sliderTextChange:function(){0>this.sliderValue.value||this.sliderValue.value>this.SLIDER_MAX_VALUE?this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.value)},_updateSliderValue:function(){0>this.sliderValue.displayedValue||this.sliderValue.displayedValue>this.SLIDER_MAX_VALUE?this.sliderValue.set("value",this.horizontalSlider.value):this.horizontalSlider.set("value",this.sliderValue.displayedValue)},
_clickTab:function(a){this._toggleTabs(a);this._toggleTabLayers(a);this.curTab=a;this._clickIncidentsButton(-1)},_toggleTabs:function(c){for(var d=0;d<this.config.tabs.length;d++)d===c?(a.add("tab"+d,"active"),b.set("tabPanel"+d,"display","block")):(a.remove("tab"+d,"active"),b.set("tabPanel"+d,"display","none"));this._scrollToTab(c)},_getTabLayersVisibility:function(){h.forEach(this.config.tabs,t.hitch(this,function(a){h.forEach(a.tabLayers,t.hitch(this,function(a){"undefined"!==typeof a.visible&&
(this.tabLayersVisibility[a.id]=a.visible,a.setVisibility(!1))}))}))},_setTabLayersVisibility:function(){h.forEach(this.config.tabs,t.hitch(this,function(a){h.forEach(a.tabLayers,t.hitch(this,function(a){a.id in this.tabLayersVisibility&&a.setVisibility(this.tabLayersVisibility[a.id])}))}))},_toggleTabLayers:function(a){this._toggleTabLayersOld();this._toggleTabLayersNew(a)},_toggleTabLayersOld:function(){var a=this.config.tabs[this.curTab];a&&(this.lyrClosest.setVisibility(!1),this.lyrProximity.setVisibility(!1),
a.tabLayers&&h.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!1)}))},_toggleTabLayersNew:function(a){a=this.config.tabs[a];switch(a.type){case "summary":a.tabLayers&&h.forEach(a.tabLayers,function(a){a.setVisibility(!0)});this.incident&&!0===a.updateFlag&&(a.summaryInfo.updateForIncident(this.incident,this.buffer),a.updateFlag=!1);break;case "weather":a.tabLayers&&h.forEach(a.tabLayers,function(a){a.setVisibility(!0)});this.incident&&!0===a.updateFlag&&(a.weatherInfo.updateForIncident(this.incident),
a.updateFlag=!1);break;case "closest":a.tabLayers&&h.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)});this.lyrClosest.setVisibility(!0);this.incident&&(a.closestInfo.updateForIncident(this.incident,this.config.maxDistance,this.lyrClosest),a.updateFlag=!1);break;case "proximity":a.tabLayers&&h.forEach(a.tabLayers,function(a){"undefined"!==typeof a.visible&&a.setVisibility(!0)}),this.lyrProximity.setVisibility(!0),this.incident&&(a.proximityInfo.updateForIncident(this.incident,
this.buffer,this.lyrProximity),a.updateFlag=!1)}a.updateFlag=!1},_drawIncident:function(a){var b=a.geometry.type,c=this.symPoint;"polyline"===b&&(c=this.symLine);"polygon"===b&&(c=this.symPoly);this.incident=new x(a.geometry,c);this.lyrIncidents.add(this.incident);this.toolbar.deactivate();this._clickIncidentsButton(-1);this._bufferIncident();"point"===b&&this._getIncidentAddress(a.geometry);this.div_reversed_address.innerHTML="";f.setStyle(this.div_reverse_geocoding,"visibility","hidden")},_getIncidentAddress:function(a){this.map.graphics.clear();
this.locator.locationToAddress(z.webMercatorToGeographic(a),100)},_showIncidentAddress:function(a){if(a.address.address){var b=a.address.address.Address,c=z.geographicToWebMercator(a.address.location),d=new B;d.family="Arial";d.size="18px";d=new P(b,d,"#000000");d.setOffset(20,-4);d.horizontalAlignment="left";this.map.graphics.add(new x(c,d,{}));b+="\x3c/br\x3e";a.address.address.City&&(b+=a.address.address.City+", ");a.address.address.Region&&(b+=a.address.address.Region);a.address.address.Postal&&
(b+=" "+a.address.address.Postal);this.div_reversed_address.innerHTML=b;f.setStyle(this.div_reverse_geocoding,"visibility","visible")}},_onAddressError:function(){this.div_reversed_address.innerHTML=this.nls.reverse_geocoded_error;f.setStyle(this.div_reverse_geocoding,"visibility","visible")},_bufferIncident:function(){if(null!==this.incident){for(var a=0;a<this.config.tabs.length;a++)this.config.tabs[a].updateFlag=!0;a=this.incident;this.buffer=null;this.lyrBuffer.clear();var b=this.horizontalSlider.value,
c=this.config.distanceSettings[this.config.distanceUnits];if(0<b){var d=a.geometry.spatialReference.wkid,a=4326===d||3857===d||102100===d?F.geodesicBuffer(a.geometry,b,c):F.buffer(a.geometry,b,c);this._locateBuffer(a.getExtent());this.buffer=new x(a,this.symBuffer);this.lyrBuffer.add(this.buffer);this._performAnalysis()}else"polygon"===a.geometry.type&&(this._locateBuffer(a.geometry.getExtent()),this.buffer=new x(a.geometry,this.symPoly),this.lyrBuffer.add(this.buffer),this._performAnalysis())}},
_performAnalysis:function(){this._toggleTabLayersNew(this.curTab)},_verifyRouting:function(){this.config.enableRouting&&(this.config.enableRouting=!1,h.forEach(this.appConfig.widgetPool.widgets,t.hitch(this,function(a){"Directions"===a.name&&(this.dirConfig=a,this.config.enableRouting=!0)})))},zoomToLocation:function(a){this.map.centerAndZoom(a,this.config.defaultZoomLevel)},routeToIncident:function(a){var b=this.incident.geometry,c=b;"point"!==b.type&&(c=b.getExtent().getCenter());this.stops=[a,
c];b=this.dirConfig.id;c=this.appConfig.theme.name;a=this.widgetManager.getControllerWidgets()[0];switch(c){case "BoxTheme":case "DartTheme":a.setOpenedIds([b]);break;case "FoldableTheme":case "JewelryBoxTheme":(b=a._getIconNodeById(b))&&a._onIconClick(b);break;case "TabTheme":a._hideOffPanelWidgets();for(var c=a.tabs,d=0,e=0;e<c.length;e++)if("more"!==c[e].flag){if(c[e].config.id===b){d=e;break}}else for(var d=e,f=c[e].config.groups,g=0;g<f.length;g++)f[g].id===b&&a._addGroupToMoreTab(f[g]);a.selectTab(d);
setTimeout(t.hitch(a,a._resizeToMax),500);break;case "LaunchpadTheme":a.setOpenedIds([b]);break;default:this.openWidgetById(b)}setTimeout(t.hitch(this,this._addStops),2E3)},_addStops:function(){var a=this.widgetManager.getWidgetById(this.dirConfig.id);if(a&&"closed"!==a.state&&(a=a._dijitDirections))a.reset(),a.addStops(this.stops)},_getTabLayers:function(a){var b=[];h.forEach(this.opLayers._layerInfos,t.hitch(this,function(c){0<c.newSubLayers.length?this._recurseOpLayers(c.newSubLayers,b,a):-1<a.indexOf(c.title)&&
b.push(c.layerObject)}));return b},_recurseOpLayers:function(a,b,c){h.forEach(a,t.hitch(this,function(a){0<a.newSubLayers.length?this._recurseOpLayers(a.newSubLayers,b,c):-1<c.indexOf(a.title)&&b.push(a.layerObject)}))},_setupSymbols:function(){var a=c.fromString(this.config.color),b=a.toRgb();b.push(0.2);var d=c.fromString("#000000"),a=c.blendColors(a,d,0.2).toRgb(),d=new D(D.STYLE_SOLID,new c([255,255,255,0.25]),1);this.symPoint=new N(N.STYLE_CIRCLE,20,d,new c([a[0],a[1],a[2],0.7]));this.symLine=
new D(D.STYLE_SOLID,new c([a[0],a[1],a[2],0.7]),3);this.symPoly=new K(K.STYLE_SOLID,this.symLine,new c([a[0],a[1],a[2],0.3]));this.symBuffer=new K(K.STYLE_SOLID,d,new c(b))},onReceiveData:function(a,b,c){null!==c&&c.eventType&&("IncidentLocation"===c.eventType?c.dataValue&&null!==c.dataValue&&(this._clear(),this._clickTab(0),a=c.dataValue,a.attributes[this.shapeFlagFieldName]?(this.incident=a,this._bufferIncident()):this._drawIncident(a)):"WebMapChanged"===c.eventType&&this._storeIncidents())},_storeIncidents:function(){if(null!==
this.incident){var a={location:A.stringify(this.incident.geometry),hasBuffer:0<this.lyrBuffer.graphics.length,buffer_dist:this.horizontalSlider.value,unit:this.config.distanceUnits},a=A.stringify(a);window.localStorage.setItem(this.Incident_Local_Storage_Key,a);console.log("Inclident saved to storage")}this.publishData({eventType:"WebMapChangedACK"});console.log("eventType WebMapChangedACK fired")},_restoreIncidents:function(){var a=window.localStorage.getItem(this.Incident_Local_Storage_Key);if(null!==
a&&"null"!==a){window.localStorage.setItem(this.Incident_Local_Storage_Key,null);var a=A.parse(a,!0),b=a.buffer_dist;this.sliderValue.set("value",b);this.horizontalSlider.set("value",b);var b=A.parse(a.location),c=a.hasBuffer;if(b){var a={},d=null;"extent"===b.type?d=new k(b):"multipoint"===b.type?d=new v(b):"point"===b.type?d=new H(b):"polygon"===b.type?d=new G(b):"polyline"===b.type&&(d=new I(b));a.geometry=d;this._drawIncident(a,c)}}},_scrollToTab:function(a){var b=d.position(this.footerContentNode).w;
d.position(this.tabsNode).w>b&&(a=d.getMarginBox("tab"+a),this.footerContentNode.scrollLeft=a.l-(b-a.w)/2)},_close:function(){this.widgetManager.closeWidget(this.id)}})});