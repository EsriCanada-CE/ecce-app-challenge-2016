// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./dijit/LoadingIndicator esri/config esri/tasks/GeometryService".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t){function e(b){var g=d.clone(b),e=a.widgetProperties;delete g.mode;a.visitElement(g,function(b,c){b.widgets?(delete b.isOnScreen,delete b.gid,"jimu.js/images/group_icon.png"===
b.icon&&delete b.icon,delete b.openType,c.isOnScreen&&b.panel&&a.isEqual(b.panel,g.widgetOnScreen.panel)&&delete b.panel):(b.icon&&b.icon===b.amdFolder+"images/icon.png"&&delete b.icon,delete b.panel,delete b.folderUrl,delete b.amdFolder,delete b.thumbnail,delete b.configFile,delete b.gid,delete b.isOnScreen,e.forEach(function(a){delete b[a]}),b.visible&&delete b.visible,delete b.manifest)});delete g.rawAppConfig;delete g._ssl;delete g.getConfigElementById;delete g.getConfigElementsByName;delete g.processNoUriWidgets;
delete g.addElementId;delete g.getCleanConfig;delete g.visitElement;delete g.agolConfig;delete g._itemData;delete g.oldWabVersion;return g}var g=null,y;y=n(null,{urlParams:null,appConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a){this.urlParams=a||{};this.listenBuilderEvents();this.versionManager=new b;this.widgetManager=k.getInstance();this.configLoader=s.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&(window.parent.setConfigViewerTopic&&
d.isFunction(window.parent.setConfigViewerTopic))&&window.parent.setConfigViewerTopic(c);"preview"===this.urlParams.mode&&(window.parent.setPreviewViewerTopic&&d.isFunction(window.parent.setPreviewViewerTopic))&&window.parent.setPreviewViewerTopic(c);l(window,"resize",d.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){c.subscribe("builder/widgetChanged",d.hitch(this,this._onWidgetChanged));c.subscribe("builder/groupChanged",d.hitch(this,this._onGroupChanged));c.subscribe("builder/widgetPoolChanged",
d.hitch(this,this._onWidgetPoolChanged));c.subscribe("builder/openAtStartChange",d.hitch(this,this._onOpenAtStartChanged));c.subscribe("builder/mapChanged",d.hitch(this,this._onMapChanged));c.subscribe("builder/mapOptionsChanged",d.hitch(this,this._onMapOptionsChanged));c.subscribe("builder/appAttributeChanged",d.hitch(this,this._onAppAttributeChanged));c.subscribe("builder/setAppConfig",d.hitch(this,this._onAppConfigSet));c.subscribe("builder/themeChanged",d.hitch(this,this._onThemeChanged));c.subscribe("builder/layoutChanged",
d.hitch(this,this._onLayoutChanged));c.subscribe("builder/styleChanged",d.hitch(this,this._onStyleChanged));c.subscribe("builder/syncExtent",d.hitch(this,this._onSyncExtent));c.subscribe("builder/loadingPageChanged",d.hitch(this,this._onLoadingPageChanged));c.subscribe("builder/templateConfigChanged",d.hitch(this,this._onTemplateConfigChanged))},loadConfig:function(){if(!("preview"===this.urlParams.mode||"config"===this.urlParams.mode)){var a=new r;a.placeAt(window.jimuConfig.layoutId);return this.configLoader.loadConfig().then(d.hitch(this,
function(b){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(b);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");b=this.getAppConfig();a.destroy();c.publish("appConfigLoaded",b);return b}),d.hitch(this,function(a){console.error(a);a&&(a.message&&"string"===typeof a.message)&&this._showErrorMessage(a.message)}))}},_showErrorMessage:function(a){h.create("div",{"class":"app-error",innerHTML:a},document.body)},getAppConfig:function(){var b;
window.appInfo.isRunInMobile?(b=d.clone(this._getMobileConfig(this.appConfig)),b._originConfig=d.clone(this.appConfig)):b=d.clone(this.appConfig);b.getConfigElementById=function(b){return a.getConfigElementById(this,b)};b.getConfigElementsByName=function(b){return a.getConfigElementsByName(this,b)};b.getCleanConfig=function(){return this._originConfig?e(this._originConfig):e(this)};b.visitElement=function(b){a.visitElement(this,b)};return b},_onWindowResize:function(){var a=this._isRunInMobile();
window.appInfo.isRunInMobile!==a&&(window.appInfo.isRunInMobile=a,this.appConfig&&c.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var a=h.getMarginBox(window.jimuConfig.layoutId);if(a.w<=window.jimuConfig.breakPoints[0]||a.h<=window.jimuConfig.breakPoints[0])return h.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;h.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(b){return a.mixinAppConfigPosition(b,b.mobileLayout)},
_onWidgetChanged:function(b){var g=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);!1===g.inPanel&&!b.uri&&(g.closeable=!0);for(var e in g)b[e]=g[e];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetChange",g)},_onGroupChanged:function(b){var g=a.reCreateObject(b);b=a.getConfigElementById(this.appConfig,b.id);for(var e in g)b[e]=g[e];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
c.publish("appConfigChanged",this.getAppConfig(),"groupChange",g)},_onWidgetPoolChanged:function(b){b=a.reCreateObject(b);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=b.widgets,this.appConfig.widgetPool.groups=b.groups;else{var g=a.getConfigElementById(this.appConfig,b.controllerId);f.forEach(g.controlledWidgets,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,a)},this);f.forEach(g.controlledGroups,function(a){this._removeWidgetOrGroupFromPoolById(this.appConfig,
a)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?b.widgets:this.appConfig.widgetPool.widgets.concat(b.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?b.groups:this.appConfig.widgetPool.groups.concat(b.groups);this.configLoader.addNeedValues(this.appConfig);g.controlledWidgets=f.map(b.widgets,function(a){return a.id});g.controlledGroups=f.map(b.groups,function(a){return a.id})}this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",b)},_removeWidgetOrGroupFromPoolById:function(a,b){f.some(a.widgetPool.widgets,function(g,e){if(g.id===b)return a.widgetPool.widgets.splice(e,1),!0});f.some(a.widgetPool.groups,function(g,e){if(g.id===b)return a.widgetPool.groups.splice(e,1),!0})},_onOpenAtStartChanged:function(b){var g=a.reCreateObject(b),e=this.appConfig;b.isOnScreen?(e=e.widgetOnScreen&&e.widgetOnScreen.widgets)&&0<e.length&&
f.forEach(e,d.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})):((e=e.widgetPool)&&(e.groups&&0<e.groups.length)&&f.forEach(e.groups,d.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})),e&&(e.widgets&&0<e.widgets.length)&&f.forEach(e.widgets,d.hitch(this,function(a){a.id===b.id?a.openAtStart=!a.openAtStart:delete a.openAtStart})));c.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",g)},_onAppAttributeChanged:function(b){b=
a.reCreateObject(b);d.mixin(this.appConfig,b);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"attributeChange",b)},_onLoadingPageChanged:function(b){b=a.reCreateObject(b);var g;"backgroundColor"in b?this.appConfig.loadingPage.backgroundColor=b.backgroundColor:"backgroundImage"in b?(g=this.appConfig.loadingPage.backgroundImage||{},this.appConfig.loadingPage.backgroundImage=
d.mixin(g,b.backgroundImage)):"loadingGif"in b&&(g=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=d.mixin(g,b.loadingGif));this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",b)},_onTemplateConfigChanged:function(b){b=a.reCreateObject(b);this.appConfig.templateConfig=b;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",
this.getAppConfig(),"templateConfigChange",b)},_onMapChanged:function(b){b=a.reCreateObject(b);this.appConfig.map.mapOptions&&a.deleteMapOptions(this.appConfig.map.mapOptions);d.mixin(this.appConfig.map,b);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"mapChange",b)},_onMapOptionsChanged:function(b){b=a.reCreateObject(b);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});d.mixin(this.appConfig.map.mapOptions,
b);c.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",b)},_onThemeChanged:function(a){this._getAppConfigFromTheme(a).then(d.hitch(this,function(b){this.appConfig=b;c.publish("appConfigChanged",this.getAppConfig(),"themeChange",a.getName())}))},_onLayoutChanged:function(b){this.appConfig=a.mixinAppConfigPosition(this.appConfig,b.layoutConfig);this._addDefaultPanelAndPosition(this.appConfig);c.publish("appConfigChanged",this.getAppConfig(),"layoutChange",b.name)},_onStyleChanged:function(a){this.appConfig.theme.styles=
this._genStyles(this.appConfig.theme.styles,a.name);c.publish("appConfigChanged",this.getAppConfig(),"styleChange",a.name)},_onSyncExtent:function(a){c.publish("syncExtent",a)},_genStyles:function(a,b){var g=[];g.push(b);f.forEach(a,function(a){0>g.indexOf(a)&&g.push(a)});return g},_getAppConfigFromTheme:function(a){var b=new p,g,e=[],e=this.getAppConfig().getCleanConfig();e.mode=this.urlParams.mode;f.forEach(e.widgetPool.groups,function(a){delete a.panel},this);if(a.appConfig)g=d.clone(a.appConfig),
g.map=e.map,g.map.position=a.appConfig.map.position,this._copyPoolToThemePool(e,g),g.links=e.links,g.title=e.title,g.subtitle=e.subtitle,g.logo=e.logo;else{var c=a.getCurrentLayout(),m=a.getCurrentStyle();g=d.clone(e);c=d.clone(c.layoutConfig);g.widgetOnScreen=c.widgetOnScreen;c.widgetPool&&(f.forEach(c.widgetPool.widgets,function(a){a.isPreconfiguredInTheme=!0}),f.forEach(c.widgetPool.groups,function(a){a.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(e,c);g.widgetPool=c.widgetPool;c.map&&
c.map.position&&(g.map.position=c.map.position);g.mobileLayout=c.mobileLayout;e=this._genStyles(f.map(a.getStyles(),function(a){return a.name}),m.name);g.theme={name:a.getName(),styles:e,version:a.getVersion()}}this.configLoader.addNeedValues(g);this.configLoader.loadWidgetsManifest(g).then(d.hitch(this,function(){this._addDefaultValues(g);b.resolve(g)}));return b},_copyPoolToThemePool:function(a,b){var g=a.widgetPool;b.widgetPool||(b.widgetPool={});var e=b.widgetPool,c=f.filter(e.widgets,function(a){if(a.isPreconfiguredInTheme||
!f.some(g.widgets,function(b){return b.name===a.name}))return!0}),m=f.filter(e.groups,function(a){return a.isPreconfiguredInTheme}),k=f.filter(g.widgets,function(a){return!a.isPreconfiguredInTheme}),r=f.filter(g.groups,function(a){return!a.isPreconfiguredInTheme}),k=this._getPoolWidgetsWithoutDuplicated(k,b.widgetOnScreen.widgets||[]);e.widgets=k.concat(c);e.groups=r.concat(m)},_getPoolWidgetsWithoutDuplicated:function(b,g){for(var e=d.clone(b),c=this.getAppConfig(),m=b.length-1;0<=m;m--)for(var k=
g.length-1;0<=k;k--)if(g[k].uri){var r=g[k].name;r||(r=a.getWidgetNameFromUri(g[k].uri));var q=c.getConfigElementById(b[m].id);b[m]&&(b[m].name===r&&!1===q.supportMultiInstance)&&(console.log("Widget",b[m].name,"is not copied to new theme because this widget exists in new theme."),e.splice(m,1))}return e},_onAppConfigSet:function(b){b=a.reCreateObject(b);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(b);this.configLoader.addNeedValues(b);this._addDefaultValues(b);
q.setPortalUrl(b.portalUrl);this.appConfig?(a.deleteMapOptions(b.map.mapOptions),this.appConfig=b,c.publish("appConfigChanged",this.getAppConfig(),"resetConfig",b)):(this.appConfig=b,c.publish("appConfigLoaded",this.getAppConfig()))},_addDefaultValues:function(a){this._addDefaultPortalUrl(a);this._addDefaultGeometryService(a);this._addDefaultStyle(a);this._addDefaultMap(a);this._addDefaultVisible(a);"undefined"===typeof a.widgetOnScreen&&(a.widgetOnScreen={});"undefined"===typeof a.widgetPool&&(a.widgetPool=
{});this._addDefaultPanelAndPosition(a);this._addDefaultOfWidgetGroup(a);(a.widgetPool.widgets&&0<a.widgetPool.widgets.length&&void 0===a.widgetPool.widgets[0].index||a.widgetPool.groups&&0<a.widgetPool.groups.length&&void 0===a.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(a);return a},_addDefaultPortalUrl:function(a){"undefined"===typeof a.portalUrl&&(a.portalUrl="http://www.arcgis.com/");a.portalUrl&&"/"!==a.portalUrl.substr(a.portalUrl.length-1)&&(a.portalUrl+="/")},_addDefaultGeometryService:function(a){var b=
a&&a.geometryService,b=b&&"string"===typeof b&&d.trim(b)?d.trim(b):this.portalSelf.helperServices.geometry.url;a.geometryService=b;m.defaults.geometryService=new t(a.geometryService)},_addDefaultStyle:function(a){if(a.theme&&(!a.theme.styles||0===a.theme.styles.length))a.theme.styles=["default"]},_addDefaultMap:function(a){a.map.id="map";"undefined"===typeof a.map["3D"]&&"undefined"===typeof a.map["2D"]&&(a.map["2D"]=!0);"undefined"===typeof a.map.position&&(a.map.position={left:0,right:0,top:0,bottom:0});
"undefined"===typeof a.map.portalUrl&&(a.map.portalUrl=a.portalUrl)},_addDefaultVisible:function(b){a.visitElement(b,function(a){void 0===a.visible&&(a.visible=!0)})},_addDefaultPanelAndPosition:function(a){this._addOnScreenDefaultPanelAndPosition(a);this._addPoolDefaultPanelAndPosition(a)},_addOnScreenDefaultPanelAndPosition:function(a){var b,g;if(a=a.widgetOnScreen){b=a.panel&&a.panel.positionRelativeTo?a.panel.positionRelativeTo:"map";"undefined"===typeof a.panel||"undefined"===typeof a.panel.uri?
a.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof a.panel.position?a.panel.position={relativeTo:b}:"undefined"===typeof a.panel.position.relativeTo&&(a.panel.position.relativeTo=b);if(a.widgets)for(b=0;b<a.widgets.length;b++)a.widgets[b].position||(a.widgets[b].position={}),a.widgets[b].position.relativeTo||(a.widgets[b].position.relativeTo=a.widgets[b]&&a.widgets[b].positionRelativeTo?a.widgets[b].positionRelativeTo:"map"),!0===a.widgets[b].inPanel&&!a.widgets[b].panel&&
(a.widgets[b].panel=d.clone(a.panel),a.widgets[b].panel.position=a.widgets[b].position,a.widgets[b].panel.position.relativeTo=a.widgets[b].position.relativeTo);if(a.groups)for(b=0;b<a.groups.length;b++){a.groups[b].panel||(a.groups[b].panel=a.panel);a.groups[b].panel&&!a.groups[b].panel.position&&(a.groups[b].panel.position={});a.groups[b].panel.position.relativeTo||(a.groups[b].panel.position.relativeTo=a.groups[b].panel.positionRelativeTo?a.groups[b].panel.positionRelativeTo:"map");a.groups[b].widgets||
(a.groups[b].widgets=[]);for(g=0;g<a.groups[b].widgets.length;g++)a.groups[b].widgets[g].panel=a.groups[b].panel}}},_addPoolDefaultPanelAndPosition:function(a){var b,g,e=a.widgetPool;if(e){b=e.panel&&e.panel.positionRelativeTo?e.panel.positionRelativeTo:"map";"undefined"===typeof e.panel||"undefined"===typeof e.panel.uri?e.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:b}}:"undefined"===typeof e.panel.position?e.panel.position={relativeTo:b}:"undefined"===typeof e.panel.position.relativeTo&&
(e.panel.position.relativeTo=b);if(e.groups)for(b=0;b<e.groups.length;b++){e.groups[b].panel?e.groups[b].panel.position.relativeTo||(e.groups[b].panel.position.relativeTo=e.groups[b].panel.positionRelativeTo?e.groups[b].panel.positionRelativeTo:"map"):e.groups[b].panel=e.panel;e.groups[b].widgets||(e.groups[b].widgets=[]);for(g=0;g<e.groups[b].widgets.length;g++)e.groups[b].widgets[g].panel=e.groups[b].panel}if(e.widgets)for(b=0;b<e.widgets.length;b++)!1===e.widgets[b].inPanel?(g=e.widgets[b].positionRelativeTo?
e.widgets[b].positionRelativeTo:"map",e.widgets[b].position?e.widgets[b].position.relativeTo||(e.widgets[b].position.relativeTo=g):e.widgets[b].position={relativeTo:g}):e.widgets[b].panel||(e.widgets[b].panel=a.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(b){a.visitElement(b,d.hitch(this,function(b,g){b.isOnScreen=g.isOnScreen;b.widgets?(b.gid=b.id,1===b.widgets.length?(b.label||(b.label=b.widgets[0].label?b.widgets[0].label:"Group"),b.icon||(b.icon=b.widgets[0].uri?this._getDefaultIconFromUri(b.widgets[0].uri):
"jimu.js/images/group_icon.png")):(b.icon=b.icon?b.icon:"jimu.js/images/group_icon.png",b.label=b.label?b.label:"Group_"+g.index)):(b.gid=g.groupId,b.uri&&a.processWidgetSetting(b))}))},_getDefaultIconFromUri:function(a){a=a.split("/");a.pop();return a.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(a){var b=0,g,e;if(a.widgetPool.widgets)for(g=0;g<a.widgetPool.widgets.length;g++)a.widgetPool.widgets[g].index=b,b++;if(a.widgetPool.groups)for(g=0;g<a.widgetPool.groups.length;g++){a.widgetPool.groups[g].index=
b;b++;for(e=0;e<a.widgetPool.groups[g].widgets.length;e++)a.widgetPool.groups[g].widgets[e].index=e}}});y.getInstance=function(a){null===g?g=new y(a):a&&(g.urlParams=a,g.configLoader&&(g.configLoader.urlParams=a));window.getAppConfig=d.hitch(g,g.getAppConfig);return g};return y})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/lang esri/arcgis/utils esri/dijit/PopupTemplate esri/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/webMercatorUtils esri/tasks/GeometryService esri/tasks/ProjectParameters esri/urlUtils esri/request esri/graphicsUtils jimu/portalUrlUtils ./shared/utils".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D,v,u,F,C,B,E,G,J,K,N){function O(a,b){a=a||"";for(var g=0,e=[{test:window.File&&window.FileReader&&window.FileList&&window.Blob||!A.file.isEnabledFlash(),failure:[a+"libs/polyfills/fileAPI/FileAPI.js"],callback:function(){g++;g===e.length&&b()}}],c=0;c<e.length;c++)testLoad(e[c])}function P(a,b){var g=a.match(/url\([^)]+\)/gi),e,c;if(null===g||""===b)return a;for(e=0;e<g.length;e++)if(c=g[e].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i),4<=c.length){var m=
c[2];b.endWith("/")||(b+="/");a=a.replace(c[1]+m+c[3],c[1]+b+m+c[3])}return a}function L(a,b){var g=Array.isArray(b),e=g&&[]||{};g?(a=a||[],e=e.concat(a),b.forEach(function(b,g){"undefined"===typeof a[g]?e[g]=b:"object"===typeof b?e[g]=L(a[g],b):-1===a.indexOf(b)&&e.push(b)})):(a&&"object"===typeof a&&Object.keys(a).forEach(function(b){e[b]=a[b]}),Object.keys(b).forEach(function(g){e[g]="object"!==typeof b[g]||!b[g]?b[g]:a[g]?L(a[g],b[g]):b[g]}));return e}function Q(a){var b,g={};b=a.indexOf("/");
a.substring(0,b);a=a.substring(0,a.lastIndexOf("/")+1);g.folderUrl=require(A.getRequireConfig()).toUrl(a);g.amdFolder=a;return g}function S(a){a.panels.forEach(function(a){a.uri="panels/"+a.name+"/Panel.js"});a.styles.forEach(function(a){a.uri="styles/"+a.name+"/style.css"});a.layouts.forEach(function(a){a.uri="layouts/"+a.name+"/config.json";a.icon="layouts/"+a.name+"/icon.png";a.RTLIcon="layouts/"+a.name+"/icon_rtl.png"})}function M(a,b,g){b=function(a){var b=[];a.split("_").forEach(function(a){var g=
!1,e;"--"===a.slice(a.length-2)&&(g=!0,a=a.slice(0,a.length-2));e=a.search(/\[[0-9]+\]/);-1===e&&(e=a.length);b.push({key:a.slice(0,e),index:Number(a.slice(e+1,-1)),deleteFlag:g})});return b}(b);for(var e=1;e<b.length-1;e++)if(a=n.isArray(a[b[e].key])?a[b[e].key][b[e].index]:a[b[e].key],!a)return;if(b[b.length-1].deleteFlag)!0===g&&(n.isArray(a[b[b.length-1].key])?delete a[b[b.length-1].key][b[b.length-1].index]:delete a[b[b.length-1].key]);else if(n.isArray(a[b[b.length-1].key])){if(void 0===g)return a[b[b.length-
1].key][b[b.length-1].index];a[b[b.length-1].key][b[b.length-1].index]=g}else{if(void 0===g)return a[b[b.length-1].key];a[b[b.length-1].key]=g}}function I(a,b,g){function e(g){g=A.template.getSearchRange(b,g,"]");var c=b.slice(g.firstPos,g.lastPos);return-1!==g.firstPos?(c=b.slice(g.firstPos+c.indexOf("[")+1,g.lastPos-1),g=b.slice(g.lastPos+1),(c=A.getConfigElementById(a,c))?{object:c,key:"section_"+g,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var c=a,m=b=b.replace(/\//g,"_"),k=
e("groups\\[.+\\]");if("deleted"!==k.state&&("isSection"===k.state&&(c=k.object,m=k.key),k=e("widgets\\[.+\\]"),"delete"!==k.state))return"isSection"===k.state&&(c=k.object,m=k.key),M(c,m,g)}var A={},X={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};n.mixin(A,N);window.atob||(window.atob=function(a){a=e.decode(a);for(var b="",g=0,c=a.length;g<c;g++)b+=String.fromCharCode(a[g]);return b});window.btob||(window.btob=function(a){for(var b=[],g=0,c=a.length;g<
c;g++)b.push(String.charCodeAt(a[g]));return e.encode(b)});var U="unload",Y=[];require.on("error",function(a){d.forEach(Y,function(b){a.info[0]&&-1<a.info[0].indexOf(b.resKey)&&b.def.reject(a);for(var g in a.info)-1<g.indexOf(b.resKey)&&b.def.reject(a)})});A.checkError=function(a,b){Y.push({resKey:a,def:b})};A.replacePlaceHolder=function(a,b){var g=s.stringify(a),e=g.match(/\$\{(\w)+\}/g),c;if(null===e)return a;for(c=0;c<e.length;c++){var m=e[c].match(/(\w)+/g)[0];b[m]&&(g=g.replace(e[c],b[m]))}return s.parse(g)};
A.changeUnit=function(a){var b=Math.abs(a),g;a=Math.floor(b);g=Math.floor(60*(b-a));b=(60*(60*(b-a)-g)).toFixed(2);return a+"\u00b0"+(10>g?"0"+g:g)+"'"+(10>b?"0"+b:b)+'"'};A.formatTime=function(a){var b=a/1E3;a=Math.floor(b/60);b=Number(b-60*a).toFixed(1);return(10>a?"0"+a:a)+":"+(10>b?"0"+b:b)};A.parseTime=function(a){var b=/(\d{2,})\:(\d{2})\.(\d{1})/;if(!b.test(a))return console.log("wrong time format."),-1;a=a.match(b);return 1E3*(60*parseInt(a[1],10)+parseInt(a[2],10)+parseInt(a[3],10)/10)};
A.preloadImg=function(a,b){var g=[],g="string"===typeof a?[a]:a;d.forEach(g,function(a){(new Image).src=b?b+a:a})};var Z=null;A.getImagesSize=function(a){var g=new k;if(!a||0!==a.indexOf("http"))return g.reject(),g;null===Z&&(Z=f.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var e=b(Z,"load",function(){clearTimeout(c);c=null;e.remove();var a=f.getContentBox(Z);1===a.w&&1===a.h||0===a.w||0===a.h?g.reject():g.resolve([a.w,a.h])},{}),c=
setTimeout(function(){clearTimeout(c);c=null;g.reject()},5E3);f.setAttr(Z,"src",a);return g};A.getPositionStyle=function(a){var b={};if(!a)return b;a=n.clone(a);if(window.isRTL){var g;"undefined"!==typeof a.left&&"undefined"!==typeof a.right?(g=a.left,a.left=a.right,a.right=g):"undefined"!==typeof a.left?(a.right=a.left,delete a.left):"undefined"!==typeof a.right&&(a.left=a.right,delete a.right);"undefined"!==typeof a.paddingLeft&&"undefined"!==typeof a.paddingRight?(g=a.paddingLeft,a.paddingLeft=
a.paddingRight,a.paddingRight=g):"undefined"!==typeof a.paddingLeft?(a.paddingRight=a.paddingLeft,delete a.paddingLeft):"undefined"!==typeof a.paddingRight&&(a.paddingLeft=a.paddingRight,delete a.paddingRight)}g="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom".split(" ");for(var e=0;e<g.length;e++){var c=g[e];"number"===typeof a[c]?b[c]=a[c]+"px":"undefined"!==typeof a[c]?b[c]=a[c]:"padding"===c.substr(0,7)?b[c]=0:b[c]="auto"}b.zIndex="undefined"===typeof a.zIndex?
"auto":a.zIndex;return b};A.isEqual=function(a,b){function g(a,b){var m;if(null===a&&null===b||"undefined"===typeof a&&"undefined"===typeof b)return!0;if(null===a&&null!==b||null===b&&null!==a||"undefined"===typeof a&&"undefined"!==typeof b||"undefined"===typeof b&&"undefined"!==typeof a)return!1;if(isNaN(a)&&isNaN(b)&&"number"===typeof a&&"number"===typeof b||a===b)return!0;if("function"===typeof a&&"function"===typeof b||a instanceof Date&&b instanceof Date||a instanceof RegExp&&b instanceof RegExp||
a instanceof String&&b instanceof String||a instanceof Number&&b instanceof Number)return a.toString()===b.toString();if(-1<e.indexOf(a)||-1<c.indexOf(b))return!1;if(null!==b){for(m in b)if(b.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof b[m]!==typeof a[m])return!1;for(m in a){if(b.hasOwnProperty(m)!==a.hasOwnProperty(m)||typeof b[m]!==typeof a[m])return!1;switch(typeof a[m]){case "object":case "function":e.push(a);c.push(b);if(!g(a[m],b[m]))return!1;e.pop();c.pop();break;default:if(isNaN(a[m])&&
isNaN(b[m])&&"number"===typeof a[m]&&"number"===typeof b[m])return!0;if(a[m]!==b[m])return!1}}}return!0}var e,c;e=[];c=[];return!g(a,b)?!1:!0};A.file={loadFileAPI:function(){var a=new k;if("unload"===U){var b=window.isBuilder?"stemapp/":"";window.FileAPI={debug:!1,flash:!0,staticPath:b+"libs/polyfills/fileAPI/",flashUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.swf",flashImageUrl:b+"libs/polyfills/fileAPI/FileAPI.flash.image.swf"};O(b,n.hitch(this,function(){U="loaded";a.resolve()}));U="loading"}else"loaded"===
U&&a.resolve();return a},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return h("safari")&&6>h("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var a=null;if(document.all)try{a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(b){a=null}else navigator.plugins&&0<navigator.plugins.length&&(a=navigator.plugins["Shockwave Flash"]);return!!a},containSeparator:function(a){return 0<=
a.indexOf("/")?!0:0<=a.indexOf("\\")?!0:!1},getNameFromPath:function(a){var b="",b=0<=a.indexOf("/")?"/":"\\";a=a.split(b);return 0<a.length?a[a.length-1]:null},getFolderFromPath:function(a){return a.substr(0,a.length-A.file.getNameFromPath(a).length)},readFile:function(a,b,g,e){if(this.supportHTML5()){var c=a.target.files[0];c&&(c.type.match(b)?c.size>=g?e({errCode:"exceed"}):(a=new FileReader,a.onload=function(a){e(null,c.name,a.target.result)},a.readAsDataURL(c)):e({errCode:"invalidType"}))}else if(this.supportFileAPI()){var m=
window.FileAPI.getFiles(a);m[0].type.match(b)?m[0].size>=g?e({errCode:"exceed"}):window.FileAPI.readAsDataURL(m[0],function(a){a&&a.result?e(null,m[0].name,a.result):e({errCode:"readError"})}):e({errCode:"invalidType"})}}};A.processWidgetSetting=function(a){if(!a.uri)return a;n.mixin(a,Q(a.uri));a.icon||(a.icon=a.amdFolder+"images/icon.png");a.thumbnail||(a.thumbnail=a.amdFolder+"images/thumbnail.png");return a};A.getRequireConfig=function(){if(jimuConfig){var a=[];jimuConfig.widgetsPackage&&(a=a.concat(jimuConfig.widgetsPackage));
jimuConfig.themesPackage&&(a=a.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(a=a.concat(jimuConfig.configsPackage));return{packages:a}}return{}};A.getTypeByGeometryType=function(a){var b="",g="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),e=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(a)?b="point":0<=g.indexOf(a)?
b="polyline":0<=e.indexOf(a)&&(b="polygon");return b};A.getSymbolTypeByGeometryType=function(a){var b=null;a=A.getTypeByGeometryType(a);"point"===a?b="marker":"polyline"===a?b="line":"polygon"===a&&(b="fill");return b};A.getServices=function(){return X};A.getArcGISDefaultGeometryService=function(){return new C(X.geometryService)};A.restoreToDefaultWebMapExtent=function(a,b,g){var e=new k;if(!(a&&"esri.Map"===a.declaredClass))return setTimeout(function(){e.reject("Invalid map.")},0),e;b=b&&b.itemInfo;
if(!b)return setTimeout(function(){e.reject("Invalid itemInfo")},0),e;b=b.item&&b.item.extent;if(!b)return setTimeout(function(){e.reject("Invalid itemInfo.item.extent")}),e;var c=new x({wkid:4326}),c=new z(b[0][0],b[0][1],b[1][0],b[1][1],c);if(4326===parseInt(a.spatialReference.wkid,10))return a.setExtent(c);if(a.spatialReference.isWebMercator())return c=F.geographicToWebMercator(c),a.setExtent(c);b=new B;b.geometries=[c];b.outSR=a.spatialReference;c=esriConfig&&esriConfig.defaults&&esriConfig.defaults.geometryService;
c&&"esri.tasks.GeometryService"===c.declaredClass||(g&&"string"===typeof g&&n.trim(g)?(g=n.trim(g),c=new C(g)):c=A.getArcGISDefaultGeometryService());c.project(b).then(function(b){if(b=b&&b[0])return a.setExtent(b);e.reject("Invalid projected geometry.");return e},function(a){console.error(a);e.reject(a);return e});return e};A.getAncestorWindow=function(){for(var a=window;a&&a.parent&&a!==a.parent;)a=a.parent;return a};A.getAncestorDom=function(a,b,g){if(a&&1===a.nodeType&&b&&"function"===typeof b){var e=
100,c=document.body;g&&("number"===typeof g?(g=parseInt(g,10),0<g&&(e=g)):1===g.nodeType&&(c=g));for(g=0;a.parentNode&&g<e&&f.isDescendant(a.parentNode,c);){if(b(a.parentNode))return a.parentNode;a=a.parentNode;g++}}return null};A.bindClickAndDblclickEvents=function(a,g,e,c){var m=null;if(a&&1===a.nodeType&&g&&"function"===typeof g&&e&&"function"===typeof e){var k=200;c&&"number"===typeof c&&(c=parseInt(c,10),0<c&&(k=c));var r=0,m=b(a,"click",function(a){r++;1===r?setTimeout(function(){1===r&&(r=
0,g(a))},k):2===r&&(r=0,e(a))})}return m};A.isScrollToBottom=function(a){var b=f.getContentBox(a);return 0===a.scrollHeight-(a.scrollTop+b.h)};A.getAllItemTypes=function(){var a=[],a=a.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service","Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application",
"Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return a=a.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer","Layer Package","Explorer Layer"]).concat(["Geoprocessing Package",
"Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};A.getItemQueryStringByTypes=function(a){var b="",g=A.getAllItemTypes();if(a&&0<a.length&&0<a.length){var e="";d.forEach(a,function(b,g){e+=' type:"'+b+'" ';g!==a.length-1&&(e+=" OR ")});b=" ( "+e+" ) ";g=a.concat(g);g=d.filter(g,function(b){return d.every(a,function(a){return 0>a.toLowerCase().indexOf(b.toLowerCase())})});
d.forEach(g,function(a){b+=' -type:"'+a+'" '})}return b};A.getItemQueryStringByTypeKeywords=function(a){var b="";a&&0<a.length&&(b=' typekeywords:"'+a.join(",")+'" ');return b};A.isNotEmptyString=function(a,b){var g=a&&"string"===typeof a;return g?b?g&&n.trim(a):!0:!1};A.isValidNumber=function(a){return"number"===typeof a&&!isNaN(a)};A.isObject=function(a){return a&&"object"===typeof a};A.createWebMap=function(a,b,g,e){a=K.getStandardPortalUrl(a);a=K.getBaseItemUrl(a);y.arcgisUrl=a;return y.createMap(b,
g,e)};A.getRandomString=function(){var a=Math.random().toString();return a=a.slice(2,a.length)};A._getDomainsByServerName=function(a){var b=a.split("."),g=b.length;return d.map(b,n.hitch(this,function(a,e){var c=b.slice(e,g),m="",k=c.length-1;d.forEach(c,n.hitch(this,function(a,b){m+=a;b!==k&&(m+=".")}));return m}))};A.removeCookie=function(a,b){var g=this._getDomainsByServerName(window.location.hostname);d.forEach(g,n.hitch(this,function(g){q(a,null,{expires:-1,path:b});q(a,null,{expires:-1,path:b,
domain:g});q(a,null,{expires:-1,path:b,domain:"."+g})}))};A.isLocaleChanged=function(a,b){return!a.startWith(b)};A.hashToObject=function(a){a=a.replace("#","");a=p.queryToObject(a);for(var b in a)if(a.hasOwnProperty(b))try{a[b]=s.parse(a[b])}catch(g){}return a};A.reCreateObject=function(a){function b(a){var e=[];a.forEach(function(a){Array.isArray(a)?e.push(b(a)):"object"===typeof a?e.push(g(a)):e.push(a)});return e}function g(a){var e={},c;for(c in a)a.hasOwnProperty(c)&&(null===a[c]?e[c]=null:Array.isArray(a[c])?
e[c]=b(a[c]):e[c]="object"===typeof a[c]?g(a[c]):a[c]);return e}return Array.isArray(a)?b(a):g(a)};A.setVerticalCenter=function(a){setTimeout(function(){var b=l(".jimu-vcenter-text",a),g,e;d.forEach(b,function(a){g=f.getContentBox(a).h;f.setStyle(a,{lineHeight:g+"px"})},this);b=l(".jimu-vcenter",a);d.forEach(b,function(a){g=f.getContentBox(a).h;e=f.getContentBox(l(a).parent()[0]).h;f.setStyle(a,{marginTop:(e-g)/2+"px"})},this)},10)};A.merge=L;A.loadStyleLink=function(a,g,e){var c=new k,m,r=require(A.getRequireConfig()).toUrl(g);
if(require.cache["url:"+r]){m=require.cache["url:"+r];var q=r.split("/").pop(),r=r.substr(0,r.length-q.length);m=P(m,r);a=e?f.create("style",{id:a,type:"text/css"},f.byId(e),"before"):f.create("style",{id:a,type:"text/css"},document.getElementsByTagName("head")[0]);a.styleSheet&&!a.sheet?a.styleSheet.cssText=m:a.appendChild(f.toDom(m));c.resolve("load");return c}m=e?f.create("link",{id:a,rel:"stylesheet",type:"text/css",href:r},f.byId(e),"before"):f.create("link",{id:a,rel:"stylesheet",type:"text/css",
href:r},document.getElementsByTagName("head")[0]);b(m,"load",function(){c.resolve("load")});var t=setInterval(function(){var a;if(d.some(document.styleSheets,function(b){if(b.href&&b.href.substr(b.href.indexOf(g),b.href.length)===g)return a=b,!0}))try{!c.isFulfilled()&&(a.cssRules&&a.cssRules.length||a.rules&&a.rules.length)&&c.resolve("load"),clearInterval(t)}catch(b){}},50);return c};A.changeLocation=function(a){window.history.pushState&&window.history.pushState({path:a},"",a)};A.urlToObject=function(a){var b=
null;-1===a.indexOf("#")?(b=E.urlToObject(a),b.hash=null):(a=a.split("#"),b=E.urlToObject(a[0]),b.hash=a[1]?-1<a[1].indexOf("\x3d")?p.queryToObject(a[1]):a[1]:null);return b};A.addManifestProperies=function(a){a.icon=a.url+"images/icon.png";"theme"===a.category?S(a):("undefined"!==typeof a["2D"]&&(a.support2D=a["2D"]),"undefined"!==typeof a["3D"]&&(a.support3D=a["3D"]),"undefined"===typeof a["2D"]&&"undefined"===typeof a["3D"]&&(a.support2D=!0),delete a["2D"],delete a["3D"],"undefined"===typeof a.properties&&
(a.properties={}),N.processWidgetProperties(a))};A.getUniqueValues=function(a,b){var g=new k,e=a.replace(/\/*$/g,"")+"/generateRenderer",c=s.stringify({type:"uniqueValueDef",uniqueValueFields:[b]});G({url:e,content:{classificationDef:c,f:"json"},handleAs:"json",callbackParamName:"callback"}).then(n.hitch(this,function(a){var b=[];(a=a&&a.uniqueValueInfos)&&0<a.length&&(b=d.map(a,n.hitch(this,function(a){return a.value})));g.resolve(b)}),n.hitch(this,function(a){g.reject(a)}));return g};A.combineRadioCheckBoxWithLabel=
function(a,b){var g=!1;if(a&&1===a.nodeType&&"input"===a.tagName.toLowerCase()){var e=a.getAttribute("type")||"",e=e.toLowerCase();if("radio"===e||"checkbox"===e)g=!0}e=!1;b&&(1===b.nodeType&&"label"===b.tagName.toLowerCase())&&(e=!0);g&&e&&(g=a.getAttribute("id"),g||(g="input_"+A.getRandomString(),a.setAttribute("id",g)),b.setAttribute("for",g),f.setStyle(b,"cursor","pointer"))};A.convertExtentToPolygon=function(a){var b=a.xmin,g=a.xmax,e=a.ymin,c=a.ymax;return new u({rings:[[[b,c],[g,c],[g,e],[b,
e],[b,c]]],spatialReference:a.toJson()})};A.combineGeometries=function(a){function b(a){var g={points:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){g.points=g.points.concat(a.points)});return new D(g)}function g(a){var b={paths:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){b.paths=b.paths.concat(a.paths)});return new v(b)}function e(a){var b={rings:[],spatialReference:a[0].spatialReference.toJson()};d.forEach(a,function(a){"polygon"===a.type?
b.rings=b.rings.concat(a.rings):"extent"===a.type&&(a=A.convertExtentToPolygon(a),b.rings=b.rings.concat(a.rings))});return new u(b)}var c=null;if(a&&0<a.length)if(1===a.length)c=a[0];else{for(var m=null,k=null,r=null,q=null,t=0;t<a.length;t++){m=a[t];switch(m.type){case "point":case "multipoint":q="point";break;case "polyline":q="polyline";break;case "polygon":case "extent":q="polygon";break;default:return null}if(0===t)r=q;else if(r!==q)return null;if(t!==a.length-1&&(k=a[t+1],!m.spatialReference.equals(k.spatialReference)))return null}"point"===
q?c=b(a):"polyline"===q?c=g(a):"polygon"===q&&(c=e(a))}return c};A.isFeaturelayerUrlSupportQuery=function(a,b){var g=!1,e=/\/featureserver\//gi.test(a),c=/\/mapserver\//gi.test(a);b=(b||"").toLowerCase();e?g=0<=b.indexOf("query"):c&&(g=0<=b.indexOf("data"));return g};A.isImageServiceSupportQuery=function(a){return 0<=(a||"").toLowerCase().indexOf("catalog")};A.isStringEndWith=function(a,b){return a.lastIndexOf(b)+b.length===a.length};A.processManifestLabel=function(a,b){var g=b.split("-")[0];a.label=
a.i18nLabels&&(a.i18nLabels[b]||a.i18nLabels[g]||a.i18nLabels.defaultLabel)||a.label||a.name;a.layouts&&d.forEach(a.layouts,function(g){var e="i18nLabels_layout_"+g.name;g.label=a[e]&&(a[e][b]||a[e].defaultLabel)||g.label||g.name});a.styles&&d.forEach(a.styles,function(g){var e="i18nLabels_style_"+g.name;g.label=a[e]&&(a[e][b]||a[e].defaultLabel)||g.label||g.name})};A.addManifest2WidgetJson=function(a,b){n.mixin(a,b.properties);a.name=b.name;a.label||(a.label=b.label);a.manifest=b};A.addI18NLabel=
function(a){var b=new k;if(a.i18nLabels)return b.resolve(a),b;a.i18nLabels={};if(a.properties&&!1===a.properties.hasLocale)return b.resolve(a),b;var g="widget"===a.category?"_widgetLabel":"_themeLabel";require(A.getRequireConfig(),["dojo/i18n!"+a.amdFolder+"nls/strings"],function(e){a.i18nLabels[dojoConfig.locale]=e[g];"theme"===a.category&&(a.layouts&&a.layouts.forEach(function(b){a["i18nLabels_layout_"+b.name]={};a["i18nLabels_layout_"+b.name][dojoConfig.locale]=e["_layout_"+b.name]}),a.styles&&
a.styles.forEach(function(b){a["i18nLabels_style_"+b.name]={};a["i18nLabels_style_"+b.name][dojoConfig.locale]=e["_style_"+b.name]}));b.resolve(a)});return b};A.localizeNumber=function(a,b){var g=(a.toString().split(".")[1]||"").length,e="",e=b&&isFinite(b.places)&&b.places,e=0<e||0<g?"#,###,###,##0.0"+Array.prototype.join.call({length:0<e?e+1:g},"0"):"#,###,###,##0",g={locale:c.locale,pattern:e};n.mixin(g,b||{});try{return r.format(a,g)}catch(m){return console.error(m),a.toLocaleString()}};A.parseNumber=
function(a,b){var g={locale:c.locale};n.mixin(g,b||{});try{return r.parse(a,g)}catch(e){return console.error(e),a}};A.localizeDate=function(a,b){var g={locale:c.locale,fullYear:!0};n.mixin(g,b||{});try{return m.format(a,g)}catch(e){return console.error(e),"date"===g.selector?a.toLocaleDateString():"time"===g.selector?a.toLocaleTimeString():a.toLocaleString()}};A.localizeNumberByFieldInfo=function(a,b){var g=null,g=n.exists("format.places",b)&&b.format.places,g=A.localizeNumber(a,{places:g});return n.exists("format.digitSeparator",
b)&&!b.format.digitSeparator?g.toString().replace(RegExp("\\"+t.group,"g"),""):g};A.localizeDateByFieldInfo=function(a,b){var e=null;try{var c={date:a instanceof Date?a.getTime():a},m=n.exists("format.dateFormat",b)?b.format.dateFormat:"longMonthDayYear",e=g.substitute(c,"${date}",{dateFormat:{properties:["date"],formatter:"DateFormat"+w.prototype._dateFormats[m]}})}catch(k){console.error(k),e=a}return e};A.fieldFormatter={getFormattedUrl:function(a){if(a&&"string"===typeof a){var b=a.indexOf("http:");
-1===b&&(b=a.indexOf("https:"));if(-1<b&&-1===a.indexOf("href\x3d")){var g=a.indexOf(" ",b);-1===g&&(g=a.length);var e=a.substring(b,g);a=a.substring(0,b)+'\x3cA href\x3d"'+e+'" target\x3d"_blank"\x3e'+e+"\x3c/A\x3e"+a.substring(g,a.length)}}return a||""},getFormattedNumber:function(a,b){if("number"===typeof a){var g=(a.toString().split(".")[1]||"").length;a=A.localizeNumberByFieldInfo(a,{format:{places:b&&"number"===typeof b.places?parseInt(b.places,10):g,digitSeparator:b&&b.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+
(a||"")+"\x3c/span\x3e"}return a},getFormattedDate:function(a,b){if("number"===typeof a||a instanceof Date)a=A.localizeDateByFieldInfo(a,{format:b});return a||""},getCodedValue:function(a,b){if(a&&a.codedValues){for(var e=0,c=a.codedValues.length;e<c;e++){var m=a.codedValues[e];if(g.isDefined(b)&&n.exists("code",m)&&b.toString()===m.code.toString())return m.name}return b}return b||null},getTypeName:function(a,b){for(var g=b.length,e=0;e<g;e++)if(a===b[e].id)return b[e].name;return a}};A.addRelativePathInCss=
P;A.url={isAbsolute:function(a){return!a?!1:a.startWith("http")||a.startWith("/")},removeQueryParamFromUrl:function(a,b){var g=E.urlToObject(a);g.query&&delete g.query[b];var e=g.path,c;for(c in g.query)e=e===g.path?e+"?"+c+"\x3d"+g.query[c]:e+"\x26"+c+"\x3d"+g.query[c];return e},addQueryParamToUrl:function(a,b,g){a=E.urlToObject(a);a.query||(a.query={});a.query[b]=g;b=a.path;for(var e in a.query)b=b===a.path?b+"?"+e+"\x3d"+a.query[e]:b+"\x26"+e+"\x3d"+a.query[e];return b}};A.processUrlInWidgetConfig=
function(a,b){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:a.startWith("${appPath}")?a.replace("${appPath}",window.appInfo.appPath):b+a};A.processUrlInAppConfig=function(a){if(a)return a.startWith("data:")||a.startWith("http")||a.startWith("/")?a:window.appInfo.appPath+a};A.getLocationUrlWithoutHashAndQueryParams=function(){var a=window.location,b=a.protocol+"//"+a.host+a.pathname,a=E.urlToObject(a.href);a.query&&a.query.apiurl&&(b=A.url.addQueryParamToUrl(b,"apiurl",
a.query.apiurl));return b};A.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};A.invertColor=function(a){a=a.substring(1);3===a.length&&(a=a.slice(0,1)+a.slice(0,1)+a.slice(1,1)+a.slice(1,1)+a.slice(2,1)+a.slice(2,1));a=parseInt(a,16);return 7829367<a?"#000000":"#ffffff"};A.mixinAppConfigPosition=function(a,b){var g=n.clone(a);if(!b)return g;b=n.clone(b);var e=g.widgetOnScreen,c=b.widgetOnScreen;c&&c.widgets&&("[object Object]"===Object.prototype.toString.call(c.widgets)?
d.forEach(e.widgets,function(a,b){var g;g=a.uri?a.uri:"ph_"+b;c.widgets[g]&&c.widgets[g].position&&(c.widgets[g].position.relativeTo||(c.widgets[g].position.relativeTo="map"),a.position=c.widgets[g].position)},this):d.forEach(c.widgets,function(a,b){a.position&&!a.position.relativeTo&&(a.position.relativeTo="map");e.widgets[b]&&a.position&&(e.widgets[b].position=a.position)}));c&&c.groups&&("[object Object]"===Object.prototype.toString.call(c.groups)?d.forEach(e.groups,function(a,b){var g;g=a.label?
a.label:"g_"+b;c.groups[g]&&(c.groups[g].panel&&c.groups[g].panel.position)&&(c.groups[g].panel.position.relativeTo||(c.groups[g].panel.position.relativeTo="map"),a.panel.position=c.groups[g].panel.position)},this):d.forEach(c.groups,function(a,b){a.panel&&(a.panel.position&&!a.panel.position.relativeTo)&&(a.panel.position.relativeTo="map");e.groups[b]&&a.panel.position&&(e.groups[b].panel.position=a.panel.position)}));b.map&&b.map.position&&(g.map?g.map.position=b.map.position:g.map={position:b.map.position});
b.widgetPool&&b.widgetPool.panel&&(b.widgetPool.panel.position&&!b.widgetPool.panel.position.relativeTo&&(b.widgetPool.panel.position.relativeTo="map"),g.widgetPool.panel.position=b.widgetPool.panel.position);b.mobileLayout&&(g.mobileLayout=b.mobileLayout);return g};A.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(a,b,g){var e=-1;b=a.search(RegExp(b));0<=b&&(a=a.slice(b,a.length),a=a.indexOf(g),e=b+a+g.length);return{firstPos:b,lastPos:e}},
setConfigValue:function(a,b,g){M(a,b,g)},getConfigValue:function(a,b){return M(a,b)},setConfigValueWithId:function(a,b,g){I(a,b,g)},getConfigValueWithId:function(a,b){return I(a,b)},getKeyInfo:function(a){var b=this.getWidgetIdByKey(a);if(null!==b)return{type:"widget",id:b};a=this.getGroupIdByKey(a);return null!==a?{type:"group",id:a}:{type:"unknow",id:null}},getWidgetIdByKey:function(a){var b=A.template.getSearchRange(a,A.template.widgetIdentification,"]");if(-1===b.firstPos)a=null;else{var g=a.slice(b.firstPos,
b.lastPos);a=a.slice(b.firstPos+g.indexOf("[")+1,b.lastPos-1)}return a},getGroupIdByKey:function(a){var b=A.template.getSearchRange(a,A.template.groupIdentification,"]");if(-1===b.firstPos)a=null;else{var g=a.slice(b.firstPos,b.lastPos);a=a.slice(b.firstPos+g.indexOf("[")+1,b.lastPos-1)}return a},getConfigedWidgetsByTemplateConfig:function(a){var b=[],g=A.template.widgetIdentification+"_config",e;d.forEach(a.configurationSettings,function(a){d.forEach(a.fields,function(a){a.fieldName&&(e=A.template.getSearchRange(a.fieldName,
g,"]"),0<=e.firstPos&&(a=A.template.getWidgetIdByKey(a.fieldName),-1===b.indexOf(a)&&b.push(a)))},this)},this);return b},mergeTemplateAppConfigToAppConfig:function(a,b,g){function e(a){var b=[];d.forEach(a,function(a){a&&b.push(a)},this);return b}var c=a.widgetOnScreen,m=a.portalUrl;b.values.webmap&&(a.map.itemId=b.values.webmap);g&&(a.map.mapOptions&&A.deleteMapOptions(a.map.mapOptions),a.map.portalUrl=m,b.values.app_title||(b.values.app_title=g.title),b.values.app_subtitle||(b.values.app_subtitle=
g.snippet));for(var k in b.values)"webmap"!==k&&A.template.setConfigValueWithId(a,k,b.values[k]);a.widgetPool.widgets=e(a.widgetPool.widgets);c.widgets=e(c.widgets);if(a.widgetPool.groups)for(b=0;b<a.widgetPool.groups.length;b++)a.widgetPool.groups[b].widgets=e(a.widgetPool.groups[b].widgets);if(c.groups)for(b=0;b<c.groups.length;b++)c.groups[b].widgets=e(c.groups[b].widgets);return a}};A.deleteMapOptions=function(a){a&&(delete a.extent,delete a.lods,delete a.center,delete a.scale,delete a.zoom,delete a.maxScale,
delete a.maxZoom,delete a.minScale,delete a.minZoom)};A.graphicsExtent=function(a,b){var g=null;try{0<a.length&&(g=J.graphicsExtent(a))&&"number"===typeof b&&0<b&&(g=g.expand(b))}catch(e){console.error(e)}return g};A.sanitizeHTML=function(a){return html_sanitize(a,function(a){return a},function(a){return a})};A.stripHTML=function(a){return!a?a:-1<a.indexOf("\x3c")&&-1<a.indexOf("\x3e")?a.replace(/<(?:.|\s)*?>/g,""):a};A.removeSuffixSlashes=function(a){return a.replace(/\/*$/g,"")};A.getBestDisplayAttributes=
function(a,b){var g={},e=null,c;for(c in a)e=A.getBestDisplayValue(c,a,b),g[c]=e;return g};A.getBestDisplayValue=function(a,b,g){var e="",c=null;n.isArrayLike(g)?c=A.getFieldInfoByFieldName(g,a):"object"===typeof g&&g.name===a&&(c=g);c&&(e=b[a],"esriFieldTypeDate"===c.type?e&&(a=new Date(parseInt(e,10)),e=A._tryLocaleDate(a)):"number"===typeof e&&(c.domain&&"codedValue"===c.domain.type?d.some(c.domain.codedValues,function(a){if(a.code===e)return e=a.name,!0}):e=A._tryLocaleNumber(e)));if(null===e||
void 0===e)e="";return e};A._tryLocaleNumber=function(a){var b=A.localizeNumber(a);if(null===b||void 0===b)b=a;return b};A._tryLocaleDate=function(a){var b=A.localizeDate(a);b||(b=a.toLocaleDateString());return b};A.getFieldInfoByFieldName=function(a,b){var g=null;a&&0<a.length&&d.some(a,n.hitch(this,function(a){return a.name===b?(g=a,!0):!1}));return g};A.containsNonLatinCharacter=function(a){for(var b=0;b<a.length;b++)if(255<a.charCodeAt(b))return!0;return!1};A.has=function(a){var b=h(a);if(b)return b;
if("ie"===a.toLowerCase()){a=0;var g=/MSIE (\d+\.\d+);/.test(navigator.userAgent),e=!!navigator.userAgent.match(/Trident\/7.0/),c=navigator.userAgent.indexOf("rv:11.0");g&&(a=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(a=10);e&&-1!==c&&(a=11);return 11===a&&11||b}if("edge"===a.toLowerCase())return navigator.userAgent.split("Edge/")[1]||b};return A})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(n,d,f){var h=n.NodeList;d.extend(h,
{_buildArrayFromCallback:function(c){for(var d=[],l=0;l<this.length;l++){var a=c.call(this[l],this[l],d);a&&(d=d.concat(a))}return d},_getUniqueAsNodeList:function(c){for(var d=[],l=0,a;a=c[l];l++)1==a.nodeType&&-1==f.indexOf(d,a)&&d.push(a);return this._wrap(d,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(c,d){var l=this._getUniqueAsNodeList(c),l=d?n._filterResult(l,d):l;return l._stash(this)},_getRelatedUniqueNodes:function(c,d){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(d),
c)},children:function(c){return this._getRelatedUniqueNodes(c,function(c,l){return d._toArray(c.childNodes)})},closest:function(c,d){return this._getRelatedUniqueNodes(null,function(l,a){do if(n._filterResult([l],c,d).length)return l;while(l!=d&&(l=l.parentNode)&&1==l.nodeType);return null})},parent:function(c){return this._getRelatedUniqueNodes(c,function(c,d){return c.parentNode})},parents:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(var a=[];c.parentNode;)c=c.parentNode,a.push(c);
return a})},siblings:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(var a=[],k=c.parentNode&&c.parentNode.childNodes,b=0;b<k.length;b++)k[b]!=c&&a.push(k[b]);return a})},next:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(var a=c.nextSibling;a&&1!=a.nodeType;)a=a.nextSibling;return a})},nextAll:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(var a=[],k=c;k=k.nextSibling;)1==k.nodeType&&a.push(k);return a})},prev:function(c){return this._getRelatedUniqueNodes(c,
function(c,d){for(var a=c.previousSibling;a&&1!=a.nodeType;)a=a.previousSibling;return a})},prevAll:function(c){return this._getRelatedUniqueNodes(c,function(c,d){for(var a=[],k=c;k=k.previousSibling;)1==k.nodeType&&a.push(k);return a})},andSelf:function(){return this.concat(this._parent)},first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(c,d){return 0!=d%2})},odd:function(){return this.filter(function(c,
d){return 0==d%2})}});return h})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],function(n){n=n.getObject("dojox.encoding.base64",!0);n.encode=function(d){for(var f=[],h=d.length,c=h%3,h=h-c,p=0;p<h;){var l=d[p++]<<16|d[p++]<<8|d[p++];f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>
6&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l&63))}switch(c){case 2:l=d[p++]<<16|d[p++]<<8;f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>18&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63));f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>6&63));f.push("\x3d");break;case 1:l=d[p++]<<16,f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>
18&63)),f.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(l>>>12&63)),f.push("\x3d"),f.push("\x3d")}return f.join("")};n.decode=function(d){d=d.split("");for(var f=[],h=d.length;"\x3d"==d[--h];);for(var c=0;c<h;){var p="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<18;c<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<12);c<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++])<<
6);c<=h&&(p|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(d[c++]));f.push(p>>>16&255);f.push(p>>>8&255);f.push(p&255)}for(;0==f[f.length-1];)f.pop();return f};return n})},"esri/tasks/ProjectParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,d,f,h,c,p,l,a){return n(null,{declaredClass:"esri.tasks.ProjectParameters",geometries:null,outSR:null,transformation:null,
transformForward:null,toJson:function(){var c=f.map(this.geometries,function(a){return a.toJson()}),b={};b.outSR=this.outSR.wkid||h.toJson(this.outSR.toJson());b.inSR=this.geometries[0].spatialReference.wkid||h.toJson(this.geometries[0].spatialReference.toJson());b.geometries=h.toJson({geometryType:a.getJsonType(this.geometries[0]),geometries:c});this.transformation&&(b.transformation=this.transformation.wkid||h.toJson(this.transformation));l.isDefined(this.transformForward)&&(b.transformForward=
this.transformForward);return b}})})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(n,d){var f=n.clone(d);f.declaredClass="jimu.portalUrlUtils";f.getPortalUrlFromLocation=function(){return f.getPortalServerFromLocation()+f.getDeployContextFromLocation()};f.getPortalSignInUrlFromLocation=function(){return f.getPortalUrlFromLocation()+"home/signin.html"};f.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};
f.getDeployContextFromLocation=function(){var d=window.location.href.split("?")[0],c=d.indexOf("/home");0>c&&(c=d.indexOf("/apps"));d=d.substring(d.indexOf(window.location.host)+window.location.host.length+1,c);"/"!==d&&(d="/"+d+"/");return d};f.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+f.getDeployContextFromLocation()+"sharing/rest/"};return f})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var n={declaredClass:"jimu.shared.basePortalUrlUtils"};
"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(d){return this.substr(0,d.length)===d});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(d){return this.substr(this.length-d.length,d.length)===d});n.getServerByUrl=function(d){d=(d||"").trim();d=d.replace(/^(http(s?):?)\/\//gi,"");0===d.indexOf("//")&&
(d=d.slice(2));return d.split("/")[0]};n.getServerWithProtocol=function(d){var f="";if(d=(d||"").trim()){var h=n.getServerByUrl(d);if(!h)return f;var c=n.getProtocol(d);c?f=c+"://"+h:0===d.indexOf("//")&&(f="//"+h)}return f};n.isSameServer=function(d,f){d=n.getServerByUrl(d)||"";f=n.getServerByUrl(f)||"";return d.toLowerCase()===f.toLowerCase()};n.getDomain=function(d){var f="";if(d=n.getServerByUrl(d))d=d.replace(/:\d+$/,""),d=d.match(/[^.]\w+\.\w+$/),null!==d&&(f=d[0],/^\d+\.\d+$/.test(f)&&(f=""));
return f};n.isSameDomain=function(d,f){var h=n.getDomain(d),c=n.getDomain(f);return""!==h&&h===c};n.isOnline=function(d){return 0<=n.getServerByUrl(d).toLowerCase().indexOf(".arcgis.com")};n.isArcGIScom=function(d){d=n.getServerByUrl(d).toLowerCase();return"www.arcgis.com"===d||"arcgis.com"===d};n.getStandardPortalUrl=function(d){var f=n.getServerByUrl(d);if(""===f)return"";n.isOnline(f)?(n.isArcGIScom(f)&&(f="www.arcgis.com"),d=n.addProtocol(d),d=n.getProtocol(d)+"://"+f):(d=(d||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),d=n.addProtocol(d),d.replace(RegExp("http(s?)://"+f,"g"),"")||(d+="/arcgis"));return d};n.isSamePortalUrl=function(d,f){var h=/^http(s?):\/\//gi,c=/^\/\//gi;d=n.getStandardPortalUrl(d).toLowerCase().replace(h,"").replace(c,"");f=n.getStandardPortalUrl(f).toLowerCase().replace(h,"").replace(c,"");return d===f};n.addProtocol=function(d){if(-1>=d.toLowerCase().indexOf("http://")&&-1>=d.toLowerCase().indexOf("https://")){var f="";"undefined"!==typeof window&&window.location?(f=
window.location.protocol,d=d.startWith("//")?f+d:d.startWith("/")?f+"//"+window.location.host+d:f+"//"+d):(f="http:",d.startWith("//")&&(d=f+d))}return d};n.getProtocol=function(d){var f="";d=d.toLowerCase();0===d.indexOf("https://")?f="https":0===d.indexOf("http://")&&(f="http");return f};n.updateUrlProtocolByOtherUrl=function(d,f){f=f.toLowerCase();0===f.indexOf("https://")?d=n.setHttpsProtocol(d):0===f.indexOf("http://")&&(d=n.setHttpProtocol(d));return d};n.removeProtocol=function(d){return d.replace(/^http(s?):\/\//i,
"//")};n.setHttpProtocol=function(d){d=n.addProtocol(d);return d.replace(/^https:\/\//,"http://")};n.setHttpsProtocol=function(d){d=n.addProtocol(d);return d.replace(/^http:\/\//,"https://")};n.setProtocol=function(d,f){return 0<=f.indexOf("https")?n.setHttpsProtocol(d):0<=f.indexOf("http")?n.setHttpProtocol(d):d};n.getSharingUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing");return f};n.getOAuth2Url=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/rest/sharing/oauth2");
return f};n.getAppIdUrl=function(d,f){var h="",c=n.getStandardPortalUrl(d);c&&(h=c+"/sharing/rest/oauth2/apps/"+f);return h};n.getSignInUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/signin.html");return f};n.getBaseSearchUrl=function(d){var f="";d=n.getStandardPortalUrl(d);(d=d.replace(/\/*$/g,""))&&(f=d+"/sharing/rest/search");return f};n.getBaseItemUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing/rest/content/items");return f};n.getItemUrl=function(d,
f){var h="",c=n.getBaseItemUrl(d);c&&f&&(h=c+"/"+f);return h};n.getItemDataUrl=function(d,f){var h="",c=n.getItemUrl(d,f);c&&(h=c+"/data");return h};n.getGenerateTokenUrl=function(d){var f="";d&&(d=n.getStandardPortalUrl(d),f=d+"/sharing/rest/generateToken");return f};n.getItemDetailsPageUrl=function(d,f){var h="";d&&f&&(d=n.getStandardPortalUrl(d),h=d+"/home/item.html?id\x3d"+f);return h};n.getUserProfilePageUrl=function(d,f){var h="";d&&f&&(d=n.getStandardPortalUrl(d),h=d+"/home/user.html?user\x3d"+
f);return h};n.getBaseGroupUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing/rest/community/groups");return f};n.getPortalSelfInfoUrl=function(d){var f="";(d=n.getStandardPortalUrl(d||""))&&(f=d+"/sharing/rest/portals/self");return f};n.getCommunitySelfUrl=function(d){var f="";(d=n.getStandardPortalUrl(d||""))&&(f=d+"/sharing/rest/community/self");return f};n.getBaseUserUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing/rest/community/users");return f};n.getUserUrl=
function(d,f){var h="",c=n.getBaseUserUrl(d);d&&f&&(h=c+"/"+f);return h};n.getUserTagsUrl=function(d,f){var h="",c=n.getUserUrl(d,f);d&&f&&(h=c+"/tags");return h};n.getUserThumbnailUrl=function(d,f,h){var c="";(d=n.getUserUrl(d,f))&&h&&(c=d+"/info/"+h);return c};n.getContentUrl=function(d){var f="";d&&(d=n.getStandardPortalUrl(d),f=d+"/sharing/rest/content");return f};n.getUserContentUrl=function(d,f,h){var c="",c="";d&&f&&(c=n.getContentUrl(d),c=h?c+"/users/"+f+"/"+h:c+"/users/"+f);return c};n.getAddItemUrl=
function(d,f,h){var c="",c="";d&&f&&(c=n.getUserContentUrl(d,f,h),c+="/addItem");return c};n.getDeleteItemUrl=function(d,f,h){var c="";(d=n.getUserItemsUrl(d,f))&&(c=d+"/"+h+"/delete");return c};n.getUserItemsUrl=function(d,f,h){var c="",c="";d&&f&&(c=n.getUserContentUrl(d,f,h),c+="/items");return c};n.getUpdateItemUrl=function(d,f,h,c){var p="",p="";d&&f&&(p=n.getUserItemsUrl(d,f,c),p=p+"/"+h+"/update");return p};n.shareItemUrl=function(d,f,h,c){var p="",p="";d&&f&&(p=n.getUserItemsUrl(d,f,c),p=
p+"/"+h+"/share");return p};n.getHomeIndexUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/index.html");return f};n.getHomeMapViewerUrl=function(d,f){var h="",c=n.getStandardPortalUrl(d);c&&(h=c+"/home/webmap/viewer.html",h=f?h+("?webmap\x3d"+f):h+"?useExisting\x3d1");return h};n.getHomeSceneViewerUrl=function(d,f){var h="",c=n.getStandardPortalUrl(d);c&&(h=c+"/home/webscene/viewer.html",f&&(h+="?webscene\x3d"+f));return h};n.getHomeGalleryUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&
(f=d+"/home/gallery.html");return f};n.getHomeGroupsUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/groups.html");return f};n.getHomeMyContentUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/content.html");return f};n.getHomeMyOrganizationUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/organization.html");return f};n.getHomeUserUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/home/user.html");return f};n.getPortalHelpUrl=function(d,
f){var h="",c=n.getStandardPortalUrl(d);c&&(h=c+"/portalhelp/"+(f||"en")+"/website/help/");return h};n.getPortalAdminHelpUrl=function(d,f){var h="",c=n.getStandardPortalUrl(d);c&&(h=c+"/portalhelp/"+(f||"en")+"/admin/help/");return h};n.getPortalProxyUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing/proxy");return f};n.getOAuth2SignOutUrl=function(d){var f="";(d=n.getStandardPortalUrl(d))&&(f=d+"/sharing/rest/oauth2/signout");return f};n.getNewPrintUrl=function(d){var f="";if(d=
n.getStandardPortalUrl(d))d=n.setHttpProtocol(d),f=d+"/sharing/tools/newPrint";return f};return n})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(n){function d(c,d){function l(a,k){var b,d,q,r,m="widgetOnScreen"===a;if(c[a]){if(c[a].groups)for(b=0;b<c[a].groups.length;b++)if(q=c[a].groups[b],k(q,{index:b,isWidget:!1,groupId:q.id,isThemeWidget:!1,isOnScreen:m}),c[a].groups[b].widgets)for(d=0;d<c[a].groups[b].widgets.length;d++)r=c[a].groups[b].widgets[d],k(r,{index:d,isWidget:!0,
groupId:q.id,isThemeWidget:r.uri&&-1<r.uri.indexOf("themes/"+c.theme.name),isOnScreen:m});if(c[a].widgets)for(b=0;b<c[a].widgets.length;b++)r=c[a].widgets[b],k(c[a].widgets[b],{index:b,isWidget:!0,groupId:a,isThemeWidget:r.uri&&-1<r.uri.indexOf("themes/"+c.theme.name),isOnScreen:m})}}l("widgetOnScreen",d);l("widgetPool",d)}var f={},h="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwithched isController hasVersionManager isThemeWidget supportMultiInstance".split(" ");
f.visitElement=d;f.getConfigElementById=function(c,p){var l;if("map"===p)return c.map;d(c,function(a){if(a.id===p)return l=a,!0});return l};f.getConfigElementByLabel=function(c,p){var l;if("map"===p)return c.map;d(c,function(a){if(a.label||a.name===p)return l=a,!0});return l};f.getConfigElementsByName=function(c,p){var l=[];if("map"===p)return[c.map];d(c,function(a){a.name===p&&l.push(a)});return l};f.getWidgetNameFromUri=function(c){c=c.split("/");c.pop();return c.pop()};f.getAmdFolderFromUri=function(c){c=
c.split("/");c.pop();return c.join("/")+"/"};f.widgetProperties=h;f.processWidgetProperties=function(c){"undefined"===typeof c.properties.isController&&(c.properties.isController=!1);"undefined"===typeof c.properties.isThemeWidget&&(c.properties.isThemeWidget=!1);"undefined"===typeof c.properties.hasVersionManager&&(c.properties.hasVersionManager=!1);h.forEach(function(d){"undefined"===typeof c.properties[d]&&(c.properties[d]=!0)})};f.getControllerWidgets=function(c){var d=[];c.visitElement(function(c){c.isController&&
d.push(c)});return d};f.isHostedService=function(c){var d=n.getServerByUrl(c)+"/[^/]+/[^/]+/rest/services";return RegExp(d,"gi").test(c)};return f})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e){var g=null,y=n(l,{constructor:function(){this.loaded=
[];this.missedActions=[];this.activeWidget=null;window.isBuilder?(p.subscribe("app/mapLoaded",d.hitch(this,this._onMapLoaded)),p.subscribe("app/mapChanged",d.hitch(this,this._onMapChanged))):(p.subscribe("mapLoaded",d.hitch(this,this._onMapLoaded)),p.subscribe("mapChanged",d.hitch(this,this._onMapChanged)));window.isBuilder?(p.subscribe("app/sceneViewLoaded",d.hitch(this,this._onSceneViewLoaded)),p.subscribe("app/sceneViewChanged",d.hitch(this,this._onSceneViewChanged))):(p.subscribe("sceneViewLoaded",
d.hitch(this,this._onSceneViewLoaded)),p.subscribe("sceneViewChanged",d.hitch(this,this._onSceneViewChanged)));window.isBuilder?(p.subscribe("app/appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),p.subscribe("app/appConfigChanged",d.hitch(this,this._onAppConfigChanged))):(p.subscribe("appConfigLoaded",d.hitch(this,this._onAppConfigLoaded)),p.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)));p.subscribe("userSignIn",d.hitch(this,this._onUserSignIn));p.subscribe("userSignOut",
d.hitch(this,this._onUserSignOut));p.subscribe("builder/actionTriggered",d.hitch(this,this._onActionTriggered));p.subscribe("/dnd/move/start",d.hitch(this,this._onMoveStart))},loadWidget:function(a){var b=new c,g;a=d.clone(a);a.folderUrl||m.processWidgetSetting(a);(g=this.getWidgetById(a.id))?b.resolve(g):r([this.loadWidgetClass(a),this.loadWidgetManifest(a)]).then(d.hitch(this,function(a){var g=a[0],c=a[1];this.loadWidgetResources(c).then(d.hitch(this,function(a){try{var m=this.createWidget(c,g,
a);h.setAttr(m.domNode,"data-widget-name",c.name);console.log("widget ["+c.uri+"] created.")}catch(k){console.log("create ["+c.uri+"] error:"+k.stack),new e({message:"create widget error: "+c.uri}),b.reject(k)}setTimeout(d.hitch(this,function(){b.resolve(m);this.emit("widget-created",m);p.publish("widgetCreated",m)}),50)}),function(a){b.reject(a)})}),function(a){b.reject(a)});return b},loadWidgetClass:function(a){var b=new c;require(m.getRequireConfig(),[a.uri],d.hitch(this,function(a){b.resolve(a)}));
m.checkError(a.uri,b);return b},loadWidgetResources:function(a){var b=new c,g,e,m,k=[];m=d.clone(a);a=this.tryLoadWidgetConfig(m);g=this._tryLoadResource(m,"i18n");e=this._tryLoadResource(m,"style");m=this._tryLoadResource(m,"template");k.push(a);k.push(g);k.push(m);k.push(e);r(k).then(d.hitch(this,function(a){var g={};g.config=a[0];g.i18n=a[1];g.template=a[2];g.style=a[3];b.resolve(g)}),function(a){b.reject(a)});return b},loadWidgetManifest:function(a){var b=new c,g=a.folderUrl+"manifest.json";if(a.manifest)return b.resolve(a),
b;q(g,{handleAs:"json"}).then(d.hitch(this,function(g){g.amdFolder=a.amdFolder;g.category="widget";a.label?(this._processManifest(g),m.addManifest2WidgetJson(a,g),b.resolve(a)):m.addI18NLabel(g).then(d.hitch(this,function(){this._processManifest(g);m.addManifest2WidgetJson(a,g);b.resolve(a)}))}),function(a){b.reject(a)});return b},getWidgetMarginBox:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return{};if(a._marginBox)return a._marginBox;a.setPosition({left:-9999,top:-9999,relativeTo:a.position.relativeTo});
this.openWidget(a);a._marginBox=a.getMarginBox();this.closeWidget(a);return a._marginBox},_processManifest:function(a){m.addManifestProperies(a);m.processManifestLabel(a,window.dojoConfig.locale)},createWidget:function(b,g,e){if(this.getWidgetById(b.id))return this.getWidgetById(b.id);e.config&&e.i18n&&(e.config=m.replacePlaceHolder(e.config,e.i18n));b.rawConfig=b.config;b.config=e.config||{};this.appConfig._appData&&this._mergeAgolConfig(b);b.nls=e.i18n||{};e.template&&(b.templateString=e.template);
b["class"]="jimu-widget";b.label||(b.label=b.name);this.map&&(b.map=this.map);b.appConfig=this.appConfig;e={};for(var c in b)b.hasOwnProperty(c)&&(e[c]=b[c]);e.widgetManager=this;b=new g(e);b.clazz=g;k.after(b,"startup",d.hitch(this,this._postWidgetStartup,b));k.before(b,"destroy",d.hitch(this,this._onDestroyWidget,b));a(b.domNode,"click",d.hitch(this,this._onClickWidget,b));this.loaded.push(b);return b},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var a=f.map(this.loaded,
function(a){return a.id});f.forEach(a,function(a){this.destroyWidget(a)},this);this.loaded=[]},loadWidgetSettingPage:function(a){var b=new c;a=d.clone(a);a.id+="_setting";r([this.loadWidgetSettingClass(a)]).then(d.hitch(this,function(g){var c=g[0];this.loadWidgetSettingPageResources(a).then(d.hitch(this,function(g){var m;g={nls:g.i18n,templateString:g.template,appConfig:this.appConfig,"class":"jimu-widget-setting"};"HTML3D"===window.appInfo.appType?g.sceneView=this.sceneView:g.map=this.map;for(var r in a)a.hasOwnProperty(r)&&
(g[r]=a[r]);try{m=new c(g),h.setAttr(m.domNode,"data-widget-name-setting",g.name),k.before(m,"destroy",d.hitch(this,this._onDestroyWidgetSetting,m)),b.resolve(m)}catch(q){new e({message:"Create widget setting page error:"+a.uri}),b.reject(q)}}),function(a){console.log(a)})}),function(a){b.reject(a)});return b},loadWidgetSettingClass:function(a){var b=new c;require(m.getRequireConfig(),[a.folderUrl+"setting/Setting.js"],d.hitch(this,function(a){b.resolve(a)}));m.checkError(a.folderUrl+"setting/Setting.js",
b);return b},loadWidgetSettingPageResources:function(a){var b=new c,g,e,m=[];a=d.clone(a);g=this._tryLoadResource(a,"settingI18n");e=this._tryLoadResource(a,"settingTemplate");a=this._tryLoadResource(a,"settingStyle");m.push(g);m.push(e);m.push(a);r(m).then(d.hitch(this,function(a){var g={};g.i18n=a[0]||{};g.template=a[1];g.style=a[2];b.resolve(g)}),function(a){console.log(a)});return b},getWidgetById:function(a){var b;f.some(this.loaded,function(g){if(g.id===a)return b=g,!0},this);return b},getWidgetByLabel:function(a){var b;
f.some(this.loaded,function(g){if(g.label===a)return b=g,!0},this);return b},getWidgetsByName:function(a){var b=[];f.some(this.loaded,function(g){g.name===a&&b.push(g)},this);return b},changeWindowStateTo:function(a,b){"normal"===b?this.normalizeWidget(a):"minimized"===b?this.minimizeWidget(a):"maximized"===b?this.maximizeWidget(a):console.log("error state: "+b)},closeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if("closed"!==a.state){this.activeWidget&&this.activeWidget.id===
a.id&&(this.activeWidget.onDeActive(),this.activeWidget=null);h.setStyle(a.domNode,"display","none");a.setState("closed");try{a.onClose()}catch(b){console.log(console.error("fail to close widget "+a.name+". "+b.stack))}}},openWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;if(!a.started)try{a.started=!0,a.startup()}catch(b){console.error("fail to startup widget "+a.name+". "+b.stack)}if("closed"===a.state){h.setStyle(a.domNode,"display","");a.setState("opened");try{a.onOpen()}catch(g){console.error("fail to open widget "+
a.name+". "+g.stack)}}},activateWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"opened"===a.state&&this._activeWidget(a)},maximizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize widget "+a.name+". "+b.stack))}},minimizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;
"closed"===a.state&&this.openWidget(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize widget "+a.name+". "+b.stack))}},normalizeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;"closed"===a.state&&this.openWidget(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to normalize widget "+a.name+". "+b.stack))}},destroyWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),
!a))return;this._removeWidget(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy widget "+a.name+". "+b.stack))}},tryLoadWidgetConfig:function(a){return this._tryLoadWidgetConfig(a).then(d.hitch(this,function(b){return this._upgradeWidgetConfig(a,b).then(function(b){return a.config=b})}))},triggerWidgetOpen:function(a){function b(a){var e=k.after(a,"onOpen",function(){e.remove();g.resolve(a)})}var g=new c,e=this.getWidgetById(a);if(e){if("closed"!==e.state)return g.resolve(e),
g;b(e)}else var m=p.subscribe("widgetCreated",d.hitch(this,function(b){b.id===a&&(m.remove(),g.resolve(b))}));p.publish("openWidget",a);return g},_tryLoadWidgetConfig:function(a){var g=new c;if(a.config&&d.isObject(a.config))return g.resolve(a.config),g;if(a.config){if(require.cache["url:"+a.config])return g.resolve(b.parse(require.cache["url:"+a.config])),g;a=m.processUrlInAppConfig(a.config);a=a.split("/");a[a.length-1]=encodeURIComponent(a[a.length-1]);a=a.join("/");return q(a,{handleAs:"json"})}return this._tryLoadResource(a,
"config")},_upgradeWidgetConfig:function(a,b){var g=new c,e=a.manifest.version,k=a.version,r;if(e===k)return g.resolve(b),g;if(!1===a.hasVersionManager)return a.version=e,g.resolve(b),g;require(m.getRequireConfig(),[a.amdFolder+"VersionManager"],d.hitch(this,function(c){c=new c;var m=c.getVersionIndex(k),d=c.getVersionIndex(e);if(m>d)g.reject("Bad widget version number, "+a.name+","+k);else try{r=c.upgrade(b,k,e),a.version=e,g.resolve(r)}catch(q){console.log("Read widget ["+a.name+"] old config error,"+
q.stack),g.resolve(b)}}));return g},loadWidgetStyle:function(a){var b="widget/style/"+a.uri,g=new c,b=this._replaceId(b);return h.byId(b)?(g.resolve("load"),g):m.loadStyleLink(b,a.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(a){var b="widget/style/"+a.uri+"/setting",g=new c,b=this._replaceId(b);return h.byId(b)?(g.resolve("load"),g):m.loadStyleLink(b,a.settingStyleFile)},loadWidgetConfig:function(a){a=require(m.getRequireConfig()).toUrl(a.configFile);
if(require.cache["url:"+a]){var g=new c;g.resolve(b.parse(require.cache["url:"+a]));return g}return q(a,{handleAs:"json"})},loadWidgetI18n:function(a){var b=new c;require(m.getRequireConfig(),["dojo/i18n!"+a.i18nFile],function(a){b.resolve(a)});return b},loadWidgetSettingI18n:function(a){var b=new c;require(m.getRequireConfig(),["dojo/i18n!"+a.settingI18nFile],function(a){b.resolve(a)});return b},loadWidgetTemplate:function(a){var b=new c;require(m.getRequireConfig(),["dojo/text!"+a.templateFile],
function(a){b.resolve(a)});m.checkError(a.templateFile,b);return b},loadWidgetSettingTemplate:function(a){var b=new c;require(m.getRequireConfig(),["dojo/text!"+a.settingTemplateFile],function(a){b.resolve(a)});m.checkError(a.settingTemplateFile,b);return b},removeWidgetStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri))},removeWidgetSettingStyle:function(a){h.destroy(this._replaceId("widget/style/"+a.uri+"/setting"))},getControllerWidgets:function(){return f.filter(this.loaded,function(a){return a.isController})},
getOffPanelWidgets:function(){return f.filter(this.loaded,function(a){return!a.inPanel})},getOnScreenOffPanelWidgets:function(){return f.filter(this.loaded,function(a){return a.isOnScreen&&!a.inPanel})},closeOtherWidgetsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===a.gid&&this.loaded[b].id!==a.id&&this.closeWidget(this.loaded[b])},closeAllWidgetsInGroup:function(a){for(var b=0;b<this.loaded.length;b++)this.loaded[b].gid===
a&&this.closeWidget(this.loaded[b])},_mergeAgolConfig:function(a){var b=this.appConfig._appData.values,g="widgets["+a.id+"]",e;for(e in b){var c=e.replace(/\//g,"_").indexOf(g+"_config");0<=c&&m.template.setConfigValue(a,e.replace(/\//g,"_").substr(c,e.length).replace(g,"widget"),b[e])}},_onUserSignIn:function(a){f.forEach(this.loaded,function(b){b.onSignIn(a)},this)},_onUserSignOut:function(){f.forEach(this.loaded,function(a){a.onSignOut()},this)},_activeWidget:function(a){if(this.activeWidget){if(this.activeWidget.id===
a.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&h.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&h.setStyle(a.domNode,"zIndex","zIndex"in a.position?a.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=a;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
h.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),p.publish("widgetActived",a))},_onClickWidget:function(a,b){var g=s(".jimu-widget",a.domNode);if(0<g.length)for(var e=0;e<g.length;e++)if(b.target===g[e]||h.isDescendant(b.target,g[e]))return;this._activeWidget(a)},_onMoveStart:function(a){f.forEach(this.loaded,function(b){b.domNode===a.node&&this._activeWidget(b)},this)},_onAppConfigLoaded:function(a){this.appConfig=a=d.clone(a);t.setPortalUrl(a.portalUrl)},_onMapLoaded:function(a){this.map=
a},_onMapChanged:function(a){this.map=a},_onSceneViewLoaded:function(a){this.sceneView=a},_onSceneViewChanged:function(a){this.sceneView=a},_onAppConfigChanged:function(a,b,g,e){var c=d.clone(a);this.appConfig=c;f.forEach(this.loaded,function(a){a&&(a.onAppConfigChanged(c,b,g,e),"widgetChange"===b&&this._onConfigChanged(g.id,g.config,e))},this)},_onConfigChanged:function(a,b){var g=this.getWidgetById(a);g&&(g.onConfigChanged(b),d.mixin(g.config,b))},_onActionTriggered:function(a){if(!("map"===a.elementId||
"app"===a.elementId)){var b=this.getWidgetById(a.elementId);if(b)b.onAction(a.action,a.data);else this.missedActions.push({id:a.elementId,action:{name:a.action,data:a.data}});f.forEach(this.getControllerWidgets(),function(b){if(b.widgetIsControlled(a.elementId))b.onAction(a.action,{widgetId:a.elementId,data:a.data})},this)}},_postWidgetStartup:function(a){a.started=!0;m.setVerticalCenter(a.domNode);k.after(a,"resize",d.hitch(this,m.setVerticalCenter,a.domNode));this.openWidget(a);var b=t.getPortalCredential(this.appConfig.portalUrl);
if(b)a.onSignIn(b);else a.onSignOut();this._triggerMissedAction(a)},_triggerMissedAction:function(a){this.missedActions.forEach(function(b){if(b.id===a.id)a.onAction(b.action.name,b.action.data)})},_remove:function(a){return f.some(this.loaded,function(b,g){if(b.id===a)return this.loaded.splice(g,1),!0},this)},_tryLoadResource:function(a,b){var g,m=new c;if("config"===b)g=a.amdFolder+"config.json",a.configFile=g,g="hasConfig";else if("style"===b)g=a.amdFolder+"css/style.css",a.styleFile=g,g="hasStyle";
else if("i18n"===b)g=a.amdFolder+"nls/strings.js",a.i18nFile=a.amdFolder+"nls/strings",g="hasLocale";else if("template"===b)g=a.amdFolder+"Widget.html",a.templateFile=g,g="hasUIFile";else if("settingTemplate"===b)g=a.amdFolder+"setting/Setting.html",a.settingTemplateFile=g,g="hasSettingUIFile";else if("settingI18n"===b)g=a.amdFolder+"setting/nls/strings.js",a.settingI18nFile=a.amdFolder+"setting/nls/strings",g="hasSettingLocale";else if("settingStyle"===b)g=a.amdFolder+"setting/css/style.css",a.settingStyleFile=
g,g="hasSettingStyle";else return m;a[g]?function(){var g;if("config"===b)g=this.loadWidgetConfig(a);else if("style"===b)g=this.loadWidgetStyle(a);else if("i18n"===b)g=this.loadWidgetI18n(a);else if("template"===b)g=this.loadWidgetTemplate(a);else if("settingTemplate"===b)g=this.loadWidgetSettingTemplate(a);else if("settingStyle"===b)g=this.loadWidgetSettingStyle(a);else if("settingI18n"===b)g=this.loadWidgetSettingI18n(a);else return m;g.then(function(a){m.resolve(a)},function(b){new e({message:"load widget resouce error: "+
a.uri});m.reject(b)})}.apply(this):m.resolve(null);return m},_replaceId:function(a){return a.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(a){"closed"!==a.state&&this.closeWidget(a);this._removeWidget(a);console.log("destroy widget ["+a.uri+"].")},_onDestroyWidgetSetting:function(a){this.removeWidgetSettingStyle(a)},_removeWidget:function(a){if("string"===typeof a&&(a=this.getWidgetById(a),!a))return;this.activeWidget&&this.activeWidget.id===a.id&&(this.activeWidget=null);this._remove(a.id);
0===this.getWidgetsByName(a.name).length&&this.removeWidgetStyle(a)}});y.getInstance=function(a){null===g&&(g=new y(a),window._widgetManager=g);return g};return y})},"jimu/tokenUtils":function(){define("dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/config esri/request esri/urlUtils esri/IdentityManager esri/arcgis/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e){"function"!==
typeof c.getAll&&(c.getAll=function(a){var b=[];(a=c(a))&&b.push(a);return b});r={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){var a=!1;try{a=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(b){console.log(b),a=!1}return!!a},isStringStartWith:function(a,b){return a.substr(0,b.length)===b},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(a){(a=
t.getStandardPortalUrl(a))&&(a+="/");this.portalUrl=a},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(g){var e=new h,c=t.getStandardPortalUrl(g);g=c+"/sharing";var m=t.setHttpsProtocol(c+"/sharing/rest/generateToken?f\x3djson"),r=t.setHttpsProtocol(g);a.get(m,{jsonp:"callback"}).then(n.hitch(this,function(a){a.token?(this.webTierPortalUrls.push(c),this.removeWabAuthCookie(),k.id.getCredential(r).then(n.hitch(this,function(g){g.token||(g.token=a.token);g=q.canUseXhr(g.server,
!0);-1<g&&b.defaults.io.corsEnabledServers.splice(g,1);this._pushCorsEnabledServerInfo({host:t.getServerByUrl(c),withCredentials:!0});e.resolve(!0)}),n.hitch(this,function(){e.resolve(!0)}))):e.resolve(!1)}),n.hitch(this,function(a){console.error(a);e.reject(a)}));return e},addAuthorizedCrossOriginDomains:function(a){if(a&&0<a.length)for(var b=0;b<a.length;b++)this.addWithCredentialDomain(a[b])},addWithCredentialDomain:function(a){if(a&&"string"===typeof a){var e=b.defaults.io.corsEnabledServers,
c=t.getServerByUrl(a);(a=t.getServerWithProtocol(a))||(a="http://"+c);a=q.canUseXhr(a,!0);-1<a&&e.splice(a,1);this._pushCorsEnabledServerInfo({host:c,withCredentials:!0})}},_pushCorsEnabledServerInfo:function(a){if(a){var e=b.defaults.io.corsEnabledServers,c="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");
if("object"===typeof a&&"string"===typeof a.host){for(var m in a.host)a[m]="function"===typeof a.host[m]?function(){return a.host[m].apply(a.host,arguments)}:a.host[m];a.length=a.host.length;d.forEach(c,function(b){"function"===typeof a.host[b]&&(a[b]=function(){return a.host[b].apply(a.host,arguments)})})}e.push(a)}},tryRegisterCredential:function(a){return!this.isValidCredential(a)?!1:!d.some(k.id.credentials,n.hitch(this,function(b){return a.token===b.token}))?(k.id.credentials.push(a),!0):!1},
registerToken:function(a){var b=t.getSharingUrl(this.portalUrl);k.id.findCredential(b)&&d.some(k.id.credentials,n.hitch(this,function(a,b){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a))return k.id.credentials.splice(b,1),!0}));return this._getTokenInfo(a).then(function(a){k.id.registerToken(a)})},_getTokenInfo:function(b){var e=t.getPortalSelfInfoUrl(this.portalUrl);return a.get(e+("?f\x3djson\x26token\x3d"+b),{jsonp:"callback"}).then(n.hitch(this,function(a){if(a.user)return{server:t.getSharingUrl(this.portalUrl),
ssl:a.allSSL,token:b,userId:a.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(a){console.error(a);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(a){return a&&"string"===typeof a&&n.trim(a)},signInPortal:function(a){var b=new h;if(this._isInvalidPortalUrl(a)){a=t.getStandardPortalUrl(a);var e=t.getSharingUrl(a),c=this.getPortalCredential(a);c?setTimeout(n.hitch(this,function(){b.resolve(c)}),0):b=k.id.getCredential(e)}else setTimeout(n.hitch(this,
function(){b.reject("Invalid portalurl.")}),0);return b},_loadPortalSelfInfo:function(a){a=t.getPortalSelfInfoUrl(a);return s({url:a,handleAs:"json",content:{f:"json"},callbackParamName:"callback"})},registerOAuthInfo:function(a,b){if(!a||!("string"===typeof a&&b&&"string"===typeof b))return null;var e=k.id.findOAuthInfo(a);e||(e=window.location.protocol+"//"+window.location.host+require.toUrl("jimu")+"/oauth-callback.html",e=new m({appId:b,expiration:20160,portalUrl:a,authNamespace:"/",popup:!0,
popupCallbackUrl:e}),k.id.registerOAuthInfos([e]));e.appId=b;return e},signOutAll:function(){var a=t.getStandardPortalUrl(this.portalUrl),b=!!k.id.findCredential(a+"/sharing/rest");window.appInfo.isRunInPortal?this.removeEsriAuthCookieStorage():this.removeWabAuthCookie();k.id.destroyCredentials();k.id._oAuthHash=null;b&&this._publishCurrentPortalUserSignOut(a)},userHaveSignInPortal:function(a){return!!this.getPortalCredential(n.trim(a||""))},isValidCredential:function(a){var b=!1;if(a){var b=a.token,
e=a.server,c=a.scope,b=b&&"string"===typeof b&&n.trim(b),e=e&&"string"===typeof e&&n.trim(e),c="portal"===c||"server"===c,m=!0;a.expires&&(a=parseInt(a.expires,10),m=(new Date).getTime(),m=a>m);b=b&&e&&c&&m}return b},isValidPortalCredentialOfPortalUrl:function(a,b){var e=!1;if(this.isValidCredential(b))var e="portal"===b.scope,c=t.isSameServer(a,b.server),e=e&&c;return e},getPortalCredential:function(a){var b=null;a=n.trim(a||"");if(!a)return null;a=t.getStandardPortalUrl(a);return b=this._filterPortalCredential(a,
k.id.credentials)},saveAndRegisterCookieToCredential:function(a){a=n.clone(a);a.referer=window.location.host;a.scope="portal";a.isAdmin=!!a.isAdmin;this.saveWabCookie(a);var b=a.server+"/sharing/rest";a.server=b;k.id.registerToken(a);return k.id.findCredential(b,a.userId)},registerAuth2Hash:function(a){a=n.clone(a);var b=1E3*parseInt(a.expires_in,10),b=(new Date).getTime()+b,e=t.getStandardPortalUrl(a.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:e,
token:a.access_token,expires:b,userId:a.username,scope:"portal",isAdmin:!!a.isAdmin})},saveWabCookie:function(a){this.removeCookie("wab_auth");c("wab_auth",p.stringify(a),{expires:new Date(a.expires),path:"/"})},removeWabAuthCookie:function(){this.removeCookie("wab_auth")},removeEsriAuthCookieStorage:function(){this.removeCookie("esri_auth");window.localStorage&&window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(a,
b){var e=null;if(b&&0<b.length){var c=d.filter(b,n.hitch(this,function(b){return this.isValidPortalCredentialOfPortalUrl(a,b)}));0<c.length&&(e=c[c.length-1])}return e},_removePortalCredential:function(a){var b=n.trim(a||"");if(b){b=t.getStandardPortalUrl(b);for(a=d.filter(k.id.credentials,n.hitch(this,function(a){return this.isValidPortalCredentialOfPortalUrl(b,a)}));0<a.length;)a[0].destroy(),a.splice(0,1);k.id.credentials=d.filter(k.id.credentials,n.hitch(this,function(a){return!this.isValidPortalCredentialOfPortalUrl(b,
a)}))}},getUserIdByToken:function(a,b){var e=new h;if(a&&"string"===typeof a&&b&&"string"===typeof b){var c=t.getStandardPortalUrl(b),m=d.filter(k.id.credentials,n.hitch(this,function(b){var e=b.token===a&&b.userId;b=t.isSameServer(c,b.server);return e&&b}));if(0<m.length){var r=m[0];setTimeout(n.hitch(this,function(){e.resolve(r.userId)}),0);return e}m=t.getCommunitySelfUrl(c);s({url:m,handleAs:"json",content:{f:"json"},callbackParamName:"callback"}).then(n.hitch(this,function(a){e.resolve(a&&a.username||
"")}),n.hitch(this,function(a){console.error(a);e.reject("fail to get userId by token")}))}else setTimeout(n.hitch(this,function(){e.reject("invalid parameters")}),0);return e},xtGetCredentialFromCookie:function(a){var b=c("wab_auth"),e=null;if(b)try{e=p.parse(b)}catch(m){console.error(m)}if(!(e&&"object"===typeof e)||!t.isSameServer(a,e.server)||window.location.host!==e.referer)return null;e.expires=parseInt(e.expires,10);b=(new Date).getTime();if(!(e.expires>b))return this.removeCookie("wab_auth"),
null;a+="/sharing/rest";e.server=a;(b=k.id.findCredential(a))||k.id.registerToken(e);return b=k.id.findCredential(a)},removeCookie:function(a){var b=this.getCookiePath();e.removeCookie(a,b)},_getDomainsByServerName:function(a){var b=a.split("."),e=b.length;return d.map(b,n.hitch(this,function(a,g){var c=b.slice(g,e),m="",k=c.length-1;d.forEach(c,n.hitch(this,function(a,b){m+=a;b!==k&&(m+=".")}));return m}))},_publishCurrentPortalUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("userSignIn",
a)}catch(b){console.error(b)}},_publishAnyUserSignIn:function(a){if(this.isValidCredential(a))try{l.publish("anyUserSignIn",a)}catch(b){console.error(b)}},_publishCurrentPortalUserSignOut:function(a){try{l.publish("userSignOut",a)}catch(b){console.error(b)}},_signInSuccess:function(a){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,a)&&this._publishCurrentPortalUserSignIn(a),this._publishAnyUserSignIn(a)}catch(b){console.error(b)}},_bindEvents:function(){f.after(k.id,"signIn",n.hitch(this,
function(a,b){console.log(b[1]);f.after(a,"callback",n.hitch(this,function(a,b){this._signInSuccess(b[0],!1)}));return a}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var a=window.parent;if(a){var b=a.esri&&a.esri.id;b&&(k.id=b,b=window.esriConfig.defaults.io,a=a.esriConfig.defaults.io,b.corsEnabledServers=a.corsEnabledServers,b.webTierAuthServers=a.webTierAuthServers,b._processedCorsServers=a._processedCorsServers,b.corsStatus=
a.corsStatus)}}this._bindEvents();this._started=!0}}};r.startup();return r})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup".split(" "),function(n,d,f,h,c,p){return n(p,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=
f.create("div",{"class":"title"},this.domNode),this.titleLabeNode=f.create("span",{"class":"title-label jimu-float-leading",innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode),this.closeBtnNode=f.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(c(this.closeBtnNode,"click",d.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:"OK",key:h.ENTER,onClick:d.hitch(this,this.close)})},_increaseZIndex:function(){f.setStyle(this.domNode,
"zIndex",501);f.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase".split(" "),function(n,d,f,h,c,p,l,a,k,b,s){var q=0;return n(s,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,
maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();h.place(this.domNode,this.container);setTimeout(d.hitch(this,function(){this._moveToMiddle()}),50);this.own(p(window,"resize",d.hitch(this,function(){this._fixedHeight||this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):
this._positioning()})));this.overlayNode=h.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();c.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=h.create("div",{"class":"title"},this.domNode);this.titleLabeNode=h.create("span",{"class":"title-label jimu-float-leading",
innerHTML:this.titleLabel||"\x26nbsp"},this.titleNode);this.closeBtnNode=h.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var b=null,b="ontouchstart"in document?a.press:"click";this.own(p(this.closeBtnNode,b,d.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=h.create("div",{"class":"content"},this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:
this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&h.place(this.content,this.contentContainerNode));this.buttonContainer=h.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&h.setStyle(this.buttonContainer,"display","none");for(var a=this.buttons.length-1;-1<a;a--)this._createButton(this.buttons[a]),this.buttons[a].disable&&this.disableButton(a)},_limitButtonsMaxWidth:function(){var a=this.enabledButtons.length;
if(0!==a){var b=h.getContentBox(this.buttonContainer),c=h.getMarginExtents(this.enabledButtons[0]),e=h.getPadBorderExtents(this.enabledButtons[0]),g=0,e=8===l("ie")?e.l+e.r:0,g=(b.w-(c.l+c.r+e)*a)/a;0<g&&(f.forEach(this.enabledButtons,d.hitch(this,function(a){h.setStyle(a,"maxWidth",g+"px")})),f.forEach(this.disabledButtons,d.hitch(this,function(a){h.setStyle(a,"maxWidth",g+"px")})))}},_moveableNode:function(a,c){this.moveable&&(this.moveable.destroy(),this.moveable=null);var k=h.getMarginBox(this.container);
k.l=k.l-a+c;k.w+=2*(a-c);this.moveable=new b.boxConstrainedMoveable(this.domNode,{box:k,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(p(this.moveable,"Moving",d.hitch(this,this.onMoving)));this.own(p(this.moveable,"MoveStop",d.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===k("#header").length?{t:0,l:0,w:0,h:0}:h.getMarginBox("header")},_getFooterBox:function(){return 0===k(".footer",this.container).length?{t:0,l:0,w:0,h:0}:h.getMarginBox(k(".footer",this.container)[0])},
_calculatePosition:function(){var a=h.getContentBox(this.container),b=this._getHeaderBox(),c=this._getFooterBox(),c=a.h-b.h-c.h-40,e=0;e=this._fixedHeight?this.height:this.autoHeight?c-200:this.height=c>this.maxHeight?this.maxHeight:c;c=(c-e)/2+b.h+20;c=c<b.h?b.h:c;this.width=this.width||this.maxWidth;h.setStyle(this.domNode,{left:(a.w-this.width)/2+"px",top:c+"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(h.setStyle(this.domNode,"height","auto"),h.addClass(this.contentContainerNode,
"content-static"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(h.setStyle(this.domNode,"height",this.height+"px"),h.addClass(this.contentContainerNode,"content-absolute"),h.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&h.setStyle(this.contentContainerNode,{bottom:"15px"}));this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var a=h.getMarginBox(this.domNode),b=h.getContentBox(this.container),
c=this._getHeaderBox(),e=this._getFooterBox(),e=b.h-c.h-e.h-40,g=0,g=a.h||e-200,a=(e-g)/2+c.h+20,a=a<c.h?c.h:a;h.setStyle(this.domNode,{left:(b.w-this.width)/2+"px",top:a+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){h.setStyle(this.domNode,"zIndex",q+200+1);h.setStyle(this.overlayNode,"zIndex",q+200);q++},onMoving:function(a){h.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){h.setStyle(a.node,"opacity",
1)},close:function(){if(!(this.onClose&&!1===this.onClose())){var a=this.domNode.parentNode,b=d.clone(this.domNode);h.setStyle(this.domNode,"display","none");h.destroy(this.overlayNode);this.destroy();this.moveable.destroy();h.place(b,a);c.animateProperty({node:b,properties:{opacity:0},duration:200,onEnd:function(){h.destroy(b)}}).play()}},addButton:function(a){this._createButton(a)},_createButton:function(a){var b=" ";a.classNames&&0<a.classNames.length&&"function"===typeof a.classNames.join&&(b+=
a.classNames.join(" "));var c=h.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label},this.buttonContainer);this.enabledButtons.unshift(c);b=h.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+b,innerHTML:a.label,style:{display:"none"}},this.buttonContainer);this.disabledButtons.unshift(b);this.own(p(c,"click",d.hitch(this,function(b){if(a.onClick)a.onClick(b);else this.close()})))},enableButton:function(a){"number"===
typeof a?(h.setStyle(this.enabledButtons[a],"display","inline-block"),h.setStyle(this.disabledButtons[a],"display","none")):(f.forEach(this.enabledButtons[a],d.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),f.forEach(this.disabledButtons[a],d.hitch(this,function(a){h.setStyle(a,"display","none")})))},disableButton:function(a){"number"===typeof a?(h.setStyle(this.disabledButtons[a],"display","inline-block"),h.setStyle(this.enabledButtons[a],"display","none")):(f.forEach(this.disabledButtons,
d.hitch(this,function(a){h.setStyle(a,"display","inline-block")})),f.forEach(this.enabledButtons,d.hitch(this,function(a){h.setStyle(a,"display","none")})))}})})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(n,d,f,h,c,p){h=n("dojo.dnd.move.constrainedMoveable",p,{constraints:function(){},within:!1,constructor:function(c,a){a||(a={});this.constraints=a.constraints;this.within=a.within},onFirstMove:function(c){var a=
this.constraintBox=this.constraints.call(this,c);a.r=a.l+a.w;a.b=a.t+a.h;this.within&&(c=d.getMarginSize(c.node),a.r-=c.w,a.b-=c.h)},onMove:function(c,a){var k=this.constraintBox,b=c.node.style;this.onMoving(c,a);a.l=a.l<k.l?k.l:k.r<a.l?k.r:a.l;a.t=a.t<k.t?k.t:k.b<a.t?k.b:a.t;b.left=a.l+"px";b.top=a.t+"px";this.onMoved(c,a)}});c=n("dojo.dnd.move.boxConstrainedMoveable",h,{box:{},constructor:function(c,a){var k=a&&a.box;this.constraints=function(){return k}}});n=n("dojo.dnd.move.parentConstrainedMoveable",
h,{area:"content",constructor:function(c,a){var k=a&&a.area;this.constraints=function(){var a=this.node.parentNode,c=f.getComputedStyle(a),q=d.getMarginBox(a,c);if("margin"==k)return q;var r=d.getMarginExtents(a,c);q.l+=r.l;q.t+=r.t;q.w-=r.w;q.h-=r.h;if("border"==k)return q;r=d.getBorderExtents(a,c);q.l+=r.l;q.t+=r.t;q.w-=r.w;q.h-=r.h;if("padding"==k)return q;r=d.getPadExtents(a,c);q.l+=r.l;q.t+=r.t;q.w-=r.w;q.h-=r.h;return q}}});return{constrainedMoveable:h,boxConstrainedMoveable:c,parentConstrainedMoveable:n}})},
"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager","./utils"],function(n,d){function f(){this.versions=[{version:"1.0",description:"The version embedded in portal 10.3 final.",upgrader:function(d){return d},compatible:!0},{version:"1.1",description:"The version embedded in online3.6, and used in developer edition 1.0.",upgrader:function(d){if(d.widgetOnScreen&&d.widgetOnScreen.panel&&"themes/FoldableTheme/panels/TitlePanel/Panel"===d.widgetOnScreen.panel.uri||"jimu/BaseWidgetPanel"===
d.widgetOnScreen.panel.uri)d.widgetOnScreen.panel.uri="jimu/PreloadWidgetIconPanel";return d},compatible:!0},{version:"1.2",description:"The version embedded in online3.7.",upgrader:function(d){var c=0;if(d.widgetOnScreen&&d.widgetOnScreen.widgets){for(var p=!1,c=0;c<d.widgetOnScreen.widgets.length;c++)"widgets/Splash/Widget"===d.widgetOnScreen.widgets[c].uri&&(p=!0);p||d.widgetOnScreen.widgets.push({uri:"widgets/Splash/Widget",visible:!1,positionRelativeTo:"browser",version:"1.2"});p=!1;for(c=0;c<
d.widgetOnScreen.widgets.length;c++)"widgets/TimeSlider/Widget"===d.widgetOnScreen.widgets[c].uri&&(p=!0);p||d.widgetOnScreen.widgets.push({uri:"widgets/TimeSlider/Widget",visible:!1,position:{bottom:55,left:7},version:"1.2"});p=!1;for(c=0;c<d.widgetOnScreen.widgets.length;c++)"widgets/Swipe/Widget"===d.widgetOnScreen.widgets[c].uri&&(p=!0);p||d.widgetOnScreen.widgets.push({uri:"widgets/Swipe/Widget",visible:!1,position:{top:145,left:7},version:"1.2"})}return d},compatible:!0},{version:"1.3",description:"The version embedded in online3.8 \x26 online3.9.",
upgrader:function(f){(function(c){d.visitElement(c,function(c){c.positionRelativeTo&&(c.position?c.position.relativeTo=c.positionRelativeTo:c.position={relativeTo:c.positionRelativeTo},c.panel&&(c.panel.position?c.panel.position.relativeTo=c.panel.positionRelativeTo:c.panel.position={relativeTo:c.panel.positionRelativeTo}))});var p=c.widgetOnScreen;p&&(p.panel&&p.panel.positionRelativeTo)&&(p.panel.position?p.panel.position.relativeTo=p.panel.positionRelativeTo:p.panel.position={relativeTo:p.panel.positionRelativeTo});
if((p=c.widgetPool)&&p.panel&&p.panel.positionRelativeTo)p.panel.position?p.panel.position.relativeTo=p.panel.positionRelativeTo:p.panel.position={relativeTo:p.panel.positionRelativeTo}})(f);f.widgetOnScreen&&(f.widgetOnScreen.panel&&"jimu/PreloadWidgetIconPanel"===f.widgetOnScreen.panel.uri)&&(f.widgetOnScreen.panel.uri="jimu/OnScreenWidgetPanel");(function(c){if(c.widgetOnScreen&&c.widgetOnScreen.widgets&&c.theme&&"FoldableTheme"===c.theme.name){var d=null,f=null;if(d=c.widgetOnScreen.widgets[4])void 0!==
d.position.top?(d={position:{left:205,top:45}},f={position:{left:255,top:45}}):(d={position:{left:205,bottom:55}},f={position:{left:255,bottom:55}}),c.widgetOnScreen.widgets.splice(7,0,d,f)}})(f);(function(){for(var c=0,d=0,l=!1,c=0;c<f.widgetOnScreen.widgets.length;c++)if("widgets/Geocoder/Widget"===f.widgetOnScreen.widgets[c].uri){l=!0;break}for(var a=!1,d=0;d<f.widgetOnScreen.widgets.length;d++)if("widgets/Search/Widget"===f.widgetOnScreen.widgets[d].uri){a=!0;break}!a&&l&&(c=f.widgetOnScreen.widgets[c],
c.uri="widgets/Search/Widget",c.name="Search")})(f);(function(c){for(var d=0,d=c.widgetOnScreen.widgets.length-1;0<=d;d--){var f=c.widgetOnScreen.widgets[d];if("widgets/Swipe/Widget"===f.uri&&!f.closeable&&(c.widgetOnScreen.widgets.splice(d,1),!1!==f.visible)){f.closeable=!0;var a;a:{for(a=a=0;a<c.widgetOnScreen.widgets.length;a++)if(!c.widgetOnScreen.widgets[a].uri)break a;a=-1}0<=a&&(f.position=c.widgetOnScreen.widgets[a].position,c.widgetOnScreen.widgets[a]=f)}"widgets/TimeSlider/Widget"===f.uri&&
(!1===f.visible?c.widgetOnScreen.widgets.splice(d,1):f.closeable=!0)}})(f);f.widgetOnScreen.widgets.push({uri:"widgets/ZoomSlider/Widget",position:{top:5,left:7},version:"1.3"});f.loadingPage||(f.loadingPage={backgroundColor:"#508dca",backgroundImage:{visible:!1},loadingGif:{visible:!0,uri:"configs/loading/images/predefined_loading_1.gif",width:58,height:58}});return f},compatible:!0},{version:"1.4",description:"The version embedded in online3.10.",upgrader:function(d){if(d.theme){var c=d.theme.name;
if(("FoldableTheme"===c||"JewelryBoxTheme"===c)&&d.widgetOnScreen){var f=d.widgetOnScreen.widgets;if(f&&0<f.length)for(var c="themes/"+c+"/widgets/HeaderController/Widget",l=null,a=0;a<f.length;a++)if((l=f[a])&&l.uri===c&&l.position&&310===l.position.paddingRight)l.position.paddingRight=275}}return d},compatible:!0},{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(d){d.keepAppState=!0;return d},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",
upgrader:function(d){return d},compatible:!0}];this.isCompatible=function(d,c){for(var f=this.getVersionIndex(d),l=this.getVersionIndex(c),f=f+1;f<=l;f++)if(!1===this.versions[f].compatible)return!1;return!0}}f.prototype=new n;return f.prototype.constructor=f})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=[];this.upgrade=function(n,d,f){d=this.getVersionIndex(d);f=this.getVersionIndex(f);if(d>f)throw Error("New version should higher than old version.");
for(d+=1;d<=f;d++)this.versions[d].upgrader&&(n=this.versions[d].upgrader(n));return n};this.getVersionIndex=function(n){n=this.fixVersion(n);var d,f;for(f=0;f<this.versions.length;f++)this.versions[f].version===n&&(d=f);null===n&&(d=-1);void 0===d&&(d=this.versions.length-1);return d};this.fixVersion=function(n){return!n?null:n}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./portalUrlUtils ./AppStateManager esri/IdentityManager esri/config esri/urlUtils esri/arcgis/utils".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x){var z=null,D;D=n(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(a,b){this._removeHash(a);this.urlParams=a||{};this.widgetManager=s.getInstance();d.mixin(this,b)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(d.hitch(this,function(a){var g=this.checkConfig(a);if(g)throw Error(g);this.rawAppConfig=d.clone(a);e.getInstance().setRawAppConfig(this.rawAppConfig);
a=this._upgradeAppConfig(a);this._processAfterTryLoad(a);this.appConfig=a;if(this.urlParams.id)return this.loadWidgetsManifest(a).then(d.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(d.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=window.isBuilder?a.title+" - Web AppBuilder for ArcGIS":a.title);return this.getAppConfig()}));r.setPortalUrl(a.portalUrl);x.arcgisUrl=t.getBaseItemUrl(a.portalUrl);return this._proesssWebTierAndSignin(a).then(d.hitch(this,
function(){return this.urlParams.appid?window.appInfo.isRunInPortal?this._getAppConfigFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(d.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})):this._processNotInPortalAppProtocol(a).then(d.hitch(this,function(a){return this._getAppDataAddTemplateDataFromTemplateAppId(a.portalUrl,this.urlParams.appid).then(d.hitch(this,function(b){b.appData.appConfig&&(a=b.appData.appConfig);a._appData=b.appData;
a.templateConfig=b.templateData;a.isTemplateApp=!0;return a}))})):this._processNotInPortalAppProtocol(a)})).then(d.hitch(this,function(a){this._processAfterTryLoad(a);this.appConfig=a;return a.map.itemId?a:(a.map["3D"]?m.getDefaultWebScene(a.portalUrl):m.getDefaultWebMap(a.portalUrl)).then(function(b){a.map.itemId=b;return a})})).then(d.hitch(this,function(a){return this.loadWidgetsManifest(a)})).then(d.hitch(this,function(a){return a._appData?a._appData.values&&a._appData.values.webmap?m.getPortal(a.portalUrl).getItemById(a._appData.values.webmap).then(d.hitch(this,
function(e){return b.template.mergeTemplateAppConfigToAppConfig(a,a._appData,e)})):b.template.mergeTemplateAppConfigToAppConfig(a,a._appData):a})).then(d.hitch(this,function(){return this._upgradeAllWidgetsConfig(a)})).then(d.hitch(this,function(){this._configLoaded=!0;a.title&&(document.title=a.title);return this.getAppConfig()}))}),d.hitch(this,function(a){this.showError(a)}))},getAppConfig:function(){var a=d.clone(this.appConfig);a.getConfigElementById=function(a){return b.getConfigElementById(this,
a)};a.getConfigElementsByName=function(a){return b.getConfigElementsByName(this,a)};a.visitElement=function(a){b.visitElement(this,a)};this._addAuthorizedCrossOriginDomains(this.portalSelf,a);return a},_addAuthorizedCrossOriginDomains:function(a,b){a&&a.authorizedCrossOriginDomains&&r.addAuthorizedCrossOriginDomains(a.authorizedCrossOriginDomains);b&&b.authorizedCrossOriginDomains&&r.addAuthorizedCrossOriginDomains(b.authorizedCrossOriginDomains)},checkConfig:function(a){return(a=this._getRepeatedId(a))?
"repeated id:"+a:null},processProxy:function(a){y.defaults.io.alwaysUseProxy=a.httpProxy&&a.httpProxy.useProxy&&a.httpProxy.alwaysUseProxy;y.defaults.io.proxyUrl="";y.defaults.io.proxyRules=[];a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.url)&&(y.defaults.io.proxyUrl=a.httpProxy.url);a.httpProxy&&(a.httpProxy.useProxy&&a.httpProxy.rules)&&f.forEach(a.httpProxy.rules,function(a){w.addProxyRule(a)})},addNeedValues:function(a){this._processNoUriWidgets(a);this._addElementId(a);this._processWidgetJsons(a)},
showError:function(a){a&&a.message&&h.create("div",{"class":"app-error",innerHTML:a.message},document.body)},_tryLoadConfig:function(){"stemapp"===this.urlParams.id&&(this.urlParams.config=window.path+"config.json",delete this.urlParams.id);if(this.urlParams.config)return this.configFile=this.urlParams.config,k(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(d.hitch(this,function(a){r.setPortalUrl(a.portalUrl);return this.urlParams.token?r.registerToken(this.urlParams.token).then(function(){return a}):
a}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var a=t.getPortalUrlFromLocation(),b=new l;r.setPortalUrl(a);x.arcgisUrl=t.getBaseItemUrl(a);var e;this.urlParams.token?e=r.registerToken(this.urlParams.token):(e=new l,e.resolve());e.then(d.hitch(this,function(){m.getPortal(a).loadSelfInfo().then(d.hitch(this,function(e){this.portalSelf=e;e.allSSL&&"http:"===window.location.protocol?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),
b.reject()):this._processSignIn(a).then(d.hitch(this,function(){this._getAppConfigFromAppId(a,this.urlParams.id).then(d.hitch(this,function(a){this._tryUpdateAppConfigByLocationUrl(a);return this._processInPortalAppProtocol(a)})).then(function(a){b.resolve(a)},function(a){b.reject(a)})}))}))}),d.hitch(this,function(a){this.showError(a)}));return b}this.configFile="config.json";return k(this.configFile,{handleAs:"json"}).then(d.hitch(this,function(a){r.setPortalUrl(a.portalUrl);return this.urlParams.token?
r.registerToken(this.urlParams.token).then(function(){return a}):a}))},_upgradeAppConfig:function(a){var b=window.wabVersion,e=a.wabVersion;if(b===e)return a;var g=this.versionManager.getVersionIndex(e),c=this.versionManager.getVersionIndex(b);if(g>c)throw Error("Bad version number, "+e);a=this.versionManager.upgrade(a,e,b);a.wabVersion=b;a.isUpgraded=!0;return a},_upgradeAllWidgetsConfig:function(b){var e=new l,g=[];if(!b.isUpgraded)return e.resolve(b),e;delete b.isUpgraded;q.visitElement(b,d.hitch(this,
function(a){a.uri&&(a.config?(a=this.widgetManager.tryLoadWidgetConfig(a),g.push(a)):a.version=a.manifest.version)}));a(g).then(d.hitch(this,function(){e.resolve(b)}),function(a){e.reject(a)});return e},_processAfterTryLoad:function(a){this._setPortalUrl(a);this._tryUpdateAppConfigByLocationUrl(a);this._processUrlParams(a);this.addNeedValues(a);this.processProxy(a);g.tokenValidity=10080;return a},_tryUpdateAppConfigByLocationUrl:function(a){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var b=
t.getPortalUrlFromLocation(),b=t.getStandardPortalUrl(b);t.isOnline(b)&&(b=t.updateUrlProtocolByOtherUrl(b,a.portalUrl),a.map.portalUrl&&t.isSamePortalUrl(a.portalUrl,a.map.portalUrl)&&(a.map.portalUrl=b),a.portalUrl=b,a.httpProxy&&a.httpProxy.url&&(a.httpProxy.url=t.getPortalProxyUrl(b)))}},_processWidgetJsons:function(a){q.visitElement(a,function(a,e){e.isWidget&&a.uri&&b.processWidgetSetting(a)})},_processNoUriWidgets:function(a){var b=0;q.visitElement(a,function(a,e){e.isWidget&&!a.uri&&(b++,
a.placeholderIndex=b)})},_addElementId:function(a){var b=0,e;q.visitElement(a,function(a){if(a.id){a.id=a.id.replace(/\//g,"_");var g=a.id.lastIndexOf("_");-1<g&&(e=a.id.substr(g+1),b=Math.max(b,e))}});q.visitElement(a,function(a){a.id||(b++,a.id=a.uri?a.uri.replace(/\//g,"_")+"_"+b:"_"+b)})},_setPortalUrl:function(a){if(a.portalUrl){var b=t.getPortalUrlFromLocation(),e=t.isOnline(b);!t.isSamePortalUrl(a.portalUrl,b)&&!e&&(window.appInfo.isRunInPortal=!1)}else window.isXT&&p("wab_portalurl")?a.portalUrl=
p("wab_portalurl"):(window.appInfo.isRunInPortal=!0,a.portalUrl=t.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(a,b){a.portalUrl=t.setProtocol(a.portalUrl,b);a.map.portalUrl&&(a.map.portalUrl=t.setProtocol(a.map.portalUrl,b));a.httpProxy&&(a.httpProxy.url=t.setProtocol(a.httpProxy.url,b),a.httpProxy&&a.httpProxy.rules&&f.forEach(a.httpProxy.rules,d.hitch(this,function(a){a.proxyUrl=t.setProtocol(a.proxyUrl,b)})))},_processInPortalAppProtocol:function(a){var b=new l,e=m.getPortal(a.portalUrl),
g=d.hitch(this,function(e){if("https:"===window.location.protocol)this._changePortalUrlProtocol(a,"https");else{if(e){console.log("redirect from http to https");window.location.href=t.setHttpsProtocol(window.location.href);b.reject();return}this._changePortalUrlProtocol(a,"http")}this._checkLocale();b.resolve(a)});e.loadSelfInfo().then(d.hitch(this,function(b){"private"===b.access?(b=0===a.portalUrl.toLowerCase().indexOf("https://"),g(b)):g(b.allSSL)}),d.hitch(this,function(a){b.reject(a)}));return b},
_processNotInPortalAppProtocol:function(a){var b=new l;a.portalUrl?m.getPortal(a.portalUrl).loadSelfInfo().then(d.hitch(this,function(e){var g="https:"===window.location.protocol;(e.allSSL||g)&&this._changePortalUrlProtocol(a,"https");0===a.portalUrl.toLowerCase().indexOf("https://")&&!g&&!r.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href),b.reject()):b.resolve(a)}),d.hitch(this,function(a){b.reject(a)})):b.resolve(a);
return b},_proesssWebTierAndSignin:function(a){var b=new l,e=!1,g=a.portalUrl;this._processWebTier(a).then(d.hitch(this,function(a){e=a;return m.getPortal(g).loadSelfInfo()})).then(d.hitch(this,function(a){this.portalSelf=a;return this._processSignIn(g,e)})).then(d.hitch(this,function(){b.resolve()}),function(a){b.reject(a)});return b},_processWebTier:function(a){var b=new l,e=a.portalUrl;a.isWebTier?(r.addAuthorizedCrossOriginDomains([e]),r.isWebTierPortal(e).then(d.hitch(this,function(){var g=r.getPortalCredential(e);
g&&g.ssl&&"http:"===window.location.protocol&&!r.isInConfigOrPreviewWindow()?(console.log("redirect from http to https"),window.location.href=t.setHttpsProtocol(window.location.href)):b.resolve(a.isWebTier)}),d.hitch(this,function(a){b.reject(a)}))):b.resolve(!1);return b},_processSignIn:function(a,b){var e=new l,c=m.getPortal(a),k=t.getSharingUrl(a);window.appInfo.isRunInPortal?(k=g.checkSignInStatus(k),k.promise.always(d.hitch(this,function(){e.resolve()}))):(!r.isInBuilderWindow()&&(!r.isInConfigOrPreviewWindow()&&
this.portalSelf.supportsOAuth&&this.rawAppConfig.appId&&!b)&&r.registerOAuthInfo(a,this.rawAppConfig.appId),k=g.checkSignInStatus(k),k.promise.always(d.hitch(this,function(){r.xtGetCredentialFromCookie(a);c.loadSelfInfo().then(d.hitch(this,function(a){this.portalSelf=a;this._checkLocale();e.resolve()}))})));return e},_checkLocale:function(){if(!r.isInConfigOrPreviewWindow()){var a=this.portalSelf.user&&this.portalSelf.user.culture||c.locale,a=a.toLowerCase();!this.urlParams.locale&&b.isLocaleChanged(c.locale,
a)&&(p("wab_app_locale",a),window.location.reload())}},_getAppConfigFromTemplateAppId:function(b,e){var g=m.getPortal(b);return this._getWabAppIdAndDataFromTemplateAppId(b,e).then(d.hitch(this,function(e){var c=e.appData;return a([this._getAppConfigFromAppId(b,e.appId),g.getItemData(c.source)]).then(d.hitch(this,function(a){var b;c.appConfig?(b=c.appConfig,delete c.appConfig):b=a[0];b=this._upgradeAppConfig(b);a=a[1];b._appData=c;b.templateConfig=a;b.isTemplateApp=!0;return b}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(a,
b){var e=m.getPortal(a);return e.getItemData(b).then(function(a){return e.getItemData(a.source).then(function(b){return{appData:a,templateData:b}})})},_getWabAppIdAndDataFromTemplateAppId:function(a,b){var e=new l,g=m.getPortal(a);g.getItemData(b).then(d.hitch(this,function(a){g.getItemById(a.source).then(d.hitch(this,function(b){b=w.urlToObject(b.url);e.resolve({appId:b.query.id,appData:a})}))}),function(a){e.reject(a)});return e},_getAppConfigFromAppId:function(a,b){return m.getPortal(a).getItemData(b)},
_removeHash:function(a){for(var b in a)a[b]&&(a[b]=a[b].replace("#",""))},loadWidgetsManifest:function(e){var g=[],c=new l;e._buildInfo&&e._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(d.hitch(this,function(m){q.visitElement(e,d.hitch(this,function(a){!a.widgets&&a.uri&&(m[a.uri]?(this._addNeedValuesForManifest(m[a.uri]),b.addManifest2WidgetJson(a,m[a.uri])):g.push(this.widgetManager.loadWidgetManifest(a)))}));a(g).then(function(){c.resolve(e)})})):(q.visitElement(e,d.hitch(this,
function(a){!a.widgets&&a.uri&&g.push(this.widgetManager.loadWidgetManifest(a))})),a(g).then(function(){c.resolve(e)}));setTimeout(function(){c.isResolved()||c.resolve(e)},6E4);return c},_addNeedValuesForManifest:function(a){b.addManifestProperies(a);b.processManifestLabel(a,c.locale)},_loadMergedWidgetManifests:function(){return k(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(a){var b=[],e;q.visitElement(a,function(a){if(0<=b.indexOf(a.id))return e=
a.id,!0;b.push(a.id)});return e},_processUrlParams:function(a){var e=this.urlParams.itemid||this.urlParams.webmap;e&&a.map.itemId!==e&&(a.map.mapOptions&&b.deleteMapOptions(a.map.mapOptions),a.map.itemId=e);this.urlParams.mode&&(a.mode=this.urlParams.mode);a.map.mapOptions||(a.map.mapOptions={});this.urlParams.scale&&(a.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)a.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});D.getInstance=function(a,
b){null===z?z=new D(a,b):(z.urlParams=a,z.options=b);return z};return D})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(n,d,f,h,c,p,l,a,k,b,s){var q=n([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(a){this.portalUrl=b.getStandardPortalUrl(a);this.selfUrl=b.getPortalSelfInfoUrl(a)},
loadSelfInfo:function(){var b=new c,e={url:this.selfUrl,content:{f:"json"},handleAs:"json",callbackParamName:"callback",preventCache:!0};this.isValidCredential()&&(e.content.token=this.credential.token);a(e).then(d.hitch(this,function(a){var e=a.user;delete a.user;d.mixin(this,a);a.user=e;b.resolve(a)}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b},_checkCredential:function(){var a=s.isValidCredential(this.credential);a||this.clearCredentialAndUser();return a},isValidCredential:function(){this.updateCredential();
return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=s.getPortalCredential(this.portalUrl))},signIn:function(){var a=new c;this.updateCredential();this.isValidCredential()?setTimeout(d.hitch(this,function(){a.resolve(this.credential)}),0):a=s.signInPortal(this.portalUrl);return a},haveSignIn:function(){return s.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=this.credential=null},getUser:function(){this.updateCredential();
var a=new c;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(d.hitch(this,function(){this.user.updateCredential();a.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(d.hitch(this,function(b){this.user=b;a.resolve(this.user)}),d.hitch(this,function(b){console.error(b);a.reject(b)})):s.getUserIdByToken(this.credential.token,this.portalUrl).then(d.hitch(this,function(b){this.credential.userId=b;this._getUser(this.credential.userId).then(d.hitch(this,
function(b){this.user=b;a.resolve(this.user)}),d.hitch(this,function(b){console.error(b);a.reject(b)}))}),d.hitch(this,function(b){console.error(b);a.reject(b)})):setTimeout(d.hitch(this,function(){a.reject("credential is null.")}),0);return a},queryItems:function(e){this.updateCredential();var m=new c,k=b.getBaseSearchUrl(this.portalUrl),q={f:"json"};e&&(q=d.mixin(q,e));this.isValidCredential()&&(q.token=this.credential.token);!q.sortField&&!q.sortOrder&&(q.sortField="title",q.sortOrder="asc");a({url:k,
handleAs:"json",content:q,callbackParamName:"callback"}).then(d.hitch(this,function(a){a.results=f.map(a.results,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new t(a)}));m.resolve(a)}),d.hitch(this,function(a){console.error(a);m.reject(a)}));return m},getItemData:function(e){this.updateCredential();e={url:b.getItemDataUrl(this.portalUrl,e),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.content.token=
this.credential.token);return a(e)},getItemById:function(e){var m=new c;this.updateCredential();e={url:b.getItemUrl(this.portalUrl,e),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.content.token=this.credential.token);a(e).then(d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;a=new t(a);m.resolve(a)}),d.hitch(this,function(a){console.error(a);m.reject(a)}));return m},getAppById:function(e){var m=new c;this.updateCredential();
this.isValidCredential()?(e=b.getAppIdUrl(this.portalUrl,e),m=a({url:e,handleAs:"json",content:{f:"json",token:this.credential.token}})):setTimeout(d.hitch(this,function(){m.reject("token is null.")}),0);return m},queryGroups:function(e){this.updateCredential();var k=new c,q=b.getBaseGroupUrl(this.portalUrl),r={f:"json"};e&&(r=d.mixin(r,e));this.isValidCredential()&&(r.token=this.credential.token);a({url:q,handleAs:"json",content:r,callbackParamName:"callback"}).then(d.hitch(this,function(a){a.results=
f.map(a.results,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;return new m(a)}));k.resolve(a)}),d.hitch(this,function(a){console.error(a);k.reject(a)}));return k},registerApp:function(e,m,k){var q=new c;this.updateCredential();if(this.isValidCredential())var r=this.credential&&this.credential.token,t=b.getOAuth2Url(this.portalUrl),q=a({url:t+"/registerApp",content:{itemId:e,appType:m,redirect_uris:l.stringify(k),token:r,f:"json"},handleAs:"json"},{usePost:!0});
else setTimeout(d.hitch(this,function(){q.reject("token is null.")}),0);return q},createAndRegisterApp:function(a){var b=new c;this.updateCredential();this.isValidCredential()?this.getUser().then(d.hitch(this,function(e){e.addItem({title:"Web AppBuilder for ArcGIS",type:"Web Mapping Application",text:"",snippet:"",tags:"Registered App for OAuth"},"").then(d.hitch(this,function(e){e.success?this.registerApp(e.id,"browser",a).then(d.hitch(this,function(a){b.resolve(a)}),d.hitch(this,function(a){console.error(a);
b.reject(a)})):b.reject("create app failed")}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);b.reject(a)})):setTimeout(d.hitch(this,function(){b.reject("token is null.")}),0);return b},_getUser:function(e){this.updateCredential();var m=new c;e={url:b.getUserUrl(this.portalUrl,e),content:{f:"json"},handleAs:"json",callbackParamName:"callback"};this.isValidCredential()&&(e.content.token=this.credential&&this.credential.token);a(e).then(d.hitch(this,
function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this;this.user=new r(a);m.resolve(this.user)}),d.hitch(this,function(a){console.error(a);m.reject(a)}));return m}}),r=n([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,constructor:function(a){a&&d.mixin(this,a)},_checkCredential:function(){var a=s.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},
updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var a=[];this.groups&&(a=f.map(this.groups,d.hitch(this,function(a){a.portalUrl=this.portalUrl;a.credential=this.credential;a.portal=this.portal;return new m(a)})));return a},getItemsByKeywords:function(a,b){return this.portal.queryItems({start:b||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+a+'"'})},getContent:function(){this.updateCredential();
var e={url:b.getUserContentUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(e.content.token=this.credential.token);return a(e)},getTags:function(){this.updateCredential();var e={url:b.getUserTagsUrl(this.portalUrl,this.username),handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(e.content.token=this.credential.token);return a(e)},addItem:function(e,m){this.updateCredential();var k=new c;
if(this.isValidCredential()){var q={f:"json",token:this.credential.token};e&&(q=d.mixin(q,e));a({url:b.getAddItemUrl(this.portalUrl,this.username,m),handleAs:"json",callbackParamName:"callback",content:q},{usePost:!0}).then(d.hitch(this,function(a){k.resolve(a)}),d.hitch(this,function(a){console.error(a);k.reject(a)}))}else setTimeout(d.hitch(this,function(){k.reject("token is null.")}),0);return k},deleteItem:function(e){this.updateCredential();var m=new c;this.isValidCredential()?(e=b.getDeleteItemUrl(this.portalUrl,
this.username,e),m=a({url:e,content:{token:this.credential.token,f:"json"},handleAs:"json"},{usePost:!0})):setTimeout(d.hitch(this,function(){m.reject("token is null.")}),0);return m},getItemById:function(e,m){this.updateCredential();var k=new c,q={url:b.getUserItemsUrl(this.portalUrl,this.username,m)+"/"+e,handleAs:"json",content:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(q.content.token=this.credential.token);a(q).then(d.hitch(this,function(a){a.portalUrl=this.portalUrl;
a.credential=this.credential;a.portal=this;a=new t(a);k.resolve(a)}),d.hitch(this,function(a){console.error(a);k.reject(a)}));return k},shareItem:function(e,m,k){this.updateCredential();var q=new c;this.isValidCredential()?(m={url:b.shareItemUrl(this.portalUrl,this.username,m,k),handleAs:"json",callbackParamName:"callback",content:{f:"json",token:this.credential.token}},e&&(m.content=d.mixin(m.content,e)),a(m,{usePost:!0}).then(d.hitch(this,function(a){q.resolve(a)}),d.hitch(this,function(a){console.error(a);
q.reject(a)}))):setTimeout(d.hitch(this,function(){q.reject("token is null.")}),0);return q},updateItem:function(e,m){this.updateCredential();var k=new c;this.isValidCredential()?this.portal.getItemById(e).then(d.hitch(this,function(c){var q={f:"json",token:this.credential.token};m&&(q=d.mixin(q,m));a({url:b.getUpdateItemUrl(this.portalUrl,this.username,e,c.ownerFolder),handleAs:"json",callbackParamName:"callback",timeout:1E5,content:q},{usePost:!0}).then(d.hitch(this,function(a){k.resolve(a)}),d.hitch(this,
function(a){console.error(a);k.reject(a)}))}),d.hitch(this,function(a){console.error(a);k.reject(a)})):setTimeout(d.hitch(this,function(){k.reject("token is null.")}),0);return k},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===this.role}}),m=n([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,
portal:null,constructor:function(a){a&&d.mixin(this,a)},_checkCredential:function(){var a=s.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(a){a.q="group:"+this.id+" AND "+a.q;return this.portal.queryItems(a)}}),t=n([],{declaredClass:"jimu.PortalItem",
itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(a){a&&d.mixin(this,a);this.itemUrl=b.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&(this.thumbnail&&this.itemUrl)&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=b.getItemDetailsPageUrl(this.portalUrl,
this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=b.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var a=s.isValidCredential(this.credential);a||(this.credential=null);return a},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getItemData:function(){return this.portal.getItemData(this.id)}}),e={portals:[],
webMapQueryStr:" "+k.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+k.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(a){for(var e=0;e<this.portals.length;e++){var c=this.portals[e];if(b.isSamePortalUrl(a,c.portalUrl))return c.updateCredential(),c}return null},getPortal:function(a){if(!a||!("string"===typeof a&&d.trim(a)))return null;a=b.getStandardPortalUrl(a);var e=this._findPortal(a);e||(e=new q(a),e.credential=s.getPortalCredential(e.portalUrl),e.updateCredential(),
this.portals.push(e));return e},getPortalSelfInfo:function(a){return this.getPortal(a).loadSelfInfo()},getBasemapGalleryGroup:function(a){return this._getPortalSelfGroup(a,"basemapGalleryGroupQuery")},getTemplatesGroup:function(a){return this._getPortalSelfGroup(a,"templatesGroupQuery")},getUnits:function(a){var b="english",e="",m=new c;this.getPortal(a).getUser().then(d.hitch(this,function(a){a&&a.units?b=a.units:(e=h.locale,b=e.startWith("en")?"english":"metric");m.resolve(b)}),d.hitch(this,function(c){console.warn(c);
this.getPortalSelfInfo(a).then(d.hitch(this,function(a){var b=null;a&&a.units?b=a.units:(e=a&&a.culture||h.locale,b=e.startWith("en")?"english":"metric");m.resolve(b)}),d.hitch(this,function(a){console.warn(a);e=h.locale;b=e.startWith("en")?"english":"metric";m.resolve(b)}))}));return m.promise},_getPortalSelfGroup:function(a,b){var e=new c,k=this.getPortal(a);k||setTimeout(d.hitch(this,function(){e.reject()}),0);this.getPortalSelfInfo(a).then(d.hitch(this,function(a){k.queryGroups({f:"json",q:a[b]}).then(d.hitch(this,
function(a){0<a.results.length?(a=a.results[0],a.portalUrl=k.portalUrl,a.credential=k.credential,a.portal=k,a=new m(a),e.resolve(a)):e.reject("Can't find portal self group.")}),d.hitch(this,function(a){console.error(a);e.reject(a)}))}),d.hitch(this,function(a){console.error(a);e.reject(a)}));return e},getWebMapsFromBasemapGalleryGroup:function(a){var b=new c;this.getBasemapGalleryGroup(a).then(d.hitch(this,function(a){a?a.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(d.hitch(this,
function(a){b.resolve(a)}),d.hitch(this,function(a){console.error(a);b.reject(a)})):b.reject()}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b},getDefaultWebScene:function(a){var e=b.getStandardPortalUrl(a);return this._searchWABDefaultWebScene(e).then(d.hitch(this,function(a){return a?a:this._createWABDefaultWebScene(e).then(d.hitch(this,function(a){return this.getPortal(e).getUser().then(d.hitch(this,function(b){var e=!1;b&&(b.privileges&&0<b.privileges.length)&&(e=f.some(b.privileges,
function(a){return 0<=a.indexOf("shareToPublic")}));return e?b.shareItem({everyone:!0},a).then(d.hitch(this,function(){return a}),d.hitch(this,function(){return a})):a}),d.hitch(this,function(b){console.error(b);return a}))}))}))},_searchWABDefaultWebScene:function(a){var e=new c;a=b.getStandardPortalUrl(a);this.getPortal(a).queryItems({q:'typekeywords:"WABDefaultWebScene" access:public '+this.webSceneQueryStr}).then(d.hitch(this,function(a){a&&a.results&&0<a.results.length?e.resolve(a.results[0].id):
e.resolve(null)}),d.hitch(this,function(a){console.error("_searchWABDefaultWebScene error:",a);e.reject(a)}));return e},_createWABDefaultWebScene:function(a){var e=new c;a=b.getStandardPortalUrl(a);this.getPortal(a).getUser().then(d.hitch(this,function(a){var b={title:"Default Web Scene",type:"Web Scene",typeKeywords:"WABDefaultWebScene",tags:"default",text:l.stringify({operationalLayers:[],baseMap:{id:"151b431fe65-basemap-0",title:"Topographic",baseMapLayers:[{id:"defaultBasemap",url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer",
layerType:"ArcGISTiledMapServiceLayer"}],elevationLayers:[{id:"globalElevation",url:"http://elevation3d.arcgis.com/arcgis/rest/services/WorldElevation3D/Terrain3D/ImageServer",layerType:"ArcGISTiledElevationServiceLayer"}]},version:"1.3",authoringApp:"WebSceneViewer",authoringAppVersion:"3.10.0.0",spatialReference:{wkid:102100,latestWkid:3857},viewingMode:"global",initialState:{viewpoint:{scale:4.5188197847224146E7,rotation:0,targetGeometry:{x:144770.99872895706,y:3232837.215000455,spatialReference:{wkid:102100,
latestWkid:3857},z:-127.7412482528016},camera:{position:{x:144770.99767624016,y:3182557.105058348,spatialReference:{wkid:102100,latestWkid:3857},z:2.551254800000001E7},heading:0,tilt:0.0999986601088944}},environment:{lighting:{datetime:1426420488E3,displayUTCOffset:0}}},presentation:{slides:[]}}),snippet:""};a.addItem(b,"").then(d.hitch(this,function(a){a.success?e.resolve(a.id):(console.error("Can't create default web scene:",a),e.reject())}))}),d.hitch(this,function(a){console.error("Can't create default web scene");
e.reject(a)}));return e},getDefaultWebMap:function(a){var b=new c;this.getPortalSelfInfo(a).then(d.hitch(this,function(e){var c=e.defaultBasemap&&e.defaultBasemap.id;c?b.resolve(c):this._getDefaultWebMapByBasemapGallery(a,e).then(d.hitch(this,function(e){e?b.resolve(e):this._getMostNumViewsWebMap(a).then(d.hitch(this,function(a){a?b.resolve(a):b.reject()}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);b.reject(a)}))}),d.hitch(this,function(a){console.error(a);
b.reject(a)}));return b},_getDefaultWebMapByBasemapGallery:function(a,b){var e=new c,m=this.getPortal(a),k=b.defaultBasemap&&b.defaultBasemap.title;m.queryGroups({f:"json",q:b.basemapGalleryGroupQuery}).then(d.hitch(this,function(a){a=a.results;0<a.length?m.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+a[0].id+" AND title:"+k}).then(d.hitch(this,function(a){a=a.results;a=f.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?e.resolve(a[0].id):
(console.log("Can't find web map under basemapGalleryGroupQuery."),m.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+k}).then(d.hitch(this,function(a){a=a.results;a=f.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));if(0<a.length){var b=a[0];m.getItemData(b.id).then(d.hitch(this,function(a){a&&(a.operationalLayers||a.baseMap||a.version)?e.resolve(b.id):e.resolve(null)}),d.hitch(this,function(){e.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),
e.resolve(null)}),d.hitch(this,function(a){console.error(a);e.reject(a)})))}),d.hitch(this,function(a){console.error(a);e.reject(a)})):(console.log("Can't find group by basemapGalleryGroupQuery."),e.resolve(null))}),d.hitch(this,function(a){console.error(a);e.reject(a)}));return e},_getMostNumViewsWebMap:function(a){var b=new c;this.getPortal(a).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(d.hitch(this,
function(a){a=a.results;a=f.filter(a,d.hitch(this,function(a){return a.type&&"web map"===a.type.toLowerCase()}));0<a.length?b.resolve(a[0].id):b.reject("Can't find most-num-views web map.")}),d.hitch(this,function(a){console.error(a);b.reject(a)}));return b}};p.subscribe("userSignOut",function(a){(a=e._findPortal(a))&&a.clearCredentialAndUser()});return e})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),
function(n,d,f,h,c,p,l,a,k){var b=null,s=n(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(a){this.rawAppConfig=a},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var b=h.stringify(this.rawAppConfig.map);this.mapMd5=a(b)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var a=new f,b={};if(k.isInConfigOrPreviewWindow()||
!this.rawAppConfig||!this.rawAppConfig.map)return a.resolve(b),a;var m=this._getAppStateKey(),d=l.get(m);d&&d.appStateMd5===this._getAppStateMd5()?(m=d.map&&d.map.extent,d=d.map&&d.map.layers,m&&(b.extent=new c(m.xmin,m.ymin,m.xmax,m.ymax,new p(m.spatialReference))),d&&(b.layers=d)):l.remove(m);a.resolve(b);return a},saveWabAppState:function(a,b){if(a&&!k.isInConfigOrPreviewWindow()){var c=this._getAppStateKey(),t={extent:{xmin:a.extent.xmin,xmax:a.extent.xmax,ymin:a.extent.ymin,ymax:a.extent.ymax,
spatialReference:{wkid:a.extent.spatialReference.wkid,wkt:a.extent.spatialReference.wkt}},layers:{}};b&&b.traversal&&b.traversal(d.hitch(this,function(a){t.layers[a.id]={visible:a.isVisible()}}));l.set(c,{map:t,appStateMd5:this._getAppStateMd5()})}}});s.getInstance=function(a){null===b&&(b=new s);b.urlParams=a;return b};return s})},"libs/md5/md5":function(){(function(n){function d(a,b){var e=(a&65535)+(b&65535);return(a>>16)+(b>>16)+(e>>16)<<16|e&65535}function f(a,b,e,c,k,q){a=d(d(b,a),d(c,q));return d(a<<
k|a>>>32-k,e)}function h(a,b,e,c,k,d,q){return f(b&e|~b&c,a,b,k,d,q)}function c(a,b,e,c,k,d,q){return f(b&c|e&~c,a,b,k,d,q)}function p(a,b,e,c,k,d,q){return f(e^(b|~c),a,b,k,d,q)}function l(a,b){a[b>>5]|=128<<b%32;a[(b+64>>>9<<4)+14]=b;var e,g,k,q,r,s=1732584193,l=-271733879,v=-1732584194,u=271733878;for(e=0;e<a.length;e+=16)g=s,k=l,q=v,r=u,s=h(s,l,v,u,a[e],7,-680876936),u=h(u,s,l,v,a[e+1],12,-389564586),v=h(v,u,s,l,a[e+2],17,606105819),l=h(l,v,u,s,a[e+3],22,-1044525330),s=h(s,l,v,u,a[e+4],7,-176418897),
u=h(u,s,l,v,a[e+5],12,1200080426),v=h(v,u,s,l,a[e+6],17,-1473231341),l=h(l,v,u,s,a[e+7],22,-45705983),s=h(s,l,v,u,a[e+8],7,1770035416),u=h(u,s,l,v,a[e+9],12,-1958414417),v=h(v,u,s,l,a[e+10],17,-42063),l=h(l,v,u,s,a[e+11],22,-1990404162),s=h(s,l,v,u,a[e+12],7,1804603682),u=h(u,s,l,v,a[e+13],12,-40341101),v=h(v,u,s,l,a[e+14],17,-1502002290),l=h(l,v,u,s,a[e+15],22,1236535329),s=c(s,l,v,u,a[e+1],5,-165796510),u=c(u,s,l,v,a[e+6],9,-1069501632),v=c(v,u,s,l,a[e+11],14,643717713),l=c(l,v,u,s,a[e],20,-373897302),
s=c(s,l,v,u,a[e+5],5,-701558691),u=c(u,s,l,v,a[e+10],9,38016083),v=c(v,u,s,l,a[e+15],14,-660478335),l=c(l,v,u,s,a[e+4],20,-405537848),s=c(s,l,v,u,a[e+9],5,568446438),u=c(u,s,l,v,a[e+14],9,-1019803690),v=c(v,u,s,l,a[e+3],14,-187363961),l=c(l,v,u,s,a[e+8],20,1163531501),s=c(s,l,v,u,a[e+13],5,-1444681467),u=c(u,s,l,v,a[e+2],9,-51403784),v=c(v,u,s,l,a[e+7],14,1735328473),l=c(l,v,u,s,a[e+12],20,-1926607734),s=f(l^v^u,s,l,a[e+5],4,-378558),u=f(s^l^v,u,s,a[e+8],11,-2022574463),v=f(u^s^l,v,u,a[e+11],16,1839030562),
l=f(v^u^s,l,v,a[e+14],23,-35309556),s=f(l^v^u,s,l,a[e+1],4,-1530992060),u=f(s^l^v,u,s,a[e+4],11,1272893353),v=f(u^s^l,v,u,a[e+7],16,-155497632),l=f(v^u^s,l,v,a[e+10],23,-1094730640),s=f(l^v^u,s,l,a[e+13],4,681279174),u=f(s^l^v,u,s,a[e],11,-358537222),v=f(u^s^l,v,u,a[e+3],16,-722521979),l=f(v^u^s,l,v,a[e+6],23,76029189),s=f(l^v^u,s,l,a[e+9],4,-640364487),u=f(s^l^v,u,s,a[e+12],11,-421815835),v=f(u^s^l,v,u,a[e+15],16,530742520),l=f(v^u^s,l,v,a[e+2],23,-995338651),s=p(s,l,v,u,a[e],6,-198630844),u=p(u,
s,l,v,a[e+7],10,1126891415),v=p(v,u,s,l,a[e+14],15,-1416354905),l=p(l,v,u,s,a[e+5],21,-57434055),s=p(s,l,v,u,a[e+12],6,1700485571),u=p(u,s,l,v,a[e+3],10,-1894986606),v=p(v,u,s,l,a[e+10],15,-1051523),l=p(l,v,u,s,a[e+1],21,-2054922799),s=p(s,l,v,u,a[e+8],6,1873313359),u=p(u,s,l,v,a[e+15],10,-30611744),v=p(v,u,s,l,a[e+6],15,-1560198380),l=p(l,v,u,s,a[e+13],21,1309151649),s=p(s,l,v,u,a[e+4],6,-145523070),u=p(u,s,l,v,a[e+11],10,-1120210379),v=p(v,u,s,l,a[e+2],15,718787259),l=p(l,v,u,s,a[e+9],21,-343485551),
s=d(s,g),l=d(l,k),v=d(v,q),u=d(u,r);return[s,l,v,u]}function a(a){var b,e="";for(b=0;b<32*a.length;b+=8)e+=String.fromCharCode(a[b>>5]>>>b%32&255);return e}function k(a){var b,e=[];e[(a.length>>2)-1]=void 0;for(b=0;b<e.length;b+=1)e[b]=0;for(b=0;b<8*a.length;b+=8)e[b>>5]|=(a.charCodeAt(b/8)&255)<<b%32;return e}function b(b){return a(l(k(b),8*b.length))}function s(b,c){var e,g=k(b),d=[],q=[];d[15]=q[15]=void 0;16<g.length&&(g=l(g,8*b.length));for(e=0;16>e;e+=1)d[e]=g[e]^909522486,q[e]=g[e]^1549556828;
e=l(d.concat(k(c)),512+8*c.length);return a(l(q.concat(e),640))}function q(a){var b="",e,c;for(c=0;c<a.length;c+=1)e=a.charCodeAt(c),b+="0123456789abcdef".charAt(e>>>4&15)+"0123456789abcdef".charAt(e&15);return b}function r(a,c,e){return!c?!e?q(b(unescape(encodeURIComponent(a)))):b(unescape(encodeURIComponent(a))):!e?q(s(unescape(encodeURIComponent(c)),unescape(encodeURIComponent(a)))):s(unescape(encodeURIComponent(c)),unescape(encodeURIComponent(a)))}"function"===typeof define&&define.amd?define(function(){return r}):
n.md5=r})(this)},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(n,d,f,h){return n(d,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);(this.hidden=!0===this.hidden)&&f.set(this.domNode,{display:"none"});f.set(this.domNode,{width:"100%",height:"100%"});var c='\x3cdiv class\x3d"loading-section"\x3e\x3cimg class\x3d"jimu-loading" src\x3d"'+
require.toUrl("jimu")+'/images/loading2.gif"\x3e\x3c/div\x3e';h.place(c,this.domNode)},show:function(){this.domNode&&f.set(this.domNode,"display","block")},hide:function(){this.domNode&&f.set(this.domNode,"display","none")}})})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/dom-construct dojo/dom-geometry dojo/Deferred dojo/promise/all dojo/when require ./WidgetManager ./PanelManager ./MapManager ./utils ./OnScreenWidgetIcon ./WidgetPlaceholder ./dijit/LoadingShelter".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x){var z=null,D;D=n([c],{constructor:function(a,b){this.widgetManager=m.getInstance();this.panelManager=t.getInstance();this.own(p.subscribe("appConfigLoaded",d.hitch(this,this.onAppConfigLoaded)));this.own(p.subscribe("appConfigChanged",d.hitch(this,this.onAppConfigChanged)));this.own(p.subscribe("mapLoaded",d.hitch(this,this.onMapLoaded)));this.own(p.subscribe("mapChanged",d.hitch(this,this.onMapChanged)));this.own(p.subscribe("beforeMapDestory",d.hitch(this,
this.onBeforeMapDestory)));this.own(p.subscribe("builder/actionTriggered",d.hitch(this,this.onActionTriggered)));this.own(p.subscribe("openWidget",d.hitch(this,this._onOpenWidgetRequest)));this.widgetPlaceholders=[];this.preloadWidgetIcons=[];this.preloadGroupPanels=[];this.invisibleWidgetIds=[];this.own(l(window,"resize",d.hitch(this,this.resize)));this.id=b},postCreate:function(){this.containerNode=this.domNode},map:null,mapId:"map",hlDiv:null,animTime:500,resize:function(){f.forEach(this.widgetManager.getAllWidgets(),
function(a){!1===a.inPanel&&a.resize()},this)},onAppConfigLoaded:function(a){this.appConfig=d.clone(a);this.appConfig.theme&&this._loadTheme(this.appConfig.theme);this._loadMap()},onAppConfigChanged:function(a,b,e){a=d.clone(a);switch(b){case "themeChange":this._onThemeChange(a);break;case "styleChange":this._onStyleChange(a);break;case "layoutChange":this._onLayoutChange(a);break;case "widgetChange":this._onWidgetChange(a,e);break;case "groupChange":this._onGroupChange(a,e);break;case "widgetPoolChange":this._onWidgetPoolChange(a,
e);break;case "resetConfig":this._onResetConfig(a);break;case "loadingPageChange":this._onLoadingPageChange(a,e)}this.appConfig=a},onMapLoaded:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onMapChanged:function(a){this.map=a;this.panelManager.setMap(a);this._loadPreloadWidgets(this.appConfig)},onBeforeMapDestory:function(){this.panelManager.destroyAllPanels();this._destroyOffPanelWidgets();this._destroyWidgetPlaceholders();this._destroyPreloadWidgetIcons()},
onActionTriggered:function(a){"highLight"===a.action&&(f.forEach(this.widgetPlaceholders,function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.preloadWidgetIcons,function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){b.configId===a.elementId&&this._highLight(b)},this),f.forEach(this.preloadGroupPanels,function(b){b.configId===a.elementId&&this._highLight(b)},this));"removeHighLight"===a.action&&
this._removeHighLight();"showLoading"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","block"),h.setStyle(jimuConfig.mainPageId,"display","none"));"showApp"===a.action&&(h.setStyle(jimuConfig.loadingId,"display","none"),h.setStyle(jimuConfig.mainPageId,"display","block"))},_highLight:function(b){if(b.domNode){this.hlDiv&&this._removeHighLight(b);var e=k.getMarginBox(b.domNode);this.hlDiv=a.create("div",{style:{position:"absolute",left:e.l+"px",top:e.t+"px",width:e.w+"px",height:e.h+"px"},"class":"icon-highlight"},
b.domNode,"before")}},_removeHighLight:function(){this.hlDiv&&(a.destroy(this.hlDiv),this.hlDiv=null)},_onWidgetChange:function(a,b){b=a.getConfigElementById(b.id);b.isController?this._reloadControllerWidget(a,b.id):(f.forEach(this.widgetPlaceholders,function(e){e.configId===b.id&&(e.destroy(),this._loadPreloadWidget(b,a))},this),this._removeDestroyed(this.widgetPlaceholders),f.forEach(this.preloadWidgetIcons,function(e){if(e.configId===b.id){var c=e.state;e.destroy();this._loadPreloadWidget(b,a).then(function(a){if(b.uri&&
"opened"===c)a.onClick()})}},this),this._removeDestroyed(this.preloadWidgetIcons),f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(e){e.configId===b.id&&(e.destroy(),!1===b.visible?0>this.invisibleWidgetIds.indexOf(b.id)&&this.invisibleWidgetIds.push(b.id):this._loadPreloadWidget(b,a))},this),f.forEach(this.preloadGroupPanels,function(a){a.reloadWidget(b)},this),this._updatePlaceholder(a),f.forEach(this.invisibleWidgetIds,function(e){e===b.id&&!1!==b.visible&&(this._loadPreloadWidget(b,
a),e=this.invisibleWidgetIds.indexOf(b.id),this.invisibleWidgetIds.splice(e,1))},this),b.isOnScreen||f.forEach(this.widgetManager.getControllerWidgets(),function(e){e.widgetIsControlled(b.id)&&this._reloadControllerWidget(a,e.id)},this))},_onGroupChange:function(a,b){b=a.getConfigElementById(b.id);b.isOnScreen?(this.panelManager.destroyPanel(b.id+"_panel"),this._removeDestroyed(this.preloadGroupPanels),this._loadPreloadGroup(b,a)):(f.forEach(this.widgetManager.getControllerWidgets(),function(e){e.isControlled(b.id)&&
this._reloadControllerWidget(a,e.id)},this),f.forEach(this.panelManager.panels,function(a){a.config.id===b.id&&a.updateConfig(b)},this))},_updatePlaceholder:function(a){f.forEach(this.widgetPlaceholders,function(b){b.setIndex(a.getConfigElementById(b.configId).placeholderIndex)},this)},_onWidgetPoolChange:function(a,b){this._reloadControllerWidget(a,b.controllerId)},_reloadControllerWidget:function(a,b){var e=this.widgetManager.getWidgetById(b);if(e){var c=e.getOpenedIds(),g=e.windowState;f.forEach(e.getAllConfigs(),
function(a){if(a.widgets)this.panelManager.destroyPanel(a.id+"_panel"),f.forEach(a.widgets,function(a){this.panelManager.destroyPanel(a.id+"_panel")},this);else{var b=this.widgetManager.getWidgetById(a.id);b&&(a.inPanel?this.panelManager.destroyPanel(b.getPanel()):this.widgetManager.destroyWidget(b))}},this);this.widgetManager.destroyWidget(e);e=a.getConfigElementById(b);!1!==e.visible&&this._loadPreloadWidget(e,a).then(d.hitch(this,function(a){this.widgetManager.changeWindowStateTo(a,g);c&&a.setOpenedIds(c)}))}},
_removeDestroyed:function(a){var b=[];f.forEach(a,function(a){a._destroyed&&b.push(a)});f.forEach(b,function(b){b=a.indexOf(b);a.splice(b,1)})},_destroyPreloadWidgetIcons:function(){f.forEach(this.preloadWidgetIcons,function(a){a.destroy()},this);this.preloadWidgetIcons=[]},_destroyOffPanelWidgets:function(){f.forEach(this.widgetManager.getOffPanelWidgets(),function(a){this.widgetManager.destroyWidget(a)},this)},_destroyWidgetPlaceholders:function(){f.forEach(this.widgetPlaceholders,function(a){a.destroy()},
this);this.widgetPlaceholders=[]},_destroyPreloadGroupPanels:function(){f.forEach(this.preloadGroupPanels,function(a){this.panelManager.destroyPanel(a)},this);this.preloadGroupPanels=[]},_changeMapPosition:function(a){this.map&&(g.isEqual(this.mapManager.getMapPosition(),a.map.position)||this.mapManager.setMapPosition(a.map.position))},_onThemeChange:function(a){this._destroyPreloadWidgetIcons();this._destroyWidgetPlaceholders();this._destroyOffPanelWidgets();this._destroyPreloadGroupPanels();this.panelManager.destroyAllPanels();
this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);r(["themes/"+a.theme.name+"/main"],d.hitch(this,function(){this._loadThemeCommonStyle(a.theme);this._loadThemeCurrentStyle(a.theme);this._changeMapPosition(a);this._loadPreloadWidgets(a)}))},_onResetConfig:function(a){p.publish("appConfigChanged",a,"mapChange",a);this._updateCommonStyle(a);this._onStyleChange(a);this._changeMapPosition(a)},_onLoadingPageChange:function(a,b){if("backgroundColor"in
b)h.setStyle(jimuConfig.loadingId,"background-color",a.loadingPage.backgroundColor);else if("backgroundImage"in b){var e=a.loadingPage.backgroundImage;e.visible&&e.uri?(h.setStyle(jimuConfig.loadingImageId,"background-image","url('"+e.uri+"')"),h.setStyle(jimuConfig.loadingImageId,"width",e.width+"px"),h.setStyle(jimuConfig.loadingImageId,"height",e.height+"px")):(h.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),h.setStyle(jimuConfig.loadingImageId,"width","0px"),h.setStyle(jimuConfig.loadingImageId,
"height","0px"))}else"loadingGif"in b&&(e=a.loadingPage.loadingGif,e.visible&&e.uri?(h.setStyle(jimuConfig.loadingGifId,"background-image","url('"+e.uri+"')"),h.setStyle(jimuConfig.loadingGifId,"width",e.width+"px"),h.setStyle(jimuConfig.loadingGifId,"height",e.height+"px")):(h.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),h.setStyle(jimuConfig.loadingGifId,"width","0px"),h.setStyle(jimuConfig.loadingGifId,"height","0px")))},_updateCommonStyle:function(a){this._removeThemeCommonStyle(this.appConfig.theme);
this._loadThemeCommonStyle(a.theme)},_onStyleChange:function(a){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(a.theme)},_onLayoutChange:function(a){this._changeMapPosition(a);f.forEach(this.widgetPlaceholders,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);f.forEach(this.preloadWidgetIcons,function(b){b.moveTo(a.getConfigElementById(b.configId).position)},this);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(b){if(!b.closeable){var e=
a.getConfigElementById(b.id).position;b.setPosition(e)}},this);f.forEach(this.preloadGroupPanels,function(b){var e=a.getConfigElementById(b.config.id).panel.position;b.setPosition(e)},this)},_loadTheme:function(a){r(["themes/"+a.name+"/main"],d.hitch(this,function(){this._loadThemeCommonStyle(a);this._loadThemeCurrentStyle(a)}))},_loadThemeCommonStyle:function(a){g.loadStyleLink(this._getThemeCommonStyleId(a),"themes/"+a.name+"/common.css");h.addClass(this.domNode,a.name)},_removeThemeCommonStyle:function(a){h.removeClass(this.domNode,
a.name);h.destroy(this._getThemeCommonStyleId(a))},_loadThemeCurrentStyle:function(a){g.loadStyleLink(this._getThemeCurrentStyleId(a),"themes/"+a.name+"/styles/"+a.styles[0]+"/style.css");h.addClass(this.domNode,a.styles[0])},_removeThemeCurrentStyle:function(a){h.removeClass(this.domNode,a.styles[0]);h.destroy(this._getThemeCurrentStyleId(a))},_getThemeCommonStyleId:function(a){return"theme_"+a.name+"_style_common"},_getThemeCurrentStyleId:function(a){return"theme_"+a.name+"_style_"+a.styles[0]},
_loadMap:function(){h.create("div",{id:this.mapId,style:d.mixin({position:"absolute",backgroundColor:"#EEEEEE",overflow:"hidden",minWidth:"1px",minHeight:"1px"})},this.id);this.mapManager=e.getInstance({appConfig:this.appConfig,urlParams:this.urlParams},this.mapId);this.mapManager.setMapPosition(this.appConfig.map.position);this.mapManager.showMap()},_createPreloadWidgetPlaceHolder:function(a){var b;b="map"===a.position.relativeTo?this.mapId:this.id;var e=d.clone(a);e.position.width=40;e.position.height=
40;var c=g.getPositionStyle(e.position);a=new w({index:e.placeholderIndex,configId:a.id});h.setStyle(a.domNode,c);h.place(a.domNode,b);this.widgetPlaceholders.push(a);return a},_createPreloadWidgetIcon:function(a){var b=new y({panelManager:this.panelManager,widgetManager:this.widgetManager,widgetConfig:a,configId:a.id,map:this.map});"map"===a.position.relativeTo?h.place(b.domNode,this.mapId):h.place(b.domNode,this.id);h.setStyle(b.domNode,g.getPositionStyle({top:a.position.top,left:a.position.left,
right:a.position.right,bottom:a.position.bottom,width:40,height:40}));b.startup();!this.openAtStartWidget&&a.openAtStart&&(b.switchToOpen(),this.openAtStartWidget=a.name);this.preloadWidgetIcons.push(b);return b},_loadPreloadWidgets:function(a){console.time("Load widgetOnScreen");var b=new x,e=[];b.placeAt(this.id);b.startup();f.forEach(a.widgetOnScreen.widgets,function(b){!1===b.visible?this.invisibleWidgetIds.push(b.id):e.push(this._loadPreloadWidget(b,a))},this);f.forEach(a.widgetOnScreen.groups,
function(b){e.push(this._loadPreloadGroup(b,a))},this);s(e).then(d.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");p.publish("preloadWidgetsLoaded");this._doPostLoad()}),d.hitch(this,function(){b&&(b.destroy(),b=null);console.timeEnd("Load widgetOnScreen");p.publish("preloadWidgetsLoaded");this._doPostLoad()}))},_doPostLoad:function(){r(["dynamic-modules/postload"])},_loadPreloadWidget:function(a,e){var c=new b;if("config"===e.mode&&!a.uri){var g=this._createPreloadWidgetPlaceHolder(a);
c.resolve(g);return c}if(!a.uri)return c.resolve(null),c;a.inPanel||a.closeable?(g=this._createPreloadWidgetIcon(a),c.resolve(g)):this.widgetManager.loadWidget(a).then(d.hitch(this,function(b){try{b.setPosition(b.position),this.widgetManager.openWidget(b)}catch(e){console.log(console.error("fail to startup widget "+b.name+". "+e.stack))}b.configId=a.id;c.resolve(b)}),function(a){c.reject(a)});return c},_loadPreloadGroup:function(a,b){return!b.mode&&(!a.widgets||0===a.widgets.length)?q(null):this.panelManager.showPanel(a).then(d.hitch(this,
function(b){b.configId=a.id;this.preloadGroupPanels.push(b);return b}))},_onOpenWidgetRequest:function(a){f.forEach(this.preloadWidgetIcons,function(b){b.configId===a&&b.switchToOpen()},this);f.forEach(this.widgetManager.getControllerWidgets(),function(b){b.widgetIsControlled(a)&&b.setOpenedIds([a])},this)}});D.getInstance=function(a,b){null===z&&(z=new D(a,b),window._layoutManager=z);return z};return D})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r){var m,t=null;m=n(null,{constructor:function(){this.panels=[];this.widgetManager=r.getInstance();a(window,"resize",d.hitch(this,this.onWindowResize));this.activePanel=null;k.subscribe("/dnd/move/start",d.hitch(this,this._onMoveStart));k.subscribe("widgetActived",d.hitch(this,this._onWidgetActived))},showPanel:function(b){var c=new p,k=this.getPanelById(b.id+"_panel");k?("closed"===k.state&&this.openPanel(k),c.resolve(k)):l({Panel:this._loadPanelClass(b.panel.uri),
nls:this._loadThemeI18N(b.panel.uri)}).then(d.hitch(this,function(k){var m=b.id+"_panel",r=this.getPanelById(m),s={label:b.label,config:b,uri:b.panel.uri,position:b.panel.position,map:this.map,widgetManager:this.widgetManager,panelManager:this,id:m,gid:b.gid,nls:k.nls};d.mixin(s,b.panel.options);try{r=new k.Panel(s),console.log("panel ["+m+"] created.")}catch(l){console.log("create panel error: "+l+", panelId: "+m);c.reject(l);return}r.setPosition(b.panel.position);q.setVerticalCenter(r.domNode);
this.openPanel(r);this.panels.push(r);a(r.domNode,"click",d.hitch(this,this._onPanelClick,r));c.resolve(r)}));return c},setMap:function(b){this.map=b;a(this.map,"resize",d.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;for(var b=0;b<this.panels.length;b++)this.panels[b].gid===a.gid&&this.panels[b].id!==a.id&&this.closePanel(this.panels[b])},closeAllPanelsInGroup:function(a){for(var b=0;b<this.panels.length;b++)this.panels[b].gid===
a&&this.closePanel(this.panels[b])},openPanel:function(a){var b=new p;if("string"===typeof a&&(a=this.getPanelById(a),!a))return b.reject(),b;if(!a.started)try{a.started=!0,a.startup()}catch(c){console.error("fail to startup panel "+a.id+". "+c.stack)}if("opened"===a.state)return b.resolve(a),b;a.setState("opened");return this.playOpenPanelAnimation(a).then(d.hitch(this,function(){h.setStyle(a.domNode,"display","");a.onOpen();this._activePanel(a);return a}))},closePanel:function(a){var b=new p;return"string"===
typeof a&&(a=this.getPanelById(a),!a)||"closed"===a.state?(b.resolve(),b):this.playClosePanelAnimation(a).then(function(){this.activePanel&&this.activePanel.id===a.id&&(this.activePanel.onDeActive(),this.activePanel=null);a.setState("closed");a.onClose();a.domNode&&h.setStyle(a.domNode,"display","none")})},minimizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("minimized");try{a.onMinimize()}catch(b){console.log(console.error("fail to minimize panel "+
a.id+". "+b.stack))}},maximizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("maximized");try{a.onMaximize()}catch(b){console.log(console.error("fail to maximize panel "+a.id+". "+b.stack))}},normalizePanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"closed"===a.state&&this.openPanel(a);a.setWindowState("normal");try{a.onNormalize()}catch(b){console.log(console.error("fail to noralize panel "+
a.id+". "+b.stack))}},changeWindowStateTo:function(a,b){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;"normal"===b?this.normalizePanel(a):"minimized"===b?this.minimizePanel(a):"maximized"===b?this.maximizePanel(a):console.log("error state: "+b)},getPanelById:function(a){for(var b=0;b<this.panels.length;b++)if(this.panels[b].id===a)return this.panels[b]},onWindowResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"!==this.panels[a].position.relativeTo&&
this.panels[a].resize()},onMapResize:function(){for(var a=0;a<this.panels.length;a++)"closed"!==this.panels[a].state&&"map"===this.panels[a].position.relativeTo&&this.panels[a].resize()},destroyPanel:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return;if(a.domNode){"closed"!==a.state&&this.closePanel(a);this._removePanel(a);try{a.destroy()}catch(b){console.log(console.error("fail to destroy panel "+a.id+". "+b.stack))}}},destroyAllPanels:function(){var a=f.map(this.panels,function(a){return a.id});
f.forEach(a,function(a){this.destroyPanel(a)},this);this.panels=[]},playOpenPanelAnimation:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a)||!a.openAnimation||0===a.animationDuration)return b();var g=new p;"string"===typeof a.openAnimation?"fadeIn"===a.openAnimation?(h.setStyle(a.domNode,{opacity:0,display:""}),c.fadeIn({node:a.domNode,duration:a.animationDuration,onEnd:function(){g.resolve()}}).play()):g.resolve():g.resolve();return g},playClosePanelAnimation:function(a){if("string"===
typeof a&&(a=this.getPanelById(a),!a)||!a.closeAnimation||0===a.animationDuration)return b();var g=new p;"string"===typeof a.closeAnimation&&("fadeOut"===a.closeAnimation?c.fadeOut({node:a.domNode,duration:a.animationDuration,onEnd:function(){g.resolve()}}).play():g.resolve());return g},getPositionOnMobile:function(a){if("string"===typeof a&&(a=this.getPanelById(a),!a))return{};var b=h.getMarginBox(window.jimuConfig.layoutId),c=b.h/2;a.titleHeight||(a.titleHeight=35);return"maximized"===a.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:b.h-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===a.windowState?b.h>b.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:a.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:b.w-b.w/2,right:0,top:"auto",bottom:0,width:b.w/
2,height:a.titleHeight,contentHeight:b.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:b.h>b.w?{left:0,right:0,top:c,bottom:0,width:"auto",height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:b.w-b.w/2,right:0,top:0,bottom:0,width:b.w/2,height:"auto",contentHeight:b.h-c-a.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(a){this._activePanel(a)},_activePanel:function(a){if(this.activePanel){if(this.activePanel.id===a.id){this.activePanel.moveTopOnActive&&
h.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var b=this.widgetManager.activeWidget;b&&("active"===b.state&&b.getPanel()!==a)&&(b.setState("opened"),!1===b.inPanel&&h.setStyle(b.domNode,"zIndex","undefined"!==typeof b.position.zIndex?b.position.zIndex:
"auto"),b.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=a;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&h.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(a){var b=this.panels.indexOf(a);-1<b&&this.panels.splice(b,1);this.activePanel&&this.activePanel.id===a.id&&(this.activePanel=null)},_onMoveStart:function(a){f.forEach(this.panels,function(b){b.domNode===a.node&&this._activePanel(b)},
this)},_onWidgetActived:function(a){this.activePanel&&("active"===this.activePanel.state&&a.getPanel()!==this.activePanel)&&(this.activePanel.setState("opened"),h.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(a){var b=new p;s([a],function(a){b.resolve(a)});return b},_loadThemeI18N:function(a){var b=new p;a.startWith("themes")?(a=
a.split("/"),s(["dojo/i18n!"+(a[0]+"/"+a[1]+"/nls/strings")],function(a){b.resolve(a)})):b.resolve({});return b}});m.getInstance=function(){null===t&&(t=new m,window._panelManager=t);return t};return m})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/aspect dojo/keys esri/dijit/InfoWindow esri/dijit/PopupMobile esri/InfoTemplate esri/request esri/geometry/Extent esri/geometry/Point require ./utils ./dijit/LoadingShelter jimu/LayerInfos/LayerInfos jimu/dijit/AppStatePopup ./MapUrlParamsHandler ./AppStateManager ./PopupManager".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D){var v=null,u=n(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(a,b){this.appConfig=a.appConfig;this.urlParams=a.urlParams;this.id=this.mapDivId=b;this.appStateManager=z.getInstance(this.urlParams);this.popupManager=D.getInstance(this);this.nls=window.jimuNls;c.subscribe("appConfigChanged",d.hitch(this,this.onAppConfigChanged));c.subscribe("changeMapPosition",
d.hitch(this,this.onChangeMapPosition));c.subscribe("syncExtent",d.hitch(this,this.onSyncExtent));p(window,"resize",d.hitch(this,this.onWindowResize));p(window,"beforeunload",d.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(a){console.time("Load Map");this.loading=new g;this.loading.placeAt(this.mapDivId);this.loading.startup();a.map["3D"]?a.map.itemId?this._show3DWebScene(a):this._show3DLayersMap(a):a.map.itemId?this._show2DWebMap(a):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appConfig.keepAppState&&this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(a){a&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this._mapMobileInfoWindow=new b(null,h.create("div",
null,null,this.map.root)),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapMobileInfoWindow),this.isMobileInfoWindow=!0):!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.map.infoWindow.hide(),this.map.setInfoWindow(this._mapInfoWindow),this.isMobileInfoWindow=!1)},onChangeMapPosition:function(a){var b=d.clone(this.mapPosition);d.mixin(b,a);this.setMapPosition(b)},setMapPosition:function(a){this.mapPosition=
a;a=e.getPositionStyle(a);h.setStyle(this.mapDivId,a);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncExtent:function(a){this.map&&(a=new r(a.extent),this.map.setExtent(a))},_visitConfigMapLayers:function(a,b){f.forEach(a.map.basemaps,function(a,e){a.isOperationalLayer=!1;b(a,e)},this);f.forEach(a.map.operationallayers,function(a,e){a.isOperationalLayer=!0;b(a,e)},this)},_show3DLayersMap:function(a){t(["esri3d/Map"],d.hitch(this,function(b){var e;
e=new b(this.mapDivId,{camera:a.map.mapOptions.camera});this._visitConfigMapLayers(a,d.hitch(this,function(a){this.createLayer(e,"3D",a)}));e.usePlugin=b.usePlugin;this._publishMapEvent(e)}))},_show3DWebScene:function(a){this._getWebsceneData(a.map.itemId).then(d.hitch(this,function(b){t(["esri3d/Map"],d.hitch(this,function(e){var c=new e(this.mapDivId,a.map.mapOptions);f.forEach(b.itemData.operationalLayers,function(a){this.createLayer(c,"3D",a)},this);f.forEach(b.itemData.baseMap.baseMapLayers,
function(a){a.type="tile";this.createLayer(c,"3D",a)},this);f.forEach(b.itemData.baseMap.elevationLayers,function(a){a.type="elevation";this.createLayer(c,"3D",a)},this);c.toc=b.itemData.toc;c.bookmarks=b.itemData.bookmarks;c.tours=b.itemData.tours}))}))},_publishMapEvent:function(a){window._viewerMap=a;x.postProcessUrlParams(this.urlParams,a);console.timeEnd("Load Map");this.map?(this.map=a,this.resetInfoWindow(!0),console.log("map changed."),c.publish("mapChanged",this.map)):(this.map=a,this.resetInfoWindow(!0),
c.publish("mapLoaded",this.map))},_getWebsceneData:function(a){return q({url:"http://184.169.133.166/sharing/rest/content/items/"+a+"/data",handleAs:"json"})},_show2DWebMap:function(b){b.map.mapOptions||(b.map.mapOptions={});var g=this._processMapOptions(b.map.mapOptions)||{};g.isZoomSlider=!1;e.createWebMap(b.map.portalUrl,b.map.itemId,this.mapDivId,{mapOptions:g,bingMapsKey:b.bingMapsKey,usePopupManager:!0}).then(d.hitch(this,function(e){var c=e.map;c.hideZoomSlider();c.infoWindow.resize(270,316);
c.itemId=b.map.itemId;c.itemInfo=e.itemInfo;c.webMapResponse=e;c.enableSnapping({snapKey:a.copyKey});h.setStyle(c.root,"zIndex",0);c._initialExtent=c.extent;this._publishMapEvent(c);setTimeout(d.hitch(this,this._checkAppState),500);this.loading.hide();this._addDataLoadingOnMapUpdate(c)}),d.hitch(this,function(){this._destroyLoadingShelter();c.publish("mapCreatedFailed")}))},_addDataLoadingOnMapUpdate:function(a){var b=h.toDom('\x3cdiv class\x3d"load-container"\x3e\x3cdiv class\x3d"loader"\x3eLoading...\x3c/div\x3e\x3c/div\x3e');
h.place(b,a.root);p(a,"update-start",d.hitch(this,function(){h.setStyle(b,"display","")}));p(a,"update-end",d.hitch(this,function(){h.setStyle(b,"display","none")}));p(a,"unload",d.hitch(this,function(){h.destroy(b);b=null;this._destroyLoadingShelter()}))},_destroyLoadingShelter:function(){this.loading&&(this.loading.destroy(),this.loading=null)},_checkAppState:function(){var a="extent center marker find query scale level".split(" "),b=this.appConfig.keepAppState;b&&f.forEach(a,function(a){a in this.urlParams&&
(b=!1)},this);b&&this.appStateManager.getWabAppState().then(d.hitch(this,function(a){y.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(b){this.layerInfosObj=b;if(a.extent||a.layers)b=new w({nls:{title:this.nls.appState.title,restoreMap:this.nls.appState.restoreMap}}),b.placeAt("main-page"),p(b,"applyAppState",d.hitch(this,function(){this._applyAppState(a,this.map)})),b.startup(),b.show()}))}))},_applyAppState:function(a,b){this.layerInfosObj.restoreState({layerOptions:a.layers||
null});a.extent&&b.setExtent(a.extent);this._publishMapEvent(b)},_processMapOptions:function(a){if(a)return a.lods||delete a.lods,a.lods&&0===a.lods.length&&delete a.lods,a=d.clone(a),a.extent&&(a.extent=new r(a.extent)),a.center&&!d.isArrayLike(a.center)&&(a.center=new m(a.center)),a.infoWindow&&(a.infoWindow=new k(a.infoWindow,h.create("div",{},this.mapDivId))),a},createLayer:function(a,b,e){t([{"2D_tiled":"esri/layers/ArcGISTiledMapServiceLayer","2D_dynamic":"esri/layers/ArcGISDynamicMapServiceLayer",
"2D_image":"esri/layers/ArcGISImageServiceLayer","2D_feature":"esri/layers/FeatureLayer","2D_rss":"esri/layers/GeoRSSLayer","2D_kml":"esri/layers/KMLLayer","2D_webTiled":"esri/layers/WebTiledLayer","2D_wms":"esri/layers/WMSLayer","2D_wmts":"esri/layers/WMTSLayer","3D_tiled":"esri3d/layers/ArcGISTiledMapServiceLayer","3D_dynamic":"esri3d/layers/ArcGISDynamicMapServiceLayer","3D_image":"esri3d/layers/ArcGISImageServiceLayer","3D_feature":"esri3d/layers/FeatureLayer","3D_elevation":"esri3d/layers/ArcGISElevationServiceLayer",
"3D_3dmodle":"esri3d/layers/SceneLayer"}[b+"_"+e.type]],d.hitch(this,function(b){var c,g={};c="label url type icon infoTemplate isOperationalLayer".split(" ");for(var k in e)0>c.indexOf(k)&&(g[k]=e[k]);e.infoTemplate?(c=new s(e.infoTemplate.title,e.infoTemplate.content),g.infoTemplate=c,b=new b(e.url,g),e.infoTemplate.width&&e.infoTemplate.height&&l.after(b,"onClick",d.hitch(this,function(){a.infoWindow.resize(e.infoTemplate.width,e.infoTemplate.height)}),!0)):b=new b(e.url,g);b.isOperationalLayer=
e.isOperationalLayer;b.label=e.label;b.icon=e.icon;a.addLayer(b)}))},onAppConfigChanged:function(a,b,e){this.appConfig=a;"mapChange"===b?this._recreateMap(a):"mapOptionsChange"===b&&e.lods&&this._recreateMap(a)},_recreateMap:function(a){this.map&&(c.publish("beforeMapDestory",this.map),this.map.destroy());this._showMap(a)},disableWebMapPopup:function(){this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map.setInfoWindowOnClick(!0)}});u.getInstance=function(a,b){null===v&&(v=new u(a,
b));return v};return u})},"esri/dijit/InfoWindow":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/sniff dojo/dom-class dojo/dom-construct dojo/dom-style dijit/_Widget dijit/_Templated dijit/_Container ../kernel ../domUtils ../InfoWindowBase ./_EventedWidget dojo/text!./templates/InfoWindow.html".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w){var x=n([y,q,r,m,g],{declaredClass:"esri.dijit.InfoWindow",isContainer:!0,
templateString:w,anchor:"upperright",fixedAnchor:null,coords:null,isShowing:!0,isContentShowing:!0,isTitleBarShowing:!0,width:250,height:150,title:"Info Window",setMap:function(a){this.inherited(arguments);b.place(this.domNode,a.root)},startup:function(){if(!this._started){this.inherited(arguments);this._ANCHORS=[x.ANCHOR_UPPERRIGHT,x.ANCHOR_LOWERRIGHT,x.ANCHOR_LOWERLEFT,x.ANCHOR_UPPERLEFT];if(7>p("ie")){var a="progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled\x3d'true', sizingMethod\x3d'crop', src\x3d'"+
s.getComputedStyle(this._sprite).backgroundImage.replace(/url\(\"/i,"").replace(/\"\)/,"")+"')",e=b.create("div",null,h.body());s.set(e,{width:"1px",height:"1px",display:"none",backgroundImage:"none",filter:a});var g=setTimeout(function(){b.destroy(e);clearTimeout(g);g=e=null},100);c.query(".sprite",this.domNode).forEach(function(b){b.style.backgroundImage="none";b.style.filter=a})}this.resize(this.width,this.height);this.hide()}},destroy:function(){this._destroyed||(this.__unregisterMapListeners(),
this.destroyDijits(this._title),this.destroyDijits(this._content),this._title.innerHTML=this._content.innerHTML="",this.inherited(arguments))},resize:function(a,b){if(a&&b){var e=s.set;e(this._topleft,{height:b+"px",marginLeft:a+"px"});e(this._topright,{width:a+"px",height:b+"px"});e(this._user,"width",a-8+"px");e(this._hide,"marginLeft",a-22+"px");e(this._title,"width",a-25+"px");e(this._content,"height",b-37+"px");e(this._bottomleft,{marginLeft:a+"px",marginTop:b+"px"});e(this._bottomright,{width:a-
5+"px",marginTop:b+"px"});this.width=a;this.height=b;this.coords&&this._adjustPosition(this.coords,this.anchor);this.onResize(a,b)}},_adjustPosition:function(a,b){var e=s.set;e(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"});b===x.ANCHOR_UPPERLEFT?e(this._window,{left:null,right:this.width+18+"px",top:null,bottom:this.height+50+"px"}):b===x.ANCHOR_UPPERRIGHT?e(this._window,{left:"6px",right:null,top:null,bottom:this.height+50+"px"}):b===x.ANCHOR_LOWERRIGHT?e(this._window,{left:"6px",
right:null,top:"43px",bottom:null}):b===x.ANCHOR_LOWERLEFT&&e(this._window,{left:null,right:this.width+18+"px",top:"43px",bottom:null})},_getAnchor:function(a){var b=this.map;return b&&a?(a.y<b.height/2?"lower":"upper")+(a.x<b.width/2?"right":"left"):"upperright"},show:function(a,b,c){if(a){a.spatialReference?(this.mapCoords=a,a=this.coords=this.map.toScreen(a,!0)):(this.mapCoords=null,this.coords=a);var g=this.map._getFrameWidth();if(-1!==g&&(a.x%=g,0>a.x&&(a.x+=g),this.map.width>g))for(var m=(this.map.width-
g)/2;a.x<m;)a.x+=g;if(!b||-1===f.indexOf(this._ANCHORS,b))b=this._getAnchor(a);k.remove(this._pointer,this.anchor);b=this.anchor=this.fixedAnchor||b;this._adjustPosition(a,b);k.add(this._pointer,b);e.show(this.domNode);this.isShowing=!0;if(!c)this.onShow()}},hide:function(a,b){e.hide(this.domNode);this.isShowing=!1;if(!b)this.onHide()},showTitleBar:function(){e.show(this._titlebar);e.show(this._border);this.isTitleBarShowing=!0},hideTitleBar:function(){e.hide(this._titlebar);e.hide(this._border);
this.isTitleBarShowing=!1},showContent:function(){e.show(this._content);e.show(this._border);this.isContentShowing=!0},hideContent:function(){e.hide(this._content);e.hide(this._border);this.isContentShowing=!1},move:function(a,b){b?a=this.coords.offset(a.x,a.y):(this.coords=a,this.mapCoords&&(this.mapCoords=this.map.toMap(a)));s.set(this._infowindow,{left:Math.round(a.x)+"px",top:Math.round(a.y)+"px"})},setFixedAnchor:function(a){a&&-1===f.indexOf(this._ANCHORS,a)||(this.fixedAnchor=a,this.isShowing&&
this.show(this.mapCoords||this.coords,a),this.onAnchorChange(a))},setTitle:function(a){this.destroyDijits(this._title);this.__setValue("_title",a);return this},setContent:function(a){this.destroyDijits(this._content);this.__setValue("_content",a);return this},onShow:function(){this.__registerMapListeners();this.startupDijits(this._title);this.startupDijits(this._content)},onHide:function(){this.__unregisterMapListeners()},onResize:function(){},onAnchorChange:function(){}});d.mixin(x,{ANCHOR_UPPERRIGHT:"upperright",
ANCHOR_LOWERRIGHT:"lowerright",ANCHOR_LOWERLEFT:"lowerleft",ANCHOR_UPPERLEFT:"upperleft"});return x})},"esri/dijit/PopupMobile":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/window dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style ../InfoWindowBase ../PopupBase ./InfoView ./NavigationBar ../kernel ../domUtils dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D){return d([e,g],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:n.toUrl("./images/whitex.png"),dArrowIcon:n.toUrl("./images/whitedown.png"),lArrowIcon:n.toUrl("./images/whitel.png"),rArrowIcon:n.toUrl("./images/whiter.png"),constructor:function(a,e){this.initialize();f.mixin(this,a);this.domNode=b.byId(e);this._nls=f.mixin({},
D.widgets.popup);var c=this.domNode;q.add(c,"esriPopupMobile");s.set(c,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var g=l.query(".titlePane",c)[0];this._arrowButton=l.query(".arrow",g)[0];this._pointerTop=l.query(".top",c)[0];this._pointerBottom=l.query(".bottom",c)[0];this._title=l.query(".title",g)[0];this._footer=l.query(".footer",g)[0];this._prev=l.query(".prev",g)[0];this._next=l.query(".next",g)[0];this._spinner=l.query(".spinner",g)[0];this._eventConnections=[h.connect(l.query(".close",g)[0],"onclick",this,this.hide),h.connect(this._arrowButton,"onclick",this,this._toggleView),h.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),h.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();z.hide(c);this.isShowing=!1},setMap:function(a){this.inherited(arguments);r.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,b){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(b,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var b=this.map;a.spatialReference?(this.location=a,a=b.toScreen(a)):this.location=b.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(z.show(this.domNode),this.isShowing=!0,this.onShow())}else z.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(z.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);c.forEach(this._eventConnections,h.disconnect);r.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");q.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[h.connect(a,"onPanStart",this,this._onPanStart),h.connect(a,"onPan",this,this._onPan),h.connect(a,"onZoomStart",this,this._onZoomStart),h.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(c.forEach(a,h.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,b){var e=this._panOrigin,c=b.x,g=b.y,k=e.left,m=e.top,d=e.right,e=e.bottom;k&&(k=parseFloat(k)+c+"px");m&&(m=parseFloat(m)+g+"px");d&&(d=parseFloat(d)-c+"px");e&&(e=parseFloat(e)-g+"px");t.set(this.domNode,{left:k,top:m,right:d,bottom:e})},_onZoomStart:function(){z.hide(this.domNode)},_onExtentChange:function(a,b,e){e&&(z.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var b=a.x;a=a.y;var e=
m.getContentBox(this.map.container),c=e.w,e=e.h,g=0,k=a+10,d=118,r=c-18;18<b&&b<r?(g=b-130,0>g?g=0:g>c-260&&(g=c-260)):18>=b?g=b-18:b>=r&&(g=c-260+(b-r));118<b&&b<c-130?d=118:118>=b?18<b?d=b-12:18>=b&&(d=6):b>=c-130&&(b<r?d=118+b-(c-130):b>=r&&(d=118+r-(c-130)));a<=e/2?(t.set(this.domNode,{left:g+"px",top:k+"px",bottom:null}),t.set(this._pointerTop,{left:d+"px"}),q.add(this._pointerBottom,"hidden"),q.remove(this._pointerTop,"hidden")):(t.set(this.domNode,{left:g+"px",top:k-64+"px",bottom:null}),t.set(this._pointerBottom,
{left:d+"px"}),q.add(this._pointerTop,"hidden"),q.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){c.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(b){b===a?l.query(".pointer."+b,this.domNode).removeClass("hidden"):l.query(".pointer."+b,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();z.show(this.popupNavigationBar.container);z.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":z.hide(this.popupNavigationBar.container);z.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new w(a,r.create("div",{},p.body()));h.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});h.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);h.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();z.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new y({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},r.create("div",{},p.body()));q.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();h.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});h.connect(this.popupInfoView,"onSwipeLeft",this,function(){});h.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",b="\x26nbsp;",e=this.selectedIndex,c=this.features,g=this.deferreds,k=this._prevFeatureButton.parentNode,m=this._nextFeatureButton.parentNode,d=this._spinner,r=this._nls;c&&1<=c.length?(a=c[e].getTitle(),b=e+1+" of "+c.length,q.remove(this._arrowButton,"hidden"),0===e?(q.add(k,"hidden"),q.add(this._prev,"hidden")):(q.remove(k,"hidden"),q.remove(this._prev,"hidden")),e===c.length-1?(q.add(m,"hidden"),
q.add(this._next,"hidden")):(q.remove(m,"hidden"),q.remove(this._next,"hidden"))):(q.add(this._arrowButton,"hidden"),q.add(k,"hidden"),q.add(m,"hidden"),q.add(this._prev,"hidden"),q.add(this._next,"hidden"));this.setTitle(a,b);this.popupNavigationBar.getItems()[1]._node.innerHTML=b;g&&g.length?(q.remove(d,"hidden"),this.setTitle(r.NLS_searching+"...","\x26nbsp;")):(q.add(d,"hidden"),(!c||!c.length)&&this.setTitle("No Information","\x26nbsp;"))}})})},"esri/dijit/InfoView":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct dojo/dom-geometry ../kernel ./_TouchBase".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r){return n(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(c,d){var e;this.container=a.byId(d);this._touchBase=r(this.container,null);this._slideDiv=b.create("div",null,this.container,"first");this.events=[];this._items=c.items;c.sections&&(this._sections=c.sections);k.add(this.container,"esriMobileInfoView");if(0===this._sections.length)b.create("div",{},this._slideDiv);else for(e=0;e<this._sections.length;e++){var g=
b.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);b.create("div",{innerHTML:this._sections[e].title},g)}for(e=0;e<this._items.length;e++){var q,g=0;this._items[e].section&&(g=this._items[e].section);switch(this._items[e].type){case "div":q=b.create("div",{"class":"esriMobileInfoViewItem",style:this._items[e].style},this._slideDiv.childNodes[g]),q=b.create("div",{innerHTML:this._items[e].text},q)}this._items[e].className&&k.add(q,this._items[e].className);q._index=e;q._item=this._items[e];
this._items[e]._node=q}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){f.forEach(this.events,h.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(a){a._index=null;a._item=null;b.destroy(a)});this._items=null;b.destroy(this._slideDiv);b.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);
this.events.push(h.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(h.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(h.connect(this._touchBase,"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){h.disconnect(this.events.pop());h.disconnect(this.events.pop());h.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);
this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},
_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===
this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_doMomentum:function(){var a,b;a=s.getContentBox(this.container);var e=0>this._velocity?0.0010:-0.0010;b=-(this._velocity*this._velocity)/(2*e);var c=-this._velocity/e,e=3*0.6-0,k=1-e,d=0,q=0;if(a.h>
this._slideDiv.scrollHeight)this.contentOffsetY=0,q=300;else if(0<this.contentOffsetY+b){a=0;for(b=Math.floor(c/20);a<b;a++)if(d=(k*20*a^3)+(e*20*a^2)+0*20*a+0,d=0>this._velocity?-d:d,0<this.contentOffsetY+d){q=20*a;break}0===q&&(q=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+b)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;a=0;for(b=Math.floor(c/20);a<b;a++)if(d=(k*20*a^3)+(e*20*a^2)+0*20*a+0,d=0>this._velocity?-d:d,Math.abs(this.contentOffsetY+
d)>this._slideDiv.scrollHeight){q=20*a;break}}else q=c,this.contentOffsetY+=b;this._slideDiv.style.webkitTransition="-webkit-transform "+q+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=s.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration=
"0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState=
"OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))}})})},"esri/dijit/_TouchBase":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/dom dojo/has ../kernel".split(" "),function(n,d,f,h,c,p){return n(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(c,a){this.domNode=h.byId(c);this.events=[f.connect(this.domNode,"touchstart",this,this._touchStartHandler),
f.connect(this.domNode,"touchmove",this,this._touchMoveHandler),f.connect(this.domNode,"touchend",this,this._touchEndHandler),f.connect(this.domNode,"onclick",this,this._clickHandler)]},setPreventDefault:function(c){this._preventDefault=c},disableOnClick:function(){f.disconnect(this.events.pop())},_clickHandler:function(c){if(this._moved)c.preventDefault();else this.onclick(c)},_touchStartHandler:function(c){this._moved=!1;this.client_x=c.targetTouches[0].clientX;this.client_y=c.targetTouches[0].clientY;
this.down_x=c.targetTouches[0].pageX;this.down_y=c.targetTouches[0].pageY;c.downX=this.down_x;c.downY=this.down_y;this.onTouchStart(c)},_touchMoveHandler:function(c){this._preventDefault&&c.preventDefault();this._moved=!0;this.up_x=c.targetTouches[0].pageX;this.cur_x=c.targetTouches[0].pageX-this.down_x;this.cur_y=c.targetTouches[0].pageY-this.down_y;c.curX=this.cur_x;c.curY=this.cur_y;this.onTouchMove(c)},_touchEndHandler:function(c){this._moved?(c.curX=this.cur_x,c.curY=this.cur_y,this.down_x-this.up_x>
this._swipeThreshold?c.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(c.swipeDirection="right")):(c.clientX=this.client_x,c.clientY=this.client_y);this.onTouchEnd(c)},onTouchStart:function(c){},onTouchMove:function(c){},onTouchEnd:function(c){},onclick:function(c){}})})},"esri/dijit/NavigationBar":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/kernel dojo/has dojo/query dojo/dom dojo/dom-class dojo/dom-construct ./_TouchBase ../kernel".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){return n(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(c,d){var q;this.container=a.byId(d);this._touchBase=s(this.container,null);this._slideDiv=b.create("div",{},this.container,"first");this.events=[f.connect(this._touchBase,"onclick",this,this._onClickHandler)];this._items=c.items;k.add(this.container,"esriMobileNavigationBar");var e=b.create("div",{},this._slideDiv);for(q=0;q<this._items.length;q++){var g,l;switch(this._items[q].type){case "img":l=
b.create("div",{"class":"esriMobileNavigationItem"},e);g=b.create("img",{src:this._items[q].src.toString(),style:{width:"100%",height:"100%"}},l);break;case "span":l=b.create("div",{"class":"esriMobileNavigationItem"},e);g=b.create("span",{innerHTML:this._items[q].text},l);break;case "div":l=b.create("div",{"class":"esriMobileNavigationInfoPanel"},e),g=b.create("div",{innerHTML:this._items[q].text},l)}k.add(l,this._items[q].position);this._items[q].className&&k.add(g,this._items[q].className);g._index=
q;g._item=this._items[q];this._items[q]._node=g}},startup:function(){this.onCreate(this._items)},destroy:function(){h.forEach(this.events,f.disconnect);this._touchBase=null;c.query("img",this.container).forEach(function(a){a._index=null;a._item=null;b.destroy(a)});this._items=null;b.destroy(this._slideDiv);b.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},
onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var b=a.target,k=b._item;c.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===k.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(b,k)}},_toggleNode:function(a,b){"ON"===b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))},_markSelected:function(a,b){b.toggleState=
"ON";b.srcAlt&&(a.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(a,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b))}})})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(n,d,f,h,c){return n([d,f],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:h,loadingText:null,
hidden:!1,showLoading:!0,postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&c.setStyle(this.domNode,"display","none");c.setStyle(this.domNode,{width:"100%",height:"100%"});this.loadingImg.src=require.toUrl("jimu")+"/images/loading2.gif";this.showLoading||c.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(d){this.domNode&&this.hidden&&
("string"===typeof d&&(this.textNode.innerHTML=d),c.setStyle(this.domNode,"display","block"),this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(c.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"jimu/LayerInfos/LayerInfos":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/on dojo/topic dojo/_base/unload dojo/Evented dojo/promise/all ./LayerInfoFactory".split(" "),function(n,d,f,h,c,p,l,a,k,b){var s=n([a],{map:null,_operLayers:null,_layerInfos:null,
_finalLayerInfos:null,_tableInfos:null,_finalTableInfos:null,_basemapLayers:null,constructor:function(a,b,c){this._basemapLayers=b.baseMap.baseMapLayers;this._operLayers=b.operationalLayers;this.tables=b.tables;this.map=a;this.options=c;this._initLayerInfos();this._initTablesInfos();this.update();this._bindEvents()},update:function(){this._extraSetLayerInfos();this._clearAddedFlag(this._layerInfos);this._initFinalTableInfos();this._initFinalLayerInfos(this._layerInfos);this._markFirstOrLastNode()},
getLayerInfoArrayOfWebmap:function(){var a=[];d.forEach(this.getLayerInfoArray(),function(b){for(var c=0;c<this._operLayers.length;c++)if(b.id===this._operLayers[c].id){a.push(b);break}c===this._operLayers.length&&0<=this._removedLayerInfoIdsFromFeatureCollection.indexOf(b.id)&&a.push(b)},this);return a},getLayerInfoArray:function(){return this._finalLayerInfos},getTableInfoArray:function(){return this._finalTableInfos},addFeatureCollection:function(a,c){var k=this._getUniqueTopLayerInfoId(c),m={layers:[]};
d.forEach(a,function(a,b){a.id=k+"_"+b;m.layers.push({id:a.id,layerObject:a})},this);this.map.addLayers(a);var q;try{q=b.getInstance().create({featureCollection:m,title:c||k,id:k},this.map),q.init()}catch(r){console.warn(r.message),q=null}q&&(q._extraOfWebmapLayerInfo=!0,this._layerInfos.push(q),this.update(),this._onUpdated())},addTable:function(a){var b=[];a=this._addTable(a,this._finalTableInfos);this._tableInfos.push(a);b.push(a);this._onTableChange(b,"added")},_addTable:function(a,c){var k;try{a.layerObject=
{url:a.url,featureCollectionData:a.featureCollectionData,empty:!0},a.id=this._getUniqueTableId(a.id),a.selfType="table",k=b.getInstance().create(a),k.init()}catch(d){console.warn(d.message),k=null}k&&c&&c.push(k);return k},_getUniqueTableId:function(a){var b=this._tableInfos.concat(this._finalTableInfos||[]);return this._getUniqueLayerOrTableId(a,b)},_getUniqueTopLayerInfoId:function(a){return this._getUniqueLayerOrTableId(a,this._finalLayerInfos)},_getUniqueLayerOrTableId:function(a,b){var c=1,k;
a||(a="table");for(k=a;;){for(var d=0;d<b.length&&b[d].id!==k;d++);if(d===b.length)return k;k=a+"_"+c.toString();c++}},removeTable:function(){},_traversal:function(a,b){for(var c=0;c<b.length;c++)if(b[c].traversal(a))return!0;return!1},traversal:function(a){var b=this.getLayerInfoArray();return this._traversal(a,b)},traversalLayerInfosOfWebmap:function(a){var b=this.getLayerInfoArrayOfWebmap();return this._traversal(a,b)},getLayerInfoById:function(a){return this._findLayerInfoById(a)},getLayerInfoByTopLayerId:function(a){return this._findTopLayerInfoById(a)},
moveUpLayer:function(a){var b=null,c;a=this._getTopLayerInfoIndexById(a);0<a&&(b=this._finalLayerInfos[a-1].obtainLayerIndexesInMap().length,this._finalLayerInfos[a].moveRightOfIndex(this._finalLayerInfos[a-1].obtainLayerIndexesInMap()[b-1].index),b=this._finalLayerInfos[a-1].id,c=this._finalLayerInfos[a],this._finalLayerInfos.splice(a,1),this._finalLayerInfos.splice(a-1,0,c),this._markFirstOrLastNode());return b},moveDownLayer:function(a){var b=null,c=this._getTopLayerInfoIndexById(a);c<this._finalLayerInfos.length-
1&&(this._finalLayerInfos[c].moveLeftOfIndex(this._finalLayerInfos[c+1].obtainLayerIndexesInMap()[0].index),b=this._finalLayerInfos[c+1].id,a=this._finalLayerInfos[c+1],this._finalLayerInfos.splice(c+1,1),this._finalLayerInfos.splice(c,0,a),this._markFirstOrLastNode());return b},getBasemapLayers:function(){var a=[];d.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);("basemap"===b._basemapGalleryLayerType||"reference"===b._basemapGalleryLayerType)&&a.push(b)},this);0===a.length&&(a=this._basemapLayers);
return a},getMapNotesLayerInfoArray:function(){return d.filter(this.getLayerInfoArray(),function(a){return a.isMapNotesLayerInfo()},this)},restoreState:function(a){d.forEach(this.getLayerInfoArray(),function(b){b.resetLayerObjectVisibility(a)},this)},_initLayerInfos:function(){var a;this._layerInfos=[];d.forEach(this._operLayers,function(c){try{a=b.getInstance().create(c),a.init()}catch(k){console.warn(k.message),a=null}a&&this._layerInfos.push(a)},this)},_extraSetLayerInfos:function(){this._removedLayerInfoIdsFromFeatureCollection=
[];d.forEach(this._layerInfos,function(a,c){var k;if("esri.layers.GeoRSSLayer"===a.layerObject.declaredClass||"esri.layers.KMLLayer"===a.layerObject.declaredClass){try{k=b.getInstance().create(a.originOperLayer),k.init()}catch(m){console.warn(m.message),k=null}k&&(a.destroyLayerInfo(),this._layerInfos[c]=k)}else if(a.originOperLayer.featureCollection){var q=[];d.forEach(a.getSubLayers(),function(a){q.push(a.id)});d.forEach(q,function(b){this.map.getLayer(b)||a.removeSubLayerById(b)},this);1===a.getSubLayers().length&&
(k=a.getSubLayers()[0],this.map.getLayer(k.id).title=a.title,a.removeSubLayerById(k.id),this._removedLayerInfoIdsFromFeatureCollection.push(k.id))}},this)},_initFinalLayerInfos:function(a){var b,c;this._finalLayerInfos=[];for(b=this.map.graphicsLayerIds.length-1;0<=b;b--)c=this.map.graphicsLayerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,a),c,!0);for(b=this.map.layerIds.length-1;0<=b;b--)c=this.map.layerIds[b],this._isBasemap(c)||this._addToFinalLayerInfos(this._findLayerInfoByIdAndReturnTopLayer(c,
a),c,!1)},_isBasemap:function(a){for(var b=!1,c=this.getBasemapLayers(),k=0;k<c.length;k++)c[k].id===a&&(b=!0);return b},_addToFinalLayerInfos:function(a,c,k){var m;if(a)!a._addedFlag&&a.isGraphicLayer()===k&&(this._finalLayerInfos.push(a),a._addedFlag=!0);else{a=this.map.getLayer(c);if("esri.layers.GraphicsLayer"!==a.declaredClass&&"labels"!==a.id){try{m=b.getInstance().create({layerObject:a,title:this._getLayerTitle(a),id:a.id||" "},this.map),m.init()}catch(q){console.warn(q.message),m=null}m&&
this._finalLayerInfos.push(m)}("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass)&&m&&m._getLayerDefinition().then(f.hitch(this,function(a){var b=[];d.forEach(a.tables,function(a){a.url=m.getUrl()+"/"+a.id;a.id=m.id+"_"+a.id;a.title=this._getLayerTitle(a);(a=this._addTable(a,this._finalTableInfos))&&b.push(a)},this);this._onTableChange(b,"added")}))}},_getLayerTitle:function(a){if(a.title)return a.title;var b=a.label||a.name||
"";if(a.url){var c;c=a.url.indexOf("rest/services/");-1<c&&(c=a.url.substring(c+14).split("/")[0],b=b?c+" - "+b:c)}return b||a.id},_findLayerInfoByIdAndReturnTopLayer:function(a,b){var c,k=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length;c++)if(k=b[c].findLayerInfoById(a)){k=b[c];break}return k},_findLayerInfoById:function(a,b){var c,k=null;b||(b=this._finalLayerInfos);for(c=0;c<b.length&&!(k=b[c].findLayerInfoById(a));c++);return k},_findTopLayerInfoById:function(a){var b,c=null,k=this._finalLayerInfos;
for(b=0;b<k.length;b++)if(k[b].id===a){c=k[b];break}return c},_getTopLayerInfoIndexById:function(a){var b,c=-1;for(b=0;b<this._finalLayerInfos.length;b++)if(this._finalLayerInfos[b].id===a){c=b;break}return c},_clearAddedFlag:function(a){d.forEach(a,function(a){a._addedFlag=!1})},_markFirstOrLastNode:function(){var a;if(this._finalLayerInfos.length){for(a=0;a<this._finalLayerInfos.length;a++)this._finalLayerInfos[a].isFirst=!1,this._finalLayerInfos[a].isLast=!1;this._finalLayerInfos[0].isFirst=!0;
this._finalLayerInfos[this._finalLayerInfos.length-1].isLast=!0;for(a=0;a<this._finalLayerInfos.length;a++)if(!this._finalLayerInfos[a].isGraphicLayer()){a&&(this._finalLayerInfos[a-1].isLast=!0);this._finalLayerInfos[a].isFirst=!0;break}}},_onReceiveBasemapGalleryeData:function(a,b,c){"BasemapGallery"===a&&(this._basemapLayers.length=0,d.forEach(c,f.hitch(this,function(a){this._basemapLayers.push({layerObject:a,id:a.id})}),this),this.update(),this.emit("layerInfosChanged"))},_onBasemapChange:function(a){var b;
for(b=this._basemapLayers.length=0;b<a.layers.length;b++)this._basemapLayers.push({layerObject:a.layer[b],id:a.layers[b].id})},_destroyLayerInfos:function(){d.forEach(this.getLayerInfoArray(),f.hitch(this,function(a){a.destroyLayerInfo()}))},_bindEvents:function(){var a,b,k,d,m;a=c(this.map,"layer-add-result",f.hitch(this,this._onLayersChange,"added"));b=c(this.map,"layer-remove",f.hitch(this,this._onLayersChange,"removed"));d=p.subscribe("layerInfos/layerInfo/isShowInMapChanged",f.hitch(this,this._onShowInMapChanged));
m=p.subscribe("layerInfos/layerInfo/visibleChanged",f.hitch(this,this._onVisibleChanged));k=c(this.map,"before-unload",f.hitch(this,function(){a.remove();b.remove();d.remove();m.remove();this._destroyLayerInfos()}));l.addOnUnload(function(){a.remove();b.remove();k.remove();d.remove();m.remove()})},_onLayersChange:function(a,b){var c=null,k;!b.error&&("esri.layers.GraphicsLayer"!==b.layer.declaredClass&&!b.layer._basemapGalleryLayerType)&&("added"===a?(this.update(),c=this._findTopLayerInfoById(b.layer.id),
k=this._findLayerInfoById(b.layer.id)):(c=this._findTopLayerInfoById(b.layer.id),k=this._findLayerInfoById(b.layer.id),this.update()),this.emit("layerInfosChanged",c,a,k))},_onShowInMapChanged:function(a){this.emit("layerInfosIsShowInMapChanged",a)},_onVisibleChanged:function(a){this.emit("layerInfosIsVisibleChanged",a)},_initTablesInfos:function(){this._tableInfos=[];d.forEach(this.tables,function(a){this._addTable(a,this._tableInfos)},this)},_initFinalTableInfos:function(){this._finalTableInfos=
[];d.forEach(this._tableInfos,function(a){this._finalTableInfos.push(a)},this)},_onTableChange:function(a,b){this.emit("tableInfosChanged",a,b)},_onUpdated:function(){this.emit("updated")}});s.getLayerInfoArrayByType=function(a,b){var c=new h,m=[],q=[];s.getInstance(a,a.iteminfo).then(function(a){a.traversal(function(a){var b=a.getLayerType();b.layerInfo=a;m.push(b)});k(m).then(function(a){d.forEach(a,function(a,c){b===a&&q.push(m[c].layerInfo)});c.resolve(q)})});return c};var q=!0,r=null,m=null,
t=new h;s.getInstance=function(a,c,k){r&&r!==a&&(q=!0,m=r=null,t=new h);m?t.resolve(m):q&&(q=!1,k||(k={}),b.getInstance(a,k).init().then(f.hitch(this,function(){var b=new s(a,c.itemData,k);r=a;m=b;t.resolve(b)})));return t};return s})},"jimu/LayerInfos/LayerInfoFactory":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/Deferred"],function(n,d,f){var h=null,c=n(null,{constructor:function(){},init:function(){var c=new f;require("jimu/LayerInfos/LayerInfoForCollection jimu/LayerInfos/LayerInfoForMapService jimu/LayerInfos/LayerInfoForKML jimu/LayerInfos/LayerInfoForGeoRSS jimu/LayerInfos/LayerInfoForDefault jimu/LayerInfos/LayerInfoForWMS jimu/LayerInfos/LayerInfoForGroup jimu/LayerInfos/LayerInfoForDefaultDynamic jimu/LayerInfos/LayerInfoForDefaultTile jimu/LayerInfos/LayerInfoForDefaultWMS jimu/LayerInfos/LayerInfoForDefaultTable jimu/LayerInfos/LayerInfoForDefaultImage jimu/LayerInfos/LayerInfoForDefaultStream".split(" "),
d.hitch(this,function(d,a,k,b,s,q,r,m,f,e,g,h,n){this.LayerInfoForCollection=d;this.LayerInfoForMapService=a;this.LayerInfoForKML=k;this.LayerInfoForGeoRSS=b;this.LayerInfoForDefault=s;this.LayerInfoForWMS=q;this.LayerInfoForGroup=r;this.LayerInfoForDefaultDynamic=m;this.LayerInfoForDefaultTile=f;this.LayerInfoForDefaultWMS=e;this.LayerInfoForDefaultTable=g;this.LayerInfoForDefaultImage=h;this.LayerInfoForDefaultStream=n;c.resolve()}));return c},create:function(c){if(c.featureCollection)return new this.LayerInfoForCollection(c,
this.map,this.options);if("esri.layers.KMLLayer"===c.layerObject.declaredClass)return new this.LayerInfoForKML(c,this.map,this.options);if("esri.layers.GeoRSSLayer"===c.layerObject.declaredClass)return new this.LayerInfoForGeoRSS(c,this.map,this.options);if("esri.layers.WMSLayer"===c.layerObject.declaredClass&&!c.selfType)return new this.LayerInfoForWMS(c,this.map,this.options);if("esri.layers.ArcGISDynamicMapServiceLayer"===c.layerObject.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===
c.layerObject.declaredClass)return new this.LayerInfoForMapService(c,this.map,this.options);if("esri.layers.ArcGISImageServiceLayer"===c.layerObject.declaredClass||"esri.layers.ArcGISImageServiceVectorLayer"===c.layerObject.declaredClass)return new this.LayerInfoForDefaultImage(c,this.map,this.options);if("esri.layers.StreamLayer"===c.layerObject.declaredClass)return new this.LayerInfoForDefaultStream(c,this.map,this.options);"Table"===c.layerObject.type&&(c.selfType="table");switch(c.selfType){case "mapservice_dynamic_group":return new this.LayerInfoForGroup(c,
this.map,this.options);case "mapservice_tiled_group":return new this.LayerInfoForGroup(c,this.map,this.options,!0);case "mapservice_dynamic":return new this.LayerInfoForDefaultDynamic(c,this.map,this.options);case "mapservice_tiled":return new this.LayerInfoForDefaultTile(c,this.map,this.options);case "wms":return new this.LayerInfoForDefaultWMS(c,this.map,this.options);case "table":return new this.LayerInfoForDefaultTable(c,this.map,this.options);default:return new this.LayerInfoForDefault(c,this.map,
this.options)}}});c.getInstance=function(d,f){null===h&&(h=new c,h.options=f);d&&(h.map=d);return h};return c})},"jimu/dijit/AppStatePopup":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/on dojo/mouse dojo/_base/fx dojo/Evented".split(" "),function(n,d,f,h,c,p,l,a){return n([d,a],{baseClass:"jimu-appstate-popup",declaredClass:"jimu.dijit.AppStatePopup",currentState:0,timeoutHandler:void 0,postCreate:function(){window.appInfo.isRunInMobile&&h.addClass(this.domNode,
"mobile");var a=h.create("div",{"class":"appstate-header"});h.create("div",{"class":"appstate-title",innerHTML:this.nls.title},a);var b=h.create("div",{"class":"appstate-close"},a);h.place(a,this.domNode);a=h.create("div",{"class":"appstate-tips",innerHTML:this.nls.restoreMap});h.place(a,this.domNode);this.own(c(a,"click",f.hitch(this,function(){this.emit("applyAppState");this.hide()})));this.own(c(b,"click",f.hitch(this,function(){this.hide()})));this.own(c(this.domNode,p.enter,f.hitch(this,function(){this.timeoutHandler&&
(clearTimeout(this.timeoutHandler),this.timeoutHandler=void 0)})));this.own(c(this.domNode,p.leave,f.hitch(this,function(){1===this.currentState&&!this.timeoutHandler&&(this.timeoutHandler=setTimeout(f.hitch(this,this.hide),1E4))})))},show:function(){l.animateProperty({node:this.domNode,duration:1E3,properties:window.appInfo.isRunInMobile?{top:{start:-120,end:0}}:{bottom:{start:-100,end:10}},onEnd:f.hitch(this,function(){this.currentState=1})}).play();this.timeoutHandler=setTimeout(f.hitch(this,this.hide),
1E4)},hide:function(){0!==this.currentState&&l.animateProperty({node:this.domNode,duration:1E3,properties:window.appInfo.isRunInMobile?{top:{start:0,end:-120}}:{bottom:{start:10,end:-100}},onEnd:f.hitch(this,function(){this.currentState=0;h.setStyle(this.domNode,"display","none")})}).play()}})})},"jimu/MapUrlParamsHandler":function(){define("dojo/_base/array dojo/Deferred dojo/topic dojo/promise/all esri/geometry/Point esri/geometry/Extent esri/geometry/scaleUtils esri/SpatialReference esri/tasks/ProjectParameters esri/config esri/geometry/webMercatorUtils esri/symbols/jsonUtils esri/graphic esri/layers/GraphicsLayer esri/InfoTemplate esri/tasks/query ./utils ./LayerInfos/LayerInfos".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y){function w(b,e){var k=b.center.split(";");1===k.length&&(k=b.center.split(","));if(2===k.length||3===k.length){var g=parseFloat(k[0]),d=parseFloat(k[1]);if(isNaN(g)||isNaN(d))g=parseFloat(k[0]),d=parseFloat(k[1]);if(!isNaN(g)&&!isNaN(d)){var m=4326;3===k.length&&!isNaN(k[2])&&(m=parseInt(k[2],10));k=new c(g,d,new a(m));J(k.spatialReference,e.spatialReference)?e.centerAt(k):G(k,e.spatialReference,function(a){e.centerAt(a[0])},function(){console.error("Project center point error.")})}}}
function x(b,c){var e=b.extent.split(";");1===e.length&&(e=b.extent.split(","));if(4===e.length||5===e.length){var k=parseFloat(e[0]),g=parseFloat(e[1]),d=parseFloat(e[2]),m=parseFloat(e[3]);if(isNaN(k)||isNaN(k)||isNaN(k)||isNaN(k))k=parseFloat(e[0]),g=parseFloat(e[1]),d=parseFloat(e[2]),m=parseFloat(e[3]);if(!isNaN(k)&&!isNaN(g)&&!isNaN(d)&&!isNaN(m)){var q=4326;5===e.length&&!isNaN(e[4])&&(q=parseInt(e[4],10));e=new p(k,g,d,m,new a({wkid:q}));J(c.spatialReference,e.spatialReference)?c.setExtent(e):
G(e,c.spatialReference,function(a){c.setExtent(a[0])},function(){console.error("Project extent error.")})}else console.error("Wrong extent parameters.")}else console.error("Wrong extent parameters.")}function z(b,e){var k=b.marker.split(";");1===k.length&&(k=b.marker.split(","));if(2<=k.length&&6>=k.length&&k[0].length&&!isNaN(k[0])&&k[1].length&&!isNaN(k[1])){var g=parseFloat(k[0]),d=parseFloat(k[1]),m=4326;3<=k.length&&(k[2].length&&!isNaN(k[2]))&&(m=parseInt(k[2],10));var r="";4<=k.length&&(r=
k[3]);var s=null;5<=k.length&&0===k[4].indexOf("http")&&(s=k[4]);var f=null;6===k.length&&(f=k[5]);var l=q.fromJson({type:"esriPMS",url:s,contentType:"image/png"}),t=null;f&&(t=q.fromJson({color:[0,0,0,255],type:"esriTS",verticalAlignment:"baseline",horizontalAlignment:"left",angle:0,xoffset:0,yoffset:0,rotated:!1,kerning:!0,font:{size:12,style:"normal",weight:"bold",family:"Arial"},text:f}));v(l).then(function(){var b=new c(g,d,new a({wkid:m}));J(b.spatialReference,e.spatialReference)?D(b,l,t,r,
e):G(b,e.spatialReference,function(a){D(a[0],l,t,r,e)},function(){console.error("Project center point error.")})})}}function D(a,b,e,k,g){var d;d=new t("",k);k=new m;g.addLayer(k);d=new r(a,b,null,d);k.add(d);e&&(e.xoffset=b.width/2,e.yoffset=b.height/2+b.yoffset,b=new r(new c(a.toJson()),e),k.add(b));g.centerAt(a)}function v(a){var b=new d;a.url?g.getImagesSize(a.url).then(function(c){a.width=c[0];a.height=c[1];b.resolve(a)},function(){a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png";
a.width=26;a.height=26;a.setOffset(0,a.height/2);b.resolve(a)}):(a.url=require.toUrl("jimu")+"/images/EsriBluePinCircle26.png",a.width=26,a.height=26,a.setOffset(0,a.height/2),b.resolve(a));return b}function u(a,b){var c=a.query.split(";");1===c.length&&(c=a.query.split(","));if(2!==c.length&&3!==c.length)console.error("query URL parameter is not correct.");else{var e=c[0];E("name",e,b).then(function(a){null===a?E("id",e,b).then(function(a){null===a?console.error("Invalid layer name or id."):F(b,
a,c)}):F(b,a,c)})}}function F(a,b,c){var k=new e,d="";if(2===c.length)k.where=c[1];else if(3===c.length&&(b.layerObject.url&&(g.isHostedService(b.layerObject.url)&&g.containsNonLatinCharacter(c[2]))&&(d="N"),n.forEach(b.layerObject.fields,function(a){a.alias.toLowerCase()!==c[1].toLowerCase()&&a.name.toLowerCase()!==c[1].toLowerCase()||(-1<["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].indexOf(a.type)?k.where=a.name+"\x3d"+c[2]:-1<["esriFieldTypeString",
'"esriFieldTypeOID"'].indexOf(a.type)&&(k.where=c[1]+"\x3d"+d+"'"+c[2].replace(/\'/g,"''")+"'"))},this),!k.where)){console.error("Invalid field name or type in query URL parameter.");return}b.layerObject.selectFeatures(k).then(function(c){if(0===c.length)console.log("No result from query URL parameter.");else{if("esriGeometryPoint"===b.layerObject.geometryType&&1===c.length)a.setExtent(l.getExtentForScale(a,1E3)),a.centerAt(c[0].geometry);else{var e=g.graphicsExtent(c);a.setExtent(e)}C(a,b,c)}},function(a){console.error(a)})}
function C(a,b,c){function e(k){var g=new m;g.setRenderer(b.layerObject.renderer);a.addLayer(g);n.forEach(c,function(a){a.setInfoTemplate(k);g.add(a)})}function k(){a.infoWindow.setFeatures(c);a.infoWindow.show(B(c[0]))}if(a.getLayer(b.layerInfo.id))k();else{var g=b.layerInfo.getInfoTemplate();g?(e(g),k()):b.layerInfo.loadInfoTemplate().then(function(a){e(a);k()})}}function B(a){a=a.geometry;if("point"!==a.type)if("multipoint"===a.type)a=a.getPoint(0);else if("polyline"===a.type)a=a.getExtent().getCenter();
else if("polygon"===a.type)a=a.getExtent().getCenter();else if("extent"===a.type)a=a.getCenter();else return console.error("Can not get layer geometry type, unknow error."),null;return a}function E(a,b,c){var e=new d,k=[];y.getInstance(c,c.itemInfo).then(function(c){c.traversal(function(c){if(e.isResolved())return!0;("id"===a&&c.id.toLowerCase()===b.toLowerCase()||"name"===a&&c.title.toLowerCase()===b.toLowerCase())&&k.push(h({layerType:c.getLayerType(),layerObject:c.getLayerObject()}).then(function(a){"FeatureLayer"===
a.layerType&&e.resolve({layerInfo:c,layerObject:a.layerObject})},function(a){console.error("Find layer error from query URL parameter",a);e.resolve(null)}))});h(k).then(function(){e.isResolved()||e.resolve(null)})});return e}function G(a,c,e,g){var d=[102113,102100,3857],m;if(4326===a.spatialReference.wkid&&K(d,c.wkid)){a.ymin=Math.max(a.ymin,-89.99);a.ymax=Math.min(a.ymax,89.99);a=s.geographicToWebMercator(a);if((g=a.spatialReference._getInfo())&&a.xmin>a.xmax)d=g.valid[1]-a.xmin,m=a.xmax-g.valid[0],
d>m?a.xmax=g.valid[1]+m:a.xmin=g.valid[0]-d;a.spatialReference.wkid=c.wkid;e([a],null)}else if(K(d,a.spatialReference.wkid)&&4326===c.wkid){a=s.webMercatorToGeographic(a);if((g=a.spatialReference._getInfo())&&a.xmin>a.xmax)d=g.valid[1]-a.xmin,m=a.xmax-g.valid[0],d>m?a.xmax=g.valid[1]+m:a.xmin=g.valid[0]-d;e([a],null)}else d=new k,d.geometries=[a],d.outSR=c,b.defaults.geometryService.project(d,function(a){a&&0<a.length&&a[0]&&"extent"===a[0].type&&!isNaN(a[0].xmin)&&!isNaN(a[0].ymin)&&!isNaN(a[0].xmax)&&
!isNaN(a[0].ymax)?e(a,null):a&&(0<a.length&&a[0]&&"point"===a[0].type&&!isNaN(a[0].x)&&!isNaN(a[0].y))&&e(a,null)},g)}function J(a,b){var c=[102113,102100,3857];return a&&b&&a.wkt===b.wkt&&(a.wkid===b.wkid||a.latestWkid&&a.latestWkid===b.wkid||b.latestWkid&&a.wkid===b.latestWkid||a.latestWkid&&a.latestWkid===b.latestWkid)||a&&b&&a.wkid&&b.wkid&&K(c,a.wkid)&&K(c,b.wkid)?!0:!1}function K(a,b){for(var c=a.length;c--;)if(a[c]===b)return!0;return!1}return{postProcessUrlParams:function(a,b){if("extent"in
a)return x(a,b);if("center"in a)return w(a,b);if("marker"in a)return z(a,b);if("find"in a)f.publish("publishData","framework","framework",{searchString:a.find},!0);else if("query"in a)return u(a,b)}}})},"jimu/PopupManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/topic dijit/_WidgetBase ./PopupActions/RelatedRecordAction ./PopupActions/EditAction".split(" "),function(n,d,f,h,c,p,l){var a=null,k=n([c],{map:null,mapmanager:null,popupUnion:null,actions:null,constructor:function(){this.actions=
[];this.own(h.subscribe("mapLoaded",d.hitch(this,this.onMapLoadedOrChanged)));this.own(h.subscribe("mapChanged",d.hitch(this,this.onMapLoadedOrChanged)))},init:function(a){this.cleanActions();this.map=a;this.popupUnion=this.mapmanager.getMapInfoWindow()},_addActionsToPopup:function(){this._addRelatedRecordAction();this._addEditAction()},_addRelatedRecordAction:function(){var a=new p({name:"showRelatedRecordAction",map:this.map,popupUnion:this.popupUnion,appConfig:this.mapmanager.appConfig});this.addAction(a)},
_addEditAction:function(){var a=new l({name:"editAction",map:this.map,popupUnion:this.popupUnion,appConfig:this.mapmanager.appConfig});this.addAction(a)},addAction:function(a){this.actions.push(a)},removeAction:function(a){for(var c=0;c<this.actions.length;c++)if(this.actions[c].name===a){this.actions[c].destroy();break}c!==this.actions.length&&this.actions.splice(c,1)},cleanActions:function(){f.forEach(this.actions,function(a){a.destroy()});this.actions=[]},onMapLoadedOrChanged:function(a){this.init(a);
this._addActionsToPopup()}});k.getInstance=function(b){null===a&&(a=new k({mapmanager:b}));return a};return k})},"jimu/PopupActions/RelatedRecordAction":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dojo/on dojo/topic jimu/WidgetManager jimu/LayerInfos/LayerInfos jimu/PopupActions/PopupAction".split(" "),function(n,d,f,h,c,p,l,a){return n([f],{name:null,map:null,popupUnion:null,attrWidgetState:null,appConfig:null,constructor:function(){this.own(c.subscribe("appConfigChanged",
d.hitch(this,this._onAppConfigChanged)))},postCreate:function(){this.inherited(arguments);l.getInstance(this.map,this.map.itemInfo).then(d.hitch(this,function(a){this.layerInfos=a}));this.showRelatedRecordBtn=new a({popupUnion:this.popupUnion,buttonInfo:{label:window.jimuNls.popupManager.showRelatedRecords,baseClass:"relationship",onClick:d.hitch(this,this._onRealtionshipClick)}});this.hide();this._updateAttrWidgetState();this.own(h(this.showRelatedRecordBtn,"selectionChange",d.hitch(this,this._onSelectionChange)))},
_updateAttrWidgetState:function(){this.attrWidgetState=this.appConfig.getConfigElementsByName("AttributeTable")[0]},_onRealtionshipClick:function(a){var b=this.layerInfos.getLayerInfoById(a._layer.id),c=a.attributes[a._layer.objectIdField];this.attrWidgetState&&this.attrWidgetState.visible&&p.getInstance().triggerWidgetOpen(this.attrWidgetState.id).then(d.hitch(this,function(a){a.showRelatedRecordsFromPopup(b,[c])}))},_onSelectionChange:function(a){this.layerInfos&&this.attrWidgetState&&this.attrWidgetState.visible&&
a._layer&&a._layer.relationships&&0<a._layer.relationships.length?(a=this.layerInfos.getLayerInfoById(a._layer.id))?a.getRelatedTableInfoArray().then(d.hitch(this,function(a){0<a.length?this.show():this.hide()})):this.hide():this.hide()},_onAppConfigChanged:function(a){this.appConfig=a;this._updateAttrWidgetState()},show:function(){this.showRelatedRecordBtn.show()},hide:function(){this.showRelatedRecordBtn.hide()},destroy:function(){this.showRelatedRecordBtn.destroy();this.inherited(arguments)}})})},
"jimu/PopupActions/PopupAction":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/Evented dojo/on dojo/query".split(" "),function(n,d,f,h,c,p,l,a){return n([c,p],{popup:null,popupMobile:null,popupUnion:null,buttonInfo:null,_buttons:null,constructor:function(){this.buttonDomNodes=[]},postCreate:function(){this.inherited(arguments);this.popup=this.popupUnion.bigScreen;this.popupMobile=this.popupUnion.mobile;this.buttonInfo&&this._addButtonNode()},
_addButtonNode:function(){this._addButtonNodeToPopup();this._addButtonNodeToPopupMobile()},_addButtonNodeToPopup:function(){var c=a(".actionList",this.popup.domNode)[0],c=h.create("a",{"class":"action "+this.buttonInfo.baseClass,href:" javascript:void(0);"},c);this.buttonDomNodes.push(c);this.popupButtonNode=h.create("span",{innerHTML:this.buttonInfo.label},c);this.own(l(this.popupButtonNode,"click",f.hitch(this,this._onButtonClick)));this.own(l(this.popup,"selection-change",f.hitch(this,this._onSelectionChange,
this.popup)));this.own(l(this.popup,"show",f.hitch(this,this._onShow)))},_addButtonNodeToPopupMobile:function(){var c=a(".esriMobilePopupInfoView .esriMobileInfoViewItem"),c=h.create("a",{"class":"action "+this.buttonInfo.baseClass,href:" javascript:void(0);"},c[c.length-1]);this.buttonDomNodes.push(c);this.popupMobileButtonNode=h.create("span",{innerHTML:this.buttonInfo.label},c);this.own(l(this.popupMobileButtonNode,"click",f.hitch(this,this._onButtonClick)));this.own(l(this.popupMobile,"selection-change",
f.hitch(this,this._onSelectionChange,this.popupMobile)));this.own(l(this.popupMobile,"show",f.hitch(this,this._onShow)))},show:function(){h.setStyle(this.popupButtonNode,"display","inline");h.setStyle(this.popupMobileButtonNode,"display","inline")},hide:function(){h.setStyle(this.popupButtonNode,"display","none");h.setStyle(this.popupMobileButtonNode,"display","none")},_onButtonClick:function(){if(this.buttonInfo.onClick&&f.isFunction(this.buttonInfo.onClick))this.buttonInfo.onClick(this._selectedFeature,
this._popupShowEvt,this._popupSelectionChangeEvt)},_onSelectionChange:function(a,b){-1<b.target.selectedIndex&&(this._selectedFeature=a.getSelectedFeature(),this._popupSelectionChangeEvt=b,this.emit("selectionChange",this._selectedFeature,b))},_onShow:function(a){this._popupShowEvt=a},destroy:function(){d.forEach(this.buttonDomNodes,function(a){h.destroy(a)},this);this.inherited(arguments)}})})},"jimu/PopupActions/EditAction":function(){define("dojo/_base/declare dojo/_base/lang dijit/_WidgetBase dojo/on dojo/topic jimu/WidgetManager jimu/PopupActions/PopupAction".split(" "),
function(n,d,f,h,c,p,l){return n([f],{name:null,map:null,popupUnion:null,editWidgetState:null,appConfig:null,constructor:function(){this.own(c.subscribe("appConfigChanged",d.hitch(this,this._onAppConfigChanged)))},postCreate:function(){this.inherited(arguments);this.editBtn=new l({popupUnion:this.popupUnion,buttonInfo:{label:window.jimuNls.popupManager.edit,baseClass:"edit",onClick:d.hitch(this,this._onEditClick)}});this.hide();this._updateEditWidgetState();this.own(h(this.editBtn,"selectionChange",
d.hitch(this,this._onSelectionChange)))},_updateEditWidgetState:function(){this.editWidgetState=this.appConfig.getConfigElementsByName("Edit")[0]},_onEditClick:function(a,c){this.editWidgetState&&this.editWidgetState.visible&&p.getInstance().triggerWidgetOpen(this.editWidgetState.id).then(d.hitch(this,function(b){c.mapPoint=c.target.location;c.graphic=a;b.reClickMap(c)}))},_onSelectionChange:function(a){this.editWidgetState&&this.editWidgetState.visible&&a._layer&&a._layer.isEditable&&a._layer.isEditable()?
this.show():this.hide()},_onAppConfigChanged:function(a){this.appConfig=a;this._updateEditWidgetState()},show:function(){this.editBtn.show()},hide:function(){this.editBtn.hide()},destroy:function(){this.editBtn.destroy();this.inherited(arguments)}})})},"jimu/OnScreenWidgetIcon":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dijit/_WidgetBase ./utils".split(" "),function(n,d,f,h,c,p,l){return n(p,{"class":"jimu-widget-onscreen-icon",postCreate:function(){this.inherited(arguments);
this.iconNode=h.create("img",{src:this.widgetConfig.icon},this.domNode);h.setAttr(this.domNode,"title",this.widgetConfig.label);h.setAttr(this.domNode,"data-widget-name",this.widgetConfig.name);this.own(c(this.domNode,"click",d.hitch(this,function(){this.onClick()})));this.position=d.clone(this.widgetConfig.position);"map"===this.widgetConfig.position.relativeTo&&this.own(c(this.map,"resize",d.hitch(this,function(){var a=d.clone(this.position);delete a.width;delete a.height;this.panel&&this.panel.setPosition(a)})));
this.state="closed"},startup:function(){this.inherited(arguments)},onClick:function(){"closed"===this.state?this.switchToOpen():this.switchToClose()},moveTo:function(a){var c={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},c=d.mixin(c,l.getPositionStyle(a));delete c.width;delete c.height;h.setStyle(this.domNode,c);this.position=d.clone(a);this.widgetConfig&&this.widgetConfig.panel&&(this.widgetConfig.panel.position=d.clone(a),this.widgetConfig.position=d.clone(a));this.panel&&
this.panel.setPosition(d.clone(a));this.widget&&this.widget.setPosition(this.getOffPanelWidgetPosition(this.widget))},destroy:function(){this.panel?this.panelManager.destroyPanel(this.panel):this.widget&&this.widgetManager.destroyWidget(this.widget);this.inherited(arguments)},switchToOpen:function(){this.state="opened";this.panelManager.closeAllPanelsInGroup(this.widgetConfig.gid);f.forEach(this.widgetManager.getOnScreenOffPanelWidgets(),function(a){a.closeable&&this.widgetManager.closeWidget(a)},
this);h.addClass(this.domNode,"jimu-state-selected");this._showLoading();!1===this.widgetConfig.inPanel?this.widgetManager.loadWidget(this.widgetConfig).then(d.hitch(this,function(a){this.widget=a;a.setPosition(this.getOffPanelWidgetPosition(a));this.widgetManager.openWidget(a);this.own(c(a,"close",d.hitch(this,function(){this.switchToClose()})));this._hideLoading()})):this.panelManager.showPanel(d.clone(this.widgetConfig)).then(d.hitch(this,function(a){this.panel=a;this.own(c(a,"close",d.hitch(this,
function(){this.switchToClose()})));this._hideLoading()}))},switchToClose:function(){this.state="closed";h.removeClass(this.domNode,"jimu-state-selected");!1===this.widgetConfig.inPanel?this.widgetManager.closeWidget(this.widget):this.panelManager.closePanel(this.panel)},getOffPanelWidgetPosition:function(a){var c={relativeTo:a.position.relativeTo},b=h.getMarginBox(this.domNode);a=this.widgetManager.getWidgetMarginBox(a);var d=h.getMarginBox("map"===c.relativeTo?this.map.id:jimuConfig.layoutId),q=
b.t+b.h+1;q+a.h>d.h?c.bottom=d.h-b.t+1:c.top=q;window.isRTL?c.right=0>b.l+b.w-a.w?0:b.l+b.w-a.w:b.l+a.w>d.w?c.right=0:c.left=b.l;return c},_showLoading:function(){h.setAttr(this.iconNode,"src",require.toUrl("jimu")+"/images/loading_circle.gif")},_hideLoading:function(){h.setAttr(this.iconNode,"src",this.widgetConfig.icon)}})})},"jimu/WidgetPlaceholder":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase","./utils"],function(n,d,f,h,c){return n(h,{"class":"jimu-widget-placeholder",
postCreate:function(){this.inherited(arguments);this.indexNode=f.create("div",{"class":"inner",innerHTML:this.index},this.domNode);f.setAttr(this.domNode,"title",window.jimuNls.widgetPlaceholderTooltip)},moveTo:function(p){var l={left:"auto",right:"auto",bottom:"auto",top:"auto",width:"auto",height:"auto"},l=d.mixin(l,c.getPositionStyle(p));delete l.width;delete l.height;f.setStyle(this.domNode,l)},setIndex:function(c){this.index=c;this.indexNode.innerHTML=c}})})},"jimu/DataManager":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/topic","./WidgetManager"],function(n,d,f,h){var c=null,p;p=n(null,{constructor:function(){f.subscribe("publishData",d.hitch(this,this.onDataPublished));f.subscribe("fetchData",d.hitch(this,this.onFetchData));f.subscribe("clearAllData",d.hitch(this,this.onClearAllData));f.subscribe("removeData",d.hitch(this,this.onRemoveData));f.subscribe("clearDataHistory",d.hitch(this,this.onClearDataHistory));this.widgetManager=h.getInstance()},_dataStore:{},onDataPublished:function(c,a,
k,b){"undefined"===typeof b&&(b=!1);this._dataStore[a]?(this._dataStore[a].current=k,b&&(this._dataStore[a].history?this._dataStore[a].history.push(k):this._dataStore[a].history=[k])):(this._dataStore[a]={current:k},b&&(this._dataStore[a].history=[k]))},onFetchData:function(c){var a;if(c)"framework"===c?this._dataStore[c]?f.publish("dataFetched","framework","framework",this._dataStore[c].current,this._dataStore[c].history):f.publish("noData","framework","framework"):(a=this.widgetManager.getWidgetById(c))?
this._dataStore[c]?f.publish("dataFetched",a.name,c,this._dataStore[c].current,this._dataStore[c].history):f.publish("noData",a.name,c):f.publish("noData",void 0,c);else for(var k in this._dataStore)(a=this.widgetManager.getWidgetById(k))&&f.publish("dataFetched",a.name,k,this._dataStore[k].current,this._dataStore[k].history)},onClearAllData:function(){this._dataStore={};f.publish("allDataCleared")},onRemoveData:function(c){delete this._dataStore[c];f.publish("dataRemoved",c)},onClearDataHistory:function(c){this._dataStore[c]&&
(this._dataStore[c].history=[]);f.publish("dataHistoryCleared",c)}});p.getInstance=function(){null===c&&(c=new p);return c};return p})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(n,d,f,h,c,p,l,a,k){return n([p,l],{type:"widget",id:void 0,label:void 0,icon:void 0,uri:void 0,position:{},config:void 0,openAtStart:!1,map:null,appConfig:null,folderUrl:null,
state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(c.subscribe("publishData",d.hitch(this,this._onReceiveData)));this.own(c.subscribe("dataFetched",d.hitch(this,this._onReceiveData)));this.own(c.subscribe("noData",d.hitch(this,this._onNoData)))},startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},
onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(a){},onSignOut:function(){},onPositionChange:function(a){this.setPosition(a)},setPosition:function(b,c){this.position=b;var k=a.getPositionStyle(this.position);k.position="absolute";c||(c="map"===b.relativeTo?this.map.id:window.jimuConfig.layoutId);h.place(this.domNode,c);h.setStyle(this.domNode,k);this.started&&this.resize()},getPosition:function(){return this.position},
getMarginBox:function(){return h.getMarginBox(this.domNode)},setMap:function(a){this.map=a},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){},onConfigChanged:function(a){},onAppConfigChanged:function(a,c,k){},onAction:function(a,c){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return k.getInstance().getPanelById(this.id+"_panel");var a=k.getInstance().getPanelById(this.gid+"_panel");
return a?a:k.getInstance().getPanelById(this.id+"_panel")},publishData:function(a,k){"undefined"===typeof k&&(k=!1);c.publish("publishData",this.name,this.id,a,k)},fetchData:function(a){a?c.publish("fetchData",a):0!==this.listenWidgetIds.length?f.forEach(this.listenWidgetIds,function(a){c.publish("fetchData",a)},this):c.publish("fetchData")},fetchDataByName:function(a){a=this.widgetManager.getWidgetsByName(a);f.forEach(a,function(a){this.fetchData(a.id)},this)},openWidgetById:function(a){return this.widgetManager.triggerWidgetOpen(a)},
_onReceiveData:function(a,c,k,d){if(c!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onReceiveData(a,c,k,d)},onReceiveData:function(a,c,k,d){},_onNoData:function(a,c){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(c)))this.onNoData(a,c)},onNoData:function(a,c){}})})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,d,f,h){return n([h],{widget:null,baseClass:"jimu-widget-frame jimu-container",
postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&("closed"!==this.widget.state&&d.isFunction(this.widget.resize))&&this.widget.resize()},setLoading:function(c){this.loading=c;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(c){this.widget=c;
this.loading&&this.loading.destroy();f.place(c.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&this.widget.domNode)try{this.widget.destroy()}catch(c){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+c.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),
function(n,d,f,h,c,p,l,a,k){return n([c,p],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var a=this.getAllWidgetConfigs(),a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];f.forEach(a,function(a){var b,c;!1!==a.visible&&(c=new l,b=this.createFrame(a),
this.addChild(b),b.setLoading(c),this.widgetManager.loadWidget(a).then(d.hitch(this,function(a){b.setWidget(a);a.startup()})))},this)},getAllWidgetConfigs:function(){var a=[];return a=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(a){for(var c=this.getChildren(),k=0;k<c.length;k++)if(c[k].getWidget()&&c[k].getWidget().id===a)return c[k].getWidget()},createFrame:function(b){return new a},setPosition:function(a,c){this.position=a;var d=k.getPositionStyle(this.position);
d.position="absolute";c||(c="map"===a.relativeTo?this.map.id:window.jimuConfig.layoutId);this.started?this.resize():this.openAnimation&&(d.display="none");h.place(this.domNode,c);h.setStyle(this.domNode,d)},getPosition:function(){return this.position},setState:function(a){this.state=a},setWindowState:function(a){this.windowState=a},resize:function(){this.getChildren().forEach(function(a){a.resize()})},onPositionChange:function(a){this.setPosition(a)},onOpen:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.openWidget(a.getWidget())},this)},onClose:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.closeWidget(a.getWidget())},this)},onMaximize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.maximizeWidget(a.getWidget())},this)},onMinimize:function(){f.forEach(this.getChildren(),function(a){a.getWidget()&&this.widgetManager.minimizeWidget(a.getWidget())},this)},onNormalize:function(){f.forEach(this.getChildren(),
function(a){a.getWidget()&&this.widgetManager.normalizeWidget(a.getWidget())},this)},onActive:function(){},onDeActive:function(){},updateConfig:function(a){this._updateConfig(a)},reloadWidget:function(a){this.isWidgetInPanel(a)&&(this._updateConfig(a),this.getChildren().forEach(function(c){c.getWidget()&&c.getWidget().id===a.id&&(c.getWidget().destroy(),c.setLoading(new l),this.widgetManager.loadWidget(a).then(d.hitch(this,function(a){c.setWidget(a);a.startup();"closed"===this.state&&this.widgetManager.closeWidget(a)})))},
this))},isWidgetInPanel:function(a){return f.some(this.getAllWidgetConfigs(),function(c){if(a.id===c.id)return!0})?!0:!1},_updateConfig:function(a){if(Array.isArray(this.config.widgets)){for(var c=-1,k=0;k<this.config.widgets.length;k++)this.config.widgets[k].id===a.id&&(c=k);0<c&&(this.config.widgets[c]=a)}else this.config=a},destroy:function(){this.getChildren().forEach(function(a){try{a.domNode&&a.destroy()}catch(c){console.error("destroy widget frame error."+c.stack)}});this.inherited(arguments)}})})},
"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,d,f,h,c){return n([h,c],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(f(window,"resize",d.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/symbolUtils":function(){define(["dojo/_base/lang","dojo/_base/html","dojox/gfx","esri/symbols/jsonUtils"],
function(n,d,f,h){return{cloneSymbol:function(c){if(!c)return null;var d=null;try{var f=c.toJson(),d=h.fromJson(f)}catch(a){console.error(a)}return d},getDefaultMarkerSymbol:function(){return h.fromJson({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})},getDefaultLineSymbol:function(){return h.fromJson({tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"})},getDefaultFillSymbol:function(){return h.fromJson({tags:["opaque"],
title:"Blue",style:"esriSFSSolid",color:[79,129,189,255],name:"Blue 6",type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}})},getHightlightMarkerSymbol:function(){return h.fromJson({color:[255,255,255,128],size:18,angle:0,xoffset:0,yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"}})},getHightlightLineSymbol:function(){return h.fromJson({color:[0,255,255,255],width:1.5,type:"esriSLS",
style:"esriSLSSolid"})},getHightlightFillSymbol:function(){return h.fromJson({color:[255,255,255,128],outline:{color:[0,255,255,255],width:1.5,type:"esriSLS",style:"esriSLSSolid"},type:"esriSFS",style:"esriSFSSolid"})},createSymbolNode:function(c,p){var l=32,a=32,k=d.create("div",{},document.body);d.setStyle(k,"display","inline-block");if(p)l=p.width,a=p.height;else if(l=80,a=30,this.isSimpleMarkerSymbol(c))a=l=Math.min(c.size+12,125);else if(this.isPictureMarkerSymbol(c)){if(!c.url||"http://"===
c.url||-1===c.url.indexOf("http://")&&-1===c.url.indexOf("https://")&&-1===c.url.indexOf("data:"))return;a=l=Math.min(Math.max(c.width,c.height),125)}else if(this.isSimpleLineSymbol(c)||this.isCartographicLineSymbol(c))l=190,a=20;var b=f.createSurface(k,l,a);if("vml"===f.renderer){var s=b.getEventSource();d.setStyle(s,"position","relative");d.setStyle(s.parentNode,"position","relative")}var s=null,s=p?h.getShapeDescriptors(c):this.isSimpleLineSymbol(c)||this.isCartographicLineSymbol(c)?this._getLineShapeDesc(c):
h.getShapeDescriptors(c),q;try{q=b.createShape(s.defaultShape),s.fill&&q.setFill(s.fill),s.stroke&&q.setStroke(s.stroke)}catch(r){b.clear();b.destroy();return}var b=b.getDimensions(),b={dx:b.width/2,dy:b.height/2},m=q.getBoundingBox(),s=m.width,m=m.height;if(s>l||m>a)l=((l<a?l:a)-5)/(s>m?s:m),n.mixin(b,{xx:l,yy:l});q.applyTransform(b);return k},_getLineShapeDesc:function(c){var d=null;if(this.isSimpleLineSymbol(c)||this.isCartographicLineSymbol(c))d={defaultShape:{type:"path",path:"M -90,0 L 90,0 E"},
fill:null,stroke:c.getStroke()};return d},isSimpleMarkerSymbol:function(c){return c&&"esri.symbol.SimpleMarkerSymbol"===c.declaredClass},isPictureMarkerSymbol:function(c){return c&&"esri.symbol.PictureMarkerSymbol"===c.declaredClass},isSimpleLineSymbol:function(c){return c&&"esri.symbol.SimpleLineSymbol"===c.declaredClass},isCartographicLineSymbol:function(c){return c&&"esri.symbol.CartographicLineSymbol"===c.declaredClass},isSimpleFillSymbol:function(c){return c&&"esri.symbol.SimpleFillSymbol"===
c.declaredClass},isPictureFillSymbol:function(c){return c&&"esri.symbol.PictureFillSymbol"===c.declaredClass},isTextSymbol:function(c){return c&&"esri.symbol.TextSymbol"===c.declaredClass}}})},"jimu/filterUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/date/locale esri/lang dojo/data/ItemFileWriteStore jimu/utils".split(" "),function(n,d,f,h,c,p,l){return n([],{_stringFieldType:"esriFieldTypeString",_dateFieldType:"esriFieldTypeDate",_numberFieldTypes:["esriFieldTypeOID",
"esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],_supportFieldTypes:[],dayInMS:86399E3,fieldsStore:null,isHosted:!1,constructor:function(){String.prototype.startsWith=function(a){return 0===this.indexOf(a)};String.prototype.endsWith=function(a){return this.substring(this.length-a.length)===a};String.prototype.count=function(a){return this.split(a).length-1};String.prototype.trim||(String.prototype.trim=d.trim);this._supportFieldTypes=[];this._supportFieldTypes.push(this._stringFieldType);
this._supportFieldTypes.push(this._dateFieldType);this._supportFieldTypes=this._supportFieldTypes.concat(this._numberFieldTypes)},OPERATORS:{stringOperatorIs:"stringOperatorIs",stringOperatorIsNot:"stringOperatorIsNot",stringOperatorStartsWith:"stringOperatorStartsWith",stringOperatorEndsWith:"stringOperatorEndsWith",stringOperatorContains:"stringOperatorContains",stringOperatorDoesNotContain:"stringOperatorDoesNotContain",stringOperatorIsBlank:"stringOperatorIsBlank",stringOperatorIsNotBlank:"stringOperatorIsNotBlank",
numberOperatorIs:"numberOperatorIs",numberOperatorIsNot:"numberOperatorIsNot",numberOperatorIsAtLeast:"numberOperatorIsAtLeast",numberOperatorIsLessThan:"numberOperatorIsLessThan",numberOperatorIsAtMost:"numberOperatorIsAtMost",numberOperatorIsGreaterThan:"numberOperatorIsGreaterThan",numberOperatorIsBetween:"numberOperatorIsBetween",numberOperatorIsNotBetween:"numberOperatorIsNotBetween",numberOperatorIsBlank:"numberOperatorIsBlank",numberOperatorIsNotBlank:"numberOperatorIsNotBlank",dateOperatorIsOn:"dateOperatorIsOn",
dateOperatorIsNotOn:"dateOperatorIsNotOn",dateOperatorIsBefore:"dateOperatorIsBefore",dateOperatorIsAfter:"dateOperatorIsAfter",dateOperatorIsBetween:"dateOperatorIsBetween",dateOperatorIsNotBetween:"dateOperatorIsNotBetween",dateOperatorIsBlank:"dateOperatorIsBlank",dateOperatorIsNotBlank:"dateOperatorIsNotBlank",dateOperatorDays:"dateOperatorDays",dateOperatorWeeks:"dateOperatorWeeks",dateOperatorMonths:"dateOperatorMonths",dateOperatorInTheLast:"dateOperatorInTheLast",dateOperatorNotInTheLast:"dateOperatorNotInTheLast"},
prepare:function(a,c){this.isHosted=l.isHostedService(a);this.setFieldsStoreByFieldInfos(c)},isPartsObjHasError:function(a){var c=!1;a&&(c=a.parts&&0<=a.parts.length?f.every(a.parts,d.hitch(this,function(a){return a.parts?0<a.parts.length?f.every(a.parts,d.hitch(this,function(a){return!a.error})):!1:!a.error})):!1);return!c},isAskForValues:function(a){var c=!1;return c=f.some(a.parts,d.hitch(this,function(a){return a.parts?f.some(a.parts,d.hitch(this,function(a){return!!a.interactiveObj})):!!a.interactiveObj}))},
setFieldsStoreByFieldInfos:function(a){a=f.filter(a,d.hitch(this,function(a){return 0<=this._supportFieldTypes.indexOf(a.type)}));a=f.map(a,function(a,b){var c;switch(a.type){case "esriFieldTypeString":c="string";break;case "esriFieldTypeDate":c="date";break;default:c="number"}return{id:b,label:a.name,shortType:c,alias:a.alias,editable:a.editable,name:a.name,nullable:a.nullable,type:a.type}},this);this.fieldsStore=new p({data:{identifier:"id",label:"label",items:a}});return a.length},_validatePartsObj:function(a){return a&&
"object"===typeof a},_isObject:function(a){return a&&"object"===typeof a},_isString:function(a){return a&&"string"===typeof a},containsNonLatinCharacter:function(a){for(var c=0;c<a.length;c++)if(255<a.charCodeAt(c))return!0;return!1},getExprByFilterObj:function(a){if(!f.every(a.parts,function(a){return!!a}))return null;if(!this.isPartsObjReadyToBuild(a))return a.expr="",a.expr;var k="";if(0===a.parts.length)k="1\x3d1";else if(1===a.parts.length)k=this.builtFilterString(a.parts[0]);else for(var b=
"",d=0;d<a.parts.length;d++){var q=this.builtFilterString(a.parts[d]);if(!c.isDefined(q))return null;k+=b+"("+q+")";b=b||" "+a.logicalOperator+" "}return a.expr=k},isPartsObjReadyToBuild:function(a){return f.every(a.parts,d.hitch(this,function(a){return a.parts?f.every(a.parts,d.hitch(this,function(a){return this._isPartReadyToBuild(a)})):this._isPartReadyToBuild(a)}))},_isPartReadyToBuild:function(a){var c=a.fieldObj.shortType,b=a.operator,d=a.valueObj;a=d.type||"value";var q=d.value,r=d.value1,
d=d.value2;if("value"===a){if("string"===c)return b===this.OPERATORS.stringOperatorIsBlank||b===this.OPERATORS.stringOperatorIsNotBlank?!0:l.isNotEmptyString(q);if("number"===c)return b===this.OPERATORS.numberOperatorIsBlank||b===this.OPERATORS.numberOperatorIsNotBlank?!0:b===this.OPERATORS.numberOperatorIsBetween||b===this.OPERATORS.numberOperatorIsNotBetween?l.isValidNumber(r)&&l.isValidNumber(d):l.isValidNumber(q);if("date"===c)return b===this.OPERATORS.dateOperatorIsBlank||b===this.OPERATORS.dateOperatorIsNotBlank?
!0:b===this.OPERATORS.dateOperatorIsBetween||b===this.OPERATORS.dateOperatorIsNotBetween?l.isNotEmptyString(r)&&l.isNotEmptyString(d):l.isNotEmptyString(q)}else{if("field"===a)return l.isNotEmptyString(q);if("unique"===a){if("string"===c)return l.isNotEmptyString(q);if("number"===c)return l.isValidNumber(q)}}return!1},builtFilterString:function(a){var k="";if(a.parts)for(var b="",d=0;d<a.parts.length;d++){var q=a.parts[d],r=this.builtSingleFilterString(q);q.expr=r.whereClause;if(!c.isDefined(r.whereClause))return null;
k+=b+r.whereClause;b=" "+a.logicalOperator+" "}else k=this.builtSingleFilterString(a).whereClause;return a.expr=k},builtSingleFilterString:function(a,k){this.isHosted&&(a.caseSensitive=!1);if(c.isDefined(a.valueObj.isValid)&&!a.valueObj.isValid)return{whereClause:null};var b=a.valueObj.value,d=a.valueObj.value1,q=a.valueObj.value2,r=!1;a.interactiveObj&&c.isDefined(k)&&(r=!0,c.isDefined(a.valueObj.value)&&(b="{"+k+"}"),c.isDefined(a.valueObj.value1)&&(d="{"+k+"}"),c.isDefined(a.valueObj.value2)&&
(q="{"+(k+1)+"}"));var m="";if("string"===a.fieldObj.shortType)switch(d="",r&&this.isHosted?d="N":b&&"field"!==a.valueObj.type&&this.isHosted&&this.containsNonLatinCharacter(b)&&(d="N"),a.operator){case this.OPERATORS.stringOperatorIs:m="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+b:a.fieldObj.name+" \x3d "+d+"'"+b.replace(/\'/g,"''")+"'";break;case this.OPERATORS.stringOperatorIsNot:m="field"===a.valueObj.type?a.fieldObj.name+" \x3c\x3e "+b:a.fieldObj.name+" \x3c\x3e "+d+"'"+b.replace(/\'/g,
"''")+"'";break;case this.OPERATORS.stringOperatorStartsWith:m=a.caseSensitive?a.fieldObj.name+" LIKE "+d+"'"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+d+"'"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorEndsWith:m=a.caseSensitive?a.fieldObj.name+" LIKE "+d+"'%"+b.replace(/\'/g,"''")+"'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+d+"'%"+b.replace(/\'/g,"''")+"')";break;case this.OPERATORS.stringOperatorContains:m=a.caseSensitive?a.fieldObj.name+" LIKE "+
d+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") LIKE UPPER("+d+"'%"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorDoesNotContain:m=a.caseSensitive?a.fieldObj.name+" NOT LIKE "+d+"'%"+b.replace(/\'/g,"''")+"%'":"UPPER("+a.fieldObj.name+") NOT LIKE UPPER("+d+"'%"+b.replace(/\'/g,"''")+"%')";break;case this.OPERATORS.stringOperatorIsBlank:m=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.stringOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}else if("number"===
a.fieldObj.shortType)switch(a.operator){case this.OPERATORS.numberOperatorIs:m=a.fieldObj.name+" \x3d "+b;break;case this.OPERATORS.numberOperatorIsNot:m=a.fieldObj.name+" \x3c\x3e "+b;break;case this.OPERATORS.numberOperatorIsAtLeast:m=a.fieldObj.name+" \x3e\x3d "+b;break;case this.OPERATORS.numberOperatorIsLessThan:m=a.fieldObj.name+" \x3c "+b;break;case this.OPERATORS.numberOperatorIsAtMost:m=a.fieldObj.name+" \x3c\x3d "+b;break;case this.OPERATORS.numberOperatorIsGreaterThan:m=a.fieldObj.name+
" \x3e "+b;break;case this.OPERATORS.numberOperatorIsBetween:m=a.fieldObj.name+" BETWEEN "+d+" AND "+q;break;case this.OPERATORS.numberOperatorIsNotBetween:m=a.fieldObj.name+" NOT BETWEEN "+d+" AND "+q;break;case this.OPERATORS.numberOperatorIsBlank:m=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.numberOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}else switch(c.isDefined(b)&&("field"!==a.valueObj.type&&"string"===typeof b)&&(b=new Date(b)),"field"!==a.valueObj.type&&(b&&(b=new Date(b)),
d&&(d=new Date(d)),q&&(q=new Date(q))),a.operator){case this.OPERATORS.dateOperatorIsOn:m="field"===a.valueObj.type?a.fieldObj.name+" \x3d "+b:r?a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+k+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(k+1)+"}'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+"'";break;case this.OPERATORS.dateOperatorIsNotOn:m="field"===a.valueObj.type?
a.fieldObj.name+" \x3c\x3e "+b:r?a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'{"+k+"}' AND "+(this.isHosted?"":"timestamp ")+"'{"+(k+1)+"}'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+"'";break;case this.OPERATORS.dateOperatorIsBefore:m="field"===a.valueObj.type?a.fieldObj.name+" \x3c "+b:a.fieldObj.name+" \x3c "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(b)+
"'";break;case this.OPERATORS.dateOperatorIsAfter:m="field"===a.valueObj.type?a.fieldObj.name+" \x3e "+b:a.fieldObj.name+" \x3e "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(b))+"'";break;case this.OPERATORS.dateOperatorIsBetween:m=r?a.fieldObj.name+" BETWEEN '"+d+"' AND '"+q+"'":a.fieldObj.name+" BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(d)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(q))+"'";break;case this.OPERATORS.dateOperatorIsNotBetween:m=
r?a.fieldObj.name+" NOT BETWEEN '"+d+"' AND '"+q+"'":a.fieldObj.name+" NOT BETWEEN "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(d)+"' AND "+(this.isHosted?"":"timestamp ")+"'"+this.formatDate(this.addDay(q))+"'";break;case this.OPERATORS.dateOperatorIsBlank:m=a.fieldObj.name+" IS NULL";break;case this.OPERATORS.dateOperatorIsNotBlank:m=a.fieldObj.name+" IS NOT NULL"}return{whereClause:m}},formatDate:function(a){var c=h.format(a,{datePattern:"yyyy-MM-dd",selector:"date"});a=h.format(a,{selector:"time",
timePattern:"HH:mm:ss"});return c+" "+a},addDay:function(a){return new Date(a.getTime()+this.dayInMS)},getFilterObjByExpr:function(a){if(a&&this.fieldsStore){var c=this.replaceStrings(a);a=c.defExpr;var b=this.findParts(a,"AND");1===b.parts.length&&(b=this.findParts(a,"OR"),1===b.parts.length&&(b.logicalOperator="AND"));f.forEach(b.parts,function(a){a.expr=a.expr.trim();if(a.expr.startsWith("(")&&-1<a.expr.search(/\)$/)){var b=a.expr.substring(1,a.expr.length-1),c=b.indexOf("("),k=b.indexOf(")");
if(-1===c&&-1===k||c<k)a.expr=b}b=this.findParts(a.expr,"AND");1===b.parts.length&&(b=this.findParts(a.expr,"OR"));1<b.parts.length&&(a.parts=b.parts,a.logicalOperator=b.logicalOperator)},this);this.parseExpr(b);this.reReplaceStrings(c,b,d.hitch(this,function(){b&&b.parts&&f.forEach(b.parts,d.hitch(this,function(a){a&&(a.parts?f.forEach(a.parts,d.hitch(this,function(a){this._handleParsedValuesForSinglePart(a);this._addDefalutValueTypeForSinglePart(a)})):(this._handleParsedValuesForSinglePart(a),this._addDefalutValueTypeForSinglePart(a)))}))}));
this.isPartsObjHasError(b)&&(b=null);return b}},_handleParsedValuesForSinglePart:function(a){a&&(a.fieldObj&&"number"===a.fieldObj.shortType&&a.valueObj)&&(a.valueObj.hasOwnProperty("value")&&(a.valueObj.value=parseFloat(a.valueObj.value)),a.valueObj.hasOwnProperty("value1")&&(a.valueObj.value1=parseFloat(a.valueObj.value1)),a.valueObj.hasOwnProperty("value2")&&(a.valueObj.value2=parseFloat(a.valueObj.value2)))},_addDefalutValueTypeForSinglePart:function(a){a&&a.valueObj&&!a.valueObj.type&&(a.valueObj.type=
"value")},replaceStrings:function(a){for(var c=a,b=function(a,c,k){var d=-1,d=a.indexOf("'",k+1);return d===k+1?(d=a.indexOf("'",d+1),b(a,c,d)):k},d=[],q=a.indexOf("'");-1<q;){var r=q,q=a.indexOf("'",q+1),m=0,q=b(a,r,q);"%"===a[r+1]&&r++;"%"===a[q-1]&&(q-=1,m++);var f=a.substring(r+1,q);"N"===a[r-1]&&(a=a.substring(0,r-1)+a.substring(r),r-=1,q-=1);!this.isDateString(f)&&-1===f.indexOf("{")?(d.push(f),a=a.substring(0,r+1)+"#"+(d.length-1)+"#"+a.substring(q),q=a.indexOf("'",a.lastIndexOf("#")+2+m)):
q=a.indexOf("'",q+1+m)}return{origDefExpr:c,defExpr:a,savedStrings:d}},reReplaceStrings:function(a,k,b){var l=a.savedStrings;if(l.length){if(l.length){var q=function(a,b){if("string"!==a.fieldObj.shortType)return!1;var e=a.valueObj.value.indexOf("#"),k=a.valueObj.value.lastIndexOf("#");return c.isDefined(a.valueObj.value)&&-1<e?(a.valueObj.value=b[parseInt(a.valueObj.value.substring(e+1,k),10)].replace(/\'\'/g,"'"),this.builtSingleFilterString(a),!0):!1},q=d.hitch(this,q),r=!1;f.forEach(k.parts,function(a){if(a.parts){var b=
!1;f.forEach(a.parts,function(a){b=q(a,l)||b});b&&(r=b,a.expr=this.builtFilterString(a))}else(r=q(a,l)||r)&&this.builtFilterString(a)},this);b&&"function"===typeof b&&b();r&&(k.expr=null,this.getExprByFilterObj(k))}}else b&&"function"===typeof b&&b()},isDateString:function(a){return 19===a.length&&"-"===a.charAt(4)&&"-"===a.charAt(7)&&" "===a.charAt(10)&&":"===a.charAt(13)&&":"===a.charAt(16)?!0:!1},findParts:function(a,c){for(var b=a.toLowerCase(),d=" "+c.toLowerCase()+" ",q=[],r=0,m=b.indexOf(d);0<
m;){var f=a.substring(r,m),e=f.toLowerCase(),g=f.count("("),l=f.count(")"),p=f.count("'");g!==l||1===p%2?m=b.indexOf(d,m+1):-1<e.indexOf(" between ")&&-1===e.indexOf(" and ")?m=b.indexOf(d,m+1):(q.push({expr:f}),r=m+d.length,m=b.indexOf(d,r))}q.push({expr:a.substring(r)});for(b=q.length-1;0<=b;b--)!this.hasOperator(q[b].expr)&&0<b&&(q[b-1].expr+=" "+c+" "+q[b].expr,q.splice(b,1));return{expr:a,parts:q,logicalOperator:c}},hasOperator:function(a){a=a.toLowerCase();return-1<a.indexOf("{")&&-1<a.indexOf("}")||
-1<a.indexOf(" \x3d ")||-1<a.indexOf(" \x3c ")||-1<a.indexOf(" \x3e ")||-1<a.indexOf(" \x3c\x3e ")||-1<a.indexOf(" \x3c\x3d ")||-1<a.indexOf(" \x3e\x3d ")||-1<a.indexOf(" like ")||-1<a.indexOf(" between ")||-1<a.indexOf(" date")||-1<a.indexOf(" is null")||-1<a.indexOf(" is not null")?!0:!1},parseExpr:function(a){f.forEach(a.parts,function(a){a.parts?this.parseExpr(a):this.parseSingleExpr(a)},this)},_preParseSingleExpr:function(a){var c=null;try{if(c=d.clone(a),c.expr=c.expr.trim(),/^UPPER\((.*)\)(\s+|\s+NOT\s+)LIKE\s+UPPER\(N?'(.*)'\)$/i.test(c.expr)){var b=
a="",f=c.expr.match(/^UPPER\((.*)\)\s+/i);if(f&&2<=f.length)a=f[1];else return null;var q=c.expr.match(/UPPER\(N?'(.*)'\)$/i);if(q&&2<=q.length)b="'"+q[1]+"'";else return null;c.expr=c.expr.replace(/^UPPER\((.*)\)\s+/i,a+" ");c.expr=c.expr.replace(/UPPER\(N?'(.*)'\)$/i,b);c.caseSensitive=!1}else/^(.+)(\s+|\s+NOT\s+)LIKE\s+N?'(.*)'$/i.test(c.expr)&&(c.caseSensitive=!0)}catch(r){return console.log(r),null}c&&this.isHosted&&(c.caseSensitive=!1);return c},parseSingleExpr:function(a){var k=this._preParseSingleExpr(a);
k&&(a=d.mixin(a,k));var k=a.expr.trim(),b=k.indexOf(" "),f=k.substring(0,b);a.fieldObj={name:f};a.valueObj={};this.getFieldItemByName({name:f},function(b){a.fieldObj.shortType=b.shortType[0];a.fieldObj.label=b.label[0]},function(){a.error={msg:"unknown field name ("+f+")",code:1}});k=k.substring(b+1).trim();b=k.toLowerCase();b.startsWith("\x3d ")?(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(12).trim():k.substring(2).trim(),this.storeValue(k,a),a.operator="date"===a.fieldObj.shortType?
this.OPERATORS.dateOperatorIsOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIs:this.OPERATORS.numberOperatorIs):b.startsWith("\x3c ")?(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(12).trim():k.substring(2).trim(),this.storeValue(k,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsBefore:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsLessThan:a.error={msg:"operator ("+b+") not supported for string",code:3}):b.startsWith("\x3e ")?
(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(12).trim():k.substring(2).trim(),this.storeValue(k,a),"date"===a.fieldObj.shortType?a.operator=this.OPERATORS.dateOperatorIsAfter:"number"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsGreaterThan:a.error={msg:"operator ("+b+") not supported for string",code:3}):b.startsWith("\x3c\x3e ")?(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(13).trim():k.substring(3).trim(),this.storeValue(k,a),a.operator="date"===
a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotOn:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNot:this.OPERATORS.numberOperatorIsNot):b.startsWith("\x3c\x3d ")?(this.storeValue(k.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtMost):b.startsWith("\x3e\x3d ")?(this.storeValue(k.substring(3).trim(),a),a.operator=this.OPERATORS.numberOperatorIsAtLeast):b.startsWith("like ")?(k=k.substring(5).trim(),k.startsWith("N'")&&(k=k.substring(1,k.length)),k.startsWith("'%")&&
k.endsWith("%'")?(this.storeValue(k.substring(2,k.length-2),a),a.operator=this.OPERATORS.stringOperatorContains):k.startsWith("'%")&&k.endsWith("'")?(this.storeValue(k.substring(2,k.length-1),a),a.operator=this.OPERATORS.stringOperatorEndsWith):k.startsWith("'")&&k.endsWith("%'")?(this.storeValue(k.substring(1,k.length-2),a),a.operator=this.OPERATORS.stringOperatorStartsWith):a.error={msg:"value ("+b+") not supported for LIKE",code:3}):b.startsWith("not like ")?(k=k.substring(9).trim(),k.startsWith("N'")&&
(k=k.substring(1,k.length)),k.startsWith("'%")&&k.endsWith("%'")?(this.storeValue(k.substring(2,k.length-2),a),a.operator=this.OPERATORS.stringOperatorDoesNotContain):a.error={msg:"value ("+b+") not supported for NOT LIKE",code:3}):b.startsWith("between ")?(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(18).trim():k.substring(8).trim(),b=k.toLowerCase().indexOf(" and "),-1<b?(this.storeValue1(k.substring(0,b).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(k.substring(b+
15).trim(),a):this.storeValue2(k.substring(b+5).trim(),a)):a.error={msg:"missing AND operator for BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsOn):a.operator=this.OPERATORS.dateOperatorIsBetween:"number"===
a.fieldObj.shortType||"oid"===a.fieldObj.shortType?a.operator=this.OPERATORS.numberOperatorIsBetween:a.error={msg:"string field not supported for BETWEEN",code:3}):b.startsWith("not between ")?(k="date"===a.fieldObj.shortType&&!this.isHosted?k.substring(22).trim():k.substring(12).trim(),b=k.toLowerCase().indexOf(" and "),-1<b?(this.storeValue1(k.substring(0,b).trim(),a),"date"===a.fieldObj.shortType&&!this.isHosted?this.storeValue2(k.substring(b+15).trim(),a):this.storeValue2(k.substring(b+5).trim(),
a)):a.error={msg:"missing AND operator for NOT BETWEEN",code:3},"date"===a.fieldObj.shortType?"string"===typeof a.valueObj.value1?a.operator=this.OPERATORS.dateOperatorIsNotBetween:1E3>Math.abs(this.subtractDay(a.valueObj.value2).getTime()-a.valueObj.value1.getTime())?(a.valueObj.value=a.valueObj.value1,delete a.valueObj.value1,delete a.valueObj.value2,a.operator=this.OPERATORS.dateOperatorIsNotOn):a.operator=this.OPERATORS.dateOperatorIsNotBetween:"number"===a.fieldObj.shortType||"oid"===a.fieldObj.shortType?
a.operator=this.OPERATORS.numberOperatorIsNotBetween:a.error={msg:"string field not supported for NOT BETWEEN",code:3}):"is null"===b?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsBlank:this.OPERATORS.numberOperatorIsBlank):"is not null"===b?(a.valueObj.value=null,a.operator="date"===a.fieldObj.shortType?this.OPERATORS.dateOperatorIsNotBlank:"string"===a.fieldObj.shortType?this.OPERATORS.stringOperatorIsNotBlank:
this.OPERATORS.numberOperatorIsNotBlank):a.error={msg:"unknown operator ("+b+")",code:2};if(c.isDefined(a.valueObj.value)&&"string"===typeof a.valueObj.value&&a.valueObj.value.startsWith("{")&&a.valueObj.value.endsWith("}")||c.isDefined(a.valueObj.value1)&&"string"===typeof a.valueObj.value1&&a.valueObj.value1.startsWith("{")&&a.valueObj.value1.endsWith("}"))a.isInteractive=!0},getFieldItemByName:function(a,c,b){this.fieldsStore.fetch({query:a,onComplete:d.hitch(this,function(a){a&&a.length?c(a[0]):
b()})})},subtractDay:function(a){return new Date(a.getTime()-this.dayInMS)},storeValue:function(a,c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value=a;else if(a.startsWith("'{")&&a.endsWith("}'"))c.valueObj.value=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value=this.parseDate(b)}else c.valueObj.value=a,c.valueObj.type="field";else"string"===c.fieldObj.shortType?(a.startsWith("#")||a.startsWith("%#"))&&
(a.endsWith("#")||a.endsWith("#%"))?c.valueObj.value=a:a.startsWith("'")&&a.endsWith("'")?c.valueObj.value=a.substring(1,a.length-1).replace(/\'\'/g,"'"):(c.valueObj.value=a,c.valueObj.type="field",this.getFieldItemByName({name:a},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+a+")",code:1}})):(c.valueObj.value=a,isNaN(a)&&(c.valueObj.type="field",this.getFieldItemByName({name:a},function(a){c.valueObj.label=a.label[0]},function(){c.error={msg:"unknown field name ("+
a+")",code:1}})))},storeValue1:function(a,c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value1=a;else if(a.startsWith("'{")&&a.endsWith("}'"))c.valueObj.value1=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value1=this.parseDate(b)}else c.valueObj.value1=a,c.valueObj.type="field";else c.valueObj.value1=a,isNaN(a)&&(c.valueObj.type="field")},storeValue2:function(a,c){if(a.startsWith("{")&&a.endsWith("}"))c.valueObj.value2=
a;else if(a.startsWith("'{")&&a.endsWith("}'"))c.valueObj.value2=a.substring(1,a.length-1);else if("date"===c.fieldObj.shortType)if(a.startsWith("'")&&a.endsWith("'")){var b=a.substring(1,a.length-1);c.valueObj.value2=this.parseDate(b)}else c.valueObj.value2=a,c.valueObj.type="field";else c.valueObj.value2=a,isNaN(a)&&(c.valueObj.type="field")},parseDate:function(a){var c=h.parse(a,{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"});c||(c=h.parse(a.replace(" ",", "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}))||
(c=h.parse(a.replace(" "," - "),{datePattern:"yyyy-MM-dd",timePattern:"HH:mm:ss"}));return c}})})},"dojo/data/ItemFileWriteStore":function(){define("../_base/lang ../_base/declare ../_base/array ../_base/json ../_base/kernel ./ItemFileReadStore ../date/stamp".split(" "),function(n,d,f,h,c,p,l){return d("dojo.data.ItemFileWriteStore",p,{constructor:function(a){this._features["dojo.data.api.Write"]=!0;this._features["dojo.data.api.Notification"]=!0;this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};
this._datatypeMap.Date.serialize||(this._datatypeMap.Date.serialize=function(a){return l.toISOString(a,{zulu:!0})});a&&!1===a.referenceIntegrity&&(this.referenceIntegrity=!1);this._saveInProgress=!1},referenceIntegrity:!0,_assert:function(a){if(!a)throw Error("assertion failed in ItemFileWriteStore");},_getIdentifierAttribute:function(){return this.getFeatures()["dojo.data.api.Identity"]},newItem:function(a,c){this._assert(!this._saveInProgress);this._loadFinished||this._forceLoad();if("object"!=
typeof a&&"undefined"!=typeof a)throw Error("newItem() was passed something other than an object");var b=null,d=this._getIdentifierAttribute();if(d===Number)b=this._arrayOfAllItems.length;else{b=a[d];if("undefined"===typeof b)throw Error("newItem() was not passed an identity for the new item");if(n.isArray(b))throw Error("newItem() was not passed an single-valued identity");}this._itemsByIdentity&&this._assert("undefined"===typeof this._itemsByIdentity[b]);this._assert("undefined"===typeof this._pending._newItems[b]);
this._assert("undefined"===typeof this._pending._deletedItems[b]);var q={};q[this._storeRefPropName]=this;q[this._itemNumPropName]=this._arrayOfAllItems.length;this._itemsByIdentity&&(this._itemsByIdentity[b]=q,q[d]=[b]);this._arrayOfAllItems.push(q);d=null;if(c&&c.parent&&c.attribute){var d={item:c.parent,attribute:c.attribute,oldValue:void 0},r=this.getValues(c.parent,c.attribute);if(r&&0<r.length){var m=r.slice(0,r.length);d.oldValue=1===r.length?r[0]:r.slice(0,r.length);m.push(q);this._setValueOrValues(c.parent,
c.attribute,m,!1);d.newValue=this.getValues(c.parent,c.attribute)}else this._setValueOrValues(c.parent,c.attribute,q,!1),d.newValue=q}else q[this._rootItemPropName]=!0,this._arrayOfTopLevelItems.push(q);this._pending._newItems[b]=q;for(var f in a){if(f===this._storeRefPropName||f===this._itemNumPropName)throw Error("encountered bug in ItemFileWriteStore.newItem");b=a[f];n.isArray(b)||(b=[b]);q[f]=b;if(this.referenceIntegrity)for(r=0;r<b.length;r++)m=b[r],this.isItem(m)&&this._addReferenceToMap(m,
q,f)}this.onNew(q,d);return q},_removeArrayElement:function(a,c){var b=f.indexOf(a,c);return-1!=b?(a.splice(b,1),!0):!1},deleteItem:function(a){this._assert(!this._saveInProgress);this._assertIsItem(a);var c=a[this._itemNumPropName],b=this.getIdentity(a);if(this.referenceIntegrity){var d=this.getAttributes(a);a[this._reverseRefMap]&&(a["backup_"+this._reverseRefMap]=n.clone(a[this._reverseRefMap]));f.forEach(d,function(b){f.forEach(this.getValues(a,b),function(c){this.isItem(c)&&(a["backupRefs_"+
this._reverseRefMap]||(a["backupRefs_"+this._reverseRefMap]=[]),a["backupRefs_"+this._reverseRefMap].push({id:this.getIdentity(c),attr:b}),this._removeReferenceFromMap(c,a,b))},this)},this);if(d=a[this._reverseRefMap])for(var q in d){var r=null;if(r=this._itemsByIdentity?this._itemsByIdentity[q]:this._arrayOfAllItems[q])for(var m in d[q]){var l=this.getValues(r,m)||[],e=f.filter(l,function(a){return!(this.isItem(a)&&this.getIdentity(a)==b)},this);this._removeReferenceFromMap(a,r,m);e.length<l.length&&
this._setValueOrValues(r,m,e,!0)}}}this._arrayOfAllItems[c]=null;a[this._storeRefPropName]=null;this._itemsByIdentity&&delete this._itemsByIdentity[b];this._pending._deletedItems[b]=a;a[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,a);this.onDelete(a);return!0},setValue:function(a,c,b){return this._setValueOrValues(a,c,b,!0)},setValues:function(a,c,b){return this._setValueOrValues(a,c,b,!0)},unsetAttribute:function(a,c){return this._setValueOrValues(a,c,[],!0)},_setValueOrValues:function(a,
c,b,d){this._assert(!this._saveInProgress);this._assertIsItem(a);this._assert(n.isString(c));this._assert("undefined"!==typeof b);var q=this._getIdentifierAttribute();if(c==q)throw Error("ItemFileWriteStore does not have support for changing the value of an item's identifier.");var q=this._getValueOrValues(a,c),r=this.getIdentity(a);if(!this._pending._modifiedItems[r]){var m={},l;for(l in a)m[l]=l===this._storeRefPropName||l===this._itemNumPropName||l===this._rootItemPropName?a[l]:l===this._reverseRefMap?
n.clone(a[l]):a[l].slice(0,a[l].length);this._pending._modifiedItems[r]=m}r=!1;if(n.isArray(b)&&0===b.length){if(r=delete a[c],b=void 0,this.referenceIntegrity&&q){l=q;n.isArray(l)||(l=[l]);for(var e=0;e<l.length;e++)m=l[e],this.isItem(m)&&this._removeReferenceFromMap(m,a,c)}}else{r=n.isArray(b)?b.slice(0,b.length):[b];if(this.referenceIntegrity)if(q){l=q;n.isArray(l)||(l=[l]);var g={};f.forEach(l,function(a){this.isItem(a)&&(a=this.getIdentity(a),g[a.toString()]=!0)},this);f.forEach(r,function(b){if(this.isItem(b)){var e=
this.getIdentity(b);g[e.toString()]?delete g[e.toString()]:this._addReferenceToMap(b,a,c)}},this);for(e in g)this._removeReferenceFromMap(this._itemsByIdentity?this._itemsByIdentity[e]:this._arrayOfAllItems[e],a,c)}else for(e=0;e<r.length;e++)m=r[e],this.isItem(m)&&this._addReferenceToMap(m,a,c);a[c]=r;r=!0}if(d)this.onSet(a,c,q,b);return r},_addReferenceToMap:function(a,c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap];d||(d=a[this._reverseRefMap]={});(a=d[c])||(a=d[c]={});a[b]=!0},_removeReferenceFromMap:function(a,
c,b){c=this.getIdentity(c);var d=a[this._reverseRefMap],q;if(d){for(q in d)q==c&&(delete d[q][b],this._isEmpty(d[q])&&delete d[q]);this._isEmpty(d)&&delete a[this._reverseRefMap]}},_dumpReferenceMap:function(){var a;for(a=0;a<this._arrayOfAllItems.length;a++){var c=this._arrayOfAllItems[a];c&&c[this._reverseRefMap]&&console.log("Item: ["+this.getIdentity(c)+"] is referenced by: "+h.toJson(c[this._reverseRefMap]))}},_getValueOrValues:function(a,c){var b=void 0;this.hasAttribute(a,c)&&(b=this.getValues(a,
c),b=1==b.length?b[0]:b);return b},_flatten:function(a){if(this.isItem(a))return{_reference:this.getIdentity(a)};if("object"===typeof a)for(var c in this._datatypeMap){var b=this._datatypeMap[c];if(n.isObject(b)&&!n.isFunction(b)){if(a instanceof b.type){if(!b.serialize)throw Error("ItemFileWriteStore:  No serializer defined for type mapping: ["+c+"]");return{_type:c,_value:b.serialize(a)}}}else if(a instanceof b)return{_type:c,_value:a.toString()}}return a},_getNewFileContentString:function(){var a=
{},c=this._getIdentifierAttribute();c!==Number&&(a.identifier=c);this._labelAttr&&(a.label=this._labelAttr);a.items=[];for(c=0;c<this._arrayOfAllItems.length;++c){var b=this._arrayOfAllItems[c];if(null!==b){var d={},q;for(q in b)if(q!==this._storeRefPropName&&q!==this._itemNumPropName&&q!==this._reverseRefMap&&q!==this._rootItemPropName){var r=this.getValues(b,q);if(1==r.length)d[q]=this._flatten(r[0]);else for(var m=[],f=0;f<r.length;++f)m.push(this._flatten(r[f])),d[q]=m}a.items.push(d)}}return h.toJson(a,
!0)},_isEmpty:function(a){var c=!0;if(n.isObject(a))for(var b in a){c=!1;break}else n.isArray(a)&&0<a.length&&(c=!1);return c},save:function(a){this._assert(!this._saveInProgress);this._saveInProgress=!0;var d=this,b=function(){d._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};d._saveInProgress=!1;a&&a.onComplete&&a.onComplete.call(a.scope||c.global)},f=function(b){d._saveInProgress=!1;a&&a.onError&&a.onError.call(a.scope||c.global,b)};if(this._saveEverything){var q=this._getNewFileContentString();
this._saveEverything(b,f,q)}this._saveCustom&&this._saveCustom(b,f);!this._saveEverything&&!this._saveCustom&&b()},revert:function(){this._assert(!this._saveInProgress);for(var a in this._pending._modifiedItems){var c=this._pending._modifiedItems[a],b=null,b=this._itemsByIdentity?this._itemsByIdentity[a]:this._arrayOfAllItems[a];c[this._storeRefPropName]=this;for(var d in b)delete b[d];n.mixin(b,c)}var q;for(a in this._pending._deletedItems)q=this._pending._deletedItems[a],q[this._storeRefPropName]=
this,c=q[this._itemNumPropName],q["backup_"+this._reverseRefMap]&&(q[this._reverseRefMap]=q["backup_"+this._reverseRefMap],delete q["backup_"+this._reverseRefMap]),this._arrayOfAllItems[c]=q,this._itemsByIdentity&&(this._itemsByIdentity[a]=q),q[this._rootItemPropName]&&this._arrayOfTopLevelItems.push(q);for(a in this._pending._deletedItems)q=this._pending._deletedItems[a],q["backupRefs_"+this._reverseRefMap]&&(f.forEach(q["backupRefs_"+this._reverseRefMap],function(a){this._addReferenceToMap(this._itemsByIdentity?
this._itemsByIdentity[a.id]:this._arrayOfAllItems[a.id],q,a.attr)},this),delete q["backupRefs_"+this._reverseRefMap]);for(a in this._pending._newItems)c=this._pending._newItems[a],c[this._storeRefPropName]=null,this._arrayOfAllItems[c[this._itemNumPropName]]=null,c[this._rootItemPropName]&&this._removeArrayElement(this._arrayOfTopLevelItems,c),this._itemsByIdentity&&delete this._itemsByIdentity[a];this._pending={_newItems:{},_modifiedItems:{},_deletedItems:{}};return!0},isDirty:function(a){return a?
(a=this.getIdentity(a),(new Boolean(this._pending._newItems[a]||this._pending._modifiedItems[a]||this._pending._deletedItems[a])).valueOf()):!this._isEmpty(this._pending._newItems)||!this._isEmpty(this._pending._modifiedItems)||!this._isEmpty(this._pending._deletedItems)},onSet:function(a,c,b,d){},onNew:function(a,c){},onDelete:function(a){},close:function(a){if(this.clearOnClose){if(this.isDirty())throw Error("dojo.data.ItemFileWriteStore: There are unsaved changes present in the store.  Please save or revert the changes before invoking close.");
this.inherited(arguments)}}})})},"dojo/data/ItemFileReadStore":function(){define("../_base/kernel ../_base/lang ../_base/declare ../_base/array ../_base/xhr ../Evented ./util/filter ./util/simpleFetch ../date/stamp".split(" "),function(n,d,f,h,c,p,l,a,k){f=f("dojo.data.ItemFileReadStore",[p],{constructor:function(a){this._arrayOfAllItems=[];this._arrayOfTopLevelItems=[];this._loadFinished=!1;this.url=this._ccUrl=this._jsonFileUrl=a.url;this._jsonData=a.data;this.data=null;this._datatypeMap=a.typeMap||
{};this._datatypeMap.Date||(this._datatypeMap.Date={type:Date,deserialize:function(a){return k.fromISOString(a)}});this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._itemsByIdentity=null;this._storeRefPropName="_S";this._itemNumPropName="_0";this._rootItemPropName="_RI";this._reverseRefMap="_RRM";this._loadInProgress=!1;this._queuedFetches=[];void 0!==a.urlPreventCache&&(this.urlPreventCache=a.urlPreventCache?!0:!1);void 0!==a.hierarchical&&(this.hierarchical=a.hierarchical?
!0:!1);a.clearOnClose&&(this.clearOnClose=!0);"failOk"in a&&(this.failOk=a.failOk?!0:!1)},url:"",_ccUrl:"",data:null,typeMap:null,clearOnClose:!1,urlPreventCache:!1,failOk:!1,hierarchical:!0,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+": Invalid item argument.");},_assertIsAttribute:function(a){if("string"!==typeof a)throw Error(this.declaredClass+": Invalid attribute argument.");},getValue:function(a,c,d){a=this.getValues(a,c);return 0<a.length?a[0]:d},getValues:function(a,
c){this._assertIsItem(a);this._assertIsAttribute(c);return(a[c]||[]).slice(0)},getAttributes:function(a){this._assertIsItem(a);var c=[],d;for(d in a)d!==this._storeRefPropName&&(d!==this._itemNumPropName&&d!==this._rootItemPropName&&d!==this._reverseRefMap)&&c.push(d);return c},hasAttribute:function(a,c){this._assertIsItem(a);this._assertIsAttribute(c);return c in a},containsValue:function(a,c,d){var k=void 0;"string"===typeof d&&(k=l.patternToRegExp(d,!1));return this._containsValue(a,c,d,k)},_containsValue:function(a,
c,k,r){return h.some(this.getValues(a,c),function(a){if(null!==a&&!d.isObject(a)&&r){if(a.toString().match(r))return!0}else if(k===a)return!0})},isItem:function(a){return a&&a[this._storeRefPropName]===this&&this._arrayOfAllItems[a[this._itemNumPropName]]===a?!0:!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){this._assertIsItem(a.item)},getFeatures:function(){return this._features},getLabel:function(a){if(this._labelAttr&&this.isItem(a))return this.getValue(a,this._labelAttr)},
getLabelAttributes:function(a){return this._labelAttr?[this._labelAttr]:null},filter:function(a,c,d){var k=[],m,f;if(a.query){var e;m=a.queryOptions?a.queryOptions.ignoreCase:!1;var g={};for(f in a.query)e=a.query[f],"string"===typeof e?g[f]=l.patternToRegExp(e,m):e instanceof RegExp&&(g[f]=e);for(m=0;m<c.length;++m){var p=!0,h=c[m];if(null===h)p=!1;else for(f in a.query)e=a.query[f],this._containsValue(h,f,e,g[f])||(p=!1);p&&k.push(h)}}else for(m=0;m<c.length;++m)f=c[m],null!==f&&k.push(f);d(k,a)},
_fetchItems:function(a,k,q){var r=this;if(this._loadFinished)this.filter(a,this._getItemsArray(a.queryOptions),k);else if(this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url),null!=this.data&&(this._jsonData=this.data,this.data=null),this._jsonFileUrl)if(this._loadInProgress)this._queuedFetches.push({args:a,
filter:d.hitch(r,"filter"),findCallback:d.hitch(r,k)});else{this._loadInProgress=!0;var m=c.get({url:r._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk});m.addCallback(function(c){try{r._getItemsFromLoadedData(c),r._loadFinished=!0,r._loadInProgress=!1,r.filter(a,r._getItemsArray(a.queryOptions),k),r._handleQueuedFetches()}catch(e){r._loadFinished=!0,r._loadInProgress=!1,q(e,a)}});m.addErrback(function(c){r._loadInProgress=!1;q(c,a)});var f=null;a.abort&&
(f=a.abort);a.abort=function(){m&&-1===m.fired&&m.cancel();f&&f.call(a)}}else if(this._jsonData)try{this._loadFinished=!0,this._getItemsFromLoadedData(this._jsonData),this._jsonData=null,r.filter(a,this._getItemsArray(a.queryOptions),k)}catch(e){q(e,a)}else q(Error(this.declaredClass+": No JSON source data was provided as either URL or a nested Javascript object."),a)},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var c=this._queuedFetches[a],
d=c.args,k=c.filter,c=c.findCallback;k?k(d,this._getItemsArray(d.queryOptions),c):this.fetchItemByIdentity(d)}this._queuedFetches=[]}},_getItemsArray:function(a){return a&&a.deep?this._arrayOfAllItems:this._arrayOfTopLevelItems},close:function(a){this.clearOnClose&&(this._loadFinished&&!this._loadInProgress)&&((""==this._jsonFileUrl||null==this._jsonFileUrl)&&(""==this.url||null==this.url)&&null==this.data&&console.debug(this.declaredClass+": WARNING!  Data reload  information has not been provided.  Please set 'url' or 'data' to the appropriate value before the next fetch"),
this._arrayOfAllItems=[],this._arrayOfTopLevelItems=[],this._loadFinished=!1,this._itemsByIdentity=null,this._loadInProgress=!1,this._queuedFetches=[])},_getItemsFromLoadedData:function(a){function c(a){return null!==a&&"object"===typeof a&&(!d.isArray(a)||r)&&!d.isFunction(a)&&(a.constructor==Object||d.isArray(a))&&"undefined"===typeof a._reference&&"undefined"===typeof a._type&&"undefined"===typeof a._value&&m.hierarchical}function k(a){m._arrayOfAllItems.push(a);for(var b in a){var e=a[b];if(e)if(d.isArray(e))for(var g=
0;g<e.length;++g){var r=e[g];c(r)&&k(r)}else c(e)&&k(e)}}var r=!1,m=this;this._labelAttr=a.label;var f,e;this._arrayOfAllItems=[];this._arrayOfTopLevelItems=a.items;for(f=0;f<this._arrayOfTopLevelItems.length;++f)e=this._arrayOfTopLevelItems[f],d.isArray(e)&&(r=!0),k(e),e[this._rootItemPropName]=!0;var g={},l;for(f=0;f<this._arrayOfAllItems.length;++f)for(l in e=this._arrayOfAllItems[f],e){if(l!==this._rootItemPropName){var p=e[l];null!==p?d.isArray(p)||(e[l]=[p]):e[l]=[null]}g[l]=l}for(;g[this._storeRefPropName];)this._storeRefPropName+=
"_";for(;g[this._itemNumPropName];)this._itemNumPropName+="_";for(;g[this._reverseRefMap];)this._reverseRefMap+="_";if(g=a.identifier){this._itemsByIdentity={};this._features["dojo.data.api.Identity"]=g;for(f=0;f<this._arrayOfAllItems.length;++f)if(e=this._arrayOfAllItems[f],a=e[g],a=a[0],Object.hasOwnProperty.call(this._itemsByIdentity,a)){if(this._jsonFileUrl)throw Error(this.declaredClass+":  The json data as specified by: ["+this._jsonFileUrl+"] is malformed.  Items within the list have identifier: ["+
g+"].  Value collided: ["+a+"]");if(this._jsonData)throw Error(this.declaredClass+":  The json data provided by the creation arguments is malformed.  Items within the list have identifier: ["+g+"].  Value collided: ["+a+"]");}else this._itemsByIdentity[a]=e}else this._features["dojo.data.api.Identity"]=Number;for(f=0;f<this._arrayOfAllItems.length;++f)e=this._arrayOfAllItems[f],e[this._storeRefPropName]=this,e[this._itemNumPropName]=f;for(f=0;f<this._arrayOfAllItems.length;++f)for(l in e=this._arrayOfAllItems[f],
e){a=e[l];for(g=0;g<a.length;++g)if(p=a[g],null!==p&&"object"==typeof p){if("_type"in p&&"_value"in p){var h=p._type,n=this._datatypeMap[h];if(n)if(d.isFunction(n))a[g]=new n(p._value);else if(d.isFunction(n.deserialize))a[g]=n.deserialize(p._value);else throw Error("dojo.data.ItemFileReadStore: Value provided in typeMap was neither a constructor, nor a an object with a deserialize function");else throw Error("dojo.data.ItemFileReadStore: in the typeMap constructor arg, no object class was specified for the datatype '"+
h+"'");}if(p._reference){p=p._reference;if(d.isObject(p))for(h=0;h<this._arrayOfAllItems.length;++h){var n=this._arrayOfAllItems[h],D=!0,v;for(v in p)n[v]!=p[v]&&(D=!1);D&&(a[g]=n)}else a[g]=this._getItemByIdentity(p);this.referenceIntegrity&&(p=a[g],this.isItem(p)&&this._addReferenceToMap(p,e,l))}else this.isItem(p)&&this.referenceIntegrity&&this._addReferenceToMap(p,e,l)}}},_addReferenceToMap:function(a,c,d){},getIdentity:function(a){var c=this._features["dojo.data.api.Identity"];return c===Number?
a[this._itemNumPropName]:(a=a[c])?a[0]:null},fetchItemByIdentity:function(a){var d,k;if(this._loadFinished)d=this._getItemByIdentity(a.identity),a.onItem&&(k=a.scope?a.scope:n.global,a.onItem.call(k,d));else{var r=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=
this.url);null!=this.data&&null==this._jsonData&&(this._jsonData=this.data,this.data=null);this._jsonFileUrl?this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,k=c.get({url:r._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk}),k.addCallback(function(c){var k=a.scope?a.scope:n.global;try{r._getItemsFromLoadedData(c),r._loadFinished=!0,r._loadInProgress=!1,d=r._getItemByIdentity(a.identity),a.onItem&&a.onItem.call(k,d),r._handleQueuedFetches()}catch(e){r._loadInProgress=
!1,a.onError&&a.onError.call(k,e)}}),k.addErrback(function(c){r._loadInProgress=!1;a.onError&&a.onError.call(a.scope?a.scope:n.global,c)})):this._jsonData&&(r._getItemsFromLoadedData(r._jsonData),r._jsonData=null,r._loadFinished=!0,d=r._getItemByIdentity(a.identity),a.onItem&&(k=a.scope?a.scope:n.global,a.onItem.call(k,d)))}},_getItemByIdentity:function(a){var c=null;this._itemsByIdentity?Object.hasOwnProperty.call(this._itemsByIdentity,a)&&(c=this._itemsByIdentity[a]):Object.hasOwnProperty.call(this._arrayOfAllItems,
a)&&(c=this._arrayOfAllItems[a]);void 0===c&&(c=null);return c},getIdentityAttributes:function(a){a=this._features["dojo.data.api.Identity"];return a===Number?null:[a]},_forceLoad:function(){var a=this;this._jsonFileUrl!==this._ccUrl?(n.deprecated(this.declaredClass+": ","To change the url, set the url property of the store, not _jsonFileUrl.  _jsonFileUrl support will be removed in 2.0"),this.url=this._ccUrl=this._jsonFileUrl):this.url!==this._ccUrl&&(this._ccUrl=this._jsonFileUrl=this.url);null!=
this.data&&(this._jsonData=this.data,this.data=null);if(this._jsonFileUrl){var d=c.get({url:this._jsonFileUrl,handleAs:"json-comment-optional",preventCache:this.urlPreventCache,failOk:this.failOk,sync:!0});d.addCallback(function(c){try{if(!0!==a._loadInProgress&&!a._loadFinished)a._getItemsFromLoadedData(c),a._loadFinished=!0;else if(a._loadInProgress)throw Error(this.declaredClass+":  Unable to perform a synchronous load, an async load is in progress.");}catch(d){throw console.log(d),d;}});d.addErrback(function(a){throw a;
})}else this._jsonData&&(a._getItemsFromLoadedData(a._jsonData),a._jsonData=null,a._loadFinished=!0)}});d.extend(f,a);return f})},"dojo/data/util/filter":function(){define(["../../_base/lang"],function(n){var d={};n.setObject("dojo.data.util.filter",d);d.patternToRegExp=function(d,h){for(var c="^",p=null,l=0;l<d.length;l++)switch(p=d.charAt(l),p){case "\\":c+=p;l++;c+=d.charAt(l);break;case "*":c+=".*";break;case "?":c+=".";break;case "$":case "^":case "/":case "+":case ".":case "|":case "(":case ")":case "{":case "}":case "[":case "]":c+=
"\\";default:c+=p}c+="$";return h?RegExp(c,"mi"):RegExp(c,"m")};return d})},"dojo/data/util/simpleFetch":function(){define(["../../_base/lang","../../_base/kernel","./sorter"],function(n,d,f){var h={};n.setObject("dojo.data.util.simpleFetch",h);h.errorHandler=function(c,f){f.onError&&f.onError.call(f.scope||d.global,c,f)};h.fetchHandler=function(c,p){var l=p.abort||null,a=!1,k=p.start?p.start:0,b=p.count&&Infinity!==p.count?k+p.count:c.length;p.abort=function(){a=!0;l&&l.call(p)};var h=p.scope||d.global;
p.store||(p.store=this);p.onBegin&&p.onBegin.call(h,c.length,p);p.sort&&c.sort(f.createSortFunction(p.sort,this));if(p.onItem)for(var q=k;q<c.length&&q<b;++q){var r=c[q];a||p.onItem.call(h,r,p)}p.onComplete&&!a&&(q=null,p.onItem||(q=c.slice(k,b)),p.onComplete.call(h,q,p))};h.fetch=function(c){c=c||{};c.store||(c.store=this);this._fetchItems(c,n.hitch(this,"fetchHandler"),n.hitch(this,"errorHandler"));return c};return h})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(n){var d=
{};n.setObject("dojo.data.util.sorter",d);d.basicComparator=function(d,h){var c=-1;null===d&&(d=void 0);null===h&&(h=void 0);if(d==h)c=0;else if(d>h||null==d)c=1;return c};d.createSortFunction=function(f,h){function c(a,b,c,e){return function(d,k){var q=e.getValue(d,a),f=e.getValue(k,a);return b*c(q,f)}}for(var p=[],l,a=h.comparatorMap,k=d.basicComparator,b=0;b<f.length;b++){l=f[b];var s=l.attribute;if(s){l=l.descending?-1:1;var q=k;a&&("string"!==typeof s&&"toString"in s&&(s=s.toString()),q=a[s]||
k);p.push(c(s,l,q,h))}}return function(a,b){for(var c=0;c<p.length;){var e=p[c++](a,b);if(0!==e)return e}return 0}};return d})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(n,d,f){return n(null,{constructor:function(){this.panelManager=f.getInstance()},postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(d){},
getConfigById:function(d){for(var c=this.getAllConfigs(),f=0;f<c.length;f++)if(c[f].id===d)return c[f]},getAllConfigs:function(){var f=[],f=f.concat(this.getWidgetConfigs(),this.getGroupConfigs()),f=d.filter(f,function(c){return c.visible});return f.sort(function(c,d){return c.index-d.index})},getAllConfigsIncludeInvisible:function(){var d=[],d=d.concat(this.getWidgetConfigs(),this.getGroupConfigs());return d.sort(function(c,d){return c.index-d.index})},isControlled:function(f){return d.some(this.getAllConfigsIncludeInvisible(),
function(c){return c.id===f})},widgetIsControlled:function(f){return d.some(this.getAllConfigsIncludeInvisible(),function(c){return c.id===f?!0:d.some(c.widgets,function(c){return c.id===f})})},getGroupConfigs:function(){var f=[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.groups&&d.forEach(this.appConfig.widgetPool.groups,function(c){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(c.id)&&f.push(c):"all"===this.controlledGroups&&f.push(c))},
this);return f},getWidgetConfigs:function(){var f=[];if(!this.appConfig.widgetPool)return f;this.appConfig.widgetPool.widgets&&d.forEach(this.appConfig.widgetPool.widgets,function(c){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(c.id)&&f.push(c):"all"===this.controlledWidgets&&f.push(c))},this);return f}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/SpatialReference ./unitUtils".split(" "),
function(n,d,f,h,c,p,l,a){var k=null,b=null,s=!1;n=n(null,function(){});var q=require.toUrl("jimu"),r=p(q+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),m=p(q+"/SpatialReference/transform.json",{handleAs:"json"});n.loadResource=function(){var a=new h;if(k&&b)return a.resolve(),a;c([r,m]).then(function(c){k=c[0];b=c[1];s=!0;a.resolve()},function(b){console.error(b);s=!1;a.reject(b)});return a};n.getAllCSUnits=function(){if(s){var a=[];f.forEach(k.wkids,d.hitch(this,function(b){b=this.getCSUnit(b);
-1===f.indexOf(a,b)&&a.push(b)}));return a}};n.convertUnit=function(b,c,d){if(s)return a.convertUnit(b,c,d)};n.getUnitRate=function(b,c){if(s)return a.getUnitRate(b,c)};n.isProjectUnit=function(b){if(s)return a.isProjectUnit(b)};n.isGeographicUnit=function(b){if(s)return a.isGeographicUnit(b)};n.getGeographicUnits=function(){if(s)return a.getGeographicUnits()};n.getProjectUnits=function(){if(s)return a.getProjectUnits()};n.getCSUnit=function(a){if(s){a=this.getCSStr(a);var b=0,c=0,b=a.lastIndexOf("UNIT"),
c=a.indexOf(",",b);return a.slice(b+6,c-1)}};n.isSameSR=function(a,b){if(s){var c=this.indexOfWkid(a),d=this.indexOfWkid(b);return k.labels[c]===k.labels[d]}};n.isValidWkid=function(a){if(s)return-1<this.indexOfWkid(a)};n.getSRLabel=function(a){if(s&&this.isValidWkid(a))return a=this.indexOfWkid(a),k.labels[a]};n.indexOfWkid=function(a){if(s)return f.indexOf(k.wkids,a)};n.isWebMercator=function(a){return l.prototype._isWebMercator?l.prototype._isWebMercator.apply({wkid:parseInt(a,10)},[]):(new l(parseInt(a,
10))).isWebMercator()};n.standardizeWkid=function(a){return this.isWebMercator(a)?3857:parseInt(a,10)};n.isValidTfWkid=function(a){if(s)return-1<this.indexOfTfWkid(a)};n.getTransformationLabel=function(a){if(s)return this.isValidTfWkid(a)?(a=this.indexOfTfWkid(a),b.labels[a]):""};n.indexOfTfWkid=function(a){if(s)return f.indexOf(b.tfWkids,a)};n.isGeographicCS=function(a){if(s)return this.isValidWkid(a)?k.details[this.indexOfWkid(a)].startWith("GEOGCS"):!1};n.isProjectedCS=function(a){if(s)return this.isValidWkid(a)?
k.details[this.indexOfWkid(a)].startWith("PROJCS"):!1};n.getGeoCSByProj=function(a){if(s&&this.isProjectedCS(a))return a=this.getSpheroidStr(a),a=f.indexOf(k.details,a),k.wkids[a]};n.getSpheroidStr=function(a){if(s){if(this.isGeographicCS(a))return k.details[this.indexOfWkid(a)];if(this.isProjectedCS(a)){a=k.details[this.indexOfWkid(a)];var b=a.indexOf("GEOGCS"),c=a.indexOf("PROJECTION")-1;return a.slice(b,c)}return null}};n.getCSStr=function(a){if(s)return k.details[this.indexOfWkid(a)]};n.isSameSpheroid=
function(a,b){if(s){var c=this.getSpheroidStr(a),d=this.getSpheroidStr(b);return c&&d&&c===d?!0:!1}};return n})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(n,d){var f="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
h="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),c={INCHES:0.0254,FOOT:0.3048,FOOT_US:0.3048006096012192,YARDS:0.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:0.0010,CENTIMETERS:0.01,METER:1,KILOMETERS:1E3,DECIMETERS:0.1,LINK_CLARKE:0.2011661949,FOOT_GOLD_COAST:0.3047997101815088,FOOT_CLARKE:0.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:0.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:0.9143984146160287,CHAIN_SEARS:20.11676512155263,
FOOT_SEARS:0.3047994715386762,YARD_INDIAN_1937:0.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:0.0174532925199433,DECIMAL_DEGREES:0.0174532925199433,MGRS:0.0174532925199433,USNG:0.0174532925199433,DEGREE_MINUTE_SECONDS:0.0174532925199433,GRAD:0.01570796326794897},p=n(null,function(){});p.convertUnit=function(d,a,k){return c[d.toUpperCase()]/c[a.toUpperCase()]*k};p.getUnitRate=function(d,a){return c[d.toUpperCase()]/c[a.toUpperCase()]};p.isProjectUnit=function(c){return-1<d.indexOf(f,c.toUpperCase())};
p.isGeographicUnit=function(c){return-1<d.indexOf(h,c.toUpperCase())};p.getGeographicUnits=function(){return h};p.getProjectUnits=function(){return f};return p})},"jimu/dijit-all":function(){define([],1)},"jimu/dijit/RadioBtn":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/array dojo/on dojo/dom-class dojo/dom-construct dijit/registry".split(" "),function(n,d,f,h,c,p,l,a){return n(d,{baseClass:"jimu-radio",declaredClass:"jimu.dijit.RadioBtn",checked:!1,group:null,
constructor:function(){},postCreate:function(){l.create("div",{"class":"jimu-radio-inner"},this.domNode);this.checked&&p.add(this.domNode,"jimu-radio-checked");this.own(c(this.domNode,"click",f.hitch(this,function(){this.checked||this.check()})))},check:function(a){void 0===a&&(a=!0);this.checked=!0;p.add(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);this.onStateChange()},uncheck:function(a){void 0===a&&(a=!0);this.checked=!1;p.remove(this.domNode,"jimu-radio-checked");a&&this._changeOthersState(!1);
this.onStateChange()},_changeOthersState:function(c){null!==this.group&&h.forEach(a.toArray(),function(a){a.id!==this.id&&(a["class"]===this["class"]&&a.group===this.group)&&(c?a.check(!1):a.uncheck(!1))},this)},onStateChange:function(){}})})},"jimu/dijit/CheckBox":function(){define("dojo/_base/declare dijit/_WidgetBase dojo/_base/lang dojo/_base/html dojo/dom-class dojo/on dojo/Evented".split(" "),function(n,d,f,h,c,p,l){return n([d,l],{baseClass:"jimu-checkbox",declaredClass:"jimu.dijit.CheckBox",
checked:!1,status:!0,label:"",postCreate:function(){this.checkNode=h.create("div",{"class":"checkbox jimu-float-leading"},this.domNode);this.label&&(this.labelNode=h.create("div",{"class":"label jimu-float-leading",innerHTML:this.label},this.domNode));this.checked&&h.addClass(this.checkNode,"checked");this.own(p(this.checkNode,"click",f.hitch(this,function(){this.status&&(this.checked?this.uncheck():this.check())})));this.label&&this.own(p(this.labelNode,"click",f.hitch(this,function(){this.checked&&
this.status?this.uncheck():this.status&&this.check()})))},setValue:function(a){this.status&&(!0===a?this.check():this.uncheck())},getValue:function(){return this.checked},setStatus:function(a){a=!!a;var d=this.status!==a;(this.status=a)?c.remove(this.domNode,"jimu-state-disabled"):c.add(this.domNode,"jimu-state-disabled");d&&this.emit("status-change",a)},getStatus:function(){return this.status},check:function(){this.status&&(this.checked=!0,h.addClass(this.checkNode,"checked"),this.onStateChange())},
uncheck:function(a){if(this.status&&(this.checked=!1,h.removeClass(this.checkNode,"checked"),!a))this.onStateChange()},onStateChange:function(){if(this.onChange&&f.isFunction(this.onChange))this.onChange(this.checked)}})})},"jimu/dijit/SymbolChooser":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/SymbolChooser.html dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/sniff dojo/query dojo/request/xhr jimu/utils jimu/symbolUtils esri/symbols/jsonUtils esri/symbols/SimpleMarkerSymbol esri/symbols/SimpleLineSymbol esri/symbols/SimpleFillSymbol esri/symbols/TextSymbol esri/symbols/Font dijit/form/Select dijit/form/NumberSpinner jimu/dijit/ColorPicker jimu/dijit/_Transparency".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z){return n([d,f,h,p],{templateString:c,baseClass:"jimu-symbol-chooser",declaredClass:"jimu.dijit.SymbolChooser",nls:null,_pointEventsBinded:!1,_lineEventBinded:!1,_fillEventBinded:!1,_textEventBinded:!1,_invokeSymbolChangeEvent:!0,symbol:null,type:null,postMixInProperties:function(){this.nls=window.jimuNls.symbolChooser},postCreate:function(){this.inherited(arguments);this.own(b(document.body,"click",l.hitch(this,this._onBodyClicked)));(this._isIE8=
8===s("ie"))&&a.addClass(this.domNode,"ie8");this.symbol?this.showBySymbol(this.symbol):this.type&&this.showByType(this.type)},reset:function(){this.symbol=this.type=null;this._hideAllSections()},showBySymbol:function(a){this.reset();var b=a&&a.declaredClass;b&&("string"===typeof b&&0<=b.indexOf("esri.symbol"))&&(this.symbol=this._cloneSymbol(a),this.isSimpleMarkerSymbol(this.symbol)||this.isPictureMarkerSymbol(this.symbol)?(this.type="marker",this._initPointSection()):this.isSimpleLineSymbol(this.symbol)?
(this.type="line",this._initLineSection()):this._isSimpleFillSymbol(this.symbol)?(this.type="fill",this._initFillSection()):this._isTextSymbol(this.symbol)&&(this.type="text",this._initTextSection()))},showByType:function(a){this.reset();if("marker"===a||"line"===a||"fill"===a||"text"===a)this.type=a,"marker"===this.type?this._initPointSection():"line"===this.type?this._initLineSection():"fill"===this.type?this._initFillSection():"text"===this.type&&this._initTextSection()},getSymbol:function(){var a=
null;"marker"===this.type?a=this._getPointSymbolBySetting():"line"===this.type?a=this._getLineSymbolBySetting():"fill"===this.type?a=this._getFillSymbolBySetting():"text"===this.type&&(a=this._getTextSymbolBySetting());var b=null;a&&(b=this._cloneSymbol(a));return b},hideColorPicker:function(){for(var a="pointColor pointOutlineColor lineColor fillColor fillOutlineColor textColor".split(" "),b=0,c=a.length;b<c;b++){var e=a[b];this[e]&&this[e].hideTooltipDialog()}},_onBodyClicked:function(a){a=a.target||
a.srcElement;this._tryHideDropDownOfSelectDijit(a,this.pointSymClassSelect);this._tryHideDropDownOfSelectDijit(a,this.lineStylesSelect)},_tryHideDropDownOfSelectDijit:function(b,c){var e=c.domNode,d=c.dropDown.domNode,e=b===e||a.isDescendant(b,e),d=b===d||a.isDescendant(b,d);if(!e&&!d)c.dropDown.onCancel()},_onChange:function(a){a=this._cloneSymbol(a);this.emit("change",a)},_hideAllSections:function(){q(".symbol-section",this.domNode).style("display","none")},_showSection:function(a){this._hideAllSections();
q("."+a+"-symbol-section",this.domNode).style("display","block")},_getAncestor:function(a,b,c){return m.getAncestorDom(a,b,c)},_getAbsoluteUrl:function(a){return window.location.protocol+"//"+window.location.host+require.toUrl(a)},_cloneSymbol:function(a){if(!a)return null;var b=a;try{var c=a.toJson(),b=e.fromJson(c)}catch(d){console.error(d)}return b},_createSymbolIconTable:function(b,c,d){var g=this.type+"-icon-table";b=a.toDom('\x3ctable class\x3d"'+("icon-table "+g+" "+(g+"-"+b))+'"\x3e\x3ctbody\x3e\x3c/tbody\x3e\x3c/table\x3e');
for(var g=q("tbody",b)[0],m=Math.ceil(c.length/8),r=0;r<m;r++)a.create("tr",{},g);var f=q("tr",b);k.forEach(c,l.hitch(this,function(b,c){var g=l.clone(b),k=e.fromJson(b),m=a.create("td",{},f[Math.floor(c/8)]);a.addClass(m,"symbol-td-item");k=this._createSymbolNode(k);a.addClass(k,"symbol-div-item");var q=k.firstChild;a.addClass(q,"svg-node");if(this._isIE8&&"point"===d)if(window.isRTL){if("Cross"===b.name||"X"===b.name)a.setStyle(q,"right","-20px"),a.setStyle(k,"marginTop","20px")}else("Cross"===
b.name||"X"===b.name)&&a.setStyle(k,"marginTop","20px");k.symbol=g;a.place(k,m)}));return b},_updatePreview:function(b){var c=this._cloneSymbol(this.symbol);a.empty(b);(c=t.createSymbolNode(c))||(c=a.create("div"));a.place(c,b)},_createSymbolNode:function(b){(b=t.createSymbolNode(b,{width:36,height:36}))||(b=a.create("div"));a.setStyle(b,{width:"36px",height:"36px"});return b},_getLineShapeDesc:function(a){var b=null;if(this.isSimpleLineSymbol(a)||this.isCartographicLineSymbol(a))b={defaultShape:{type:"path",
path:"M -90,0 L 90,0 E"},fill:null,stroke:a.getStroke()};return b},_initPointSection:function(){this._showSection("point");this._pointEventsBinded||(this._pointEventsBinded=!0,this._bindPointEvents(),this._onPointSymClassSelectChange());this.isPictureMarkerSymbol(this.symbol)?this._showPictureMarkerSymSettings():(this.isSimpleMarkerSymbol(this.symbol)||(this.symbol=new g({style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18})),this._showSimpleMarkerSymSettings());
this._initPointSettings(this.symbol);this._getPointSymbolBySetting()},_bindPointEvents:function(){this.own(b(this.pointIconTables,".symbol-div-item:click",l.hitch(this,this._onPointSymIconItemClick)));this.own(b(this.pointSymClassSelect,"Change",l.hitch(this,this._onPointSymClassSelectChange)));this.own(b(this.pointSize,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointAlpha,"change",l.hitch(this,this._onPointSymbolChange)));
this.own(b(this.pointOutlineColor,"change",l.hitch(this,this._onPointSymbolChange)));this.own(b(this.pointOutlineWidth,"change",l.hitch(this,this._onPointSymbolChange)))},_onPointSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getPointSymbolBySetting(),this._onChange(this.symbol))},_initPointSettings:function(a){if(a){this._invokeSymbolChangeEvent=!1;if(this.isSimpleMarkerSymbol(a)){if(this.pointSize.set("value",a.size),this.pointColor.setColor(a.color),this.pointAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a=a.outline)this.pointOutlineColor.setColor(a.color),this.pointOutlineWidth.set("value",parseFloat(a.width.toFixed(0)))}else this.isPictureMarkerSymbol(a)&&this.pointSize.set("value",a.width);this._invokeSymbolChangeEvent=!0}},isSimpleMarkerSymbol:function(a){return a&&"esri.symbol.SimpleMarkerSymbol"===a.declaredClass},isPictureMarkerSymbol:function(a){return a&&"esri.symbol.PictureMarkerSymbol"===a.declaredClass},_onPointSymClassSelectChange:function(){this._showSelectedPointSymIconTable();var a=
this.pointSymClassSelect.get("value");this.pointSymClassSelect["def"+a]||this._requestPointSymJson(a)},_showSelectedPointSymIconTable:function(){var a=this.pointSymClassSelect.get("value");q(".marker-icon-table",this.pointIconTables).style("display","none");a=q(".marker-icon-table-"+a,this.pointIconTables);0<a.length&&a.style("display","table")},_requestPointSymJson:function(b){var c="def"+b,e=this.pointSymClassSelect[c];e||(e=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json"),e=r(e,{handleAs:"json"}),
this.pointSymClassSelect[c]=e,e.then(l.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"point"),a.place(c,this.pointIconTables),this._showSelectedPointSymIconTable())}),l.hitch(this,function(a){console.error("get point symbol failed",a)})))},_onPointSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),
a.addClass(b,"selected-symbol-div-item"),b=b.symbol){this.symbol=e.fromJson(b);b=a.getStyle(this.pointColorTr,"display");this.isSimpleMarkerSymbol(this.symbol)?this._showSimpleMarkerSymSettings():this._showPictureMarkerSymSettings();this._onPointSymbolChange();var c=a.getStyle(this.pointColorTr,"display");b!==c&&this.emit("resize")}},_showSimpleMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","");a.setStyle(this.pointOpacityTr,"display","");a.setStyle(this.pointOutlineColorTr,"display",
"");a.setStyle(this.pointOulineWidthTr,"display","")},_showPictureMarkerSymSettings:function(){a.setStyle(this.pointColorTr,"display","none");a.setStyle(this.pointOpacityTr,"display","none");a.setStyle(this.pointOutlineColorTr,"display","none");a.setStyle(this.pointOulineWidthTr,"display","none")},_getPointSymbolBySetting:function(){if(!this.symbol)return null;var a=parseFloat(this.pointSize.get("value"));if(this.isSimpleMarkerSymbol(this.symbol)){this.symbol.setSize(a);var a=this.pointColor.getColor(),
b=this.pointAlpha.getAlpha();a.a=b;this.symbol.setColor(a);var a=this.pointOutlineColor.getColor(),b=parseFloat(this.pointOutlineWidth.get("value")),c=new y;c.setStyle(y.STYLE_SOLID);c.setColor(a);c.setWidth(b);this.symbol.setOutline(c)}else this.isPictureMarkerSymbol(this.symbol)&&(this.symbol.setWidth(a),this.symbol.setHeight(a));this._updatePreview(this.pointSymPreview);return this.symbol},_initLineSection:function(){this._showSection("line");this._lineEventBinded||(this._lineEventBinded=!0,this._bindLineEvents(),
this._requestLineSymJson("line"));this._initLineSettings(this.symbol);this._getLineSymbolBySetting()},_bindLineEvents:function(){this.own(b(this.lineIconTables,".symbol-div-item:click",l.hitch(this,this._onLineSymIconItemClick)));this.own(b(this.lineColor,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineStylesSelect,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineAlpha,"change",l.hitch(this,this._onLineSymbolChange)));this.own(b(this.lineWidth,"change",l.hitch(this,
this._onLineSymbolChange)))},_onLineSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getLineSymbolBySetting(),this._onChange(this.symbol))},_initLineSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.lineColor.setColor(a.color),this.lineAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),this.lineWidth.set("value",parseFloat(a.width.toFixed(0))),this.lineStylesSelect.set("value",a.style),this._invokeSymbolChangeEvent=!0)},isSimpleLineSymbol:function(a){return a&&"esri.symbol.SimpleLineSymbol"===
a.declaredClass},isCartographicLineSymbol:function(a){return a&&"esri.symbol.CartographicLineSymbol"===a.declaredClass},_requestLineSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");r(c,{handleAs:"json"}).then(l.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"line"),a.place(c,this.lineIconTables))}),l.hitch(this,function(a){console.error("get line symbol failed",a)}))},_onLineSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,
function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=e.fromJson(b),this._initLineSettings(b),this._onLineSymbolChange()},_getLineSymbolBySetting:function(){this.symbol=new y;var a=this.lineColor.getColor(),b=this.lineStylesSelect.get("value");a.a=this.lineAlpha.getAlpha();var c=parseFloat(this.lineWidth.get("value"));this.symbol.setStyle(b);
this.symbol.setColor(a);this.symbol.setWidth(c);this._updatePreview(this.lineSymPreview);return this.symbol},_initFillSection:function(){this._showSection("fill");this._fillEventBinded||(this._fillEventBinded=!0,this._bindFillEvents(),this._requestFillSymJson("fill"));this._initFillSettings(this.symbol);this._getFillSymbolBySetting()},_bindFillEvents:function(){this.own(b(this.fillIconTables,".symbol-div-item:click",l.hitch(this,this._onFillSymIconItemClick)));this.own(b(this.fillColor,"change",l.hitch(this,
this._onFillSymbolChange)));this.own(b(this.fillAlpha,"change",l.hitch(this,this._onFillSymbolChange)));this.own(b(this.fillOutlineColor,"change",l.hitch(this,this._onFillSymbolChange)));this.own(b(this.fillOutlineWidth,"change",l.hitch(this,this._onFillSymbolChange)))},_onFillSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getFillSymbolBySetting(),this._onChange(this.symbol))},_initFillSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.fillColor.setColor(a.color),this.fillAlpha.setAlpha(parseFloat(a.color.a.toFixed(2))),
a.outline&&(this.fillOutlineColor.setColor(a.outline.color),this.fillOutlineWidth.set("value",parseInt(a.outline.width,10))),this._invokeSymbolChangeEvent=!0)},_isSimpleFillSymbol:function(a){return a&&"esri.symbol.SimpleFillSymbol"===a.declaredClass},_requestFillSymJson:function(b){var c=this._getAbsoluteUrl("jimu/dijit/SymbolsInfo/"+b+".json");r(c,{handleAs:"json"}).then(l.hitch(this,function(c){this.domNode&&(c=this._createSymbolIconTable(b,c,"fill"),a.place(c,this.fillIconTables))}),l.hitch(this,
function(a){console.error("get fill symbol failed",a)}))},_onFillSymIconItemClick:function(b){if(b=this._getAncestor(b.target||b.srcElement,function(b){return a.hasClass(b,"symbol-div-item")},5))if(q(".selected-symbol-div-item",b.parentNode.parentNode.parentNode).removeClass("selected-symbol-div-item"),a.addClass(b,"selected-symbol-div-item"),b=b.symbol)b=e.fromJson(b),this._initFillSettings(b),this._onFillSymbolChange()},_getFillSymbolBySetting:function(){this.symbol=new w;var a=this.fillColor.getColor();
a.a=this.fillAlpha.getAlpha();var b=this.fillOutlineColor.getColor(),c=parseInt(this.fillOutlineWidth.get("value"),10);this.symbol.setColor(a);this.symbol.setStyle(w.STYLE_SOLID);a=new y;a.setStyle(y.STYLE_SOLID);a.setColor(b);a.setWidth(c);this.symbol.setOutline(a);this._updatePreview(this.fillSymPreview);return this.symbol},_initTextSection:function(){this._showSection("text");this._textEventBinded||(this._textEventBinded=!0,this._bindTextEvents());this._initTextSettings();this._getTextSymbolBySetting()},
_bindTextEvents:function(){this.own(b(this.inputText,"change",l.hitch(this,this._onTextSymbolChange)));this.own(b(this.textColor,"change",l.hitch(this,this._onTextSymbolChange)));this.own(b(this.textFontSize,"change",l.hitch(this,this._onTextSymbolChange)))},_onTextSymbolChange:function(){this._invokeSymbolChangeEvent&&(this._getTextSymbolBySetting(),this._onChange(this.symbol))},_initTextSettings:function(a){a&&(this._invokeSymbolChangeEvent=!1,this.inputText.value=a.text,this.textColor.setColor(a.color),
a=parseInt(a.font.size,10),this.textFontSize.set("value",a),this._invokeSymbolChangeEvent=!0)},_isTextSymbol:function(a){return a&&"esri.symbol.TextSymbol"===a.declaredClass},_updateTextPreview:function(){var b=this.textColor.getColor().toHex(),c=parseInt(this.textFontSize.get("value"),10)+"px";a.setStyle(this.textPreview,{color:b,fontSize:c});this.textPreview.innerHTML=this.inputText.value},_getTextSymbolBySetting:function(){this.symbol=new x;var a=this.inputText.value,b=this.textColor.getColor(),
c=parseInt(this.textFontSize.get("value"),10),e=new z;e.setSize(c);this.symbol.setText(a);this.symbol.setColor(b);this.symbol.setFont(e);this._updateTextPreview();return this.symbol}})})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w){function x(b){return function(c){this._isLoaded?this.inherited(b,arguments):this.loadDropDown(a.hitch(this,b,c))}}var z=d("dijit.form._SelectMenu",r,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}))},focus:function(){var b=!1,c=this.parentWidget.value;
a.isArray(c)&&(c=c[c.length-1]);c&&n.forEach(this.parentWidget._getChildren(),function(a){a.option&&c===a.option.value&&(b=!0,this.focusChild(a,!1))},this);b||this.inherited(arguments)}});c=d("dijit.form.Select"+(b("dojo-bidi")?"_NoBidi":""),[s,q,g],{baseClass:"dijitSelect dijitValidationTextBox",templateString:w,_buttonInputDisabled:b("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var a=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=a?a:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});h.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(b){if(!b.value&&!b.label)return new t({ownerDocument:this.ownerDocument});var c=a.hitch(this,"_setValueAttr",b);b=new m({option:b,label:("text"===this.labelType?(b.label||"").toString().replace(/&/g,
"\x26amp;").replace(/</g,"\x26lt;"):b.label)||this.emptyLabel,onClick:c,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:b.disabled||!1});b.focusNode.setAttribute("role","option");return b},_addOptionItem:function(a){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(a))},_getChildren:function(){return!this.dropDown?[]:this.dropDown.getChildren()},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(a){}},focusChild:function(a){a&&
this.set("value",a.option)},_getFirst:function(){var a=this._getChildren();return a.length?a[0]:null},_getLast:function(){var a=this._getChildren();return a.length?a[a.length-1]:null},childSelector:function(a){return(a=y.byNode(a))&&a.getParent()==this.dropDown},onKeyboardSearch:function(a,b,c,e){a&&this.focusChild(a)},_loadChildren:function(a){if(!0===a)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{n.forEach(this._getChildren(),
function(a){a.destroyRecursive()});var b=new m({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(b)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(a){this.inherited(arguments);f.set(this.valueNode,"value",this.get("value"));this._refreshState()},
_setNameAttr:"valueNode",_setDisabledAttr:function(a){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(a){this._set("required",a);this.focusNode.setAttribute("aria-required",a);this._refreshState()},_setOptionsAttr:function(a){this._isLoaded=!1;this._set("options",a)},_setDisplay:function(a){a=("text"===this.labelType?(a||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):a)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+a+"\x3c/span\x3e"},validate:function(a){a=this.disabled||this.isValid(a);this._set("state",a?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",a?"false":"true");var b=a?"":this._missingMsg;b&&this.focused&&this._hasBeenBlurred?e.show(b,this.domNode,this.tooltipPosition,!this.isLeftToRight()):e.hide(this.domNode);this._set("message",b);return a},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);e.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=p.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(k(this.domNode,"selectstart",function(a){a.preventDefault();a.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var a=this._keyNavCodes;delete a[l.LEFT_ARROW];delete a[l.RIGHT_ARROW]},_setStyleAttr:function(a){this.inherited(arguments);
h.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(a){this._loadChildren(!0);this._isLoaded=!0;a()},destroy:function(a){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(a),delete this.dropDown);e.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){e.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
b("dojo-bidi")&&(c=d("dijit.form.Select",c,{_setDisplay:function(a){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));c._Menu=z;c.prototype._onContainerKeydown=x("_onContainerKeydown");c.prototype._onContainerKeypress=x("_onContainerKeypress");return c})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r){return c("dijit.form._FormSelectWidget",r,{multiple:!1,options:null,store:null,_setStoreAttr:function(a){this._created&&this._deprecatedSetStore(a)},query:null,_setQueryAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:a})},queryOptions:null,_setQueryOptionsAttr:function(a){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:a})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(a){var b=this.options||[];if(null==a)return b;if(k.isArray(a))return n.map(a,"return this.getOptions(item);",this);k.isString(a)&&(a={value:a});k.isObject(a)&&(n.some(b,function(b,c){for(var d in a)if(!(d in b)||b[d]!=a[d])return!1;a=c;return!0})||(a=-1));return 0<=a&&a<b.length?b[a]:null},addOption:function(a){n.forEach(k.isArray(a)?a:[a],function(a){a&&k.isObject(a)&&this.options.push(a)},this);this._loadChildren()},removeOption:function(a){a=this.getOptions(k.isArray(a)?
a:[a]);n.forEach(a,function(a){a&&(this.options=n.filter(this.options,function(b){return b.value!==a.value||b.label!==a.label}),this._removeOptionItem(a))},this);this._loadChildren()},updateOption:function(a){n.forEach(k.isArray(a)?a:[a],function(a){var b=this.getOptions({value:a.value}),c;if(b)for(c in a)b[c]=a[c]},this);this._loadChildren()},setStore:function(b,c,e){a.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(b,c,e)},_deprecatedSetStore:function(a,b,c){var g=this.store;c=c||{};if(g!==a){for(var r;r=this._notifyConnections.pop();)r.remove();a.get||(k.mixin(a,{_oldAPI:!0,get:function(a){var b=new d;this.fetchItemByIdentity({identity:a,onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var c=new d(function(){e.abort&&e.abort()});c.total=new d;var e=this.fetch(k.mixin({query:a,onBegin:function(a){c.total.resolve(a)},
onComplete:function(a){c.resolve(a)},onError:function(a){c.reject(a)}},b));return new q(c)}}),a.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[f.after(a,"onNew",k.hitch(this,"_onNewItem"),!0),f.after(a,"onDelete",k.hitch(this,"_onDeleteItem"),!0),f.after(a,"onSet",k.hitch(this,"_onSetItem"),!0)]));this._set("store",a)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);c.query&&this._set("query",c.query);c.queryOptions&&this._set("queryOptions",c.queryOptions);a&&a.query&&(this._loadingStore=!0,this.onLoadDeferred=new d,this._queryRes=a.query(this.query,this.queryOptions),s(this._queryRes,k.hitch(this,function(d){if(this.sortByLabel&&!c.sort&&d.length)if(a.getValue)d.sort(h.createSortFunction([{attribute:a.getLabelAttributes(d[0])[0]}],a));else{var g=this.labelAttr;d.sort(function(a,b){return a[g]>b[g]?1:b[g]>
a[g]?-1:0})}c.onFetch&&(d=c.onFetch.call(this,d,c));n.forEach(d,function(a){this._addOptionForItem(a)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(k.hitch(this,function(a,b,c){b==c?this._onSetItem(a):(-1!=b&&this._onDeleteItem(a),-1!=c&&this._onNewItem(a))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:b);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(d):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),function(a){console.error("dijit.form.Select: "+a.toString());this.onLoadDeferred.reject(a)}));return g},_setValueAttr:function(a,b){this._onChangeActive||(b=null);if(this._loadingStore)this._pendingValue=a;else if(null!=a){a=k.isArray(a)?n.map(a,function(a){return k.isObject(a)?a:{value:a}}):k.isObject(a)?[a]:[{value:a}];a=n.filter(this.getOptions(a),function(a){return a&&a.value});var c=this.getOptions()||[];if(!this.multiple&&(!a[0]||!a[0].value)&&c.length)a[0]=c[0];n.forEach(c,
function(b){b.selected=n.some(a,function(a){return a.value===b.value})});c=n.map(a,function(a){return a.value});if(!("undefined"==typeof c||"undefined"==typeof c[0])){var d=n.map(a,function(a){return a.label});this._setDisplay(this.multiple?d:d[0]);this.inherited(arguments,[this.multiple?c:c[0],b]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var a=n.map([].concat(this.get("selectedOptions")),function(a){return a&&"label"in a?a.label:a?a.value:null},this);return this.multiple?a:a[0]},
_setDisplayedValueAttr:function(a){this.set("value",this.getOptions("string"==typeof a?{label:a}:a))},_loadChildren:function(){this._loadingStore||(n.forEach(this._getChildren(),function(a){a.destroyRecursive()}),n.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var a=[].concat(this.value);if(a&&a[0]){var b=this;n.forEach(this._getChildren(),function(c){var d=n.some(a,function(a){return c.option&&
a===c.option.value});d&&!b.multiple&&(b.focusedChild=c);l.toggle(c.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),d);c.domNode.setAttribute("aria-selected",d?"true":"false")},this)}},_getValueFromOpts:function(){var a=this.getOptions()||[];if(!this.multiple&&a.length){var b=n.filter(a,function(a){return a.selected})[0];if(b&&b.value)return b.value;a[0].selected=!0;return a[0].value}return this.multiple?n.map(n.filter(a,function(a){return a.selected}),function(a){return a.value})||[]:""},
_onNewItem:function(a,b){(!b||!b.parent)&&this._addOptionForItem(a)},_onDeleteItem:function(a){this.removeOption({value:this.store.getIdentity(a)})},_onSetItem:function(a){this.updateOption(this._getOptionObjForItem(a))},_getOptionObjForItem:function(a){var b=this.store,c=this.labelAttr&&this.labelAttr in a?a[this.labelAttr]:b.getLabel(a);return{value:c?b.getIdentity(a):null,label:c,item:a}},_addOptionForItem:function(a){var b=this.store;b.isItemLoaded&&!b.isItemLoaded(a)?b.loadItem({item:a,onItem:function(a){this._addOptionForItem(a)},
scope:this}):(a=this._getOptionObjForItem(a),this.addOption(a))},constructor:function(a){this._oValue=(a||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);p.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?b("\x3e *",this.srcNodeRef).map(function(b){return"separator"===b.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:b.getAttribute("data-"+a._scopeName+"-value")||b.getAttribute("value"),
label:String(b.innerHTML),selected:b.getAttribute("selected")||!1,disabled:b.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);f.after(this,"onChange",k.hitch(this,"_updateSelection"));var a=this.store;if(a&&(a.getIdentity||a.getFeatures()["dojo.data.api.Identity"]))this.store=null,this._deprecatedSetStore(a,this._oValue,
{query:this.query,queryOptions:this.queryOptions});this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var a;a=this._notifyConnections.pop();)a.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(n,d,f){var h=function(c){function p(a){c[a]=function(){var d=arguments,b=f(c,function(b){Array.prototype.unshift.call(d,b);return h(n[a].apply(n,d))});if("forEach"!==a||l)return b}}if(!c)return c;var l=!!c.then;l&&(c=d.delegate(c));p("forEach");p("filter");
p("map");null==c.total&&(c.total=f(c,function(a){return a.length}));return c};d.setObject("dojo.store.util.QueryResults",h);return h})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys","dojo/text!./templates/Menu.html","./_MenuBase"],function(n,d,f,h){return n("dijit.DropDownMenu",h,{templateString:f,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(c){this._moveToPopup(c);c.stopPropagation();c.preventDefault()},
_onLeftArrow:function(c){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else c.stopPropagation(),c.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t){return d("dijit._MenuBase",[q,
t,m,r],{selected:null,_setSelectedAttr:function(a){this.selected!=a&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),a&&a._setSelected(!0),this._set("selected",a))},activated:!1,_setActivatedAttr:function(a){c.toggle(this.domNode,"dijitMenuActive",a);c.toggle(this.domNode,"dijitMenuPassive",!a);this._set("activated",a)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,childSelector:function(a){var b=s.byNode(a);return a.parentNode==this.containerNode&&
b&&b.focus},postCreate:function(){var c=this,d="string"==typeof this.childSelector?this.childSelector:p.hitch(this,"childSelector");this.own(a(this.containerNode,a.selector(d,l.enter),function(){c.onItemHover(s.byNode(this))}),a(this.containerNode,a.selector(d,l.leave),function(){c.onItemUnhover(s.byNode(this))}),a(this.containerNode,a.selector(d,b),function(a){c.onItemClick(s.byNode(this),a);a.stopPropagation()}),a(this.containerNode,a.selector(d,"focusin"),function(){c._onItemFocus(s.byNode(this))}));
this.inherited(arguments)},onKeyboardSearch:function(a,b,c,d){this.inherited(arguments);if(a&&(-1==d||a.popup&&1==d))this.onItemClick(a,b)},_keyboardSearchCompare:function(a,b){return a.shortcutKey?b==a.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(a){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,a);else(a=this._getTopMenu())&&a._isMenuBar&&a.focusNext()},
_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(a){this.activated?(this.set("selected",a),a.popup&&(!a.disabled&&!this.hover_timer)&&(this.hover_timer=this.defer(function(){this._openItemPopup(a)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(a,{type:"click"})},this.passivePopupDelay));this._hoveredChild=
a;a._set("hovering",!0)},_onChildDeselect:function(a){this._stopPopupTimer();this.currentPopupItem==a&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;a._closePopup()},this.popupDelay))},onItemUnhover:function(a){this._hoveredChild==a&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);a._set("hovering",!1)},_stopPopupTimer:function(){this.hover_timer&&
(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var a=this;a.parentMenu;a=a.parentMenu);return a},onItemClick:function(a,b){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(a);if(a.disabled)return!1;if(a.popup){this.set("selected",a);this.set("activated",!0);var c=/^key/.test(b._origType||b.type)||0==b.clientX&&0==b.clientY;this._openItemPopup(a,
c)}else this.onExecute(),a._onClick?a._onClick(b):a.onClick(b)},_openItemPopup:function(b,c){if(b!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var d=b.popup;d.parentMenu=this;this.own(this._mouseoverHandle=a.once(d.domNode,"mouseover",p.hitch(this,"_onPopupHover")));var k=this;b._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){c&&k.focusChild(b);k._cleanUp()},onExecute:p.hitch(this,
"_cleanUp",!0),onClose:function(){k._mouseoverHandle&&(k._mouseoverHandle.remove(),delete k._mouseoverHandle)}},c);this.currentPopupItem=b}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(h.set(this.selected.focusNode,"tabIndex",this.tabIndex),this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),
this.currentPopupItem=null)},_onItemFocus:function(a){if(this._hoveredChild&&this._hoveredChild!=a)this.onItemUnhover(this._hoveredChild);this.set("selected",a)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(a){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);a&&this.set("selected",null)}})})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(n,d,f,h,c,p,l,a,k,b){return d("dijit._KeyNavContainer",[k,b,a],{connectKeyNavHandlers:function(a,b){var d=this._keyNavCodes={},k=p.hitch(this,"focusPrev"),f=p.hitch(this,"focusNext");n.forEach(a,function(a){d[a]=k});n.forEach(b,function(a){d[a]=f});d[c.HOME]=p.hitch(this,"focusFirstChild");d[c.END]=p.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){h.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);n.forEach(this.getChildren(),
p.hitch(this,"_startupChild"))},addChild:function(a,b){this.inherited(arguments);this._startupChild(a)},_startupChild:function(a){a.set("tabIndex","-1")},_getFirst:function(){var a=this.getChildren();return a.length?a[0]:null},_getLast:function(){var a=this.getChildren();return a.length?a[a.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(a){return(a=
l.byNode(a))&&a.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(n,d,f,h,c,p,l,a){return d("dijit._KeyNavMixin",a,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);f.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var a=this._keyNavCodes={};a[h.HOME]=c.hitch(this,"focusFirstChild");a[h.END]=c.hitch(this,
"focusLastChild");a[this.isLeftToRight()?h.LEFT_ARROW:h.RIGHT_ARROW]=c.hitch(this,"_onLeftArrow");a[this.isLeftToRight()?h.RIGHT_ARROW:h.LEFT_ARROW]=c.hitch(this,"_onRightArrow");a[h.UP_ARROW]=c.hitch(this,"_onUpArrow");a[h.DOWN_ARROW]=c.hitch(this,"_onDownArrow")}var b=this,a="string"==typeof this.childSelector?this.childSelector:c.hitch(this,"childSelector");this.own(p(this.domNode,"keypress",c.hitch(this,"_onContainerKeypress")),p(this.domNode,"keydown",c.hitch(this,"_onContainerKeydown")),p(this.domNode,
"focus",c.hitch(this,"_onContainerFocus")),p(this.containerNode,p.selector(a,"focusin"),function(a){b._onChildFocus(l.getEnclosingWidget(this),a)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(a,b){a&&(this.focusedChild&&a!==this.focusedChild&&this._onChildBlur(this.focusedChild),a.set("tabIndex",this.tabIndex),a.focus(b?"end":"start"))},_onContainerFocus:function(a){a.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){f.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(a){f.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(a){a&&a!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),a.set("tabIndex",this.tabIndex),this.lastFocused=a,this._set("focusedChild",a))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(a,b,c,d){a&&this.focusChild(a)},_keyboardSearchCompare:function(a,b){var c=a.domNode,c=(a.label||(c.focusNode?
c.focusNode.label:"")||c.innerText||c.textContent||"").replace(/^\s+/,"").substr(0,b.length).toLowerCase();return b.length&&c==b?-1:0},_isFormElement:function(a){return"INPUT"===a.tagName||"TEXTAREA"===a.tagName||"SELECT"===a.tagName||"BUTTON"===a.tagName},_onContainerKeydown:function(a){if(!this._isFormElement(document.activeElement)){var b=this._keyNavCodes[a.keyCode];b?(b(a,this.focusedChild),a.stopPropagation(),a.preventDefault(),this._searchString=""):a.keyCode==h.SPACE&&(this._searchTimer&&
!a.ctrlKey&&!a.altKey&&!a.metaKey)&&(a.stopImmediatePropagation(),a.preventDefault(),this._keyboardSearch(a," "))}},_onContainerKeypress:function(a){if(!this._isFormElement(document.activeElement)&&!(a.charCode<=h.SPACE||a.ctrlKey||a.altKey||a.metaKey))a.preventDefault(),a.stopPropagation(),this._keyboardSearch(a,String.fromCharCode(a.charCode).toLowerCase())},_keyboardSearch:function(a,b){var d=null,q,r=0;c.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=b;
var a=/^(.)\1*$/.test(this._searchString)?1:this._searchString.length;q=this._searchString.substr(0,a);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var c=this.focusedChild||null;if(1==a||!c)if(c=this._getNextFocusableChild(c,1),!c)return;a=c;do{var e=this._keyboardSearchCompare(c,q);e&&0==r++&&(d=c);if(-1==e){r=-1;break}c=this._getNextFocusableChild(c,1)}while(c!=a)})();this.onKeyboardSearch(d,a,q,r)},_onChildBlur:function(){},
_getNextFocusableChild:function(a,b){var c=a;do{if(a)a=this._getNext(a,b);else if(a=this[0<b?"_getFirst":"_getLast"](),!a)break;if(null!=a&&a!=c&&a.isFocusable())return a}while(a!=c);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(a,b){if(a)for(a=a.domNode;a;)if((a=a[0>b?"previousSibling":"nextSibling"])&&"getAttribute"in a){var c=l.byNode(a);if(c)return c}return null}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){l=n("dijit.MenuItem"+(p("dojo-bidi")?"_NoBidi":""),[a,k,b,s],{templateString:q,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(a){this._set("label",a);var b="",c;c=a.search(/{\S}/);if(0<=c){var b=a.charAt(c+1),e=a.substr(0,c);a=a.substr(c+3);c=e+b+a;a=e+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+b+"\x3c/span\x3e"+a}else c=a;this.domNode.setAttribute("aria-label",c+" "+this.accelKey);this.containerNode.innerHTML=a;this._set("shortcutKey",b)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(a){a&&!("label"in this.params)&&this._set("label",a.innerHTML)},buildRendering:function(){this.inherited(arguments);f.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&f.set(this.accelKeyNode,"id",this.id+"_accel");d.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==p("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(a){}},_setSelected:function(a){h.toggle(this.domNode,
"dijitMenuItemSelected",a)},setLabel:function(a){c.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",a)},setDisabled:function(a){c.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",a)},_setDisabledAttr:function(a){this.focusNode.setAttribute("aria-disabled",a?"true":"false");this._set("disabled",a)},_setAccelKeyAttr:function(a){this.accelKeyNode&&(this.accelKeyNode.style.display=
a?"":"none",this.accelKeyNode.innerHTML=a,f.set(this.containerNode,"colSpan",a?"1":"2"));this._set("accelKey",a)}});p("dojo-bidi")&&(l=n("dijit.MenuItem",l,{_setLabelAttr:function(a){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return l})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(n,d){return n("dijit._Contained",null,{_getSibling:function(f){var h=this.domNode;do h=h[f+"Sibling"];while(h&&1!=h.nodeType);return h&&
d.byNode(h)},getPreviousSibling:function(){return this._getSibling("previous")},getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var d=this.getParent();return!d||!d.getIndexOfChild?-1:d.getIndexOfChild(this)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),function(n,d,f,h,c,p){return n("dijit.MenuSeparator",[f,h,c],{templateString:p,buildRendering:function(){this.inherited(arguments);
d.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(n,d,f,h){return n("dijit.form.NumberSpinner",[f,h.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(c,d){var f=this.constraints,a=isNaN(c),k=!isNaN(f.max),b=!isNaN(f.min);a&&0!=d&&(c=0<d?b?f.min:k?f.max:0:k?this.constraints.max:b?f.min:0);var h=c+d;if(a||isNaN(h))return c;k&&h>
f.max&&(h=f.max);b&&h<f.min&&(h=f.min);return h},_onKeyDown:function(c){if(!this.disabled&&!this.readOnly&&(c.keyCode==d.HOME||c.keyCode==d.END)&&!c.ctrlKey&&(!c.altKey&&!c.metaKey)&&"undefined"!=typeof this.get("value")){var f=this.constraints[c.keyCode==d.HOME?"min":"max"];"number"==typeof f&&this._setValueAttr(f,!1);c.stopPropagation();c.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(n,d,f,h,c,p,l,a,k,b){return n("dijit.form._Spinner",a,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:0.9,smallDelta:1,largeDelta:10,templateString:k,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(a){return a},_arrowPressed:function(a,c,d){!this.disabled&&!this.readOnly&&(this._setValueAttr(this.adjust(this.get("value"),c*d),!1),b.selectInputText(this.textbox,this.textbox.value.length))},
_arrowReleased:function(){this._wheelTimer=null},_typematicCallback:function(a,b,c){var k=this.smallDelta;b==this.textbox&&(b=c.keyCode,k=b==d.PAGE_UP||b==d.PAGE_DOWN?this.largeDelta:this.smallDelta,b=b==d.UP_ARROW||b==d.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==a?this._arrowReleased(b):this._arrowPressed(b,b==this.upArrowNode?1:-1,k)},_wheelTimer:null,_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();var b=a.wheelDelta/120;Math.floor(b)!=b&&(b=0<a.wheelDelta?1:-1);a=a.detail?
-1*a.detail:b;if(0!==a){var c=this[0<a?"upArrowNode":"downArrowNode"];this._arrowPressed(c,a,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(c)},50)}},_setConstraintsAttr:function(a){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",
this.constraints.max):this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(a,b){this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(p(this.domNode,c.wheel,f.hitch(this,"_mouseWheeled")),l.addListener(this.upArrowNode,this.textbox,{keyCode:d.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,
this.textbox,{keyCode:d.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.upArrowNode,this.textbox,{keyCode:d.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),l.addListener(this.downArrowNode,this.textbox,{keyCode:d.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",
this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout))}})})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(n,d,f){return n("dijit.form.RangeBoundTextBox",f,{rangeMessage:"",rangeCheck:function(d,c){return("min"in c?0<=this.compare(d,c.min):!0)&&("max"in c?0>=this.compare(d,c.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var d=
this.get("value");if(null==d)return!1;var c=!1;"min"in this.constraints&&(c=this.constraints.min,c=0>this.compare(d,"number"==typeof c&&0<=c&&0!=d?0:c));!c&&"max"in this.constraints&&(c=this.constraints.max,c=0<this.compare(d,"number"!=typeof c||0<c?c:0));return c},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(d){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(d))},getErrorMessage:function(d){var c=
this.get("value");return null!=c&&""!==c&&("number"!=typeof c||!isNaN(c))&&!this.isInRange(d)?this.rangeMessage:this.inherited(arguments)},postMixInProperties:function(){this.inherited(arguments);this.rangeMessage||(this.messages=d.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(n,d,f,h){return n("dijit.form.MappedTextBox",
h,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(c){return c.toString?c.toString():""},toString:function(){var c=this.filter(this.get("value"));return null!=c?"string"==typeof c?c:this.serialize(c,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=f.place("\x3cinput type\x3d'hidden'"+(this.name&&
!d("msapp")?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),function(n,d,f,h,c,p){var l=function(a){a=a||{};var b=f.getLocalization("dojo.cldr","number",f.normalizeLocale(a.locale)),c=a.pattern?a.pattern:b[(a.type||"decimal")+"Format"];a="number"==
typeof a.places?a.places:"string"===typeof a.places&&0<a.places.length?a.places.replace(/.*,/,""):-1!=c.indexOf(".")?c.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:b.decimal,places:a}},a=n("dijit.form.NumberTextBoxMixin",null,{pattern:function(a){return"("+(this.focused&&this.editOptions?this._regExpGenerator(d.delegate(a,this.editOptions))+"|":"")+this._regExpGenerator(a)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:c.format,_regExpGenerator:c.regexp,_decimalInfo:l(),postMixInProperties:function(){this.inherited(arguments);
this._set("type","text")},_setConstraintsAttr:function(a){var b="number"==typeof a.places?a.places:0;b&&b++;"number"!=typeof a.max&&(a.max=9*Math.pow(10,15-b));"number"!=typeof a.min&&(a.min=-9*Math.pow(10,15-b));this.inherited(arguments,[a]);this.focusNode&&(this.focusNode.value&&!isNaN(this.value))&&this.set("value",this.value);this._decimalInfo=l(a)},_onFocus:function(){if(!this.disabled&&!this.readOnly){var a=this.get("value");"number"==typeof a&&!isNaN(a)&&(a=this.format(a,this.constraints),
void 0!==a&&(this.textbox.value=a));this.inherited(arguments)}},format:function(a,b){var c=String(a);if("number"!=typeof a)return c;if(isNaN(a))return"";if(!("rangeCheck"in this&&this.rangeCheck(a,b))&&!1!==b.exponent&&/\de[-+]?\d/i.test(c))return c;this.editOptions&&this.focused&&(b=d.mixin({},b,this.editOptions));return this._formatter(a,b)},_parser:c.parse,parse:function(a,b){var c=this._parser(a,d.mixin({},b,this.editOptions&&this.focused?this.editOptions:{}));this.editOptions&&(this.focused&&
isNaN(c))&&(c=this._parser(a,b));return c},_getDisplayedValueAttr:function(){var a=this.inherited(arguments);return isNaN(a)?this.textbox.value:a},filter:function(a){if(null==a||"string"==typeof a&&""==a)return NaN;"number"==typeof a&&(!isNaN(a)&&0!=a)&&(a=c.round(a,this._decimalInfo.places));return this.inherited(arguments,[a])},serialize:function(a,b){return"number"!=typeof a||isNaN(a)?"":this.inherited(arguments)},_setBlurValue:function(){var a=d.hitch(d.delegate(this,{focused:!0}),"get")("value");
this._setValueAttr(a,!0)},_setValueAttr:function(a,b,c){if(void 0!==a&&void 0===c)if(c=String(a),"number"==typeof a)if(isNaN(a))c="";else{if("rangeCheck"in this&&this.rangeCheck(a,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(c))c=void 0}else a?a=void 0:(c="",a=NaN);this.inherited(arguments,[a,b,c])},_getValueAttr:function(){var a=this.inherited(arguments);if(isNaN(a)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&RegExp("^"+
c._realNumberRegexp(d.delegate(this.constraints))+"$").test(this.textbox.value))return a=Number(this.textbox.value),isNaN(a)?void 0:a}else return a},isValid:function(a){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var b=this.get("value");return!isNaN(b)&&this.rangeCheck(b,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var a="number"==typeof this.constraints.min,
b="number"==typeof this.constraints.max,c=this.get("value");if(isNaN(c)||!a&&!b)return this.inherited(arguments);var d=c|0,f=0>c,m=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),l=(this.maxLength||20)-this.textbox.value.length,e=m?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"",d=m?d+"."+e:d+"",l=h.rep("9",l),m=c;f?m=Number(d+l):c=Number(d+l);return!(a&&c<this.constraints.min||b&&m>this.constraints.max)}});n=n("dijit.form.NumberTextBox",[p,a],{baseClass:"dijitTextBox dijitNumberTextBox"});
n.Mixin=a;return n})},"jimu/dijit/ColorPicker":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/_base/lang dojo/_base/html dojo/on dojo/_base/Color dijit/TooltipDialog dijit/popup dojox/widget/ColorPicker".split(" "),function(n,d,f,h,c,p,l,a,k,b){return n([d,f],{baseClass:"jimu-color-picker",declaredClass:"jimu.dijit.ColorPicker",templateString:"\x3cdiv\x3e\x3c/div\x3e",_isTooltipDialogOpened:!1,color:null,showHex:!0,showHsv:!0,showRgb:!0,postCreate:function(){this.inherited(arguments);
this.color?this.color instanceof l||(this.color=new l(this.color)):this.color=new l("#ccc");c.setStyle(this.domNode,"backgroundColor",this.color.toHex());this._createTooltipDialog(this.domNode);this._hideTooltipDialog()},destroy:function(){k.close(this.tooltipDialog);this.picker.destroy();this.tooltipDialog.destroy();this.inherited(arguments)},isPartOfPopup:function(a){var b=this.tooltipDialog.domNode;return a===b||c.isDescendant(a,b)},hideTooltipDialog:function(){this._hideTooltipDialog()},_showTooltipDialog:function(){k.open({parent:this.getParent(),
popup:this.tooltipDialog,around:this.domNode});this._isTooltipDialogOpened=!0},_hideTooltipDialog:function(){k.close(this.tooltipDialog);this._isTooltipDialogOpened=!1},_createTooltipDialog:function(){var d=c.create("div");this.tooltipDialog=new a({content:d});var k=new b({showHex:this.showHex,showRgb:this.showRgb,showHsv:this.showHsv,value:this.color.toHex(),onChange:h.hitch(this,function(a){a=new l(a);this.setColor(a)})});k.placeAt(d);k.startup();this.own(p(this.domNode,"click",h.hitch(this,function(a){a.stopPropagation();
a.preventDefault();this._isTooltipDialogOpened?this._hideTooltipDialog():this._showTooltipDialog()})));this.own(p(document.body,"click",h.hitch(this,function(a){this.isPartOfPopup(a.target||a.srcElement)||this._hideTooltipDialog()})));this.picker=k},setColor:function(a){if(a instanceof l){var b=this.color,d="";b&&(d=b.toHex());b=a.toHex();this.color=a;c.setStyle(this.domNode,"backgroundColor",b);if(d!==b)this.onChange(new l(b))}},getColor:function(){return this.color},onChange:function(a){}})})},
"dojox/widget/ColorPicker":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/connect dojo/_base/sniff dojo/_base/window dojo/_base/event dojo/dom dojo/dom-class dojo/keys dojo/fx dojo/dnd/move dijit/registry dijit/_base/focus dijit/form/_FormWidget dijit/typematic dojox/color dojo/i18n dojo/i18n!./nls/ColorPicker dojo/i18n!dojo/cldr/nls/number dojo/text!./ColorPicker/ColorPicker.html".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,
t,e,g,y,w,x,z,D,v){n.experimental("dojox.widget.ColorPicker");return d("dojox.widget.ColorPicker",g,{showRgb:!0,showHsv:!0,showHex:!0,webSafe:!0,animatePoint:!0,slideDuration:250,liveUpdate:!1,PICKER_HUE_H:150,PICKER_SAT_VAL_H:150,PICKER_SAT_VAL_W:150,PICKER_HUE_SELECTOR_H:8,PICKER_SAT_SELECTOR_H:10,PICKER_SAT_SELECTOR_W:10,value:"#ffffff",_underlay:require.toUrl("dojox/widget/ColorPicker/images/underlay.png"),_hueUnderlay:require.toUrl("dojox/widget/ColorPicker/images/hue.png"),_pickerPointer:require.toUrl("dojox/widget/ColorPicker/images/pickerPointer.png"),
_huePickerPointer:require.toUrl("dojox/widget/ColorPicker/images/hueHandle.png"),_huePickerPointerAlly:require.toUrl("dojox/widget/ColorPicker/images/hueHandleA11y.png"),templateString:v,postMixInProperties:function(){s.contains(a.body(),"dijit_a11y")&&(this._huePickerPointer=this._huePickerPointerAlly);this._uId=t.getUniqueId(this.id);f.mixin(this,x.getLocalization("dojox.widget","ColorPicker"));f.mixin(this,x.getLocalization("dojo.cldr","number"));this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
7>l("ie")&&(this.colorUnderlay.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src\x3d'"+this._underlay+"', sizingMethod\x3d'scale')",this.colorUnderlay.src=this._blankGif.toString());this.showRgb||(this.rgbNode.style.visibility="hidden");this.showHsv||(this.hsvNode.style.visibility="hidden");this.showHex||(this.hexNode.style.visibility="hidden");this.webSafe||(this.safePreviewNode.style.visibility="hidden")},startup:function(){this._started||(this._started=!0,this.set("value",this.value),
this._mover=new m.boxConstrainedMoveable(this.cursorNode,{box:{t:-(this.PICKER_SAT_SELECTOR_H/2),l:-(this.PICKER_SAT_SELECTOR_W/2),w:this.PICKER_SAT_VAL_W,h:this.PICKER_SAT_VAL_H}}),this._hueMover=new m.boxConstrainedMoveable(this.hueCursorNode,{box:{t:-(this.PICKER_HUE_SELECTOR_H/2),l:0,w:0,h:this.PICKER_HUE_H}}),this._subs=[],this._subs.push(p.subscribe("/dnd/move/stop",f.hitch(this,"_clearTimer"))),this._subs.push(p.subscribe("/dnd/move/start",f.hitch(this,"_setTimer"))),this._keyListeners=[],
this._connects.push(y.addKeyListener(this.hueCursorNode,{charOrCode:q.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(y.addKeyListener(this.hueCursorNode,{charOrCode:q.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateHueCursorNode),25,25)),this._connects.push(y.addKeyListener(this.cursorNode,{charOrCode:q.UP_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),
25,25)),this._connects.push(y.addKeyListener(this.cursorNode,{charOrCode:q.DOWN_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)),this._connects.push(y.addKeyListener(this.cursorNode,{charOrCode:q.LEFT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),25,25)),this._connects.push(y.addKeyListener(this.cursorNode,{charOrCode:q.RIGHT_ARROW,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1},this,f.hitch(this,this._updateCursorNode),
25,25)))},_setValueAttr:function(a,b){this._started&&this.setColor(a,b)},setColor:function(a,b){a=w.fromString(a);this._updatePickerLocations(a);this._updateColorInputs(a);this._updateValue(a,b)},_setTimer:function(a){a.node!=this.cursorNode&&a.node!=this.hueCursorNode||(e.focus(a.node),b.setSelectable(this.domNode,!1),this._timer=setInterval(f.hitch(this,"_updateColor"),45))},_clearTimer:function(a){this._timer&&(clearInterval(this._timer),this._timer=null,this.onChange(this.value),b.setSelectable(this.domNode,
!0))},_setHue:function(a){c.style(this.colorUnderlay,"backgroundColor",w.fromHsv(a,100,100).toHex())},_updateHueCursorNode:function(a,b,e){if(-1!==a){a=c.style(this.hueCursorNode,"top");b=this.PICKER_HUE_SELECTOR_H/2;a+=b;var d=!1;e.charOrCode==q.UP_ARROW?0<a&&(a-=1,d=!0):e.charOrCode==q.DOWN_ARROW&&a<this.PICKER_HUE_H&&(a+=1,d=!0);d&&c.style(this.hueCursorNode,"top",a-b+"px")}else this._updateColor(!0)},_updateCursorNode:function(a,b,e){b=this.PICKER_SAT_SELECTOR_H/2;var d=this.PICKER_SAT_SELECTOR_W/
2;if(-1!==a){a=c.style(this.cursorNode,"top");var g=c.style(this.cursorNode,"left");a+=b;var g=g+d,k=!1;e.charOrCode==q.UP_ARROW?0<a&&(a-=1,k=!0):e.charOrCode==q.DOWN_ARROW?a<this.PICKER_SAT_VAL_H&&(a+=1,k=!0):e.charOrCode==q.LEFT_ARROW?0<g&&(g-=1,k=!0):e.charOrCode==q.RIGHT_ARROW&&g<this.PICKER_SAT_VAL_W&&(g+=1,k=!0);k&&(g-=d,c.style(this.cursorNode,"top",a-b+"px"),c.style(this.cursorNode,"left",g+"px"))}else this._updateColor(!0)},_updateColor:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/
2,d=this.PICKER_SAT_SELECTOR_W/2,b=c.style(this.hueCursorNode,"top")+b,e=c.style(this.cursorNode,"top")+e,d=c.style(this.cursorNode,"left")+d,b=Math.round(360-360*(b/this.PICKER_HUE_H)),d=w.fromHsv(b,100*(d/this.PICKER_SAT_VAL_W),100-100*(e/this.PICKER_SAT_VAL_H));this._updateColorInputs(d);this._updateValue(d,a);b!=this._hue&&this._setHue(b)},_colorInputChange:function(a){var b,c=!1;switch(a.target){case this.hexCode:b=w.fromString(a.target.value);c=!0;break;case this.Rval:case this.Gval:case this.Bval:b=
w.fromArray([this.Rval.value,this.Gval.value,this.Bval.value]);c=!0;break;case this.Hval:case this.Sval:case this.Vval:b=w.fromHsv(this.Hval.value,this.Sval.value,this.Vval.value),c=!0}c&&(this._updatePickerLocations(b),this._updateColorInputs(b),this._updateValue(b,!0))},_updateValue:function(a,b){var c=a.toHex();this.value=this.valueNode.value=c;if(b&&(!this._timer||this.liveUpdate))this.onChange(c)},_updatePickerLocations:function(a){var b=this.PICKER_HUE_SELECTOR_H/2,e=this.PICKER_SAT_SELECTOR_H/
2,d=this.PICKER_SAT_SELECTOR_W/2;a=a.toHsv();b=Math.round(this.PICKER_HUE_H-a.h/360*this.PICKER_HUE_H)-b;d=Math.round(a.s/100*this.PICKER_SAT_VAL_W)-d;e=Math.round(this.PICKER_SAT_VAL_H-a.v/100*this.PICKER_SAT_VAL_H)-e;this.animatePoint?(r.slideTo({node:this.hueCursorNode,duration:this.slideDuration,top:b,left:0}).play(),r.slideTo({node:this.cursorNode,duration:this.slideDuration,top:e,left:d}).play()):(c.style(this.hueCursorNode,"top",b+"px"),c.style(this.cursorNode,{left:d+"px",top:e+"px"}));a.h!=
this._hue&&this._setHue(a.h)},_updateColorInputs:function(a){var b=a.toHex();this.showRgb&&(this.Rval.value=a.r,this.Gval.value=a.g,this.Bval.value=a.b);this.showHsv&&(a=a.toHsv(),this.Hval.value=Math.round(a.h),this.Sval.value=Math.round(a.s),this.Vval.value=Math.round(a.v));this.showHex&&(this.hexCode.value=b);this.previewNode.style.backgroundColor=b;this.webSafe&&(this.safePreviewNode.style.backgroundColor=b)},_setHuePoint:function(a){a=a.layerY-this.PICKER_HUE_SELECTOR_H/2;this.animatePoint?r.slideTo({node:this.hueCursorNode,
duration:this.slideDuration,top:a,left:0,onEnd:f.hitch(this,function(){this._updateColor(!1);e.focus(this.hueCursorNode)})}).play():(c.style(this.hueCursorNode,"top",a+"px"),this._updateColor(!1))},_setPoint:function(a){var b=a.layerY-this.PICKER_SAT_SELECTOR_H/2,d=a.layerX-this.PICKER_SAT_SELECTOR_W/2;a&&e.focus(a.target);this.animatePoint?r.slideTo({node:this.cursorNode,duration:this.slideDuration,top:b,left:d,onEnd:f.hitch(this,function(){this._updateColor(!0);e.focus(this.cursorNode)})}).play():
(c.style(this.cursorNode,{left:d+"px",top:b+"px"}),this._updateColor(!1))},_handleKey:function(a){},focus:function(){this.focused||e.focus(this.focusNode)},_stopDrag:function(a){k.stop(a)},destroy:function(){this.inherited(arguments);h.forEach(this._subs,function(a){p.unsubscribe(a)});delete this._subs}})})},"dojox/color":function(){define(["./color/_base"],function(n){return n})},"dojox/color/_base":function(){define(["../main","dojo/_base/lang","dojo/_base/Color","dojo/colors"],function(n,d,f,h){n=
d.getObject("color",!0,n);n.Color=f;n.blend=f.blendColors;n.fromRgb=f.fromRgb;n.fromHex=f.fromHex;n.fromArray=f.fromArray;n.fromString=f.fromString;n.greyscale=h.makeGrey;d.mixin(n,{fromCmy:function(c,p,l){d.isArray(c)?(p=c[1],l=c[2],c=c[0]):d.isObject(c)&&(p=c.m,l=c.y,c=c.c);p=1-p/100;l=1-l/100;return new f({r:Math.round(255*(1-c/100)),g:Math.round(255*p),b:Math.round(255*l)})},fromCmyk:function(c,p,l,a){d.isArray(c)?(p=c[1],l=c[2],a=c[3],c=c[0]):d.isObject(c)&&(p=c.m,l=c.y,a=c.b,c=c.c);p/=100;l/=
100;a/=100;c=1-Math.min(1,c/100*(1-a)+a);p=1-Math.min(1,p*(1-a)+a);l=1-Math.min(1,l*(1-a)+a);return new f({r:Math.round(255*c),g:Math.round(255*p),b:Math.round(255*l)})},fromHsl:function(c,p,l){d.isArray(c)?(p=c[1],l=c[2],c=c[0]):d.isObject(c)&&(p=c.s,l=c.l,c=c.h);p/=100;for(l/=100;0>c;)c+=360;for(;360<=c;)c-=360;var a,k;120>c?(a=(120-c)/60,k=c/60,c=0):240>c?(a=0,k=(240-c)/60,c=(c-120)/60):(a=(c-240)/60,k=0,c=(360-c)/60);a=2*p*Math.min(a,1)+(1-p);k=2*p*Math.min(k,1)+(1-p);c=2*p*Math.min(c,1)+(1-p);
0.5>l?(a*=l,k*=l,c*=l):(a=(1-l)*a+2*l-1,k=(1-l)*k+2*l-1,c=(1-l)*c+2*l-1);return new f({r:Math.round(255*a),g:Math.round(255*k),b:Math.round(255*c)})}});n.fromHsv=function(c,p,l){d.isArray(c)?(p=c[1],l=c[2],c=c[0]):d.isObject(c)&&(p=c.s,l=c.v,c=c.h);360==c&&(c=0);p/=100;l/=100;var a,k,b;if(0==p)k=b=a=l;else{var h=c/60;c=Math.floor(h);var q=h-c,h=l*(1-p),r=l*(1-p*q);p=l*(1-p*(1-q));switch(c){case 0:a=l;k=p;b=h;break;case 1:a=r;k=l;b=h;break;case 2:a=h;k=l;b=p;break;case 3:a=h;k=r;b=l;break;case 4:a=
p;k=h;b=l;break;case 5:a=l,k=h,b=r}}return new f({r:Math.round(255*a),g:Math.round(255*k),b:Math.round(255*b)})};d.extend(f,{toCmy:function(){var c=1-this.g/255,d=1-this.b/255;return{c:Math.round(100*(1-this.r/255)),m:Math.round(100*c),y:Math.round(100*d)}},toCmyk:function(){var c,d,f,a=this.r/255;c=this.g/255;d=this.b/255;f=Math.min(1-a,1-c,1-d);c=(1-c-f)/(1-f);d=(1-d-f)/(1-f);return{c:Math.round(100*((1-a-f)/(1-f))),m:Math.round(100*c),y:Math.round(100*d),b:Math.round(100*f)}},toHsl:function(){var c=
this.r/255,d=this.g/255,f=this.b/255,a=Math.min(c,f,d),k=Math.max(c,d,f),b=k-a,h=0,q=0,a=(a+k)/2;0<a&&1>a&&(q=b/(0.5>a?2*a:2-2*a));0<b&&(k==c&&k!=d&&(h+=(d-f)/b),k==d&&k!=f&&(h+=2+(f-c)/b),k==f&&k!=c&&(h+=4+(c-d)/b),h*=60);return{h:h,s:Math.round(100*q),l:Math.round(100*a)}},toHsv:function(){var c=this.r/255,d=this.g/255,f=this.b/255,a=Math.min(c,f,d),k=Math.max(c,d,f),a=k-a,b=null,h=0==k?0:a/k;0==h?b=0:(b=c==k?60*(d-f)/a:d==k?120+60*(f-c)/a:240+60*(c-d)/a,0>b&&(b+=360));return{h:b,s:Math.round(100*
h),v:Math.round(100*k)}}});return n})},"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(n,d,f,h){var c={};d.setObject("dojo.colors",c);var p=function(a,c,b){0>b&&++b;1<b&&--b;var d=6*b;return 1>d?a+(c-a)*d:1>2*b?c:2>3*b?a+6*(c-a)*(2/3-b):a};n.colorFromRgb=f.fromRgb=function(a,c){var b=a.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(b){var d=b[2].split(/\s*,\s*/),q=d.length,b=b[1];if("rgb"==b&&3==q||"rgba"==b&&4==q)return b=d[0],
"%"==b.charAt(b.length-1)?(b=h.map(d,function(a){return 2.56*parseFloat(a)}),4==q&&(b[3]=d[3]),f.fromArray(b,c)):f.fromArray(d,c);if("hsl"==b&&3==q||"hsla"==b&&4==q){var b=(parseFloat(d[0])%360+360)%360/360,r=parseFloat(d[1])/100,m=parseFloat(d[2])/100,r=0.5>=m?m*(r+1):m+r-m*r,m=2*m-r,b=[256*p(m,r,b+1/3),256*p(m,r,b),256*p(m,r,b-1/3),1];4==q&&(b[3]=d[3]);return f.fromArray(b,c)}}return null};var l=function(a,c,b){a=Number(a);return isNaN(a)?b:a<c?c:a>b?b:a};f.prototype.sanitize=function(){this.r=
Math.round(l(this.r,0,255));this.g=Math.round(l(this.g,0,255));this.b=Math.round(l(this.b,0,255));this.a=l(this.a,0,1);return this};c.makeGrey=f.makeGrey=function(a,c){return f.fromArray([a,a,a,c])};d.mixin(f.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,
105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,
79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,
230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,
50],linen:[250,240,230],magenta:[255,0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],
orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,
144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return f})},"jimu/dijit/_Transparency":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/Evented dojo/text!./templates/_Transparency.html dojo/_base/lang dojo/_base/html dojo/on dijit/form/HorizontalSlider dijit/form/HorizontalRuleLabels dijit/form/HorizontalRule".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){return n([d,f,h,c],{baseClass:"jimu-transparency",declaredClass:"jimu.dijit.Transparency",templateString:p,nls:null,alpha:1,postMixInProperties:function(){this.nls=window.jimuNls.transparency},postCreate:function(){this.inherited(arguments);"number"===typeof this.alpha&&this.setAlpha(this.alpha)},setAlpha:function(a){a=Math.round(100-100*a);this.opacitySlider.set("value",a)},getAlpha:function(){return Math.round(100-this.opacitySlider.get("value"))/100},_onAlphaChanged:function(){var a=
this.getAlpha();this.emit("change",a)}})})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z){var D=d("dijit.form._SliderMover",
s,{onMouseMove:function(b){var d=this.widget,e=d._abspos;e||(e=d._abspos=c.position(d.sliderBarContainer,!0),d._setPixelValue_=a.hitch(d,"_setPixelValue"),d._isReversed_=d._isReversed());b=b[d._mousePixelCoord]-e[d._startingPixelCoord];d._setPixelValue_(d._isReversed_?e[d._pixelCount]-b:b,e[d._pixelCount],!1)},destroy:function(a){s.prototype.destroy.apply(this,arguments);var b=this.widget;b._abspos=null;b._setValueAttr(b.value,!0)}});f=d("dijit.form.HorizontalSlider",[w,x],{templateString:z,value:0,
showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:t.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",_onKeyUp:function(a){!this.disabled&&(!this.readOnly&&!a.altKey&&
!a.ctrlKey&&!a.metaKey)&&this._setValueAttr(this.value,!0)},_onKeyDown:function(a){if(!this.disabled&&!this.readOnly&&!a.altKey&&!a.ctrlKey&&!a.metaKey){switch(a.keyCode){case l.HOME:this._setValueAttr(this.minimum,!1);break;case l.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?l.RIGHT_ARROW:l.LEFT_ARROW:case !1===this._descending?l.DOWN_ARROW:l.UP_ARROW:case !1===this._descending?l.PAGE_DOWN:l.PAGE_UP:this.increment(a);break;case this._descending||this.isLeftToRight()?
l.LEFT_ARROW:l.RIGHT_ARROW:case !1===this._descending?l.UP_ARROW:l.DOWN_ARROW:case !1===this._descending?l.PAGE_UP:l.PAGE_DOWN:this.decrement(a);break;default:return}a.stopPropagation();a.preventDefault()}},_onHandleClick:function(a){!this.disabled&&!this.readOnly&&(k("ie")||e.focus(this.sliderHandle),a.stopPropagation(),a.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(a){if(!this.disabled&&!this.readOnly&&this.clickSelect){e.focus(this.sliderHandle);a.stopPropagation();
a.preventDefault();var b=c.position(this.sliderBarContainer,!0),d=a[this._mousePixelCoord]-b[this._startingPixelCoord];this._setPixelValue(this._isReversed()?b[this._pixelCount]-d:d,b[this._pixelCount],!0);this._movable.onMouseDown(a)}},_setPixelValue:function(a,b,c){if(!this.disabled&&!this.readOnly){var d=this.discreteValues;if(1>=d||Infinity==d)d=b;d--;a=Math.round(a/(b/d));this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*a/d+this.minimum,this.maximum),this.minimum),c)}},_setValueAttr:function(a,
b){this._set("value",a);this.valueNode.value=a;this.focusNode.setAttribute("aria-valuenow",a);this.inherited(arguments);var c=this.maximum>this.minimum?(a-this.minimum)/(this.maximum-this.minimum):0,d=!1===this._descending?this.remainingBar:this.progressBar,e=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(b&&0<this.slideDuration&&d.style[this._progressPixelSize]){var g=this,k={},f=parseFloat(d.style[this._progressPixelSize]),
m=this.slideDuration*(c-f/100);0!=m&&(0>m&&(m=0-m),k[this._progressPixelSize]={start:f,end:100*c,units:"%"},this._inProgressAnim=h.animateProperty({node:d,duration:m,onAnimate:function(a){e.style[g._progressPixelSize]=100-parseFloat(a[g._progressPixelSize])+"%"},onEnd:function(){delete g._inProgressAnim},properties:k}),this._inProgressAnim.play())}else d.style[this._progressPixelSize]=100*c+"%",e.style[this._progressPixelSize]=100*(1-c)+"%"},_bumpValue:function(a,b){if(!this.disabled&&!(this.readOnly||
this.maximum<=this.minimum)){var d=p.getComputedStyle(this.sliderBarContainer),e=c.getContentBox(this.sliderBarContainer,d),d=this.discreteValues;if(1>=d||Infinity==d)d=e[this._pixelCount];d--;e=(this.value-this.minimum)*d/(this.maximum-this.minimum)+a;0>e&&(e=0);e>d&&(e=d);e=e*(this.maximum-this.minimum)/d+this.minimum;this._setValueAttr(e,b)}},_onClkBumper:function(a){!this.disabled&&(!this.readOnly&&this.clickSelect)&&this._setValueAttr(a,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===
this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(a){this._bumpValue(a.keyCode==l.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(a){this._bumpValue(a.keyCode==l.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(a){a.stopPropagation();a.preventDefault();this._bumpValue(0>a.wheelDelta?-1:1,!0)},startup:function(){this._started||(n.forEach(this.getChildren(),function(a){this[a.container]!=
this.containerNode&&this[a.container].appendChild(a.domNode)},this),this.inherited(arguments))},_typematicCallback:function(a,b,c){if(-1==a)this._setValueAttr(this.value,!0);else this[b==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](c)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display="");var a=q('label[for\x3d"'+this.id+'"]');a.length&&(a[0].id||(a[0].id=this.id+
"_label"),this.focusNode.setAttribute("aria-labelledby",a[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(g.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),g.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(m(this.domNode,r.wheel,a.hitch(this,"_mouseWheeled")));var c=d(D,{widget:this});this._movable=
new b(this.sliderHandle,{mover:c});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});f._Mover=D;return f})},"dijit/form/HorizontalRuleLabels":function(){define("dojo/_base/declare dojo/has dojo/number dojo/query dojo/_base/lang ./HorizontalRule".split(" "),function(n,d,f,h,c,p){n=n("dijit.form.HorizontalRuleLabels",p,{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH dijitRuleLabelsContainer dijitRuleLabelsContainerH"\x3e\x3c/div\x3e',
labelStyle:"",labels:[],numericMargin:0,minimum:0,maximum:1,constraints:{pattern:"#%"},_positionPrefix:'\x3cdiv class\x3d"dijitRuleLabelContainer dijitRuleLabelContainerH" style\x3d"left:',_labelPrefix:'"\x3e\x3cdiv class\x3d"dijitRuleLabel dijitRuleLabelH"\x3e',_suffix:"\x3c/div\x3e\x3c/div\x3e",_calcPosition:function(c){return c},_genHTML:function(c,a){var d=this.labels[a];return this._positionPrefix+this._calcPosition(c)+this._positionSuffix+this.labelStyle+this._genDirectionHTML(d)+this._labelPrefix+
d+this._suffix},_genDirectionHTML:function(c){return""},getLabels:function(){var c=this.labels;!c.length&&this.srcNodeRef&&(c=h("\x3e li",this.srcNodeRef).map(function(a){return String(a.innerHTML)}));if(!c.length&&1<this.count)for(var a=this.minimum,d=(this.maximum-a)/(this.count-1),b=0;b<this.count;b++)c.push(b<this.numericMargin||b>=this.count-this.numericMargin?"":f.format(a,this.constraints)),a+=d;return c},postMixInProperties:function(){this.inherited(arguments);this.labels=this.getLabels();
this.count=this.labels.length}});d("dojo-bidi")&&n.extend({_setTextDirAttr:function(d){this.textDir!=d&&(this._set("textDir",d),h(".dijitRuleLabelContainer",this.domNode).forEach(c.hitch(this,function(a){a.style.direction=this.getTextDir(a.innerText||a.textContent||"")})))},_genDirectionHTML:function(c){return this.textDir?"direction:"+this.getTextDir(c)+";":""}});return n})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(n,d,f){return n("dijit.form.HorizontalRule",
[d,f],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(d){return this._positionPrefix+d+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);var d;if(1==this.count)d=this._genHTML(50,0);else{var c,
f=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){d=this._genHTML(0,0);for(c=1;c<this.count-1;c++)d+=this._genHTML(f*c,c);d+=this._genHTML(100,this.count-1)}else{d=this._genHTML(100,0);for(c=1;c<this.count-1;c++)d+=this._genHTML(100-f*c,c);d+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=d}})})},"jimu/dijit/Search":function(){define(["dojo/_base/declare","dojo/_base/html","dojo/string","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(n,d,f,h,c){return n([h,c],{baseClass:"jimu-search",
declaredClass:"jimu.dijit.Search",templateString:'\x3cdiv\x3e\x3cspan class\x3d"jimu-input-wrapper" style\x3d"left:0;right:0;"\x3e\x3cinput class\x3d"jimu-input" style\x3d"background:#fafafc;" data-dojo-attach-point\x3d"inputSearch" data-dojo-attach-event\x3d"onKeydown: _onKeyDown, onKeyUp: _onKeyUp"/\x3e\x3c/span\x3e\x3cdiv class\x3d"search-btn jimu-icon jimu-icon-search" data-dojo-attach-point\x3d"searchBtn" data-dojo-attach-event\x3d"onClick: _onBtnClick"\x3e\x3c/div\x3e\x3c/div\x3e',placeholder:"",
onSearch:null,searchWhenInput:!1,postCreate:function(){this.inherited(arguments);this.placeholder&&d.setAttr(this.inputSearch,"placeholder",this.placeholder)},getValue:function(){return f.trim(this.inputSearch.value)},doSearch:function(){if(this.onSearch)this.onSearch(this.getValue())},_onKeyDown:function(c){13===(void 0!==c.keyCode?c.keyCode:c.which)&&this.doSearch();c.stopPropagation()},_onKeyUp:function(){this.searchWhenInput&&this.doSearch()},_onBtnClick:function(){this.doSearch()}})})},"jimu/dijit/ServiceURLInput":function(){define("dojo/_base/declare dojo/_base/html dojo/_base/lang dojo/on dojo/Deferred dojo/aspect esri/request dijit/form/ValidationTextBox".split(" "),
function(n,d,f,h,c,p,l,a){return n([a],{_validatingNode:null,_validNode:null,_inValidNode:null,_fetchHandle:null,_fetchErrHandle:null,declaredClass:"jimu.dijit.ServiceURLInput",verify:!0,_status:null,postCreate:function(){this.inherited(arguments);this._validatingNode=d.create("div",{"class":"jimu-service-validating"},this.domNode);this._validNode=d.create("div",{"class":"jimu-service-valid"},this.domNode);this._inValidNode=d.create("div",{"class":"jimu-service-invalid jimu-icon jimu-icon-error"},
this.domNode);d.addClass(this.domNode,"jimu-serviceurl-input");this.verify&&this.own(h(this,"Change",f.hitch(this,"_onServiceUrlChange")))},setProcessFunction:function(a,b){this._fetchHandle&&this._fetchErrHandle&&this._removeProcessFunction();"function"===typeof a&&(this._fetchHandle=p.after(this,"onFetch",a),this.own(this._fetchHandle));"function"===typeof b&&(this._fetchErrHandle=p.after(this,"onFetchError",b),this.own(this._fetchErrHandle))},_removeProcessFunction:function(){this._fetchHandle&&
this._fetchHandle.remove&&(this._fetchHandle.remove(),this._fetchHandle=null);this._fetchErrHandle&&this._fetchErrHandle.remove&&(this._fetchErrHandle.remove(),this._fetchErrHandle=null)},onFetch:function(a){return a},onFetchError:function(a){},getStatus:function(){return this._status},_onServiceUrlChange:function(a){var b=new c;b.then(f.hitch(this,function(){this._valid()}),f.hitch(this,function(){this._inValid();this.onFetchError()}));this._validating();a?l({url:f.trim(a||""),handleAs:"json",content:{f:"json"},
callbackParamName:"callback"}).then(f.hitch(this,function(a){this.onFetch({url:this.getValue(),data:a})?b.resolve("success"):b.reject("error")}),f.hitch(this,function(a){b.reject(a)})):b.reject("error")},_validating:function(){this._status="validating";d.removeClass(this.domNode,"jimu-serviceurl-input-invalid");d.removeClass(this.domNode,"jimu-serviceurl-input-valid");d.addClass(this.domNode,"jimu-serviceurl-input-validating")},_valid:function(){this._status="valid";d.removeClass(this.domNode,"jimu-serviceurl-input-invalid");
d.removeClass(this.domNode,"jimu-serviceurl-input-validating");d.addClass(this.domNode,"jimu-serviceurl-input-valid")},_inValid:function(){this._status="invalid";d.removeClass(this.domNode,"jimu-serviceurl-input-validating");d.removeClass(this.domNode,"jimu-serviceurl-input-valid");d.addClass(this.domNode,"jimu-serviceurl-input-invalid")}})})},"jimu/dijit/SimpleTable":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dojo/Evented dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dijit/registry jimu/utils jimu/dijit/CheckBox".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){return n([d,f,h],{baseClass:"jimu-simple-table",declaredClass:"jimu.dijit.SimpleTable",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"head-section" data-dojo-attach-point\x3d"headDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"headTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;" data-dojo-attach-point\x3d"tableInHeadSection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"headColgroup"\x3e\x3c/colgroup\x3e\x3cthead class\x3d"simple-table-thead simple-table-title"  data-dojo-attach-point\x3d"thead"\x3e\x3c/thead\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"body-section" data-dojo-attach-point\x3d"bodyDiv"\x3e\x3cdiv class\x3d"table-div" data-dojo-attach-point\x3d"bodyTableDiv"\x3e\x3ctable class\x3d"table" cellspacing\x3d"0" onselectstart\x3d"return false;"data-dojo-attach-point\x3d"tableInBodySection"\x3e\x3ccolgroup data-dojo-attach-point\x3d"bodyColgroup"\x3e\x3c/colgroup\x3e\x3ctbody class\x3d"simple-table-tbody" data-dojo-attach-point\x3d"tbody"\x3e\x3c/tbody\x3e\x3c/table\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e',
_name:null,_rowIndex:0,_rowHeight:30,_headHeight:36,REPEATING_ERROR:"REPEATING_ERROR",_classSimpleTableRow:"simple-table-row",_classFirstSimpleTableRow:"first-simple-table-row",_classLastSimpleTableRow:"last-simple-table-row",_classJimuStateDisabled:"jimu-state-disabled",_classRowUpDiv:"row-up-div",_classRowDownDiv:"row-down-div",_classVerticalScroll:"vertical-scroll",autoHeight:!0,selectable:!1,fields:null,postMixInProperties:function(){this.nls=window.jimuNls.simpleTable},postCreate:function(){this.inherited(arguments);
this._initSelf()},startup:function(){this.inherited(arguments);this.updateUI()},_initSelf:function(){this.own(s.bindClickAndDblclickEvents(this.tableInBodySection,c.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return p.hasClass(a,"simple-table-row")&&p.hasClass(a,"not-empty")},this.tbody))this.selectRow(a),this._onClickRow(a)}),c.hitch(this,function(a){if(a=s.getAncestorDom(a.target||a.srcElement,function(a){return p.hasClass(a,"simple-table-row")&&p.hasClass(a,
"not-empty")},this.tbody))this.selectRow(a),this._onDblClickRow(a)})));var b=Math.random().toString();this._name="jimu_table_"+b.slice(2,b.length);if(this.fields&&0<this.fields.length){var d=p.create("tr",{},this.thead);l.forEach(this.fields,c.hitch(this,function(b){var e="auto";"actions"===b.type&&(b.name="actions");b.hidden?e=1:void 0!==b.width&&null!==b.width?e=b.width:"actions"===b.type&&!b.name&&(b.width=this._calculateActionsWidth(b)+20,e=b.width);p.create("col",{width:e},this.headColgroup);
p.create("col",{width:e},this.bodyColgroup);e=p.create("th",{innerHTML:b.title,title:b.title},d);if("checkbox"===b.type){e.innerHTML="";var g=new q({label:b.title}),f=k(".checkbox",g.domNode)[0];f&&(f.style.marginTop="10px");this.own(a(g.domNode,"click",c.hitch(this,function(){g.getValue()?this._checkAllTdCheckBoxes(b.name):this._uncheckAllTdCheckBoxes(b.name)})));g.placeAt(e)}p.addClass(e,"simple-table-field");b.hidden&&p.addClass(e,"hidden-column");b["class"]&&p.addClass(e,b["class"]);p.addClass(e,
b.name)}))}else this.fields=null},_getThCheckBox:function(a){var c=null;a=k(".simple-table-field."+a+" .jimu-checkbox",this.thead)[0];return c=b.byNode(a)},_getAllEnabledTdCheckBoxes:function(a){a=k(".simple-table-cell."+a+" .jimu-checkbox",this.tbody);a=l.map(a,function(a){return b.byNode(a)});return a=l.filter(a,function(a){return a.getStatus()})},_checkAllTdCheckBoxes:function(a){a=this._getAllEnabledTdCheckBoxes(a);l.forEach(a,function(a){a.getValue()||a.setValue(!0)})},_uncheckAllTdCheckBoxes:function(a){a=
this._getAllEnabledTdCheckBoxes(a);l.forEach(a,function(a){a.getValue()&&a.setValue(!1)})},_delaySyncThCheckBoxStatusWithAllTdCheckBoxes:function(a){setTimeout(c.hitch(this,function(){this._syncThCheckBoxStatusWithAllTdCheckBoxes(a)}),100)},_syncThCheckBoxStatusWithAllTdCheckBoxes:function(a){var b=this._getAllEnabledTdCheckBoxes(a),b=l.filter(b,c.hitch(this,function(a){return a.getStatus()}));0!==b.length&&(a=this._getThCheckBox(a),l.every(b,function(a){return a.getValue()})?a.getValue()||a.setValue(!0):
a.getValue()&&a.setValue(!1))},clear:function(){var a=this._getNotEmptyRows();p.empty(this.tbody);l.forEach(a,c.hitch(this,function(a){this._onDeleteRow(a)}));this.updateUI();this._rowIndex=0;this._onClearRows(a)},addRows:function(a){var b=[];this.fields&&(a&&0<a.length)&&l.forEach(a,c.hitch(this,function(a){b.push(this.addRow(a,-1,!0))}));this.updateUI();return b},addRow:function(a,b,d){this._rowIndex++;var e={success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||
"object"!==typeof a)return e;var g=l.filter(this.fields,c.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),g=l.filter(g,c.hitch(this,function(b){return 0<this.getRowDataArrayByFieldValue(b.name,a[b.name]).length}));if(0<g.length)return e.errorCode=this.REPEATING_ERROR,e.errorMessage="repeating data",e.repeatFields=g,e;var f=p.create("tr",{"class":"simple-table-row not-empty"},this.tbody);p.setAttr(f,"rowId","row"+this._rowIndex);l.forEach(this.fields,c.hitch(this,function(b){var c=a[b.name],
d=b.type,e=null;"actions"===d?this._createActionsTd(f,b):("text"===d?e=this._createTextTd(f,b,c):"radio"===d?e=this._createRadioTd(f,b,c):"checkbox"===d?e=this._createCheckboxTd(f,b,c):"empty"===d?e=this._createEmptyTd(f,b):"extension"===d&&(e=this._createExtensionTd(f,b,c)),b.hidden&&p.addClass(e,"hidden-column"))}));d||(this.updateUI(),d=this.getRows(),"number"===typeof b&&(0<=b&&b<d.length)&&p.place(f,d[b],"before"));e.success=!0;e.tr=f;e.errorMessage=null;this._onAddRow(f);return e},deleteRow:function(a){a&&
(p.destroy(a),this.updateUI(),this._onDeleteRow(a))},selectRow:function(a){this.selectable&&(k(".simple-table-row",this.tbody).removeClass("jimu-state-active"),p.addClass(a,"jimu-state-active"),this._onSelectRow(a))},updateUI:function(){this._updateRowClassName();this._updateHeight();p.removeClass(this.domNode,this._classVerticalScroll);0<this.bodyDiv.clientHeight&&this.bodyDiv.clientHeight<this.bodyDiv.scrollHeight&&p.addClass(this.domNode,this._classVerticalScroll)},_updateHeadTableWidth:function(){if(this.domNode){var a=
p.getContentBox(this.tableInBodySection).w,b="100%";"number"===typeof a&&0<a&&(b=a+"px");p.setStyle(this.tableInHeadSection,"width",b)}},_updateHeight:function(){if(this.autoHeight){var a=this.getRows();p.setStyle(this.domNode,"height",this._headHeight+this._rowHeight*(0<a.length?a.length:1)+1+"px")}},_updateRowClassName:function(){var a=k("."+this._classFirstSimpleTableRow,this.tbody)[0];a&&(a=k("."+this._classRowUpDiv,a)[0])&&p.removeClass(a,this._classJimuStateDisabled);if(a=k("."+this._classLastSimpleTableRow,
this.tbody)[0])(a=k("."+this._classRowDownDiv,a)[0])&&p.removeClass(a,this._classJimuStateDisabled);a=k("."+this._classSimpleTableRow,this.tbody);a.removeClass("odd");a.removeClass("even");a.removeClass(this._classFirstSimpleTableRow);a.removeClass(this._classLastSimpleTableRow);l.forEach(a,c.hitch(this,function(a,b){0===b%2?p.addClass(a,"odd"):p.addClass(a,"even")}));if(0<a.length){var b=a[0];p.addClass(b,this._classFirstSimpleTableRow);(b=k("."+this._classRowUpDiv,b)[0])&&p.addClass(b,this._classJimuStateDisabled);
a=a[a.length-1];p.addClass(a,this._classLastSimpleTableRow);(a=k("."+this._classRowDownDiv,a)[0])&&p.addClass(a,this._classJimuStateDisabled)}},_createTextTd:function(a,b,c){var d=null;return d=b.editable?this._createEditableTextTd(a,b,c):this._createNormalTextTd(a,b,c)},_createNormalTextTd:function(a,b,c){var d=p.toDom('\x3ctd class\x3d"simple-table-cell normal-text-td"\x3e\x3cdiv class\x3d"normal-text-div"\x3e\x3c/div\x3e\x3c/td\x3e');p.addClass(d,b.name);var g=k("div",d)[0];g.innerHTML=c||"";g.title=
c||"";b["class"]&&p.addClass(d,b["class"]);p.place(d,a);return d},_createEditableTextTd:function(b,d,f){var e=p.toDom('\x3ctd class\x3d"editable-text-td '+d.name+'"\x3e\x3cdiv class\x3d"editable-div"\x3e\x3c/div\x3e\x3cinput class\x3d"editable-input" type\x3d"text" style\x3d"display:none;" /\x3e\x3c/td\x3e');p.addClass(e,"simple-table-cell");p.place(e,b);d["class"]&&p.addClass(e,d["class"]);var g=k("div",e)[0],q=k("input",e)[0];g.innerHTML=f||"";""!==g.innerHTML&&(g.title=g.innerHTML);q.value=g.innerHTML;
this.own(a(g,"dblclick",c.hitch(this,function(a){a.stopPropagation();q.value=g.innerHTML;p.setStyle(g,"display","none");p.setStyle(q,"display","inline");q.focus()})));this.own(a(q,"blur",c.hitch(this,function(){q.value=c.trim(q.value);var a=g.innerHTML,e=q.value;""!==e?d.unique?0<this.getRowDataArrayByFieldValue(d.name,e,b).length?q.value=a:g.innerHTML=e:g.innerHTML=e:q.value=a;p.setStyle(q,"display","none");p.setStyle(g,"display","block")})));return e},_createRadioTd:function(a,b,c){var d=p.toDom('\x3ctd class\x3d"radio-td '+
b.name+'"\x3e\x3cinput type\x3d"radio" /\x3e\x3c/td\x3e');p.addClass(d,"simple-table-cell");p.place(d,a);b["class"]&&p.addClass(d,b["class"]);a=k("input",d)[0];a.name=b.radio&&"row"===b.radio?this._name+this._rowIndex:this._name+b.name;a.checked=!0===c;return d},_createCheckboxTd:function(b,d,f){var e=p.toDom('\x3ctd class\x3d"checkbox-td '+d.name+'"\x3e\x3c/td\x3e');p.addClass(e,"simple-table-cell");p.place(e,b);d["class"]&&p.addClass(e,d["class"]);var g=new q({onChange:c.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name);
"function"===typeof d.onChange&&setTimeout(c.hitch(this,function(){d.onChange(b,g)}),200)})});this.own(a(g,"status-change",c.hitch(this,function(){this._delaySyncThCheckBoxStatusWithAllTdCheckBoxes(d.name)})));this._setValueForCheckBox(g,f);g.placeAt(e);return e},_createActionsTd:function(b,d){var f=p.toDom('\x3ctd class\x3d"actions-td"\x3e\x3cdiv class\x3d"action-item-parent jimu-float-leading"\x3e\x3c/div\x3e\x3c/td\x3e');p.addClass(f,"simple-table-cell");var e=k(".action-item-parent",f)[0];p.place(f,
b);d["class"]&&p.addClass(f,d["class"]);l.forEach(d.actions,c.hitch(this,function(d){"up"===d?(d=p.create("div",{"class":"action-item jimu-float-leading row-up-div jimu-icon jimu-icon-up"},e),d.title=this.nls.moveUp,this.own(a(d,"click",c.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowUp(b)){a=k(".simple-table-row",this.tbody);var c=l.indexOf(a,b);if(0<c&&(a=a[c-1]))p.place(b,a,"before"),this.updateUI(),this.emit("row-up",b)}})))):"down"===d?(d=p.create("div",{"class":"action-item jimu-float-leading row-down-div jimu-icon jimu-icon-down"},
e),d.title=this.nls.moveDown,this.own(a(d,"click",c.hitch(this,function(a){a.stopPropagation();if(this.onBeforeRowDown(b)){a=k(".simple-table-row",this.tbody);var c=l.indexOf(a,b);if(c<a.length-1&&(a=a[c+1]))p.place(b,a,"after"),this.updateUI(),this.emit("row-down",b)}})))):"edit"===d?(d=p.create("div",{"class":"action-item jimu-float-leading row-edit-div jimu-icon jimu-icon-edit"},e),d.title=this.nls.edit,this.own(a(d,"click",c.hitch(this,function(a){a.stopPropagation();this.onBeforeRowEdit(b)&&
this._onActionsEdit(b)})))):"delete"===d&&(d=p.create("div",{"class":"action-item jimu-float-leading row-delete-div jimu-icon jimu-icon-delete"},e),d.title=this.nls.deleteRow,this.own(a(d,"click",c.hitch(this,function(a){a.stopPropagation();this.onBeforeRowDelete(b)&&this.deleteRow(b)}))))}));var g=this._calculateActionsWidth(d)+"px";p.setStyle(e,"width",g);return f},_calculateActionsWidth:function(a){return 20*l.map(a.actions,function(a){return"up"===a||"down"===a||"edit"===a||"delete"===a}).length},
_createEmptyTd:function(a,b){var c=p.create("td",{"class":b.name},a);p.addClass(c,"simple-table-cell");p.addClass(c,"empty-text-td");b["class"]&&p.addClass(c,b["class"]);return c},_createExtensionTd:function(a,b,c){a=p.create("td",{"class":b.name},a);p.addClass(a,"simple-table-cell");p.addClass(a,"extension-td");b["class"]&&p.addClass(a,b["class"]);b.create&&"function"===typeof b.create&&b.create(a);b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c);return a},editRow:function(a,b){var d=
{success:!1,tr:null,errorCode:null,errorMessage:null,repeatFields:null};if(!this.fields||"object"!==typeof b||!p.isDescendant(a,this.tbody))return d;var e=c.mixin([],this.fields),e=l.filter(e,c.hitch(this,function(a){return"text"===a.type&&!0===a.unique})),e=l.filter(e,c.hitch(this,function(c){return 0<this.getRowDataArrayByFieldValue(c.name,b[c.name],a).length}));if(0<e.length)return d.errorCode=this.REPEATING_ERROR,d.errorMessage="repeating data",d.repeatFields=e,d;var g=k(".simple-table-cell",
a);l.forEach(this.fields,c.hitch(this,function(a,c){if(b.hasOwnProperty(a.name)){var d=g[c],e=b[a.name],f=a.type;"text"===f?a.editable?this._editEditableText(d,a,e):this._editNormalText(d,a,e):"radio"===f?this._editRadio(d,a,e):"checkbox"===f?this._editCheckbox(d,a,e):"extension"===f&&this._editExtension(d,a,e)}}));d.success=!0;d.tr=a;d.errorMessage=null;this._onEditRow(a);return d},_editNormalText:function(a,b,c){a=k("div",a)[0];a.innerHTML=c||"";a.title=a.innerHTML},_editEditableText:function(a,
b,c){b=k("div",a)[0];b.innerHTML=c||"";k("input",a)[0].value=b.innerHTML},_editRadio:function(a,b,c){k("input",a)[0].checked=!0===c},_editCheckbox:function(a,c,d){a=k(".jimu-checkbox",a)[0];a=b.byNode(a);this._setValueForCheckBox(a,d)},_setValueForCheckBox:function(a,b){null===b?a.setStatus(!1):(a.setStatus(!0),b!==a.getValue()&&a.setValue(b))},_editExtension:function(a,b,c){b.setValue&&"function"===typeof b.setValue&&b.setValue(a,c)},_getAllRows:function(){return k(".simple-table-row",this.tbody)},
_getNotEmptyRows:function(){var a=this._getAllRows();return l.filter(a,c.hitch(this,function(a){return!p.hasClass(a,"empty")}))},_getEmptyRows:function(){var a=this._getAllRows();return l.filter(a,c.hitch(this,function(a){return p.hasClass(a,"empty")}))},getRows:function(){return this._getNotEmptyRows()},getSelectedRow:function(){var a=null,b=k(".simple-table-row",this.tbody),b=l.filter(b,c.hitch(this,function(a){return!p.hasClass(a,"empty")&&p.hasClass(a,"jimu-state-active")}));0<b.length&&(a=b[0]);
return a},getSelectedRowData:function(){var a=null,b=this.getSelectedRow();b&&(a=this._getRowDataByTr(b));return a},getData:function(a){var b=this._getNotEmptyRows();a&&(b=l.filter(b,c.hitch(this,function(b){return b!==a})));return l.map(b,c.hitch(this,function(a){return this._getRowDataByTr(a)}))},getRowData:function(a){return this._getRowDataByTr(a)},_getRowDataByTr:function(a){var d=null;if(a)d={};else return null;l.forEach(this.fields,c.hitch(this,function(c){var e=c.type;if("actions"!==e){var g=
c.name;d[g]=null;var f=k("."+g,a)[0];f&&("text"===e?(c=k("div",f)[0],d[g]=c.innerHTML):"radio"===e?(c=k("input",f)[0],d[g]=c.checked):"checkbox"===e?(c=k(".jimu-checkbox",f)[0],c=b.byNode(c),c.getStatus()?d[g]=c.getValue():d[g]=null):"extension"===e&&c.getValue&&"function"===typeof c.getValue&&(d[g]=c.getValue(f,c)))}}));return d},getRowDataArrayByFieldValue:function(a,b,d){var e=[];if(!this.fields||!l.some(this.fields,c.hitch(this,function(b){return b.name===a})))return[];d=this.getData(d);return e=
l.filter(d,c.hitch(this,function(c){return c[a]==b}))},_onClickRow:function(a){this.emit("row-click",a)},_onDblClickRow:function(a){this.emit("row-dblclick",a)},_onSelectRow:function(a){this.emit("row-select",a)},_onAddRow:function(a){this.emit("row-add",a)},_onEditRow:function(a){this.emit("row-edit",a)},_onDeleteRow:function(a){this.emit("row-delete",a)},_onEnterRow:function(a){this.emit("row-enter",a)},_onClearRows:function(a){this.emit("rows-clear",a)},_onActionsEdit:function(a){this.emit("actions-edit",
a)},onBeforeRowUp:function(a){return!0},onBeforeRowDown:function(a){return!0},onBeforeRowEdit:function(a){return!0},onBeforeRowDelete:function(a){return!0}})})},"jimu/dijit/TabContainer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dijit/_WidgetBase dijit/_TemplatedMixin ./ViewStack ../utils".split(" "),function(n,d,f,h,c,p,l,a,k,b){return n([l,a,p],{baseClass:"jimu-tab",declaredClass:"jimu.dijit.TabContainer",templateString:'\x3cdiv\x3e\x3cdiv class\x3d"control" data-dojo-attach-point\x3d"controlNode"\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-container" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this.inherited(arguments);if(0!==this.tabs.length){this.controlNodes=[];this.viewStack=new k(null,this.containerNode);var a=100*(1/this.tabs.length);this.isNested&&h.addClass(this.domNode,"nested");f.forEach(this.tabs,function(b){this._createTab(b,a)},this)}},startup:function(){this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title);b.setVerticalCenter(this.domNode)},_createTab:function(a,b){var f;f=h.create("div",{innerHTML:a.title,
"class":"tab jimu-vcenter-text",style:{width:this.isNested?"auto":b+"%"},label:a.title},this.controlNode);this.viewStack.viewType=a.content.domNode?"dijit":"dom";a.content.label=a.title;this.viewStack.addView(a.content);this.own(c(f,"click",d.hitch(this,this.onSelect,a.title)));f.label=a.title;this.controlNodes.push(f)},onSelect:function(a){this.selectTab(a)},selectTab:function(a){this._selectControl(a);this.viewStack.switchView(a);this.emit("tabChanged",a)},_selectControl:function(a){f.forEach(this.controlNodes,
function(b){h.removeClass(b,"jimu-state-selected");b.label===a&&h.addClass(b,"jimu-state-selected")})}})})},"jimu/dijit/ViewStack":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dojo/_base/array","dijit/_WidgetBase"],function(n,d,f,h,c){return n(c,{baseClass:"jimu-viewstack",declaredClass:"jimu.dijit.ViewStack",_currentView:null,postCreate:function(){this.inherited(arguments);this.views||(this.views=[]);h.forEach(this.views,d.hitch(this,function(c){1===c.nodeType?(f.place(c,
this.domNode),f.addClass(c,"view"),f.setStyle(c,"display","none")):c.domNode&&(f.place(c.domNode,this.domNode),f.addClass(c.domNode,"view"),f.setStyle(c.domNode,"display","none"))}))},startup:function(){this.inherited(arguments);0<this.views.length&&this.switchView(0)},getSelectedView:function(){return this._currentView},getSelectedLabel:function(){var c="",d=this.getSelectedView();d&&(c=d.label);return c},getViewByLabel:function(c){for(var d=0;d<this.views.length;d++)if(c===this.views[d].label)return this.views[d];
return null},addView:function(c){this.views.push(c);1===c.nodeType?(f.place(c,this.domNode),f.addClass(c,"view")):c.domNode&&(f.place(c.domNode,this.domNode),f.addClass(c.domNode,"view"))},removeView:function(c){var d=this.views.length;this.views=h.filter(this.views,function(a){return c!==a});d!==this.views.length&&(1===c.nodeType?f.destroy(c):c.domNode&&c.destroyRecursive())},switchView:function(c){var l,a;l="number"===typeof c?this.views[c]:"string"===typeof c?this.getViewByLabel(c):c;this.views.forEach(d.hitch(this,
function(c){c&&(1===c.nodeType?a=c:c.domNode&&(a=c.domNode),c===l?(f.setStyle(a,"display","block"),c.domNode&&!c._started&&(c.startup(),c._started=!0)):f.setStyle(a,"display","none"))}));this._currentView=l;this.onViewSwitch(l)},onViewSwitch:function(){}})})},"jimu/dijit/TabContainer3":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/on dojo/Evented dojo/query dijit/_WidgetBase dijit/_TemplatedMixin dojo/text!./templates/TabContainer3.html jimu/dijit/ViewStack".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s){return n([a,k,p],{templateString:b,selected:"",tabs:null,average:!1,baseClass:"jimu-tab3",declaredClass:"jimu.dijit.TabContainer3",_currentIndex:-1,postCreate:function(){this.inherited(arguments);this._initSelf();this.selected?this.selectTab(this.selected):0<this.tabs.length&&this.selectTab(this.tabs[0].title)},selectTab:function(a){var b=l("td",this.tabTr);f.forEach(b,d.hitch(this,function(b,c){h.removeClass(b,"jimu-state-active");b.label===a&&(h.addClass(b,"jimu-state-active"),
this._currentIndex=c)}));this.controlNode.removeChild(this.controlTable);h.place(this.controlTable,this.controlNode);this.viewStack.switchView(a);this.emit("tabChanged",a)},addTab:function(a){if(!this.average){var b=l("td:last-child",this.tabTr);0<b.length&&h.destroy(b[0])}0<f.filter(this.tabs,function(b){return b.title===a.title}).length?console.error("tab title conflict: "+a.title):(this.tabs.push(a),this._createTab(a),this.average||(b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e'),
h.place(b,this.tabTr)))},removeTab:function(a){var b=-1;if(f.some(this.tabs,function(c,d){if(c.title===a)return b=d,!0})){var c=this.tabs.splice(b,1)[0],d=l("td",this.tabTr),e;f.some(d,function(b){if(b.label===a)return e=b,!0})&&h.destroy(e);this.viewStack.removeView(c.content)}},showShelter:function(){h.setStyle(this.shelter,"display","block")},hideShelter:function(){h.setStyle(this.shelter,"display","none")},getSelectedIndex:function(){return this._currentIndex},getSelectedTitle:function(){return this.viewStack.getSelectedLabel()},
_initSelf:function(){this.viewStack=new s(null,this.containerNode);f.forEach(this.tabs,function(a){this._createTab(a)},this);if(this.average)this.controlTable.style.tableLayout="fixed";else{var a=h.toDom('\x3ctd nowrap class\x3d"tab-item-td" style\x3d"border-bottom:1px solid #ccc;"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');h.place(a,this.tabTr)}},startup:function(){this.inherited(arguments);this._started=!0},_createTab:function(a){var b=h.toDom('\x3ctd nowrap class\x3d"tab-item-td"\x3e\x3cdiv class\x3d"tab-item-div"\x3e\x3c/div\x3e\x3c/td\x3e');
b.label=a.title||"";h.place(b,this.tabTr);var f=l(".tab-item-div",b)[0];f.innerHTML=b.label;f.label=b.label;a.content.label=b.label;this.viewStack.addView(a.content);this.own(c(b,"click",d.hitch(this,this._onSelect,a.title)))},_onSelect:function(a){this.selectTab(a)}})})},"jimu/dijit/TileLayoutContainer":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(n,d,f,h){return n([h],{baseClass:"jimu-tile-container",declaredClass:"jimu.dijit.TileLayoutContainer",
constructor:function(){this.items=[];this.vmargin=this.hmargin=15},startup:function(){this.inherited(arguments);this.items.forEach(d.hitch(this,function(c){this._placeItem(c)}));this.resize()},_placeItem:function(c){c.domNode?f.place(c.domNode,this.domNode):f.place(c,this.domNode)},addItem:function(c){this.items.push(c);this._placeItem(c);this.resize()},addItems:function(c){this.items=this.items.concat(c);this.items.forEach(d.hitch(this,function(c){this._placeItem(c)}));this.resize()},removeItem:function(c){var d;
for(d=0;d<this.items.length;d++)if(this.items[d].label===c){this.items[d].domNode?this.items[d].destroy():f.destroy(this.items[d]);this.items.splice(d,1);this.resize();break}},empty:function(){var c;for(c=0;c<this.items.length;c++)this.items[c].domNode?this.items[c].destroy():f.destroy(this.items[c]);this.items=[]},resize:function(){var c,h,l;c=f.getMarginBox(this.domNode);h=this.getItemSize(c);l=Math.floor((c.w+this.hmargin)/(h.width+this.hmargin));this.items.forEach(d.hitch(this,function(a,c){this.setItemPosition(a,
c,h,l)}))},getItemSize:function(c){var d={},f;if("fixWidth"===this.strategy)d.width=this.itemSize.width,d.height=this.itemSize.height;else if("breakWidth"===this.strategy)for(f=0;f<this.itemSize.length;f++){if(c.w<=this.itemSize[f].screenWidth){d.width=this.itemSize[f].width;d.height=this.itemSize[f].height;break}}else"fixCols"===this.strategy&&(d.width=(c.w-this.hmargin*(this.maxCols-1))/this.maxCols,d.height="number"===typeof this.itemSize.height?this.itemSize.height:d.width*parseFloat(this.itemSize.height.substring(0,
this.itemSize.height.length-1))/100);return d},setItemPosition:function(c,d,l,a){d++;var k=d%a;d=Math.ceil(d/a);0===k&&(k=a);a={position:"absolute",top:(this.vmargin+l.height)*(d-1)+"px"};a[window.isRTL?"right":"left"]=(this.hmargin+l.width)*(k-1)+"px";0<=l.width&&(a.width=l.width+"px");0<=l.height&&(a.height=l.height+"px");f.setStyle(c.domNode?c.domNode:c,a)}})})},"jimu/dijit/DrawBox":function(){define("dojo/_base/declare dijit/_WidgetBase dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dojo/text!./templates/DrawBox.html dojo/_base/lang dojo/_base/html dojo/_base/array dojo/on dojo/query dojo/Evented esri/graphic esri/layers/GraphicsLayer esri/toolbars/draw esri/symbols/jsonUtils esri/geometry/Polygon".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e){return n([d,f,h,s],{templateString:c,baseClass:"jimu-draw-box",declaredClass:"jimu.dijit.DrawBox",nls:null,drawLayer:null,drawLayerId:null,drawToolBar:null,types:null,geoTypes:null,map:null,pointSymbol:null,polylineSymbol:null,polygonSymbol:null,textSymbol:null,showClear:!1,keepOneGraphic:!1,deactivateAfterDrawing:!0,postMixInProperties:function(){this.nls=window.jimuNls.drawBox},postCreate:function(){this.inherited(arguments);var a={};this.drawLayerId&&(a.id=
this.drawLayerId);this.drawLayer=new r(a);this._initDefaultSymbols();this._initTypes();a=b(".draw-item",this.domNode);this.own(a.on("click",p.hitch(this,this._onItemClick)));this.own(k(this.btnClear,"click",p.hitch(this,this.clear)));this.map&&this.setMap(this.map);l.setStyle(this.btnClear,"display",!0===this.showClear?"block":"none")},disableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!1)},enableWebMapPopup:function(){this.map&&this.map.setInfoWindowOnClick(!0)},destroy:function(){this.drawToolBar&&
this.drawToolBar.deactivate();this.drawLayer&&this.map&&this.map.removeLayer(this.drawLayer);this.drawLayer=this.map=this.drawToolBar=null;this.inherited(arguments)},setMap:function(a){a&&(this.map=a,this.map.addLayer(this.drawLayer),this.drawToolBar=new m(this.map),this.drawToolBar.setMarkerSymbol(this.pointSymbol),this.drawToolBar.setLineSymbol(this.polylineSymbol),this.drawToolBar.setFillSymbol(this.polygonSymbol),this.own(k(this.drawToolBar,"draw-end",p.hitch(this,this._onDrawEnd))))},setPointSymbol:function(a){this.pointSymbol=
a;this.drawToolBar.setMarkerSymbol(this.pointSymbol)},setLineSymbol:function(a){this.polylineSymbol=a;this.drawToolBar.setLineSymbol(a)},setPolygonSymbol:function(a){this.polygonSymbol=a;this.drawToolBar.setFillSymbol(a)},setTextSymbol:function(a){this.textSymbol=a},reset:function(){this.deactivate();this.clear()},clear:function(){this.drawLayer.clear();this.onClear()},deactivate:function(){this.enableWebMapPopup();this.drawToolBar&&this.drawToolBar.deactivate();b(".draw-item",this.domNode).removeClass("jimu-state-active")},
activate:function(a){var c=null,d=b(".draw-item",this.domNode);"TEXT"===a?(a="POINT",c=this.textIcon):(d=d.filter(function(b){return b.getAttribute("data-geotype")===a}),0<d.length&&(c=d[0]));c&&this._activate(c)},onIconSelected:function(a,b,c){this.emit("icon-selected",a,b,c)},onDrawEnd:function(a,b,c){this.emit("draw-end",a,b,c)},onClear:function(){this.emit("clear")},addGraphic:function(a){this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(a)},removeGraphic:function(a){this.drawLayer.remove(a)},
_initDefaultSymbols:function(){var a={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},b={style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},c={style:"esriSFSSolid",color:[79,129,189,128],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}};this.pointSymbol||(this.pointSymbol=t.fromJson(a));this.polylineSymbol||(this.polylineSymbol=t.fromJson(b));this.polygonSymbol||
(this.polygonSymbol=t.fromJson(c))},_initTypes:function(){this.geoTypes&&0<this.geoTypes.length?this.types=null:(this.geoTypes=[],this.types&&0<this.types.length||(this.types=["point","polyline","polygon"]),0<=this.types.indexOf("point")&&(this.geoTypes=this.geoTypes.concat(["POINT"])),0<=this.types.indexOf("polyline")&&(this.geoTypes=this.geoTypes.concat(["LINE","POLYLINE","FREEHAND_POLYLINE"])),0<=this.types.indexOf("polygon")&&(this.geoTypes=this.geoTypes.concat("TRIANGLE EXTENT CIRCLE ELLIPSE POLYGON FREEHAND_POLYGON".split(" "))),
0<=this.types.indexOf("text")&&(this.geoTypes=this.geoTypes.concat(["TEXT"])));var c=b(".draw-item",this.domNode);c.style("display","none");a.forEach(c,p.hitch(this,function(b){var c=b.getAttribute("data-geotype"),c=0<=a.indexOf(this.geoTypes,c);l.setStyle(b,"display",c?"block":"none")}))},_onItemClick:function(a){a=a.target||a.srcElement;l.hasClass(a,"jimu-state-active")?this.deactivate():this._activate(a)},_activate:function(a){b(".draw-item",this.domNode).removeClass("jimu-state-active");l.addClass(a,
"jimu-state-active");var c=a.getAttribute("data-geotype"),d=a.getAttribute("data-commontype"),e=m[c];"TEXT"===c&&(e=m.POINT);this.disableWebMapPopup();this.drawToolBar.activate(e);this.onIconSelected(a,c,d)},_onDrawEnd:function(a){var c=b(".draw-item.jimu-state-active",this.domNode)[0],d=c.getAttribute("data-geotype"),c=c.getAttribute("data-commontype"),f=null,f="extent"===a.geometry.type?e.fromExtent(a.geometry):a.geometry;a=f.type;var k=null,k="point"===a||"multipoint"===a?l.hasClass(this.textIcon,
"jimu-state-active")?this.textSymbol:this.pointSymbol:"line"===a||"polyline"===a?this.polylineSymbol:this.polygonSymbol,f=new q(f,k,null,null);this.keepOneGraphic&&this.drawLayer.clear();this.drawLayer.add(f);this.deactivateAfterDrawing&&this.deactivate();this.onDrawEnd(f,d,c)}})})},"esri/toolbars/draw":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Color dojo/_base/window dojo/has dojo/sniff dojo/keys dojo/dom-construct dojo/dom-style dojo/dom-geometry ../kernel ../sniff ./_toolbar ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../graphic ../geometry/jsonUtils ../geometry/webMercatorUtils ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/Rect dojo/i18n!../nls/jsapi".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D,v,u,F,C){var B=n(t,{declaredClass:"esri.toolbars.Draw",_eventMap:{"draw-complete":!0,"draw-end":["geometry"]},constructor:function(b,f){this.markerSymbol=new e(e.STYLE_SOLID,10,new g(g.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,0.25]));this.lineSymbol=new g(g.STYLE_SOLID,new c([255,0,0]),2);this.fillSymbol=new y(y.STYLE_SOLID,new g(g.STYLE_SOLID,new c([255,0,0]),2),new c([0,0,0,0.25]));this._points=[];this._mouse=!l("esri-touch")&&!l("esri-pointer");
this._defaultOptions={showTooltips:!0,drawTime:75,tolerance:8,tooltipOffset:15};this._options=d.mixin(d.mixin({},this._defaultOptions),f||{});if(a("ios")||a("android"))this._options.showTooltips=!1;this._onKeyDownHandler=d.hitch(this,this._onKeyDownHandler);this._onMouseDownHandler=d.hitch(this,this._onMouseDownHandler);this._onMouseUpHandler=d.hitch(this,this._onMouseUpHandler);this._onClickHandler=d.hitch(this,this._onClickHandler);this._onMouseMoveHandler=d.hitch(this,this._onMouseMoveHandler);
this._onMouseDragHandler=d.hitch(this,this._onMouseDragHandler);this._onDblClickHandler=d.hitch(this,this._onDblClickHandler);this._updateTooltip=d.hitch(this,this._updateTooltip);this._hideTooltip=d.hitch(this,this._hideTooltip);this._redrawGraphic=d.hitch(this,this._redrawGraphic)},_geometryType:null,respectDrawingVertexOrder:!1,setRespectDrawingVertexOrder:function(a){this.respectDrawingVertexOrder=a},setMarkerSymbol:function(a){this.markerSymbol=a},setLineSymbol:function(a){this.lineSymbol=a},
setFillSymbol:function(a){this.fillSymbol=a},activate:function(a,b){this._geometryType&&this.deactivate();var c=this.map,e=h.connect,g=B;this._options=d.mixin(d.mixin({},this._options),b||{});c.navigationManager.setImmediateClick(!1);switch(a){case g.ARROW:case g.LEFT_ARROW:case g.RIGHT_ARROW:case g.UP_ARROW:case g.DOWN_ARROW:case g.TRIANGLE:case g.CIRCLE:case g.ELLIPSE:case g.RECTANGLE:this._deactivateMapTools(!0,!1,!1,!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._mouse?
(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler2_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&
(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case g.POINT:this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);break;case g.LINE:case g.EXTENT:case g.FREEHAND_POLYLINE:case g.FREEHAND_POLYGON:this._deactivateMapTools(!0,!1,!1,!0);this._mouse?(this._onMouseDownHandler_connect=e(c,"onMouseDown",this._onMouseDownHandler),
this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseUp",this._onMouseUpHandler)):(this._onMouseDownHandler_connect=e(c,"onMouseDragStart",this._onMouseDownHandler),this._onMouseDragHandler_connect=e(c,"onMouseDrag",this._onMouseDragHandler),this._onMouseUpHandler_connect=e(c,"onMouseDragEnd",this._onMouseUpHandler));l("esri-touch")&&!l("esri-pointer")&&(this._onMouseDownHandler2_connect=e(c,"onSwipeStart",this._onMouseDownHandler),
this._onMouseDragHandler2_connect=e(c,"onSwipeMove",this._onMouseDragHandler),this._onMouseUpHandler2_connect=e(c,"onSwipeEnd",this._onMouseUpHandler));break;case g.POLYLINE:case g.POLYGON:case g.MULTI_POINT:c.navigationManager.setImmediateClick(!0);this._onClickHandler_connect=e(c,"onClick",this._onClickHandler);this._onDblClickHandler_connect=e(c,"onDblClick",this._onDblClickHandler);this._dblClickZoom=c.isDoubleClickZoom;c.disableDoubleClickZoom();break;default:console.error("Unsupported geometry type: "+
a);return}this._onKeyDown_connect=e(c,"onKeyDown",this._onKeyDownHandler);this._redrawConnect=e(c,"onExtentChange",this._redrawGraphic);this._geometryType=a;this._toggleTooltip(!0);c.snappingManager&&("freehandpolyline"!==this._geometryType&&"freehandpolygon"!==this._geometryType)&&(c.snappingManager._startSelectionLayerQuery(),c.snappingManager._setUpSnapping());this.onActivate(this._geometryType)},deactivate:function(){var a=this.map;this._clear();var b=h.disconnect;b(this._onMouseMoveHandler_connect);
b(this._onMouseDownHandler_connect);b(this._onMouseDragHandler_connect);b(this._onMouseUpHandler_connect);b(this._onMouseDownHandler2_connect);b(this._onMouseDragHandler2_connect);b(this._onMouseUpHandler2_connect);b(this._onClickHandler_connect);b(this._onDblClickHandler_connect);b(this._onKeyDown_connect);b(this._redrawConnect);this._onMouseDownHandler_connect=this._onMouseMoveHandler_connect=this._onMouseDragHandler_connect=this._onMouseUpHandler_connect=this._onMouseDownHandler2_connect=this._onMouseDragHandler2_connect=
this._onMouseUpHandler2_connect=this._onClickHandler_connect=this._onDblClickHandler_connect=this._onKeyDown_connect=this._redrawConnect=null;a.snappingManager&&(a.snappingManager._stopSelectionLayerQuery(),a.snappingManager._killOffSnapping());switch(this._geometryType){case B.CIRCLE:case B.ELLIPSE:case B.TRIANGLE:case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.RECTANGLE:case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:this._activateMapTools(!0,
!1,!1,!0);break;case B.POLYLINE:case B.POLYGON:case B.MULTI_POINT:this._dblClickZoom&&a.enableDoubleClickZoom()}b=this._geometryType;this._geometryType=null;a.navigationManager.setImmediateClick(!1);this._toggleTooltip(!1);this.onDeactivate(b)},_clear:function(){this._graphic&&this.map.graphics.remove(this._graphic,!0);this._tGraphic&&this.map.graphics.remove(this._tGraphic,!0);this._graphic=this._tGraphic=null;this.map.snappingManager&&this.map.snappingManager._setGraphic(null);this._points=[]},
finishDrawing:function(){var a,b=this._points,c=this.map.spatialReference,d=B,b=b.slice(0,b.length);switch(this._geometryType){case d.POLYLINE:if(!this._graphic||2>b.length)return;a=new D(c);a.addPath([].concat(b));break;case d.POLYGON:if(!this._graphic||3>b.length)return;a=new v(c);b=[].concat(b,[b[0].offset(0,0)]);!v.prototype.isClockwise(b)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),b.reverse());
a.addRing(b);break;case d.MULTI_POINT:a=new u(c),f.forEach(b,function(b){a.addPoint(b)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(a)},_drawEnd:function(a){if(a){var b=this.map.spatialReference,c;this.onDrawEnd(a);b&&(b.isWebMercator()?c=z.webMercatorToGeographic(a,!0):4326===b.wkid&&(c=x.fromJson(a.toJson())));this.onDrawComplete({geometry:a,geographicGeometry:c})}},_normalizeRect:function(a,b,c){var d=a.x;a=a.y;var e=b.x;b=b.y;var g=Math.abs(d-
e),f=Math.abs(a-b);return{x:Math.min(d,e),y:Math.max(a,b),width:g,height:f,spatialReference:c}},_onMouseDownHandler:function(a){this._dragged=!1;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=b||a.mapPoint,d=B;b=this.map;var e=b.spatialReference;this._points.push(c.offset(0,0));switch(this._geometryType){case d.LINE:this._graphic=b.graphics.add(new w(new D({paths:[[[c.x,c.y],[c.x,c.y]]],spatialReference:e}),this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);
break;case d.FREEHAND_POLYLINE:this._oldPoint=a.screenPoint;c=new D(e);c.addPath(this._points);this._graphic=b.graphics.add(new w(c,this.lineSymbol),!0);b.snappingManager&&b.snappingManager._setGraphic(this._graphic);break;case d.CIRCLE:case d.ELLIPSE:case d.TRIANGLE:case d.ARROW:case d.LEFT_ARROW:case d.RIGHT_ARROW:case d.UP_ARROW:case d.DOWN_ARROW:case d.RECTANGLE:case d.FREEHAND_POLYGON:this._oldPoint=a.screenPoint,c=new v(e),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),
!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)}l("esri-touch")&&a.preventDefault()},_onMouseMoveHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[this._points.length-1];a=b||a.mapPoint;b=this._tGraphic;var d=b.geometry;switch(this._geometryType){case B.POLYLINE:case B.POLYGON:d.setPoint(0,0,{x:c.x,y:c.y}),d.setPoint(0,1,{x:a.x,y:a.y}),b.setGeometry(d)}},_onMouseDragHandler:function(a){if(this._graphic||this._points.length)if(l("esri-touch")&&
!this._points.length)a.preventDefault();else{this._dragged=!0;var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0],e=b||a.mapPoint,g=this.map,f=g.spatialReference;b=this._graphic;var k=B,q=g.toScreen(c),m=g.toScreen(e),h=[],h=m.x-q.x,m=m.y-q.y,r=Math.sqrt(h*h+m*m);switch(this._geometryType){case k.CIRCLE:this._hideTooltip();b.geometry=v.createCircle({center:q,r:r,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case k.ELLIPSE:this._hideTooltip();
b.geometry=v.createEllipse({center:q,longAxis:h,shortAxis:m,numberOfPoints:60,map:g});b.setGeometry(b.geometry);break;case k.TRIANGLE:this._hideTooltip();h=[[0,-r],[0.8660254037844386*r,0.5*r],[-0.8660254037844386*r,0.5*r],[0,-r]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.ARROW:this._hideTooltip();c=m/r;g=h/r;e=0.25*g*r;f=0.25*r/(m/h);r*=0.25*c;h=[[h,m],[h-e*(1+24/f),m+24*g-r],[h-e*(1+12/f),m+12*g-r],[-12*c,12*g],[12*c,-12*g],[h-e*(1-12/f),m-12*g-r],[h-e*(1-24/f),
m-24*g-r],[h,m]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.LEFT_ARROW:this._hideTooltip();h=0>=h?[[h,0],[0.75*h,m],[0.75*h,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*h,-0.5*m],[0.75*h,-m],[h,0]]:[[0,0],[0.25*h,m],[0.25*h,0.5*m],[h,0.5*m],[h,-0.5*m],[0.25*h,-0.5*m],[0.25*h,-m],[0,0]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.RIGHT_ARROW:this._hideTooltip();h=0<=h?[[h,0],[0.75*h,m],[0.75*h,0.5*m],[0,0.5*m],[0,-0.5*m],[0.75*h,-0.5*m],[0.75*
h,-m],[h,0]]:[[0,0],[0.25*h,m],[0.25*h,0.5*m],[h,0.5*m],[h,-0.5*m],[0.25*h,-0.5*m],[0.25*h,-m],[0,0]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.UP_ARROW:this._hideTooltip();h=0>=m?[[0,m],[-h,0.75*m],[-0.5*h,0.75*m],[-0.5*h,0],[0.5*h,0],[0.5*h,0.75*m],[h,0.75*m],[0,m]]:[[0,0],[-h,0.25*m],[-0.5*h,0.25*m],[-0.5*h,m],[0.5*h,m],[0.5*h,0.25*m],[h,0.25*m],[0,0]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.DOWN_ARROW:this._hideTooltip();
h=0<=m?[[0,m],[-h,0.75*m],[-0.5*h,0.75*m],[-0.5*h,0],[0.5*h,0],[0.5*h,0.75*m],[h,0.75*m],[0,m]]:[[0,0],[-h,0.25*m],[-0.5*h,0.25*m],[-0.5*h,m],[0.5*h,m],[0.5*h,0.25*m],[h,0.25*m],[0,0]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.RECTANGLE:this._hideTooltip();h=[[0,0],[h,0],[h,m],[0,m],[0,0]];b.geometry=this._toPolygon(h,q.x,q.y);b.setGeometry(b.geometry);break;case k.LINE:b.setGeometry(d.mixin(b.geometry,{paths:[[[c.x,c.y],[e.x,e.y]]]}));break;case k.EXTENT:b&&g.graphics.remove(b,
!0);b=new F(this._normalizeRect(c,e,f));b._originOnly=!0;this._graphic=g.graphics.add(new w(b,this.fillSymbol),!0);g.snappingManager&&g.snappingManager._setGraphic(this._graphic);break;case k.FREEHAND_POLYLINE:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry);break;case k.FREEHAND_POLYGON:this._hideTooltip();if(!1===this._canDrawFreehandPoint(a)){l("esri-touch")&&
a.preventDefault();return}this._points.push(a.mapPoint.offset(0,0));b.geometry._insertPoints([e.offset(0,0)],0);b.setGeometry(b.geometry)}l("esri-touch")&&a.preventDefault()}},_canDrawFreehandPoint:function(a){if(!this._oldPoint)return!1;var b=this._oldPoint.x-a.screenPoint.x,c=this._oldPoint.y-a.screenPoint.y,d=this._options.tolerance;if((0>b?-1*b:b)<d&&(0>c?-1*c:c)<d)return!1;b=new Date;if(b-this._startTime<this._options.drawTime)return!1;this._startTime=b;this._oldPoint=a.screenPoint;return!0},
_onMouseUpHandler:function(a){if(!this._dragged||!this._graphic)this._clear();else{0===this._points.length&&this._points.push(a.mapPoint.offset(0,0));var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);var c=this._points[0];b=b||a.mapPoint;var d=this.map.spatialReference,e=B,g;switch(this._geometryType){case e.CIRCLE:case e.ELLIPSE:case e.TRIANGLE:case e.ARROW:case e.LEFT_ARROW:case e.RIGHT_ARROW:case e.UP_ARROW:case e.DOWN_ARROW:case e.RECTANGLE:g=this._graphic.geometry;break;
case e.LINE:g=new D({paths:[[[c.x,c.y],[b.x,b.y]]],spatialReference:d});break;case e.EXTENT:g=(new F(this._normalizeRect(c,b,d))).getExtent();break;case e.FREEHAND_POLYLINE:g=new D(d);g.addPath([].concat(this._points,[b.offset(0,0)]));break;case e.FREEHAND_POLYGON:g=new v(d),c=[].concat(this._points,[b.offset(0,0),this._points[0].offset(0,0)]),!v.prototype.isClockwise(c)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),
c.reverse()),g.addRing(c)}l("esri-touch")&&a.preventDefault();this._clear();this._drawEnd(g)}},_onClickHandler:function(a){var b;this.map.snappingManager&&(b=this.map.snappingManager._snappingPoint);a=b||a.mapPoint;b=this.map;var c=b.toScreen(a),d=B;this._points.push(a.offset(0,0));switch(this._geometryType){case d.POINT:this._drawEnd(a.offset(0,0));this._setTooltipMessage(0);break;case d.POLYLINE:1===this._points.length?(c=new D(b.spatialReference),c.addPath(this._points),this._graphic=b.graphics.add(new w(c,
this.lineSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new D({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.lineSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.lineSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,
1,a.offset(0,0)),b.setGeometry(c));break;case d.POLYGON:1===this._points.length?(c=new v(b.spatialReference),c.addRing(this._points),this._graphic=b.graphics.add(new w(c,this.fillSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic),this._onMouseMoveHandler_connect=h.connect(b,"onMouseMove",this._onMouseMoveHandler),this._tGraphic=b.graphics.add(new w(new D({paths:[[[a.x,a.y],[a.x,a.y]]],spatialReference:b.spatialReference}),this.fillSymbol),!0)):(this._graphic.geometry._insertPoints([a.offset(0,
0)],0),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.fillSymbol),b=this._tGraphic,c=b.geometry,c.setPoint(0,0,a.offset(0,0)),c.setPoint(0,1,a.offset(0,0)),b.setGeometry(c));break;case d.MULTI_POINT:a=this._points;1===a.length?(c=new u(b.spatialReference),c.addPoint(a[a.length-1]),this._graphic=b.graphics.add(new w(c,this.markerSymbol),!0),b.snappingManager&&b.snappingManager._setGraphic(this._graphic)):(this._graphic.geometry.addPoint(a[a.length-1]),this._graphic.setGeometry(this._graphic.geometry).setSymbol(this.markerSymbol));
break;case d.ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.LEFT_ARROW:this._addShape([[0,0],[24,24],[24,12],[96,12],[96,-12],[24,-12],[24,-24],[0,0]],c.x,c.y);break;case d.RIGHT_ARROW:this._addShape([[0,0],[-24,24],[-24,12],[-96,12],[-96,-12],[-24,-12],[-24,-24],[0,0]],c.x,c.y);break;case d.UP_ARROW:this._addShape([[0,0],[-24,24],[-12,24],[-12,96],[12,96],[12,24],[24,24],[0,0]],c.x,c.y);break;case d.DOWN_ARROW:this._addShape([[0,
0],[-24,-24],[-12,-24],[-12,-96],[12,-96],[12,-24],[24,-24],[0,0]],c.x,c.y);break;case d.TRIANGLE:this._addShape([[0,-48],[41.56921938165306,24],[-41.56921938165306,24],[0,-48]],c.x,c.y);break;case d.RECTANGLE:this._addShape([[0,-96],[96,-96],[96,0],[0,0],[0,-96]],c.x-48,c.y+48);break;case d.CIRCLE:this._clear();this._drawEnd(v.createCircle({center:c,r:48,numberOfPoints:60,map:b}));break;case d.ELLIPSE:this._clear(),this._drawEnd(v.createEllipse({center:c,longAxis:48,shortAxis:24,numberOfPoints:60,
map:b}))}this._setTooltipMessage(this._points.length)},_addShape:function(a,b,c){this._setTooltipMessage(0);this._clear();this._drawEnd(this._toPolygon(a,b,c))},_toPolygon:function(a,b,c){var d=this.map,e=new v(d.spatialReference);e.addRing(f.map(a,function(a){return d.toMap({x:a[0]+b,y:a[1]+c})}));return e},_onDblClickHandler:function(a){var b,c=this._points,d=this.map.spatialReference,e=B;l("esri-touch")&&c.push(a.mapPoint);var g=c[c.length-1],k=c[c.length-2],c=g&&k&&g.x===k.x&&g.y===k.y?c.slice(0,
c.length-1):c.slice(0,c.length);switch(this._geometryType){case e.POLYLINE:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new D(d);b.addPath([].concat(c));break;case e.POLYGON:if(!this._graphic||2>c.length){h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._onClickHandler(a);return}b=new v(d);a=[].concat(c,[c[0].offset(0,0)]);!v.prototype.isClockwise(a)&&!this.respectDrawingVertexOrder&&(console.debug(this.declaredClass+
" :  Polygons drawn in anti-clockwise direction will be reversed to be clockwise."),a.reverse());b.addRing(a);break;case e.MULTI_POINT:b=new u(d),f.forEach(c,function(a){b.addPoint(a)})}h.disconnect(this._onMouseMoveHandler_connect);this._clear();this._setTooltipMessage(0);this._drawEnd(b)},_onKeyDownHandler:function(a){a.keyCode===k.ESCAPE&&(h.disconnect(this._onMouseMoveHandler_connect),this._clear(),this._setTooltipMessage(0))},_toggleTooltip:function(a){this._options.showTooltips&&(a?this._tooltip||
(this._tooltip=b.create("div",{"class":"tooltip"},this.map.container),q.isBodyLtr()||s.set(this._tooltip,"direction","rtl"),this._tooltip.style.display="none",this._tooltip.style.position="fixed",this._setTooltipMessage(0),this._onTooltipMouseEnterHandler_connect=h.connect(this.map,"onMouseOver",this._updateTooltip),this._onTooltipMouseLeaveHandler_connect=h.connect(this.map,"onMouseOut",this._hideTooltip),this._onTooltipMouseMoveHandler_connect=h.connect(this.map,"onMouseMove",this._updateTooltip)):
this._tooltip&&(h.disconnect(this._onTooltipMouseEnterHandler_connect),h.disconnect(this._onTooltipMouseLeaveHandler_connect),h.disconnect(this._onTooltipMouseMoveHandler_connect),b.destroy(this._tooltip),this._tooltip=null))},_hideTooltip:function(){var a=this._tooltip;a&&(a.style.display="none")},_setTooltipMessage:function(a){var b=this._tooltip;if(b){var c="";switch(this._geometryType){case B.POINT:c=C.toolbars.draw.addPoint;break;case B.ARROW:case B.LEFT_ARROW:case B.RIGHT_ARROW:case B.UP_ARROW:case B.DOWN_ARROW:case B.TRIANGLE:case B.RECTANGLE:case B.CIRCLE:case B.ELLIPSE:c=
C.toolbars.draw.addShape;break;case B.LINE:case B.EXTENT:case B.FREEHAND_POLYLINE:case B.FREEHAND_POLYGON:c=C.toolbars.draw.freehand;break;case B.POLYLINE:case B.POLYGON:c=C.toolbars.draw.start;1===a?c=C.toolbars.draw.resume:2<=a&&(c=C.toolbars.draw.complete);break;case B.MULTI_POINT:c=C.toolbars.draw.addMultipoint,1<=a&&(c=C.toolbars.draw.finish)}b.innerHTML=c}},_updateTooltip:function(a){var b=this._tooltip;if(b){var c;a.clientX||a.pageY?(c=a.clientX,a=a.clientY):(c=a.clientX+p.body().scrollLeft-
p.body().clientLeft,a=a.clientY+p.body().scrollTop-p.body().clientTop);b.style.display="none";s.set(b,{left:c+this._options.tooltipOffset+"px",top:a+"px"});b.style.display=""}},_redrawGraphic:function(a,b,c,d){if(c||this.map.wrapAround180)(a=this._graphic)&&a.setGeometry(a.geometry),(a=this._tGraphic)&&a.setGeometry(a.geometry)},onActivate:function(){},onDeactivate:function(){},onDrawComplete:function(){},onDrawEnd:function(){}});d.mixin(B,{POINT:"point",MULTI_POINT:"multipoint",LINE:"line",EXTENT:"extent",
POLYLINE:"polyline",POLYGON:"polygon",FREEHAND_POLYLINE:"freehandpolyline",FREEHAND_POLYGON:"freehandpolygon",ARROW:"arrow",LEFT_ARROW:"leftarrow",RIGHT_ARROW:"rightarrow",UP_ARROW:"uparrow",DOWN_ARROW:"downarrow",TRIANGLE:"triangle",CIRCLE:"circle",ELLIPSE:"ellipse",RECTANGLE:"rectangle"});return B})},"esri/toolbars/_toolbar":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../Evented"],function(n,d,f,h,c){return n([c],{declaredClass:"esri.toolbars._Toolbar",constructor:function(c){this.map=
c},_cursors:{move:"pointer","move-v":"pointer","move-gv":"pointer",box0:"nw-resize",box1:"n-resize",box2:"ne-resize",box3:"e-resize",box4:"se-resize",box5:"s-resize",box6:"sw-resize",box7:"w-resize",box8:"pointer"},_deactivateMapTools:function(c,d,a,f){var b=this.map;c&&(this._mapNavState={isDoubleClickZoom:b.isDoubleClickZoom,isClickRecenter:b.isClickRecenter,isPan:b.isPan,isRubberBandZoom:b.isRubberBandZoom,isKeyboardNavigation:b.isKeyboardNavigation,isScrollWheelZoom:b.isScrollWheelZoom},b.disableDoubleClickZoom(),
b.disableClickRecenter(),b.disablePan(),b.disableRubberBandZoom(),b.disableKeyboardNavigation());d&&b.hideZoomSlider();a&&b.hidePanArrows();f&&b.graphics.disableMouseEvents()},_activateMapTools:function(c,d,a,f){var b=this.map,h=this._mapNavState;c&&h&&(h.isDoubleClickZoom&&b.enableDoubleClickZoom(),h.isClickRecenter&&b.enableClickRecenter(),h.isPan&&b.enablePan(),h.isRubberBandZoom&&b.enableRubberBandZoom(),h.isKeyboardNavigation&&b.enableKeyboardNavigation(),h.isScrollWheelZoom&&b.enableScrollWheelZoom());
d&&b.showZoomSlider();a&&b.showPanArrows();f&&b.graphics.enableMouseEvents()}})})},"jimu/dijit/URLInput":function(){define(["dojo/_base/declare","dojo/_base/html","dijit/form/ValidationTextBox","dojox/validate/regexp"],function(n,d,f,h){return n([f],{required:!0,invalidMessage:"Invalid url.",trim:!0,rest:!0,allowNamed:!0,allowLocal:!0,declaredClass:"jimu.dijit.URLInput",postMixInProperties:function(){this.inherited(arguments);this.invalidMessage=(this.nls=window.jimuNls.urlInput)?this.nls.invalidUrl:
"Invalid Url"},postCreate:function(){this.inherited(arguments);d.addClass(this.domNode,"jimu-url-input")},validator:function(c){if(isFinite(c))return!1;var d="^"+h.url({allowNamed:this.allowNamed,allowLocal:this.allowLocal}),d=RegExp(d,"g").test(c);return this.rest?(c=/\/rest\/services/gi.test(c),d&&c):d}})})},"dojox/validate/regexp":function(){define(["dojo/_base/lang","dojo/regexp","dojox/main"],function(n,d,f){var h=n.getObject("validate.regexp",!0,f);return h=f.validate.regexp={ipAddress:function(c){c=
"object"==typeof c?c:{};"boolean"!=typeof c.allowDottedDecimal&&(c.allowDottedDecimal=!0);"boolean"!=typeof c.allowDottedHex&&(c.allowDottedHex=!0);"boolean"!=typeof c.allowDottedOctal&&(c.allowDottedOctal=!0);"boolean"!=typeof c.allowDecimal&&(c.allowDecimal=!0);"boolean"!=typeof c.allowHex&&(c.allowHex=!0);"boolean"!=typeof c.allowIPv6&&(c.allowIPv6=!0);"boolean"!=typeof c.allowHybrid&&(c.allowHybrid=!0);var d=[];c.allowDottedDecimal&&d.push("((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
c.allowDottedHex&&d.push("(0[xX]0*[\\da-fA-F]?[\\da-fA-F]\\.){3}0[xX]0*[\\da-fA-F]?[\\da-fA-F]");c.allowDottedOctal&&d.push("(0+[0-3][0-7][0-7]\\.){3}0+[0-3][0-7][0-7]");c.allowDecimal&&d.push("(0|[1-9]\\d{0,8}|[1-3]\\d{9}|4[01]\\d{8}|42[0-8]\\d{7}|429[0-3]\\d{6}|4294[0-8]\\d{5}|42949[0-5]\\d{4}|429496[0-6]\\d{3}|4294967[01]\\d{2}|42949672[0-8]\\d|429496729[0-5])");c.allowHex&&d.push("0[xX]0*[\\da-fA-F]{1,8}");c.allowIPv6&&d.push("([\\da-fA-F]{1,4}\\:){7}[\\da-fA-F]{1,4}");c.allowHybrid&&d.push("([\\da-fA-F]{1,4}\\:){6}((\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])\\.){3}(\\d|[1-9]\\d|1\\d\\d|2[0-4]\\d|25[0-5])");
c="";0<d.length&&(c="("+d.join("|")+")");return c},host:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowIP&&(c.allowIP=!0);"boolean"!=typeof c.allowLocal&&(c.allowLocal=!1);"boolean"!=typeof c.allowPort&&(c.allowPort=!0);"boolean"!=typeof c.allowNamed&&(c.allowNamed=!1);var d=c.allowPort?"(\\:\\d+)?":"",f="((?:(?:[\\da-zA-Z](?:[-\\da-zA-Z]{0,61}[\\da-zA-Z])?)\\.)+(?:[a-zA-Z](?:[-\\da-zA-Z]{0,6}[\\da-zA-Z])?)\\.?)";c.allowIP&&(f+="|"+h.ipAddress(c));c.allowLocal&&(f+="|localhost");c.allowNamed&&
(f+="|^[^-][a-zA-Z0-9_-]*");return"("+f+")"+d},url:function(c){c="object"==typeof c?c:{};"scheme"in c||(c.scheme=[!0,!1]);return d.buildGroupRE(c.scheme,function(c){return c?"(https?|ftps?)\\://":""})+h.host(c)+"(/(?:[^?#\\s/]+/)*(?:[^?#\\s/]+(?:\\?[^?#\\s/]*)?(?:#[A-Za-z][\\w.:-]*)?)?)?"},emailAddress:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowCruft&&(c.allowCruft=!1);c.allowPort=!1;var d="([!#-'*+\\-\\/-9\x3d?A-Z^-~]+[.])*[!#-'*+\\-\\/-9\x3d?A-Z^-~]+@"+h.host(c);c.allowCruft&&
(d="\x3c?(mailto\\:)?"+d+"\x3e?");return d},emailAddressList:function(c){c="object"==typeof c?c:{};"string"!=typeof c.listSeparator&&(c.listSeparator="\\s;,");var d=h.emailAddress(c);return"("+d+"\\s*["+c.listSeparator+"]\\s*)*"+d+"\\s*["+c.listSeparator+"]?\\s*"},numberFormat:function(c){c="object"==typeof c?c:{};"undefined"==typeof c.format&&(c.format="###-###-####");return d.buildGroupRE(c.format,function(c){return d.escapeString(c,"?").replace(/\?/g,"\\d?").replace(/#/g,"\\d")})},ca:{postalCode:function(){return"([A-Z][0-9][A-Z] [0-9][A-Z][0-9])"},
province:function(){return"(AB|BC|MB|NB|NL|NS|NT|NU|ON|PE|QC|SK|YT)"}},us:{state:function(c){c="object"==typeof c?c:{};"boolean"!=typeof c.allowTerritories&&(c.allowTerritories=!0);"boolean"!=typeof c.allowMilitary&&(c.allowMilitary=!0);var d="AL|AK|AZ|AR|CA|CO|CT|DE|DC|FL|GA|HI|ID|IL|IN|IA|KS|KY|LA|ME|MD|MA|MI|MN|MS|MO|MT|NE|NV|NH|NJ|NM|NY|NC|ND|OH|OK|OR|PA|RI|SC|SD|TN|TX|UT|VT|VA|WA|WV|WI|WY";c.allowTerritories&&(d+="|AS|FM|GU|MH|MP|PW|PR|VI");c.allowMilitary&&(d+="|AA|AE|AP");return"("+d+")"}}}})},
"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(n,d,f,h,c,p,l,a,k){return n([l,p],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(a){a.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(a){a.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(a){this.panelManager.closePanel(this);a.stopPropagation()},_normalizePositionObj:function(a){var c=this._getLayoutBox();a.left=
isFinite(a.left)?a.left:c.w-a.right;a.top=isFinite(a.top)?a.top:c.h-a.bottom;delete a.right;delete a.bottom;this.position=d.mixin(d.clone(this.position),a)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new k({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(a,k){this.disableMoveable();var q=f.getMarginBox(jimuConfig.layoutId);q.l=q.l-a+k;q.w+=2*(a-k);this.moveable=new c.boxConstrainedMoveable(this.domNode,{box:q,handle:this.titleNode,within:!0});this.own(h(this.moveable,
"Moving",d.hitch(this,this.onMoving)));this.own(h(this.moveable,"MoveStop",d.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){f.removeClass(this.titleNode,"title-normal");f.addClass(this.titleNode,"title-full");f.setStyle(this.foldableNode,"display",
"block");f.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(f.removeClass(this.foldableNode,"fold-up"),f.addClass(this.foldableNode,"fold-down")):(f.removeClass(this.foldableNode,"fold-down"),f.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){f.removeClass(this.titleNode,"title-full");f.addClass(this.titleNode,"title-normal");f.setStyle(this.foldableNode,"display","none");f.setStyle(this.maxNode,"display","none")},resize:function(a){var c=this._getPositionInfo(),
f={left:c.position.left,top:c.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};a&&(a.t=this.domNode.offsetTop,f.left=isFinite(a.l)?a.l:f.left,f.top=isFinite(a.t)?a.t:f.top,f.width=isFinite(a.w)?a.w:f.width,f.height=isFinite(a.h)?a.h:f.height,this._normalizePositionObj(d.clone(f)),this.makePositionInfoBox(),f.width=this._positionInfoBox.w,f.height=this._positionInfoBox.h);c.position=f;this._onResponsible(c);this.inherited(arguments)},_onResponsible:function(a){a.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(a.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,0.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(a){this._normalizePositionObj(a);this.makePositionInfoBox();a=this._getPositionInfo();this._onResponsible(a)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var a=jimuConfig.layoutId,
a="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return f.getMarginBox(a)},_getPositionInfo:function(){var a={isRunInMobile:!1,position:{left:0,top:5}},c=this._getLayoutBox(),d=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return a.isRunInMobile=!0,a;a.position.left=window.isRTL?c.w-d:d;var d=this._positionInfoBox.t,f=c.h-d;d>=f?d>=this._positionInfoBox.h&&(a.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):f>=this._positionInfoBox.h&&(a.position.top=
this._positionInfoBox.t+40+3);!a.isRunInMobile&&a.position.left+this._positionInfoBox.w>c.w&&(a.position.left-=this._positionInfoBox.w);return a},_setMobilePosition:function(){window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==f.byId(jimuConfig.layoutId))&&f.place(this.domNode,jimuConfig.layoutId);var b=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(b.zIndex=this.position.zIndex);var c=a.getPositionStyle(b);d.mixin(c,b.borderRadiusStyle);f.setStyle(this.domNode,
c)},_setDesktopPosition:function(a){!window.appInfo.isRunInMobile&&(this.domNode&&this.domNode.parentNode!==f.byId(jimuConfig.mapId))&&f.place(this.domNode,jimuConfig.mapId);f.setStyle(this.domNode,{left:a.left+"px",right:"auto",top:a.top+"px",width:(a.width||this.position.width||this._originalBox.w)+"px",height:(a.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(a){f.setStyle(a.node,"opacity",0.9)},onMoveStop:function(a){f.setStyle(a.node,"opacity",1);a=f.getMarginBox(a.node);
this._normalizePositionObj(d.clone({left:a.l,top:a.t,width:a.w,height:a.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g){n.experimental("dojox.layout.ResizeHandle");
var y=r("dojox.layout._ResizeHelper",e,{show:function(){q.set(this.domNode,"display","")},hide:function(){q.set(this.domNode,"display","none")},resize:function(a){s.setMarginBox(this.domNode,a)}});return r("dojox.layout.ResizeHandle",[e,g],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,
startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,m.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=t.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new y({id:"dojoxGlobalResizeHelper"})).placeAt(l.body()),b.add(this._resizeHelper.domNode,this.activeResizeClass)));
this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var a=d.partial(b.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;a("dojoxResizeNW");break;case "x":this._resizeX=!0;a("dojoxResizeW");break;case "y":this._resizeY=!0,a("dojoxResizeN")}},_beginSizing:function(a){if(!this._isSizing&&(f.publish(this.startTopic,[this]),this.targetDomNode=
(this.targetWidget=t.byId(this.targetId))?this.targetWidget.domNode:k.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var b=s.position(this.targetDomNode,!0);this._resizeHelper.resize({l:b.x,t:b.y,w:b.w,h:b.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:b.x,t:b.y})}this._isSizing=!0;this.startPoint={x:a.clientX,y:a.clientY};var b=q.getComputedStyle(this.targetDomNode),d="border-model"===
s.boxModel?{w:0,h:0}:s.getPadBorderExtents(this.targetDomNode,b),e=s.getMarginExtents(this.targetDomNode,b);this.startSize={w:q.get(this.targetDomNode,"width",b),h:q.get(this.targetDomNode,"height",b),pbw:d.w,pbh:d.h,mw:e.w,mh:e.h};!this.isLeftToRight()&&"absolute"==q.get(this.targetDomNode,"position")&&(b=s.position(this.targetDomNode,!0),this.startPosition={l:b.x,t:b.y});this._pconnects=[f.connect(l.doc,m.move,this,"_updateSizing"),f.connect(l.doc,m.release,this,"_endSizing")];c.stop(a)}},_updateSizing:function(a){if(this.activeResize)this._changeSizing(a);
else{var b=this._getNewCoords(a,"border",this._resizeHelper.startPosition);if(!1===b)return;this._resizeHelper.resize(b)}a.preventDefault()},_getNewCoords:function(a,b,c){try{if(!a.clientX||!a.clientY)return!1}catch(d){return!1}this._activeResizeLastEvent=a;var e=(this.isLeftToRight()?1:-1)*(this.startPoint.x-a.clientX),g=this.startPoint.y-a.clientY;a=this.startSize.w-(this._resizeX?e:0);g=this._checkConstraints(a,this.startSize.h-(this._resizeY?g:0));if((c=c||this.startPosition)&&this._resizeX)g.l=
c.l+e,g.w!=a&&(g.l+=a-g.w),g.t=c.t;switch(b){case "margin":g.w+=this.startSize.mw,g.h+=this.startSize.mh;case "border":g.w+=this.startSize.pbw,g.h+=this.startSize.pbh}return g},_checkConstraints:function(a,b){if(this.minSize){var c=this.minSize;a<c.w&&(a=c.w);b<c.h&&(b=c.h)}this.constrainMax&&this.maxSize&&(c=this.maxSize,a>c.w&&(a=c.w),b>c.h&&(b=c.h));if(this.fixedAspect){var c=this.startSize.w,d=this.startSize.h,e=c*b-d*a;0>e?a=b*c/d:0<e&&(b=a*d/c)}return{w:a,h:b}},_changeSizing:function(b){var c=
this.targetWidget&&d.isFunction(this.targetWidget.resize),e=this._getNewCoords(b,c&&"margin");if(!1!==e&&(c?this.targetWidget.resize(e):this.animateSizing?a[this.animateMethod]([p.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:e.w}},duration:this.animateDuration}),p.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:e.h}},duration:this.animateDuration})]).play():q.set(this.targetDomNode,{width:e.w+"px",height:e.h+"px"}),
this.intermediateChanges))this.onResize(b)},_endSizing:function(a){h.forEach(this._pconnects,f.disconnect);var b=d.partial(f.publish,this.endTopic,[this]);this.activeResize?b():(this._resizeHelper.hide(),this._changeSizing(a),setTimeout(b,this.animateDuration+15));this._isSizing=!1;this.onResize(a)},onResize:function(a){}})})},"jimu/LayerInfos/LayerInfoForCollection":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(n,d,f,
h,c){return n(h,{constructor:function(){this.layerObject={declaredClass:"esri.layers.FeatureCollection",type:"FeatureCollection",empty:!0}},getExtent:function(){var c=[],h;d.forEach(this.originOperLayer.featureCollection.layers,function(a){c=c.concat(a.layerObject.graphics)});0===c.length?h=null:(h=1===c.length?c[0].getLayer().fullExtent:f.graphicsExtent(c),h=this._convertGeometryToMapSpatialRef(h));return h},_resetLayerObjectVisiblityBeforeInit:function(){this._layerOption&&(d.forEach(this.newSubLayers,
function(c){c._layerOption&&c.layerObject.setVisibility(c._layerOption.visible)},this),this._setTopLayerVisible(this._layerOption.visible))},initVisible:function(){var c=!1,d;for(d=0;d<this.newSubLayers.length;d++)c=c||this.newSubLayers[d].layerObject.visible;c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;d.forEach(this.newSubLayers,function(c){c.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var f=[];d.forEach(this.originOperLayer.featureCollection.layers,
function(d){this._getLayerIndexesInMapByLayerId(d.layerObject.id)&&(d=c.getInstance().create({layerObject:d.layerObject,title:d.layerObject.label||d.layerObject.title||d.layerObject.name||d.layerObject.id||" ",id:d.id||" ",collection:{layerInfo:this},selfType:"collection",showLegend:d.showLegend,parentLayerInfo:this}),f.push(d),d.init())},this);f.reverse();return f},_obtainLayerIndexesInMap:function(){var c=[],d,a;for(a=0;a<this.newSubLayers.length;a++)(d=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&
c.push(d);return c},moveLeftOfIndex:function(c){var d;for(d=this.newSubLayers.length-1;0<=d;d--)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)},moveRightOfIndex:function(c){var d;for(d=0;d<this.newSubLayers.length;d++)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)},_getShowLegendOfWebmap:function(){return void 0!==this.originOperLayer.featureCollection.showLegend?this.originOperLayer.featureCollection.showLegend:!0}})})},"jimu/LayerInfos/LayerInfo":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all dojo/dom-construct dojo/topic esri/config esri/tasks/ProjectParameters esri/SpatialReference esri/geometry/webMercatorUtils".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s){return n(null,{originOperLayer:null,layerObject:null,map:null,title:null,id:null,newSubLayers:null,parentLayerInfo:null,_oldIsShowInMap:null,_eventHandles:null,constructor:function(a,b,c){this.originOperLayer=a;this.layerObject=a.layerObject;this.map=b;this.title=this.originOperLayer.title;this.id=this.originOperLayer.id;this._layerOption=c.layerOptions?c.layerOptions[this.id]:null;this.parentLayerInfo=a.parentLayerInfo?a.parentLayerInfo:null;this.nls=window.jimuNls.layerInfosMenu;
this._eventHandles=[]},init:function(){this.newSubLayers=this.obtainNewSubLayers();this.initVisible();this.originOperLayer.popupInfo&&(this.popupVisible=!0);this._oldIsShowInMap=this.isShowInMap();this._bindEvent()},isGraphicLayer:function(){var a=this._obtainLayerIndexesInMap();return a.length?a[0].isGraphicLayer:!1},obtainLayerIndexesInMap:function(){return this._obtainLayerIndexesInMap()},getExtent:function(){},getOpacity:function(){var a,b=0;for(a=0;a<this.newSubLayers.length;a++)if(this.newSubLayers[a].layerObject.opacity)b=
this.newSubLayers[a].layerObject.opacity>b?this.newSubLayers[a].layerObject.opacity:b;else return 1;return b},setOpacity:function(a){d.forEach(this.newSubLayers,function(b){b.layerObject.setOpacity&&b.layerObject.setOpacity(a)})},moveLeftOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},moveRightOfIndex:function(a){this.map.reorderLayer(this.layerObject,a)},traversal:function(a){if(a(this))return!0;for(var b=this.getSubLayers(),c=0;c<b.length;c++)if(b[c].traversal(a))return!0},findLayerInfoById:function(a){var b=
null,c=0;if(this.id&&this.id===a)return this;for(c=0;c<this.newSubLayers.length&&!(b=this.newSubLayers[c].findLayerInfoById(a));c++);return b},setTopLayerVisible:function(a){this._setTopLayerVisible(a)},_setTopLayerVisible:function(a){},setSubLayerVisible:function(a,b){},setLayerVisiblefromTopLayer:function(){},_resetLayerObjectVisiblityBeforeInit:function(){},resetLayerObjectVisibility:function(a){this.isRootLayer&&(this._layerOptions=a.layerOptions?a.layerOptions:null,this.traversal(function(b){b._layerOption=
a.layerOptions?a.layerOptions[b.id]:null}),void 0!==this._layerOption&&this._resetLayerObjectVisiblityBeforeInit())},initVisible:function(){},isVisible:function(){return this._visible?!0:!1},_obtainLayerIndexesInMap:function(){var a=[],b;(b=this._getLayerIndexesInMapByLayerId(this.id))&&a.push(b);return a},_getLayerIndexesInMapByLayerId:function(a){var b;for(b=0;b<this.map.graphicsLayerIds.length;b++)if(this.map.graphicsLayerIds[b]===a)return{isGraphicLayer:!0,index:b};for(b=0;b<this.map.layerIds.length;b++)if(this.map.layerIds[b]===
a)return{isGraphicLayer:!1,index:b};return null},_convertGeometryToMapSpatialRef:function(c){var d=new h;if(this.map.spatialReference.equals(c.spatialReference))return d.resolve([c]),d;if(this.map.spatialReference.isWebMercator()&&c.spatialReference.equals(new b(4326)))return d.resolve([s.geographicToWebMercator(c)]),d;if(this.map.spatialReference.equals(new b(4326))&&c.spatialReference.isWebMercator())return d.resolve([s.webMercatorToGeographic(c)]),d;d=new k;d.geometries=[c];d.outSR=this.map.spatialReference;
return a.defaults.geometryService.project(d)},_isShowInMapChanged:function(a){var b=this.isShowInMap();if(a!==b){!1===b&&this.map.infoWindow.hide();var c=[];this.traversal(function(a){c.push(a)});l.publish("layerInfos/layerInfo/isShowInMapChanged",c)}},_isShowInMapChanged2:function(){var a=this.isShowInMap();!1===a&&this.map.infoWindow.hide();this._oldIsShowInMap!==a&&(this._oldIsShowInMap=a,l.publish("layerInfos/layerInfo/isShowInMapChanged",[this]));d.forEach(this.getSubLayers(),function(a){a._isShowInMapChanged2()})},
_visibleChanged:function(){l.publish("layerInfos/layerInfo/visibleChanged",[this])},obtainNewSubLayers:function(){return[]},createLegendsNode:function(){return p.create("div",{"class":"legends-div"})},drawLegends:function(a,b){},_getLayerTypesOfSupportTable:function(){return"FeatureLayer,CSVLayer,Table,ArcGISImageServiceLayer,StreamLayer,ArcGISImageServiceVectorLayer"},_isItemLayer:function(){return this.originOperLayer.itemId||this.layerObject._itemId},_getShowLegendOfWebmap:function(){return void 0!==
this.originOperLayer.showLegend?this.originOperLayer.showLegend:!0},getLayerObject:function(){var a=new h;this.layerObject?a.resolve(this.layerObject):a.reject("layerObject is null");return a},getSubLayers:function(){return this.newSubLayers},isLeaf:function(){return 0===this.getSubLayers().length?!0:!1},isRootLayer:function(){return this.parentLayerInfo?!1:!0},isShowInMap:function(){for(var a=!0,b=this;b;)a=a&&b.isVisible(),b=b.parentLayerInfo;return a},getLayerType:function(){var a=[null],b=new h;
this.layerObject.declaredClass&&(a=this.layerObject.declaredClass.split("."));b.resolve(a[a.length-1]);return b},getPopupInfo:function(){return this.originOperLayer.popupInfo},loadInfoTemplate:function(){var a=new h;a.resolve(null);return a},getInfoTemplate:function(){return null},getFilterOfWebmap:function(){return this.originOperLayer.layerDefinition?this.originOperLayer.layerDefinition.definitionExpression:null},getShowLegendOfWebmap:function(){for(var a=this,b=!0;a;)b=b&&a._getShowLegendOfWebmap(),
a=a.parentLayerInfo;return b},getUrl:function(){return this.layerObject.url},hasLayerTypes:function(a){},getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},d=this.getLayerType(),k=this.getLayerObject();c({type:d,layerObject:k}).then(f.hitch(this,function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);if(c)if(this.parentLayerInfo&&this.parentLayerInfo.isMapNotesLayerInfo())b.isSupportQuery=
!1;else{if(!c.url||c.capabilities&&0<=c.capabilities.indexOf("Query"))b.isSupportQuery=!0}else b.isSupportQuery=!1;a.resolve(b)}),function(){a.resolve(b)});return a},getRelatedTableInfoArray:function(){var a=new h;a.resolve([]);return a},removeSubLayerById:function(a){var b=[];d.forEach(this.newSubLayers,function(c){c.id!==a&&b.push(c)});this.newSubLayers=b},destroy:function(){d.forEach(this._eventHandles,function(a){a.remove()});this.inherited(arguments)},destroyLayerInfo:function(){d.forEach(this.newSubLayers,
function(a){a.destroyLayerInfo()});this.destroy()},isMapNotesLayerInfo:function(){return this.originOperLayer.featureCollection&&0===this.id.indexOf("mapNotes_")&&"ArcGISFeatureLayer"===this.originOperLayer.layerType&&!this.map.getLayer(this.id)?!0:!1},_bindEvent:function(){if(this.layerObject&&!this.layerObject.empty){var a=this.layerObject.on("visibility-change",f.hitch(this,this._onVisibilityChanged));this._eventHandles.push(a)}},_onVisibilityChanged:function(){this.initVisible();this._visibleChanged();
this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForMapService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/json dojo/aspect dojo/topic ./LayerInfo esri/request esri/lang ./LayerInfoFactory".split(" "),function(n,d,f,h,c,p,l,a,k,b,s){return n(a,{_legendInfo:null,_sublayerIdent:null,controlPopupInfo:null,_jsapiLayerInfos:null,constructor:function(a,b,c){this._layerOptions=c.layerOptions?c.layerOptions:null;this._initJsapiLayerInfos();this.initSubLayerVisible();
this._initSubLayerIdent();this._initControlPopup()},_initJsapiLayerInfos:function(){var a=d.filter(this.originOperLayer.layers,function(a){return b.isDefined(a.id)&&b.isDefined(a.name)&&b.isDefined(a.minScale)&&b.isDefined(a.maxScale)&&b.isDefined(a.parentLayerId)&&b.isDefined(a.defaultVisibility)});this._jsapiLayerInfos=0<a.length?a:this.layerObject.layerInfos},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplates:f.clone(this.layerObject.infoTemplates)};this.layerObject._infoTemplates=
f.clone(this.layerObject.infoTemplates);p.after(this.layerObject,"setInfoTemplates",f.hitch(this,function(){this.layerObject._infoTemplates=f.clone(this.layerObject.infoTemplates);this.controlPopupInfo.infoTemplates=f.clone(this.layerObject.infoTemplates);this.traversal(function(a){a._afterSetInfoTemplates&&a._afterSetInfoTemplates()})}))},_initSubLayerIdent:function(){this._sublayerIdent={definitions:{},empty:!0,defLoad:new h}},initSubLayerVisible:function(a){this.subLayerVisible={};for(var b=0;b<
this._jsapiLayerInfos.length;b++)this.subLayerVisible[this._jsapiLayerInfos[b].id]=0;a?d.forEach(a,function(a){this.subLayerVisible[a]++},this):this.originOperLayer.visibleLayers?d.forEach(this.originOperLayer.visibleLayers,function(a){this.subLayerVisible[a]++},this):d.forEach(this._jsapiLayerInfos,function(a){a.defaultVisibility&&this.subLayerVisible[a.id]++},this)},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent)},
_resetLayerObjectVisiblityBeforeInit:function(){if(this._layerOptions&&(this._layerOption&&this.layerObject.setVisibility(this._layerOption.visible),"esri.layers.ArcGISDynamicMapServiceLayer"===this.layerObject.declaredClass)){var a=!1,c=[];d.forEach(this._jsapiLayerInfos,function(d){var e=this.id+"_"+d.id;b.isDefined(this._layerOptions[e])&&(a=!0,this._layerOptions[e].visible&&c.push(d.id))},this);if(a){this.initSubLayerVisible(c);this.traversal(function(a){a.initVisible()});var f={};this.traversal(function(a){0===
a.getSubLayers().length&&(f[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});this.setSubLayerVisible(f)}}},initVisible:function(){this._visible=this.originOperLayer.layerObject.visible},_setTopLayerVisible:function(a){this.originOperLayer.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var b=[-1,-1,-1],c,f=d.filter(this.originOperLayer.layerObject.visibleLayers,function(a){return-1!==a}),e;for(e in a)if(a.hasOwnProperty(e)&&"function"!==typeof a[e]){var g=
Number(e);a[e]?(c=d.indexOf(f,g),0>c&&f.push(g)):(c=d.indexOf(f,g),0<=c&&f.splice(c,1))}b=b.concat(f);this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[],b=this.originOperLayer.layerObject,c=null,c="esri.layers.ArcGISDynamicMapServiceLayer"===b.declaredClass?"dynamic":"tiled";d.forEach(this._jsapiLayerInfos,function(d){var g=null,g=b.url+"/"+d.id,f=b.id+"_"+d.id;d.subLayerIds&&0<d.subLayerIds.length?(g={url:g,empty:!0},this._addNewSubLayer(a,g,f,d,c+"_group")):
(g={url:g,empty:!0},this._addNewSubLayer(a,g,f,d,c))},this);var f=[];d.forEach(this._jsapiLayerInfos,function(b,c){var d=b.parentLayerId;if(-1!==d){for(var f=null,k=0;k<a.length;k++)if(a[k].mapService.subId===d){f=a[k];break}(d=f)&&d.subLayers.push(a[c])}},this);d.forEach(this._jsapiLayerInfos,function(b,c){var d;-1===b.parentLayerId&&(d=s.getInstance().create(a[c]),f.push(d),d.init())},this);return f},_addNewSubLayer:function(a,b,c,d,e){a.push({layerObject:b,title:d.name||d.id||" ",id:c||" ",subLayers:[],
mapService:{layerInfo:this,subId:d.id},selfType:"mapservice_"+e,parentLayerInfo:this})},_handleErrorSubLayer:function(a,b,c,d,e,g){a[b]={layerObject:null,title:g.name||g.id||" ",id:c||" ",subLayers:[],mapService:{layerInfo:this,subId:d}}},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},getLegendInfo:function(a){var b=new h;this._legendInfo?b.resolve(this._legendInfo):this._legendRequest(a).then(f.hitch(this,
function(a){this._legendInfo=a.layers;b.resolve(this._legendInfo)}),function(){b.reject()});return b},_legendRequest:function(a){return 10.01<=this.layerObject.version?this._legendRequestServer():this._legendRequestTools(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",b={f:"json"};this.layerObject._params.dynamicLayers&&(b.dynamicLayers=c.stringify(this._createDynamicLayers(this.layerObject)),"[{}]"===b.dynamicLayers&&(b.dynamicLayers="[]"));return k({url:a,content:b,handleAs:"json",
callbackParamName:"callback"})},_legendRequestTools:function(a){return k({url:a+"sharing/tools/legend?soapUrl\x3d"+this.layerObject.url,content:{f:"json"},handleAs:"json",callbackParamName:"callback"})},_createDynamicLayers:function(a){var b=[],c;d.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&
(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getLayerDefinition:function(){var a=new h;this._request(this.layerObject.url).then(f.hitch(this,function(b){a.resolve(b)}),function(b){console.error(b.message||b);a.resolve(null)});return a},_getSublayerDefinition:function(a){var b;this._sublayerIdent.definitions[a]?(b=new h,b.resolve(this._sublayerIdent.definitions[a])):b=this._layerAndTableRequest(a);return b},_layerAndTableRequest:function(a){return 10.11<=
this.layerObject.version?this._allLayerAndTableServer(a):this._allLayerAndTable(a)},_allLayerAndTableServer:function(a){var b=new h,c=this.layerObject.url+"/layers";this._sublayerIdent.empty?(this._sublayerIdent.empty=!1,this._request(c).then(f.hitch(this,function(c){this._sublayerIdent.definitions=c.layers;this._sublayerIdent.defLoad.resolve();b.resolve(this._sublayerIdent.definitions[a])}),f.hitch(this,function(a){console.error(a.message||a);this._sublayerIdent.defLoad.reject();this._sublayerIdent.defLoad=
new h;this._sublayerIdent.empty=!0;b.resolve(null)}))):this._sublayerIdent.defLoad.then(f.hitch(this,function(){b.resolve(this._sublayerIdent.definitions[a])}),function(a){console.error(a.message||a);b.resolve(null)});return b},_allLayerAndTable:function(a){var b=new h;this._request(this.layerObject.url+"/"+a).then(f.hitch(this,function(c){this._sublayerIdent.definitions[a]=c;b.resolve(c)}),function(a){console.error(a.message||a);b.resolve(null)});return b},_request:function(a){return k({url:a,content:{f:"json"},
handleAs:"json",callbackParamName:"callback"})},_getSublayerSettingOfWebmap:function(a){var b=d.filter(this.originOperLayer.layers,function(b){return b.id===a});return 1===b.length?b[0]:null},_getSublayerShowLegendOfWebmap:function(a){return(a=this._getSublayerSettingOfWebmap(a))?void 0!==a.showLegend?a.showLegend:!0:!0},_idIsInJsapiLayerInfos:function(a){return null===this._getJsapiLayerInfoById(a)?!1:!0},_getJsapiLayerInfoById:function(a){for(var b=null,c=0;c<this._jsapiLayerInfos.length;c++)this._jsapiLayerInfos[c].id===
a&&(b=this._jsapiLayerInfos[c]);return b},_isGroupLayerBySubId:function(a){return(a=this._getJsapiLayerInfoById(a))&&a.subLayerIds&&0<a.subLayerIds.length?!0:!1},_subLayerVisibleChanged:function(){var a=[];this.traversal(function(b){a.push(b)});l.publish("layerInfos/layerInfo/visibleChanged",a)},_bindEvent:function(){this.inherited(arguments);if(this.layerObject&&!this.layerObject.empty)this.layerObject.on("visible-layers-change",f.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(a){var b=
a.visibleLayers;if(-1===b[0]&&-1===b[1]&&-1===b[2])this._subLayerVisibleChanged(),this._isShowInMapChanged2();else{a=[];var c=[-1,-1,-1],b=this._converVisibleLayers(b);a=b.visibleLayersForUpdateSubLayerVisible;c=c.concat(b.visibleLayersForSetVisibleLayers);this.initSubLayerVisible(a);this.traversal(function(a){a.initVisible()});this.layerObject.setVisibleLayers(c)}},_converVisibleLayers:function(a){var b={visibleLayersForUpdateSubLayerVisible:[],visibleLayersForSetVisibleLayers:[]};d.forEach(a,function(b){var c=
this.findLayerInfoById(this.id+"_"+b);if(this._isGroupLayerBySubId(b))c.traversal(function(b){a.push(b.originOperLayer.mapService.subId)});else for(;c&&c.originOperLayer.mapService;)a.push(c.originOperLayer.mapService.subId),c=c.parentLayerInfo},this);d.forEach(a,function(a){0>b.visibleLayersForUpdateSubLayerVisible.indexOf(a)&&b.visibleLayersForUpdateSubLayerVisible.push(a)},this);d.forEach(b.visibleLayersForUpdateSubLayerVisible,function(a){this._isGroupLayerBySubId(a)||b.visibleLayersForSetVisibleLayers.push(a)},
this);return b}})})},"jimu/LayerInfos/LayerInfoForKML":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefault ./LayerInfoFactory dojo/Deferred".split(" "),function(n,d,f,h,c,p,l,a,k){return n(p,{constructor:function(){},getExtent:function(){var a=this.originOperLayer.layerObject.getLayers(),c=null,f;d.forEach(a,function(a){f=this._convertGeometryToMapSpatialRef(a.initialExtent);c=c?c.union(f):f},this);return c},_resetLayerObjectVisiblityBeforeInit:function(){this._layerOption&&
(d.forEach(this.newSubLayers,function(a){a._layerOption&&a.layerObject.setVisibility(a._layerOption.visible)},this),this._setTopLayerVisible(this._layerOption.visible))},initVisible:function(){var a=!1,c;for(c=0;c<this.newSubLayers.length;c++)a=a||this.newSubLayers[c].layerObject.visible;a&&(this._visible=!0)},_setTopLayerVisible:function(a){this._visible=a?!0:!1;d.forEach(this.newSubLayers,function(a){a.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var b=
[],c=this.originOperLayer.layerObject.getLayers();d.forEach(c,function(c){this._getLayerIndexesInMapByLayerId(c.id)&&(c=a.getInstance().create({layerObject:c,title:c.label||c.title||c.name||c.id||" ",id:c.id||" ",collection:{layerInfo:this},selfType:"kml",parentLayerInfo:this}),b.push(c),c.init())},this);return b}})})},"jimu/LayerInfos/LayerInfoForDefault":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred ./LayerInfo ./LayerInfos dojox/gfx dojo/dom-construct dojo/dom-attr dojo/aspect jimu/portalUrlUtils esri/symbols/jsonUtils esri/dijit/PopupTemplate esri/dijit/Legend".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m){var t=n(c,{_legendsNode:null,controlPopupInfo:null,constructor:function(){this._initControlPopup()},getExtent:function(){var a=this.originOperLayer.layerObject.fullExtent||this.originOperLayer.layerObject.initialExtent;if(a)return this._convertGeometryToMapSpatialRef(a);a=new h;a.resolve(null);return a},_resetLayerObjectVisiblityBeforeInit:function(){!this.originOperLayer.collection&&this._layerOption&&(this.layerObject.setVisibility(this._layerOption.visible),
this._visible=this.layerObject.visible)},initVisible:function(){var a=!1;if(this.originOperLayer.collection&&this._notFirstInitVisilbeFlag){var a=this.originOperLayer.collection.layerInfo,b=this.layerObject.visible;if(a._oldIsShowInMap!==a.isShowInMap())return;this._visible=b?!0:!1;a._onVisibilityChanged()}else this._visible=a=this.originOperLayer.layerObject.visible;this._notFirstInitVisilbeFlag=!0},_initControlPopup:function(){this.controlPopupInfo={enablePopup:this.layerObject.infoTemplate?!0:
!1,infoTemplate:this.layerObject.infoTemplate};this.layerObject._infoTemplate=this.layerObject.infoTemplate;b.after(this.layerObject,"setInfoTemplate",f.hitch(this,function(){this.layerObject._infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.infoTemplate=this.layerObject.infoTemplate;this.controlPopupInfo.enablePopup||(this.layerObject.infoTemplate=null)}))},_setTopLayerVisible:function(a){this.originOperLayer.collection?this.originOperLayer.collection.layerInfo._visible?a?(this.layerObject.show(),
this._visible=!0):(this.layerObject.hide(),this._visible=!1):a?(this.layerObject.hide(),this._visible=!0):(this.layerObject.hide(),this._visible=!1):(a?this.layerObject.show():this.layerObject.hide(),this._visible=a)},setLayerVisiblefromTopLayer:function(){this.originOperLayer.collection.layerInfo._visible?this._visible&&this.layerObject.show():this.layerObject.hide()},createLegendsNode:function(){var b=a.create("div",{"class":"legends-div jimu-leading-margin1"},document.body);a.create("img",{"class":"legends-loading-img",
src:require.toUrl("jimu")+"/images/loading.gif"},b);return b},drawLegends:function(a){this._initLegendsNodeByLegendDijit(a)},_initLegendsNodeByLegendDijit:function(b){if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length)&&this.layerObject.loaded)a.empty(b),(new m({map:this.map,layerInfos:[{layer:this.layerObject}],arrangement:m.ALIGN_LEFT,respectCurrentMapScale:!1,respectVisibility:!1},b)).startup()},_initLegendsNode:function(b){var c=
[],h=this.layerObject;if(this.layerObject&&!this.layerObject.empty&&(!this.originOperLayer.subLayer||0===this.originOperLayer.subLayers.length))a.empty(b),h.renderer&&(h.renderer.infos?c=f.clone(h.renderer.infos):c.push({label:h.renderer.label,symbol:h.renderer.symbol}),h.renderer&&(h.renderer.defaultSymbol&&0<c.length)&&c.push({label:h.renderer.defaultLabel||"others",symbol:h.renderer.defaultSymbol}),d.forEach(c,function(c){c.legendDiv=a.create("div",{"class":"legend-div"},b);c.symbolDiv=a.create("div",
{"class":"legend-symbol jimu-float-leading"},c.legendDiv);c.labelDiv=a.create("div",{"class":"legend-label jimu-float-leading",innerHTML:c.label||" "},c.legendDiv);if("textsymbol"===c.symbol.type)k.set(c.symbolDiv,"innerHTML",c.symbol.text);else{var d=l.createSurface(c.symbolDiv,50,50);c=q.getShapeDescriptors(c.symbol);d.createShape(c.defaultShape).setFill(c.fill).setStroke(c.stroke).setTransform(l.matrix.translate(25,25))}},this))},obtainNewSubLayers:function(){var a=[];this.originOperLayer.subLayers&&
0!==this.originOperLayer.subLayers.length&&d.forEach(this.originOperLayer.subLayers,function(b){b=new t(b,this.map);a.push(b);b.init()},this);return a},getOpacity:function(){return this.layerObject.opacity?this.layerObject.opacity:1},setOpacity:function(a){this.layerObject.setOpacity&&this.layerObject.setOpacity(a)},_getDefaultPopupTemplate:function(a){var b=null;if(a&&a.fields){var c={title:a.name,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]};d.forEach(a.fields,function(b){b.name!==
a.objectIdField&&c.fieldInfos.push({fieldName:b.name,visible:!0,label:b.alias,isEditable:!1})});b=new r(c)}return b},enablePopup:function(){this.controlPopupInfo.enablePopup=!0;this.layerObject.infoTemplate=this.controlPopupInfo.infoTemplate},disablePopup:function(){this.controlPopupInfo.enablePopup=!1;this.layerObject.infoTemplate=null},loadInfoTemplate:function(){var a=new h;this.controlPopupInfo.infoTemplate||(this.controlPopupInfo.infoTemplate=this._getDefaultPopupTemplate(this.layerObject));
a.resolve(this.controlPopupInfo.infoTemplate);return a},getInfoTemplate:function(){return this.controlPopupInfo.infoTemplate},_getRelatedTableInfoArray:function(a,b){var c=[],k=a.url.lastIndexOf("/"),h=a.url.slice(0,k);d.forEach(a.relationships,function(a){a=h+"/"+a.relatedTableId.toString();for(var d=0;d<b.length;d++)if(f.getObject("layerObject.url",!1,b[d])&&s.removeProtocol(a.toString().toLowerCase())===s.removeProtocol(b[d].layerObject.url.toString().toLowerCase())){c.push(b[d]);break}},this);
return c},getRelatedTableInfoArray:function(){var a=[],b=new h;if(this.layerObject.relationships){var c,d,k;p.getInstance(this.map,this.map.itemInfo).then(f.hitch(this,function(h){c=h.getTableInfoArray();d=[];h.getLayerInfoArray().forEach(f.hitch(this,function(a){a.traversal(function(a){d.push(a)})}));k=c.concat(d);a=this._getRelatedTableInfoArray(this.layerObject,k);b.resolve(a)}))}else b.resolve(a);return b}});return t})},"esri/dijit/Legend":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/debounce dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dojo/dom-class dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/SimpleLineSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D,v,u,F,C,B,E,G,J,K,N,O,P,L,Q,S,M){var I=d([S,g],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,transparencyRampColor:new l([64,64,64]),defaultText:"Aa",sizeRampLightColor:new l([255,255,255]),sizeRampDarkColor:new l([128,128,128]),gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,
_align:null,_legendAlign:null,constructor:function(b,c){f.mixin(this,M.widgets.legend);this._i18n=M.widgets.legend;b=b||{};b.map?c?(this.map=b.map,this.layerInfos=b.layerInfos,this._respectCurrentMapScale=!1===b.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===b.respectVisibility?!1:!0,this.arrangement=b.arrangement===I.ALIGN_RIGHT?I.ALIGN_RIGHT:I.ALIGN_LEFT,this.arrangement===I.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===b.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend=
{},this.refresh=a(this.refresh,0)):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],n.locale&&-1!==n.locale.indexOf(c)&&(-1!==n.locale.indexOf("-")?-1!==n.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":
"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>k("ie")&&(this._repaintItems=f.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=
a,this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=
null);for(a=this.domNode.children.length-1;0<=a;a--)m.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],h.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):
this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];h.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&
(d=c.getLayers(),h.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),h.forEach(d,function(a){b.push(a.id)},this))},this);h.forEach(this.map.graphicsLayerIds,function(c){var d=this.map.getLayer(c);-1==h.indexOf(a,c)&&-1==h.indexOf(b,c)&&(this._isSupportedLayerType(d)&&d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_activate:function(){this._deactivate();
this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=c.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=c.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=c.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=c.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),h.forEach(this.layers,function(a){a.ovcConnect=c.connect(a,"onVisibilityChange",this,"_refreshLayers");a.ovcConnect=
c.connect(a,"onOpacityChange",this,"_refreshLayers");a.oscConnect=c.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=c.connect(a,"_onDynamicLayersChange",f.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=c.connect(a,"onRenderingChange",f.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===
a.declaredClass&&(a.oivrConnect=c.connect(a,"onRendererChange",f.hitch(this,"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&c.disconnect(this._ozeConnect);this._olaConnect&&c.disconnect(this._olaConnect);this._olroConnect&&c.disconnect(this._olroConnect);this._olrConnect&&c.disconnect(this._olrConnect);h.forEach(this.layers,function(a){a.ovcConnect&&c.disconnect(a.ovcConnect);a.oscConnect&&c.disconnect(a.oscConnect);a.odcConnect&&c.disconnect(a.odcConnect);a.oirConnect&&c.disconnect(a.oirConnect);
a.oivrConnect&&c.disconnect(a.oivrConnect)},this)},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];h.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);h.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&
(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;t.set(this.domNode,"position","relative");m.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var b=[];h.forEach(this.layers,function(d){if("esri.layers.KMLLayer"==d.declaredClass||"esri.layers.GeoRSSLayer"==d.declaredClass){var e;d.loaded?("esri.layers.KMLLayer"==d.declaredClass?e=d.getLayers():"esri.layers.GeoRSSLayer"==d.declaredClass&&
(e=d.getFeatureLayers(),this.hideLayersInLegend[d.id]&&(e=h.filter(e,function(a){return-1==h.indexOf(this.hideLayersInLegend[d.id],a.id)},this))),h.forEach(e,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&d._titleForLegend&&(a._titleForLegend=d._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),b.push(a))},
this)):c.connect(d,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===d.declaredClass)if(d.loaded){if((!this._respectVisibility||this._respectVisibility&&d.visible)&&0<d.layerInfos.length&&h.some(d.layerInfos,function(a){return a.legendURL})){var g=!1;h.forEach(d.layerInfos,function(b){b.legendURL&&-1<h.indexOf(d.visibleLayers,b.name)&&(g||(m.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(d._titleForLegend||d.name||d.id)+"\x3c/span\x3e"},
this.domNode),g=!0),m.create("div",{innerHTML:"\x3cimg src\x3d'"+b.legendURL+"'/\x3e"},this.domNode),a=!0)},this)}}else c.connect(d,"onLoad",f.hitch(this,function(){this.refresh(this.layerInfos)}));else b.push(d)},this);var d=[];h.forEach(b,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=m.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});
m.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},m.create("td",{align:this._align},m.create("tr",{},m.create("tbody",{},m.create("table",{width:"95%"},b)))));m.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):d.push(this._legendRequest(a))}}else var e=c.connect(a,"onLoad",this,function(a){c.disconnect(e);e=null;this.refresh()})},this);0===d.length&&!a?(r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new s(d)).addCallback(f.hitch(this,
function(b){a?r.byId(this.id+"_msg").innerHTML="":r.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?h.forEach(c,function(c,d){if(!this.hideLayersInLegend[a.id]||-1==h.indexOf(this.hideLayersInLegend[a.id],c.id)){var e=this._buildLegendItems(a,c,d);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,
{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(t.set(r.byId(this.id+"_"+a.id),"display","block"),t.set(r.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);c.connect(a,"onLoad",f.hitch(this,"_legendRequest"))},
_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var d=f.hitch(this,"_processLegendResponse"),e={f:"json"};a._params.dynamicLayers&&(e.dynamicLayers=q.stringify(this._createDynamicLayers(a)),"[{}]"===e.dynamicLayers&&(e.dynamicLayers="[]"));a._params.bandIds&&(e.bandIds=a._params.bandIds);a._params.renderingRule?e.renderingRule=a._params.renderingRule:a.rasterFunctionInfos&&0<a.rasterFunctionInfos.length&&
h.forEach(a.rasterFunctionInfos,function(a){a&&(a.name&&"none"===a.name.toLowerCase())&&(e.renderingRule=q.stringify({rasterFunction:a.name}))});return v({url:b,content:e,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:D.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!k("ie")||8<k("ie"))b+="\x26returnbytes\x3dtrue";var c=
f.hitch(this,"_processLegendResponse");return v({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,d){c(a,b,d)},error:D.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,r.byId(this.id+"_"+a.id)&&m.empty(r.byId(this.id+"_"+a.id)),m.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},m.create("td",{align:this._align},m.create("tr",{},m.create("tbody",{},m.create("table",{width:"95%"},r.byId(this.id+"_"+
a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+p.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,e=r.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=m.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==g?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==g?e:r.byId(this.id+"_"+a.id+"_"+g+"_group")),m.create("td",{innerHTML:x.encode(b.name),align:this._align},m.create("tr",{},m.create("tbody",
{},m.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(this._respectVisibility&&a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;c=m.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?e:r.byId(this.id+"_"+a.id+"_"+g+"_group"));m.create("td",{innerHTML:x.encode(b.name)||"",align:this._align},m.create("tr",{},m.create("tbody",{},m.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));
a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,c):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,c))}return d},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,e=this.map.getScale(),g=!1,f=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&
this._isLayerInScale(a,b,e)){var k=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var l=this._getEffectiveScale(a,b);if(l.minScale&&l.minScale<e||l.maxScale&&l.maxScale>e)k=!1}if(k){var e=f(a.legendResponse.layers,b),q=e.legendType,p=e.layerType,s=e.legend;if(s){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,e,b);c=m.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},c);var n=m.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);h.forEach(s,function(c){if(!(10.1<=a.version&&!c.values&&1<s.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version||"Raster Layer"===p))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=!0,this._buildRow_Tools(c,n,a,b.id,q)},this)}}}g&&(t.set(r.byId(this.id+
"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(r.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return g},_sanitizeLegendResponse:function(a,b,c){var d=b.legend;if(10.1<=a.version&&1<d.length&&!b._sanitized){a=f.getObject("layerDefinition.drawingInfo.renderer",!1,c);var e,g;a||(a=f.getObject("drawingInfo.renderer",!1,c));h.some(d,function(a){if(a.values)return!0})&&h.some(d,function(a,b){a.values||(g=b,e=a);return!!e});a?"uniqueValue"===a.type?e&&(d.splice(g,
1),d.push(e)):"classBreaks"===a.type&&(e&&d.splice(g,1),d.reverse(),e&&d.push(e)):e&&(d.splice(g,1),d.push(e));b._sanitized=!0}},_buildRow_Tools:function(a,b,c,d,e){var g=m.create("tr",{},b),f;this.alignRight?(b=m.create("td",{align:this._isRightToLeft?"left":"right"},g),f=m.create("td",{align:this._isRightToLeft?"left":"right",width:35},g)):(f=m.create("td",{width:35,align:"center"},g),b=m.create("td",{},g));g=a.url;(!k("ie")||9<=k("ie")||9>k("ie")&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&
a.imageData&&0<a.imageData.length?g="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(g=c.url+"/"+d+"/images/"+a.url,(d=c._getToken())&&(g+="?token\x3d"+d));d=m.create("img",{src:g,border:0,style:"opacity:"+c.opacity},f);a=m.create("td",{innerHTML:x.encode(a.label),align:this._align},m.create("tr",{},m.create("tbody",{},m.create("table",{width:"95%",dir:"ltr"},b))));e&&("Stretched"===e&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(a.style.verticalAlign=
"top",a.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",b.style.verticalAlign="top");9>k("ie")&&(d.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,b,c){var d;a&&(d=(a=a.getVisualVariablesForType(b,c))&&a[0]);return d},_getVariables:function(a,b,c){a=[this._getVariable(a,"colorInfo",!1),this._getVariable(a,"opacityInfo",!1),this._getVariable(a,"sizeInfo",!1)];return b?h.filter(a,function(a){return!(!a||!(a.field===b&&a.normalizationField==c))}):
a},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),d=f.isFunction(a)?null:b.getField(a),e=c||d,g="";e&&(g=c&&c.label||d&&d.alias||e.name||e.fieldName);return g},_getRampTitle:function(a,b){var c,d=a.field,e=a.normalizationField,g=!1,k=!1,h=!1,m,d=f.isFunction(d)?null:d,e=f.isFunction(e)?null:e;if(a.legendOptions&&a.legendOptions.title)c=a.legendOptions.title;else{if(b.renderer.authoringInfo&&b.renderer.authoringInfo.visualVariables){var l=b.renderer.authoringInfo.visualVariables;
for(m=0;m<l.length;m++){var q=l[m];if("colorInfo"===q.type&&"ratio"===q.style){g=!0;break}else if("colorInfo"===q.type&&"percent"===q.style){k=!0;break}else if("colorInfo"===q.type&&"percentTotal"===q.style){h=!0;break}}}(g=h&&"showRatioPercentTotal"||k&&"showRatioPercent"||g&&"showRatio"||e&&"showNormField"||d&&"showField"||null)&&(c=u.substitute({field:d&&this._getFieldAlias(d,b),normField:e&&this._getFieldAlias(e,b)},this._i18n[g]))}return c},_getRendererTitle:function(a,b){var c;if(a){var d,e,
g;a instanceof E&&(d=a.attributeField,e=a.normalizationField,g="percent-of-total"===a.normalizationType);d=f.isFunction(d)?null:d;(g=(e=f.isFunction(e)?null:e)&&"showNormField"||(g?"showNormPct":null)||d&&"showField"||null)&&(c=u.substitute({field:d&&this._getFieldAlias(d,b),normField:e&&this._getFieldAlias(e,b)},this._i18n[g]))}return c},_buildLegendItems_Renderer:function(a,b,c){var d=b.parentLayerId,e=this.map,g=e.getScale(),k,l=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,g)){var q,
p,s="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?a.renderer.renderer:a.renderer,n,y,v,u,z;if(s instanceof G&&(s=(s="zoom"===s.rangeType?s.getRendererInfoByZoom(e.getZoom()):s.getRendererInfoByScale(g))&&s.renderer,!s))return!1;var w=this._getVariables(s),D=h.filter(w,function(a){return!!a}).length,g=w[0],e=w[1],w=w[2],F,I;g&&(n=this._getMedianColor(s,g),g.field&&(v=f.isFunction(g.field)?null:a.getField(g.field)));e&&e.field&&(z=f.isFunction(e.field)?null:a.getField(e.field));w&&w.field&&
(u=f.isFunction(w.field)?null:a.getField(w.field));if(s instanceof O)k=l=!0,this._showHeatRamp(a,b,s,c);else if(s instanceof J)k=l=!0,this._showDotDensityLegend(a,b,s,c);else if(s instanceof K)k=l=!0,p=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),q=m.create("tbody",{},p),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,a,b),s.latestObservationRenderer&&s.latestObservationRenderer instanceof C&&this._buildRow_Renderer(a,s.latestObservationRenderer.symbol,
n,x.encode(s.latestObservationRenderer.label)||this.NLS_currentObservations,null,q),s.observationRenderer&&s.observationRenderer instanceof C&&this._buildRow_Renderer(a,s.observationRenderer.symbol,n,x.encode(s.observationRenderer.label)||this.NLS_previousObservations,null,q);else if(s instanceof B){if(s.infos&&0<s.infos.length){k=l=!0;p=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);q=m.create("tbody",{},p);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,
a,b);s.attributeField&&w&&this._addSubHeader(q,this._getFieldAlias(s.attributeField,a));var M=[];h.forEach(s.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==d&&(d=b.value);-1===h.indexOf(M,d)&&(M.push(d),this._buildRow_Renderer(a,b.symbol,n,x.encode(d),c,q))},this)}I=this._displayDefaultSymbol(a,s,c)}else if(s instanceof E){if(s.infos&&0<s.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){k=l=!0;F=this._isUnclassedRenderer(s);
!g&&1===s.infos.length&&(y=(y=s.infos[0])&&y.symbol);F||(p=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),q=m.create("tbody",{},p),D=this._getRendererTitle(s,a),this._buildRow_Renderer(a,null,n,x.encode(D),null,q));p=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);q=m.create("tbody",{},p);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,a,b);if(!F||!w)D=s.infos.slice(0).reverse(),h.forEach(D,function(b){var c=
b.label;null==c&&!F&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,n,x.encode(c),null,q)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===N.STYLE_SCALAR||a.renderer.style===N.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,s.defaultSymbol,null,"",null,q),a._hideDefaultSymbol=!0}F||(I=this._displayDefaultSymbol(a,s,c))}else s instanceof C&&(k=l=!0,p=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),
q=m.create("tbody",{},p),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(p,a,b),y=null,a._editable&&(a.templates&&0<a.templates.length)&&(y=a.templates[0]),p=1<D?null:v||z||u,this._buildRow_Renderer(a,s.symbol,n,x.encode(p?this._getRampTitle(1<D?null:g||e||w,a):s.label),y,q),y=g?null:s.symbol,p&&(v=z=u=null));if(k){if(g&&(g.field||g.valueExpression))this._showGradientRamp(a,b,s,null,c,g,v,null,w?!0:!1);if(w&&(w.field||w.valueExpression))k=g||s instanceof B?!1:!0,this._showSizeLegend(a,b,
s,w,n,c,u,null,k);if(e&&(e.field||e.valueExpression))u=y&&!y.url&&y.color?y.color:this.transparencyRampColor,this._showGradientRamp(a,b,s,u,c,e,z,null,!1)}I||(I=this._displayDefaultSymbol(a,s,c));l=l||I}l&&(t.set(r.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(r.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,d)));return l},_isUnclassedRenderer:function(a,b){var c;if(a instanceof E&&a.infos&&1===a.infos.length){c=a.attributeField;var d=a.normalizationField;
c=b?c===b:!!this._getVariables(a,c,d).length}return c},_displayDefaultSymbol:function(a,b,c){var d;!a._hideDefaultSymbol&&b.defaultSymbol&&(d=!0,c=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),c=m.create("tbody",{},c),this._buildRow_Renderer(a,b.defaultSymbol,null,x.encode(b.defaultLabel)||"others",null,c));return d},_showGradientRamp:function(a,b,c,d,e,g,f,k,h){h=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!h?" esriLegendSubFragment":
"")},e);e=m.create("tbody",{},h);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(h,a,b,k);(f||g.valueExpression)&&this._addSubHeader(e,this._getRampTitle(g,a));(b=this._getRampStops(c,g,d))&&b.length&&this._drawGradientRamp(e,b,!0,a,this._getRampBorderColor(c),!!d)},_getMedianColor:function(a,b){var c,d;b.colors?(c=b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c){var d,
e,g,f,k=!1;b.colors||b.opacityValues?(e=b.maxDataValue-b.minDataValue,d=h.map([0,0.25,0.5,0.75,1],function(a){g=b.minDataValue+a*e;return Number(g.toFixed(6))}),this._checkPrecision(0,4,d)):b.stops&&(d=h.map(b.stops,function(a){return a.value}),(k=h.some(b.stops,function(a){return!!a.label}))&&(f=h.map(b.stops,function(a){return a.label})));var m=d[0],q,p,r;e=d[d.length-1]-m;return h.map(d,function(g,h){c?(q=new l(c.toRgba()),p=a.getOpacity(g,{opacityInfo:b}),null!=p&&(q.a=p)):q=a.getColor(g,{colorInfo:b});
r="";0===h?r=this._specialChars.lt+" ":h===d.length-1&&(r=this._specialChars.gt+" ");return{value:g,color:q,offset:1-(g-m)/e,label:k?f[h]:r+F.format(g)}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,e=c[a],g=c[d],f=c[b],k=Math.floor(e),h=Math.floor(g),m=Math.floor(f);k===e&&(m===f&&h!==g&&k!==h&&m!==h)&&(c[d]=h);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof C)b=a.symbol;else if(a instanceof B||a instanceof
E)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawGradientRamp:function(a,b,c,d,e,g){var f=m.create("tr",{},a),q,p,r,s,n,u=b.length-1,v;s=0;this.alignRight?(a=m.create("td",{align:this._isRightToLeft?"left":"right"},f),q=m.create("td",{align:this._isRightToLeft?"left":"right",width:this.gradientWidth},f)):(q=m.create("td",{width:this.gradientWidth,align:"center"},f),a=m.create("td",{},f));f=e&&0<e.a&&!(240<=e.r&&240<=e.g&&240<=e.b);p=m.create("div",
{"class":f?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},q);q=m.create("div",{"class":"esriLegendColorRamp"+(g?" esriLegendTransparencyRamp":"")},p);g=t.get(q,"width");f&&(e=9>k("ie")?e.toHex():"rgba("+e.toRgba().join(",")+")",t.set(q,"border",this.colorRampBorder+" "+e));c?(e=this.gradientHeight*u,t.set(q,"height",e+"px")):e=t.get(q,"height");t.set(p,"height",e+"px");f=y.createSurface(q,g,e);9>k("ie")&&(s=f.getEventSource(),t.set(s,"position","relative"),
t.set(s.parentNode,"position","relative"),s=1);try{c&&h.forEach(b,function(a,b){a.offset=b/u}),n=f.createRect({x:-s,y:-s,width:g+s,height:e+s}),n.setFill({type:"linear",x1:0,y1:0,x2:0,y2:e,colors:b}).setStroke(null),f.createRect({width:g,height:e}).setFill(new l([255,255,255,1-d.opacity])).setStroke(null),this._surfaceItems.push(f)}catch(z){f.clear(),f.destroy()}h.forEach(b,function(a,c){if(a.label){v="top:"+100*a.offset+"%;";var d="";0===c&&(d+=" esriLegendColorRampTickFirst");c===b.length-1&&(d+=
" esriLegendColorRampTickLast");m.create("div",{"class":"esriLegendColorRampTick"+d,innerHTML:"\x26nbsp;",style:v},p)}});r=m.create("div",{"class":"esriLegendColorRampLabels",style:{height:e+this.gradientHeight+"px"}},a);c?h.forEach(b,function(a){m.create("div",{"class":"esriLegendColorRampLabel",innerHTML:x.encode(a.label)||"\x26nbsp;"},r)}):(m.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},r),m.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,
style:"top: "+(e+this.gradientHeight-2*this.gradientHeight)+"px;"},r))},_showHeatRamp:function(a,b,c,d,e){var g,f=c.field;g=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=m.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||e)&&this._createHoverAction(g,a,b,e);(f=f&&a.getField(f))&&this._addSubHeader(d,this._getFieldAlias(f.name,a));b=this._getHeatmapStops(c);b.length&&this._drawGradientRamp(d,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=
a.colors;var c,d,e,g;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else d=b[0].value,e=b[c].value-d,b=h.map(b,function(a){return{color:a.color,ratio:(a.value-d)/e}});else a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=h.map(a,function(a,b){return{color:a,ratio:b*g}}));b=h.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,
b,c,d){var e=c.legendOptions,g,k,q,l,p,r,s,n=this.dotDensitySwatchSize,t=Math.round(n/2);e&&(k=e.backgroundColor,q=e.outline,l=e.valueUnit,p=e.dotCoverage);p=(p||this.dotCoverage)/100;s=Math.round(n*n/Math.pow(c.dotSize,2)*p);d=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);r=m.create("tbody",{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(r,u.substitute({value:c.dotValue,unit:l||""},this.NLS_dotValue));h.forEach(c.fields,
function(b){b=f.mixin({},b);b.numPoints=s;g=new P(c._generateImageSrc(n,n,[b],{x:0,y:0},{x:n,y:n},k),q||c.outline,n,n);b=a.getField(b.name)||b;this._buildRow_Renderer(a,g,null,x.encode(this._getFieldAlias(b.name,a)),null,r,{type:"path",path:"M "+-t+","+-t+" L "+t+","+-t+" L "+t+","+t+" L "+-t+","+t+" L "+-t+","+-t+" E"})},this)},_showSizeLegend:function(a,b,c,d,e,g,f,k,h){var q=d.legendOptions,q=q&&q.customValues;e=this._getSizeSymbol(c,e);if(!(d.valueUnit&&"unknown"!==d.valueUnit||!e||!q&&(null==
d.minSize||null==d.maxSize))){h=m.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"+(!h?" esriLegendSubFragment":"")},g);g=m.create("tbody",{},h);(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(h,a,b,k);(f||d.valueExpression)&&this._addSubHeader(g,this._getRampTitle(d,a));b=q||this._getDataValues(c,e,d);for(f=h=b.length-1;0<=f;f--)k=b[f],e=Q.fromJson(e.toJson()),this._applySize(e,c,d,k),k=F.format(k),q="",f===h?q=this._specialChars.gt+" ":0===f&&(q=this._specialChars.lt+
" "),q="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+x.encode(q+k)+"\x3c/span\x3e",this._buildRow_Renderer(a,e,null,q,null,g)}},_getSizeSymbol:function(a,b){var c,d;if(a instanceof C)c=a.symbol;else if(a instanceof N)c=a.defaultSymbol;else if(a instanceof B||a instanceof E)c=a.infos[0].symbol,d=1<a.infos.length;if(c=c&&-1!==c.type.indexOf("fillsymbol")?null:c)if(c=Q.fromJson(c.toJson()),b||d)-1!==c.type.indexOf("linesymbol")?c.setColor(new l(this.sizeRampDarkColor)):(c.setColor(new l(this.sizeRampLightColor)),
c.setOutline&&(d=new L,d.setColor(new l(this.sizeRampDarkColor)),d.setWidth(1.5),c.setOutline(d)));return c},_getDataValues:function(a,b,c,d,e){d=null==d?5:d;e=null==e?20:e;var g=a.getSizeRangeAtScale(c,this.map.getScale());d=this._interpolateSizeRange(g,d);var f=h.map(d,function(a){return this._getDataValueFromSize(a,c,g)},this),k,m,f=F.round(f);for(k=1;k<f.length-1;k++)if(m=this._roundDataValue(a,b,c,f[k],f[k-1],e))f[k]=m[0],d[k]=m[1];return f},_interpolateSizeRange:function(a,b){var c=a.minSize,
d=(a.maxSize-c)/(b-1),e,g=[];for(e=0;e<b;e++)g.push(c+d*e);return g},_getDataValueFromSize:function(a,b,c){var d=c.minSize;c=c.maxSize;var e=b.minDataValue;b=b.maxDataValue;return a=a<=d?e:a>=c?b:(a-d)/(c-d)*(b-e)+e},_roundDataValue:function(a,b,c,d,e,g){var f=this._getSize(b,a,c,d);e=this._getSize(b,a,c,e);var k,h=F.getDigits(d),m=h.integer,h=h.fractional,q,l,p,r,s,n,t,x,y,u,v;0<d&&1>d&&(k=Math.pow(10,h),d*=k,m=F.getDigits(d).integer);for(m-=1;0<=m&&!(q=Math.pow(10,m),h=Math.floor(d/q)*q,q*=Math.ceil(d/
q),null!=k&&(h/=k,q/=k),l=(h+q)/2,l=F.round([h,l,q],{indexes:[1]})[1],p=this._getSize(b,a,c,h),r=this._getSize(b,a,c,q),s=this._getSize(b,a,c,l),n=F.getPctChange(f,p,e,null),t=F.getPctChange(f,r,e,null),x=F.getPctChange(f,s,e,null),y=n.prev<=g,u=t.prev<=g,y&&u&&(n.prev<=t.prev?(y=!0,u=!1):(u=!0,y=!1)),y?v=[h,p]:u?v=[q,r]:x.prev<=g&&(v=[l,s]),v);m--);return v},_applySize:function(a,b,c,d){var e=a.type;b=this._getSize(a,b,c,d);switch(e){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":e=
a.width;c=a.height;a.setHeight(b);a.setWidth(b*(e/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,d){return b.getSize(d,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,d,e,g,f){var k=m.create("tr",{},g),h;this.alignRight?(g=m.create("td",{align:this._isRightToLeft?"left":"right"},k),b&&(h=m.create("td",{align:this._isRightToLeft?
"left":"right",width:35},k))):(b&&(h=m.create("td",{width:35,align:"center"},k)),g=m.create("td",{},k));var q=k=30,l;if(b){if("simplemarkersymbol"==b.type)k=Math.min(Math.max(k,b.size+12),125),q=Math.min(Math.max(q,b.size+12),125);else if("picturemarkersymbol"==b.type)k=Math.min(Math.max(k,b.width),125),q=Math.min(b.height||q,125);else if("textsymbol"==b.type){var p,r;b.text||(p=b.text,r=!0,b.setText(this.defaultText));k=Math.min(Math.max(k,b.getWidth()+12),125);q=Math.min(Math.max(q,b.getHeight()+
12),125);r&&b.setText(p)}l=m.create("div",{style:"width:"+k+"px;height:"+q+"px;"},h)}u.isDefined(d)&&"number"===typeof d&&(d=""+d);m.create("td",{innerHTML:d||"",align:this._align},m.create("tr",{},m.create("tbody",{},m.create("table",{width:"95%"},g))));b&&(a=this._drawSymbol(l,b,c,k,q,e,a,f),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=m.create("tr",{},a),c=m.create("td",{align:this._align,colspan:2},c);m.create("td",{innerHTML:x.encode(b)||"",align:this._align},m.create("tr",
{},m.create("tbody",{},m.create("table",{width:"95%"},c))))},_drawSymbol:function(a,b,c,d,e,g,h,m){b=Q.fromJson(b.toJson());var q=h.opacity;c&&b.setColor(new l(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=q;b.color.setColor(c)}else"simplemarkersymbol"===b.type||"simplefillsymbol"===b.type?(b.color&&(c=b.color.toRgba(),c[3]*=q,b.color.setColor(c)),b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),
c[3]*=q,b.outline.color.setColor(c))):"picturemarkersymbol"===b.type&&(a.style.opacity=q,a.style.filter="alpha(opacity\x3d("+100*q+"))");a=y.createSurface(a,d,e);9>k("ie")&&(c=a.getEventSource(),t.set(c,"position","relative"),t.set(c.parentNode,"position","relative"));g=this._getDrawingToolShape(b,g)||Q.getShapeDescriptors(b);var p,q=(c=g.defaultShape)&&"text"===c.type;try{q&&!c.text&&(c.text=this.defaultText),p=a.createShape(m||c).setFill(g.fill).setStroke(g.stroke),q&&p.setFont(g.font)}catch(r){a.clear();
a.destroy();return}var s=p.getBoundingBox();m=s.width;g=s.height;var q=-(s.x+m/2),n=-(s.y+g/2);c=a.getDimensions();q={dx:q+c.width/2,dy:n+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)d=h._getScaleMatrix(s,b.size),p.applyTransform(w.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/2}));else if(m>d||g>e)h=m/d>g/e,d=((h?d:e)-5)/(h?m:g),f.mixin(q,{xx:d,yy:d});p.applyTransform(q);return a},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c=
{type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),
stroke:a.getStroke()}},_repaintItems:function(){h.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&f.isArray(a.children)&&h.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,d,e){if(e=b._hoverLabel||b._hoverLabels&&b._hoverLabels[d.id]||e)e=x.encode(e),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[d.id]=
c.connect(a,"onmousemove",f.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(r.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(f.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,r.byId(this.id+"_hoverLabel")){var d=r.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";t.set(d,"top",b+"px");t.set(d,"left",a+15+"px");t.set(d,"display",
"")}else m.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},e)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[d.id]=c.connect(a,"onmouseout",f.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(r.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;h.forEach(this.layers,
function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)c.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)c.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;h.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[d.id]&&(e=a.layerDefinitions[d.id]);e&&(c.definitionExpression=e);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&
(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(t.set(r.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),
this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var e=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,f;for(g=0;g<e.length;g++)if(e[g].id===c&&e[g].subLayerIds)for(f=0;f<e[g].subLayerIds.length;f++){var k=e[g].subLayerIds[f];-1===h.indexOf(d,k)&&(d.push(k),b(k,d))}}a.layer.layerInfos&&h.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&
a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var f,k;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(f=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(k=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(f=Math.min(a.minScale,g.minScale)||a.minScale||g.minScale,k=Math.max(a.maxScale,g.maxScale));if(0<f&&f<c||k>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<
c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):
b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],u.isDefined(a)&&(b+=" ("+a+")"));return x.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(u.isDefined(b.parentLayerId)){var e=a.layerInfos,g=b.parentLayerId,f;for(f=e.length-1;0<=f;f--)if(e[f].id==
g)if(0==c&&0<e[f].minScale?c=e[f].minScale:0<c&&0==e[f].minScale||0<c&&0<e[f].minScale&&(c=Math.min(c,e[f].minScale)),d=Math.max(d||0,e[f].maxScale||0),-1<e[f].parentLayerId)g=e[f].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===
a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});f.mixin(I,{ALIGN_LEFT:0,ALIGN_RIGHT:1});return I})},"dojo/debounce":function(){define([],function(){return function(n,d){var f;return function(){f&&clearTimeout(f);var h=this,c=arguments;f=setTimeout(function(){n.apply(h,
c)},d)}}})},"esri/numberUtils":function(){define(["dojo/has","dojo/number","dojo/i18n!dojo/cldr/nls/number","./kernel"],function(n,d,f,h){var c=function(c,a){return c-a},p={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var a=String(c),d=a.match(p._reNumber);c={integer:0,fractional:0};d&&d[1]?(c.integer=d[1].split("").length,c.fractional=d[3]?d[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(d=a.split("e"),a=d[0],d=d[1],a&&d&&(a=Number(a),d=Number(d),(c=0<d)||(d=Math.abs(d)),a=p.getDigits(a),
c?(a.integer+=d,a.fractional=d>a.fractional?0:a.fractional-d):(a.fractional+=d,a.integer=d>a.integer?1:a.integer-d),c=a));return c},getFixedNumbers:function(c,a){var d,b;d=Number(c.toFixed(a));d<c?b=d+1/Math.pow(10,a):(b=d,d-=1/Math.pow(10,a));d=Number(d.toFixed(a));b=Number(b.toFixed(a));return[d,b]},getPctChange:function(c,a,d,b){var f={prev:null,next:null},h;null!=d&&(h=c-d,d=a-d-h,f.prev=Math.floor(Math.abs(100*d/h)));null!=b&&(h=b-c,d=b-a-h,f.next=Math.floor(Math.abs(100*d/h)));return f},round:function(d,
a){var f=d.slice(0),b,h,q,r,m,n,e,g,y,w=!a||null==a.tolerance?2:a.tolerance,x=a&&a.indexes,z=!a||null==a.strictBounds?!1:a.strictBounds;if(x)x.sort(c);else{x=[];for(n=0;n<f.length;n++)x.push(n)}for(n=0;n<x.length;n++)if(y=x[n],b=f[y],h=0===y?null:f[y-1],q=y===f.length-1?null:f[y+1],r=p.getDigits(b),r=r.fractional){e=0;for(g=!1;e<=r&&!g;)m=p.getFixedNumbers(b,e),m=z&&0===n?m[1]:m[0],g=p.hasMinimalChange(b,m,h,q,w),e++;g&&(f[y]=m)}return f},hasMinimalChange:function(c,a,d,b,f){c=p.getPctChange(c,a,
d,b);a=null==c.prev||c.prev<=f;d=null==c.next||c.next<=f;return a&&d||c.prev+c.next<=2*f},_reAllZeros:RegExp("\\"+f.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$","g"),format:function(c,a){a=a||{places:20,round:-1};var f=d.format(c,a);f&&(f=f.replace(p._reSomeZeros,"$1").replace(p._reAllZeros,""));return f}};return p})},"jimu/LayerInfos/LayerInfoForGeoRSS":function(){define(["dojo/_base/declare","dojo/_base/array","esri/graphicsUtils","./LayerInfo","./LayerInfoFactory"],function(n,d,f,h,c){return n(h,
{constructor:function(){},getExtent:function(){var c=this.layerObject.items;if(0===c.length)return null;c=f.graphicsExtent(c);return this._convertGeometryToMapSpatialRef(c)},_resetLayerObjectVisiblityBeforeInit:function(){this._layerOption&&(d.forEach(this.newSubLayers,function(c){c._layerOption&&c.layerObject.setVisibility(c._layerOption.visible)},this),this._setTopLayerVisible(this._layerOption.visible))},initVisible:function(){var c=!1,d;for(d=0;d<this.newSubLayers.length;d++)c=c||this.newSubLayers[d].layerObject.visible;
c&&(this._visible=!0)},_setTopLayerVisible:function(c){this._visible=c?!0:!1;d.forEach(this.newSubLayers,function(c){c.setLayerVisiblefromTopLayer()},this);this._onVisibilityChanged()},obtainNewSubLayers:function(){var f=[],h=this.layerObject.getFeatureLayers();d.forEach(h,function(a){a=c.getInstance().create({layerObject:a,title:a.label||a.title||a.name||a.id||" ",id:a.id||" ",collection:{layerInfo:this},selfType:"geo_rss",parentLayerInfo:this});f.push(a);a.init()},this);return f},_obtainLayerIndexesInMap:function(){var c=
[],d,a;for(a=0;a<this.newSubLayers.length;a++)(d=this._getLayerIndexesInMapByLayerId(this.newSubLayers[a].layerObject.id))&&c.push(d);return c},moveLeftOfIndex:function(c){var d;for(d=this.newSubLayers.length-1;0<=d;d--)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)},moveRightOfIndex:function(c){var d;for(d=0;d<this.newSubLayers.length;d++)this.map.reorderLayer(this.newSubLayers[d].layerObject,c)}})})},"jimu/LayerInfos/LayerInfoForWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/topic dojo/Deferred esri/graphicsUtils dojo/aspect ./LayerInfo ./LayerInfoForDefaultWMS ./LayerInfoFactory esri/layers/FeatureLayer esri/lang".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){return n(a,{constructor:function(a,b,c){this._layerOptions=c.layerOptions?c.layerOptions:null},getExtent:function(){return this._convertGeometryToMapSpatialRef(this.originOperLayer.layerObject.extent)},_resetLayerObjectVisiblityBeforeInit:function(){if(this._layerOptions){this._layerOption&&this.layerObject.setVisibility(this._layerOption.visible);var a=[],b=!1;d.forEach(this.layerObject.layerInfos,function(c){var d=this.id+"_"+c.name;q.isDefined(this._layerOptions[d])&&
(b=!0,this._layerOptions[d].visible&&a.push(c.name))},this);if(0<a.length||b)this.layerObject.setVisibleLayers(a),this.traversal(function(a){a.initVisible()})}},initVisible:function(){this._visible=this.layerObject.visible},_setTopLayerVisible:function(a){this.layerObject.setVisibility(a);this._visible=a},setSubLayerVisible:function(a){var b=[],c,b=f.clone(this.originOperLayer.layerObject.visibleLayers),e;for(e in a)if(a.hasOwnProperty(e)&&"function"!==typeof a[e]){var g=a[e],k=e.toString();c=d.indexOf(b,
k);g?0>c&&b.push(k):0<=c&&b.splice(c,1)}this.originOperLayer.layerObject.setVisibleLayers(b)},obtainNewSubLayers:function(){var a=[];d.forEach(this.layerObject.layerInfos,function(c,d){var e;e=b.getInstance().create({layerObject:this.layerObject,title:c.label||c.title||c.name||" ",id:this.id+"_"+(c.name||" "),wms:{layerInfo:this,subId:c.name,wmsLayerInfo:c},selfType:"wms",parentLayerInfo:this});a.push(e);e.init()},this);return a},_bindEvent:function(){this.inherited(arguments);this.layerObject&&!this.layerObject.empty&&
l.after(this.layerObject,"setVisibleLayers",f.hitch(this,this._onVisibleLayersChanged))},_onVisibleLayersChanged:function(){var a=[];this.traversal(function(b){b.initVisible();a.push(b)});h.publish("layerInfos/layerInfo/visibleChanged",a);this._isShowInMapChanged2()}})})},"jimu/LayerInfos/LayerInfoForDefaultWMS":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/_base/html dojo/dom-construct dojo/on ./LayerInfoForDefault".split(" "),function(n,d,f,h,c,p,l){return n(l,{constructor:function(a,
c){this.layerObject=a.layerObject},getExtent:function(){},_resetLayerObjectVisiblityBeforeInit:function(){},initVisible:function(){var a=[],a=!1,a=f.clone(this.originOperLayer.layerObject.visibleLayers);this._visible=a=0<=d.indexOf(a,this.originOperLayer.wms.subId)?!0:!1},_setTopLayerVisible:function(a){var c=this.originOperLayer.wms;this._visible=a?!0:!1;var b={};b[c.subId]=a;c.layerInfo.setSubLayerVisible(b)},drawLegends:function(a){this._initLegendsNode(a)},_initLegendsNode:function(a){if(this.originOperLayer.wms.wmsLayerInfo.legendURL){var d=
c.create("img",{"class":"legend-div-image",src:this.originOperLayer.wms.wmsLayerInfo.legendURL});p(d,"load",function(){c.empty(a);var b=c.create("div",{"class":"legend-div"},a);h.place(d,b)})}else c.empty(a)},obtainNewSubLayers:function(){return[]},getOpacity:function(){},setOpacity:function(a){},_bindEvent:function(){},_onVisibleLayersChanged:function(){}})})},"jimu/LayerInfos/LayerInfoForGroup":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred esri/request ./LayerInfo ./LayerInfoFactory".split(" "),
function(n,d,f,h,c,p,l){return n(p,{constructor:function(a,c,b,d){this.noLegend=d},getExtent:function(){},initVisible:function(){var a=!1,c=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<c.layerInfo.subLayerVisible[c.subId]&&(a=!0);this._visible=a},_setTopLayerVisible:function(a){var c;if(this.originOperLayer.mapService&&(c=this.originOperLayer.mapService,0<this.originOperLayer.subLayers.length)){a?c.layerInfo.subLayerVisible[c.subId]++:c.layerInfo.subLayerVisible[c.subId]--;this._visible=
a;var b={};this.traversal(function(a){0===a.getSubLayers().length&&(b[a.originOperLayer.mapService.subId]=a.isVisbleOrInvisilbe())});c.layerInfo.setSubLayerVisible(b)}},setLayerVisiblefromTopLayer:function(){},_visibleChanged:function(a){},_sevVisible:function(a){this.visible=a},obtainNewSubLayers:function(){var a=[];d.forEach(this.originOperLayer.subLayers,function(c){c.parentLayerInfo=this;c=l.getInstance().create(c);a.push(c);c.init()},this);return a},getOpacity:function(){},setOpacity:function(a){},
getLayerObject:function(){var a=new h;this.layerObject.empty?c({url:this.layerObject.url,handleAs:"json",callbackParamName:"callback",timeout:1E5,content:{f:"json"}}).then(f.hitch(this,function(c){var b=this.layerObject.url;this.layerObject=c;this.layerObject.url=b;this.layerObject.id=this.id;a.resolve(this.layerObject)}),function(c){a.reject(c)}):a.resolve(this.layerObject);return a},getLayerType:function(){var a=new h;a.resolve("GroupLayer");return a},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)}})})},
"jimu/LayerInfos/LayerInfoForDefaultDynamic":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,d){return n(d,{constructor:function(d,h){},initVisible:function(){var d=!1,h=this.originOperLayer.mapService;this.originOperLayer.mapService&&0<h.layerInfo.subLayerVisible[h.subId]&&(d=!0);this._visible=d},_setTopLayerVisible:function(d){var h;this.originOperLayer.mapService&&(h=this.originOperLayer.mapService,d?h.layerInfo.subLayerVisible[h.subId]++:h.layerInfo.subLayerVisible[h.subId]--,
this._visible=d,this.visbleOrInvisilbe())},visbleOrInvisilbe:function(){var d=this.originOperLayer.mapService,h={};h[d.subId]=this.isVisbleOrInvisilbe();d.layerInfo.setSubLayerVisible(h)},isVisbleOrInvisilbe:function(){for(var d=this.originOperLayer.mapService,h=-1,c=d.subId,p=0;;){h++;p+=d.layerInfo.subLayerVisible[c];c=d.layerInfo._getJsapiLayerInfoById(c);if(-1===c.parentLayerId)return p>h?!0:!1;c=c.parentLayerId}}})})},"jimu/LayerInfos/LayerInfoForDefaultService":function(){define("dojo/_base/declare dojo/_base/array dojo/_base/lang dojo/Deferred dojo/dom-construct dojo/promise/all ./LayerInfoForDefault ./LayerInfos esri/layers/FeatureLayer esri/layers/RasterLayer".split(" "),
function(n,d,f,h,c,p,l,a,k,b){return n(l,{_legendsNode:null,_resetLayerObjectVisiblityBeforeInit:function(){},_loadLegends:function(a){var b=new h;this.originOperLayer.mapService.layerInfo.getLegendInfo(a).then(f.hitch(this,function(a){b.resolve(a)}));return b},drawLegends:function(a,b){this._loadLegends(b).then(f.hitch(this,function(b){this._initLegendsNode(b,a)}))},_initLegendsNode:function(a,b){var f=this.originOperLayer.mapService;if(a){c.empty(b);for(var k=null,h=0;h<a.length;h++)if(a[h].layerId===
f.subId){k=a[h];break}if(k){var e=c.create("table",{"class":"legend-table",style:"font-size: 12px"},b);d.forEach(k.legend,function(a){if("\x3call other values\x3e"!==a.label){var b=c.create("tr",{"class":"legend-tr",style:"border: 1px solid"},e),d=c.create("td",{"class":"legend-symbol-td",style:""},b),f=null,f=a.imageData?"data:"+a.contentType+";base64,"+a.imageData:a.url;c.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;top:0;left:0;bottom:0;right:0",src:f},d);c.create("td",
{"class":"legend-label-td",innerHTML:a.label||" ",style:"padding-left: 5px"},b)}},this)}}},_initControlPopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo={enablePopup:a.infoTemplates&&a.infoTemplates[b]?!0:!1,infoTemplates:void 0}},_afterSetInfoTemplates:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;!this.controlPopupInfo.enablePopup&&a.infoTemplates&&
delete a.infoTemplates[b]},_getShowLegendOfWebmap:function(){return this.originOperLayer.mapService.layerInfo._getSublayerShowLegendOfWebmap(this.originOperLayer.mapService.subId)},getLayerObject:function(){var a=new h;this.getLayerType().then(f.hitch(this,function(c){this.layerObject.empty?(this.layerObject="RasterLayer"===c?new b(this.layerObject.url):new k(this.layerObject.url),this.layerObject.on("load",f.hitch(this,function(){this.layerObject.id=this.id;a.resolve(this.layerObject)})),this.layerObject.on("error",
f.hitch(this,function(){a.resolve(null)}))):this.layerObject.loaded?a.resolve(this.layerObject):(this.layerObject.on("load",f.hitch(this,function(){a.resolve(this.layerObject)})),this.layerObject.on("error",f.hitch(this,function(){a.resolve(null)})))}),f.hitch(this,function(){a.resolve(null)}));return a},getPopupInfo:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var c=0;c<b.length;c++)if(b[c].id===this.originOperLayer.mapService.subId){a=b[c].popupInfo;
break}return a},getFilterOfWebmap:function(){var a=null,b=this.originOperLayer.mapService.layerInfo.originOperLayer.layers;if(b)for(var c=0;c<b.length;c++)if(b[c].id===this.originOperLayer.mapService.subId){a=b[c].layerDefinition?b[c].layerDefinition.definitionExpression:null;break}return a},getLayerType:function(){var a=new h,b=this.originOperLayer.mapService;b.layerInfo._getSublayerDefinition(b.subId).then(f.hitch(this,function(b){b?a.resolve(b.type.replace(/\ /g,"")):a.resolve(null)}),function(){a.resolve(null)});
return a},getSupportTableInfo:function(){var a=new h,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null};this.getLayerType().then(f.hitch(this,function(c){b.layerType=c;0<=this._getLayerTypesOfSupportTable().indexOf(c)&&(b.isSupportedLayer=!0);c=this.originOperLayer.mapService;c.layerInfo._getSublayerDefinition(c.subId).then(f.hitch(this,function(c){c&&0<=c.capabilities.indexOf("Data")&&(b.isSupportQuery=!0);a.resolve(b)}),function(){a.resolve(b)})}),function(){a.resolve(b)});return a},enablePopup:function(){var a=
this.originOperLayer.mapService.layerInfo,b=a.layerObject,c=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!0;a.controlPopupInfo.infoTemplates&&(b.infoTemplates||(b.infoTemplates={}),b.infoTemplates[c]=a.controlPopupInfo.infoTemplates[c])},disablePopup:function(){var a=this.originOperLayer.mapService.layerInfo.layerObject,b=this.originOperLayer.mapService.subId;this.controlPopupInfo.enablePopup=!1;a.infoTemplates&&delete a.infoTemplates[b]},loadInfoTemplate:function(){var a=
new h,b=this.originOperLayer.mapService.layerInfo,c=this.originOperLayer.mapService.subId;b.controlPopupInfo.infoTemplates&&b.controlPopupInfo.infoTemplates[c]?a.resolve(b.controlPopupInfo.infoTemplates[c]):(b.controlPopupInfo.infoTemplates||(b.controlPopupInfo.infoTemplates={}),b._getSublayerDefinition(c).then(f.hitch(this,function(d){d=this._getDefaultPopupTemplate(d);b.controlPopupInfo.infoTemplates[c]={infoTemplate:d,layerUrl:null};a.resolve(d)}),f.hitch(this,function(){a.resolve(null)})));return a},
getInfoTemplate:function(){var a=this.originOperLayer.mapService.layerInfo,b=this.originOperLayer.mapService.subId;return a.controlPopupInfo.infoTemplates&&a.controlPopupInfo.infoTemplates[b]&&a.controlPopupInfo.infoTemplates[b].infoTemplate?a.controlPopupInfo.infoTemplates[b].infoTemplate:null},getRelatedTableInfoArray:function(){var b=[],c=new h,d=this.getLayerObject(),k=a.getInstance(this.map,this.map.itemInfo);p({layerObject:d,layerInfos:k}).then(f.hitch(this,function(a){if(a.layerObject&&a.layerObject.relationships){var d,
g=[];this.originOperLayer.mapService.layerInfo.traversal(function(a){g.push(a)});d=a.layerInfos.getTableInfoArray().concat(g);b=this._getRelatedTableInfoArray(a.layerObject,d)}c.resolve(b)}));return c},_onVisibilityChanged:function(){}})})},"esri/layers/RasterLayer":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/sniff dojo/dom-construct dojo/dom-style dojo/number ../lang ../domUtils ./layer ./ImageServiceLayerMixin ../SpatialReference ../geometry/Point".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m){return n([s,q],{declaredClass:"esri.layers.RasterLayer",managedSuspension:!0,constructor:function(a,b){this.drawMode=b&&void 0!==b.drawMode?b.drawMode:!0;this.drawType=b&&b.drawType?b.drawType:"2d";this._initialize(a,b);(null===this.format||void 0===this.format)&&this.setImageFormat("LERC",!0)},opacity:1,setDrawMode:function(a){this.drawMode=a},setOpacity:function(a){if(this.opacity!=a)this.onOpacityChange(this.opacity=a)},onOpacityChange:function(){},refresh:function(){if(!this._canDraw()||
10>c("ie"))this.onError(Error("Unable to refresh. This layer is not supported in the current browser."));else this._map&&this._extentChangeHandler(this._map.extent)},clear:function(){this._canDraw()&&"2d"===this.drawType&&this._context.clearRect(0,0,this._mapWidth,this._mapHeight)},getContext:function(){return this._context},onResume:function(){this.inherited(arguments);this._toggleTime();this._displayTimer=this._displayTimer||setTimeout(d.hitch(this,function(){this._extentChangeHandler(this._map.extent,
null,!0)}),0)},onSuspend:function(){this.inherited(arguments);this._toggleTime();clearTimeout(this._displayTimer);this._displayTimer=null},_setMap:function(a,b){this.inherited(arguments);var c=this._canvas=p.create("canvas",{id:"canvas",width:a.width+"px",height:a.height+"px",style:"position: absolute; left: 0px; top: 0px;"},b);k.isDefined(this.opacity)&&l.set(c,"opacity",this.opacity);(this._context=c.getContext(this.drawType))||console.error("Unable to create the context. This browser might not support \x3ccanvas\x3e elements.");
this._mapWidth=a.width;this._mapHeight=a.height;this._connects=[];this._connects.push(f.connect(a,"onPan",this,this._panHandler));this._connects.push(f.connect(a,"onPanEnd",this,this._panEndHandler));this._connects.push(f.connect(a,"onZoom",this,this._onZoomHandler));this._connects.push(f.connect(a,"onZoomEnd",this,this._onZoomEndHandler));this._connects.push(f.connect(a,"onResize",this,this._onResizeHandler));this._connects.push(f.connect(a,"onExtentChange",this,this._extentChangeHandler));this._connects.push(f.connect(this,
"onVisibilityChange",this,this._visibilityChangeHandler));this._connects.push(f.connect(this,"onOpacityChange",this,this._opacityChangeHandler));this._startRect={left:0,top:0,width:a.width,height:a.height};this.evaluateSuspension();if(this.suspended&&!a.loaded)var d=f.connect(a,"onLoad",this,function(){f.disconnect(d);d=null;this.evaluateSuspension()});return c},_unsetMap:function(a,b){h.forEach(this._connects,f.disconnect,this);this._canvas&&b.removeChild(this._canvas);this._map=this._canvas=this._context=
this.data=this._connects=null;clearTimeout(this._displayTimer);this._displayTimer=null;this.inherited(arguments)},_canDraw:function(){return this._map&&this._canvas&&this._context?!0:!1},_requestDataErrorHandler:function(a){"CancelError"!==a.name&&(this.clear(),this.onError(a))},_drawPixelData:function(){l.set(this._canvas,{left:"0px",top:"0px",width:this._map.width+"px",height:this._map.height+"px"});this._startRect={left:0,top:0,width:this._map.width,height:this._map.height};if(this._canDraw&&this.drawMode)if(this._useBrowserDecoding())this._fireUpdateEnd();
else if(this.drawMode)if(!this.pixelData||!this.pixelData.pixelBlock)this.clear();else{var a=this.pixelData.pixelBlock,b=this._context,c=b.createImageData(a.width,a.height);c.data.set(a.getAsRGBA());b.putImageData(c,0,0);this._fireUpdateEnd()}},_panHandler:function(a,b){l.set(this._canvas,{left:this._startRect.left+b.x+"px",top:this._startRect.top+b.y+"px"})},_panEndHandler:function(a,b){b&&(this._startRect.left+=b.x,this._startRect.top+=b.y)},_onZoomHandler:function(a,b,c){var d=this._startRect;
a=d.width*b;b*=d.height;var f=d.left-(a-d.width)*(c.x-d.left)/d.width;c=d.top-(b-d.height)*(c.y-d.top)/d.height;l.set(this._canvas,{left:f+"px",top:c+"px",width:a+"px",height:b+"px"});this._endRect={left:f,top:c,width:a,height:b}},_onZoomEndHandler:function(){this._endRect&&(this._startRect=this._endRect)},_onResizeHandler:function(a,b,c){l.set(this._canvas,{width:b+"px",height:c+"px"});this._startRect.width=this._canvas.width=b;this._startRect.height=this._canvas.height=c},_extentChangeHandler:function(a,
b,c,d){this.suspended||(this._fireUpdateStart(),a=this._map,this._requestData(a.extent,a.width,a.height))},_visibilityChangeHandler:function(a){a?b.show(this._canvas):b.hide(this._canvas)},_opacityChangeHandler:function(a){l.set(this._canvas,"opacity",a)}})})},"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D,v,u,F,C,B,E,G,J){return n(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,b){this.useMapTime=b&&b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0},_initialize:function(a,b){this._url=t.urlToObject(a);this.raster=new D(a);this.infoTemplate=b&&b.infoTemplate;var c=b&&b.imageServiceParameters;
this.format=c&&c.format;this.compressionTolerance=c&&c.compressionTolerance?c.compressionTolerance:0.01;this.interpolation=c?c.interpolation:null;this.compressionQuality=c?c.compressionQuality:null;this.bandIds=c?c.bandIds:null;this.mosaicRule=c?c.mosaicRule:null;this.renderingRule=c?c.renderingRule:null;this.useMapDimensionValue=b&&b.hasOwnProperty("useMapDimensionValue")?!!b.useMapDimensionValue:!0;this.activeMapDimensions=b&&b.activeMapDimensions;this._params=d.mixin({},this._url.query,{f:"image",
interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},c?c.toJson():{});this.pixelFilter=b&&b.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=d.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=d.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=d.hitch(this,this._initLayer);this._queryVisibleRastersHandler=
d.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=b&&b.loadCallback;(c=b&&b.resourceInfo)?this._initLayer(c):r({url:this._url.path,content:d.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,
b){if(!(null===a||void 0===a)){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var c=this.minScale,g=this.maxScale;d.mixin(this,a);this.minScale=c;this.maxScale=g;this.initialExtent=this.fullExtent=this.extent=new e(a.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var f=this.minValues,k=this.maxValues,h=this.meanValues,m=this.stdvValues,l=this.bands=
[],c=0,g=this.bandCount;c<g;c++)l[c]={min:f[c],max:k[c],mean:h[c],stddev:m[c]};this.timeInfo=(c=this.timeInfo)&&c.timeExtent?new C(c):null;g=this.fields=[];if(f=a.fields)for(c=0;c<f.length;c++)g.push(new B(f[c]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:9.3);q.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);q.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);c={};a.defaultMosaicMethod?(c.method=
a.defaultMosaicMethod,c.operation=a.mosaicOperator,c.sortField=a.sortField,c.sortValue=a.sortValue):c.method=w.METHOD_NONE;this.defaultMosaicRule=new w(c);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&this._setDefaultMultidimensionalDefinition(!0);
10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(d.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=d.clone(a.fields))}));this._isVectorData()&&!q.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new u,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,
this.getKeyProperties().then(d.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(c=this._loadCallback)delete this._loadCallback,c(this)}},getKeyProperties:function(){var a=this._url.path+"/keyProperties",b=new f(m._dfdCanceller);10<this.version?(b._pendingDfd=r({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(a){b.callback(a)},function(a){b.errback(a)})):(a=Error("Layer does not have key properties"),a.log=p.isDebug,b.errback(a));
return b},getRasterAttributeTable:function(a){var b=this._url.path+"/rasterAttributeTable",d=new f(m._dfdCanceller),e={f:"json"},g=this.hasRasterAttributeTable;a&&a.renderingRule&&(e.renderingRule=c.toJson(a.renderingRule.toJson()),g=!0);10<this.version&&g?(d._pendingDfd=r({url:b,content:e,handleAs:"json",callbackParamName:"callback"}),d._pendingDfd.then(function(a){d.callback(a)},function(a){d.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=p.isDebug,d.errback(a));return d},
_getRenderingRuleAttributeTable:function(a){var b=new f(m._dfdCanceller);if(!a||!a.renderingRule)return b.errback(Error("Rendering rule is not specified")),b;a=a.renderingRule;var c=a.functionName;this._renderingRuleAttributeTable&&c&&this._renderingRuleAttributeTable.hasOwnProperty(c)?b.resolve(this._renderingRuleAttributeTable[c]):b=this.getRasterAttributeTable({renderingRule:a}).then(d.hitch(this,function(a){var b;a&&(a.features&&a.features.length&&a.fields&&a.fields.length)&&(b={features:d.clone(a.features),
fields:d.clone(a.fields)},c&&(this._renderingRuleAttributeTable[c]=b));return b}));return b},_getRasterAttributeTableFeatures:function(){var a=new f;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(d.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=d.clone(a.features))})),
a;a.resolve(this._rasterAttributeTableFeatures);return a},_getRenderingRuleAttributeTableFeatures:function(a){a=a&&a.renderingRule;return!a?(a=new f,a.errback(Error("Rendering rule is not specified")),a):this._getRenderingRuleAttributeTable({renderingRule:a}).then(function(a){return a&&a.features})},getCustomRasterFields:function(a){var b=a?a.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;a=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var c={name:this._rasterFieldPrefix+
"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:a},e={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:a},g={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},f=this.fields?d.clone(this.fields):[];a=f.length;f[a]=e;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||
!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))a++,f[a]=g;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a++,f[a]=c;if(q.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))c={name:this._rasterFieldPrefix+"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},e={name:this._rasterFieldPrefix+
"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},a++,f[a]=c,a++,f[a]=e;a=this._rasterAttributeTableFields;if((c=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(c))a=this._renderingRuleAttributeTable[c].fields;a&&0<a.length&&(a=h.filter(a,function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),a=h.map(a,function(a){var c=d.clone(a);c.name=b+a.name;return c}),
f=f.concat(a));var k=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&h.forEach(this.rasterFunctionInfos,function(a){a&&(a.name&&"none"!==a.name.toLowerCase())&&(a={name:k+a.name.replace(/ /gi,"_"),alias:a.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},f.push(a))});return f},_prepareGetImageParameters:function(a,b,e,g){g=q.isDefined(g)?g:this._params;var f=a.spatialReference.wkid||c.toJson(a.spatialReference.toJson(!1));delete g._ts;
d.mixin(g,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:f,bboxSR:f,size:b+","+e},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete g.compressionTolerance;g.format&&"LERC"===g.format.toUpperCase()&&(g.compressionTolerance=this.compressionTolerance);g.token=this._getToken()},getImageUrl:function(a,b,c,e,g){g=q.isDefined(g)?g:this._params;this._prepareGetImageParameters(a,b,c,g);a=d.clone(g);this._cleanupRequestParams(a);b=this._url.path+"/exportImage?";c=t.addProxy(b+k.objectToQuery(d.mixin(a,
{f:"image"})));var f=a.token;c.length>s.defaults.io.postLength||this.useMapImage?this._jsonRequest=r({url:b,content:d.mixin(a,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;f&&(c+=-1===c.indexOf("?")?"?token\x3d"+f:"\x26token\x3d"+f);e(t.addProxy(c))},error:this._errorHandler}):e(c)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,b){this.interpolation=this._params.interpolation=a;b||this.refresh(!0)},setCompressionQuality:function(a,
b){this.compressionQuality=this._params.compressionQuality=a;b||this.refresh(!0)},setCompressionTolerance:function(a,b){this.compressionTolerance=a;b||this.refresh(!0)},setBandIds:function(a,b){var c=!1;this.bandIds!==a&&(c=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(c&&!b)this.onRenderingChange();b||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,
b){var d=!1;this.mosaicRule!==a&&(d=!0);this.mosaicRule=a;this._params.mosaicRule=c.toJson(a.toJson());if(d&&!b)this.onMosaicRuleChange();b||this.refresh(!0)},setRenderingRule:function(a,b){var d=!1;this.renderingRule!==a&&(d=!0);this.renderingRule=a;this._params.renderingRule=a?c.toJson(a.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:a});if(d&&!b)this.onRenderingChange();b||this.refresh(!0)},setImageFormat:function(a,b){this.format=this._params.format=
a;b||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,b){var c=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?c=this.defaultMosaicRule.toJson():c.method=w.METHOD_NONE);c.where=a;c=new w(c);this.setMosaicRule(c,b);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},setPixelFilter:function(a){this.pixelFilter=a},getPixelData:function(a){return a?(this._useBrowserDecoding()&&
(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(a,b,c,e){var k=this._map,q=m._fixDfd(new f(m._dfdCanceller));this._visibleRasters=[];var l,p,r=!0,s=this.infoTemplate?this.infoTemplate.info:null,n=s?d.clone(this.infoTemplate.info.fieldInfos):null;if(this.infoTemplate.info.mediaInfos&&
this.infoTemplate.info.mediaInfos.length){var t=[];h.forEach(this.infoTemplate.info.mediaInfos,function(a){t=t.concat(a&&a.value&&a.value.fields||[])});t.length&&h.forEach(n,function(a){a&&-1<t.indexOf(a.fieldName)&&(a.visible=!0)})}if(n&&0<n.length){r=!1;for(l=0;l<n.length;l++)if((p=n[l])&&p.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+"servicepixelvalue"&&(p.visible||s.title&&-1<s.title.toLowerCase().indexOf(p.fieldName.toLowerCase()))){r=!0;break}}var u=(p=this._removeVisualizationStretchFunction(this.renderingRule))&&
p.functionName,y=[];if(10.4<=this.version){var v=!1;if(this.rasterFunctionInfos&&n){var z=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(this.rasterFunctionInfos,function(a){var b=z+a.name.replace(/ /gi,"_");h.some(n,function(a){return a.visible&&a.fieldName===b})&&(v=v||u&&u===a.name,y.push(new x({rasterFunction:a.name})))})}p&&!v&&y.push(p)}l=new J;l.geometry=a.geometry;l.returnGeometry=this._map.spatialReference.equals(this.spatialReference);l.returnCatalogItems=r;l.timeExtent=
a.timeExtent;l.mosaicRule=this.mosaicRule||null;l.renderingRule=10.4>this.version&&p||null;l.renderingRules=y||null;k&&(a=new g((k.extent.xmax-k.extent.xmin)/(2*k.width),(k.extent.ymax-k.extent.ymin)/(2*k.height),k.extent.spatialReference),l.pixelSize=a);b.requestParams=l;var w=this;a=new G(this.url);(q._pendingDfd=a.execute(l)).addCallbacks(function(a){w._queryVisibleRastersHandler(a,b,c,e,q)},function(a){w._resolve([a],null,e,q,!0)});return q},_queryVisibleRastersHandler:function(a,b,g,f,k){function m(){var a=
this.getCustomRasterFields(b),c=this._getDomainFields(a),f=b?b.returnDomainValues:!1,r=b&&b.rasterAttributeTableFieldPrefix,t,x,u,y,z,w,D,B,F,K;this._useRenderingRuleAttributeTable&&this.renderingRule?(a=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),K=l):a=this._getRasterAttributeTableFeatures();a.then(d.hitch(this,function(a){for(t=0;t<n.length;t++){R=n[t];R.setInfoTemplate(this.infoTemplate);R._layer=this;if(l){F=l.replace(/ /gi,"").split(",");x=l;u=F;s&&s.length>=
t&&(x=s[t].replace(/ /gi,", "),u=s[t].split(" "));R.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=u;R.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=F;p&&(R.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=p.replace(/ /gi,"").split(","));if(this.pixelFilter){var b=new v({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});h.forEach(u,function(a){b.addData({pixels:[a],statistics:{minValue:a,maxValue:a,noDataValue:null}})});this.pixelFilter({pixelBlock:b,extent:new e(0,
0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)R.attributes[this._rasterFieldPrefix+"Magnitude"]=b.pixels[0][0],R.attributes[this._rasterFieldPrefix+"Direction"]=b.pixels[1][0]}h.forEach(C,function(a){R.attributes[a.name]=a.value});var m=K||x;if(a&&0<a.length&&(y=h.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==m:a.attributes.VALUE==
m}),0<y.length&&(z=d.clone(y[0]),r&&z))){B={};for(w in z.attributes)z.attributes.hasOwnProperty(w)&&(D=r+w,B[D]=z.attributes[w]);z.attributes=B;R.attributes=d.mixin(R.attributes,z.attributes)}}f&&(c&&0<c.length)&&h.forEach(c,function(a){if(a){var b=R.attributes[a.name];q.isDefined(b)&&(b=this._getDomainValue(a.domain,b),q.isDefined(b)&&(R.attributes[a.name]=b))}},this);$.push(R);this._visibleRasters.push(R)}this._resolve([$,null,!0],null,g,k)}))}var l=a.value,p=a.value,s,n,t=0,x=0,u=this,z=this.objectIdField,
w,D,C=[];f=b.requestParams.renderingRules;var B=a.processedValues,F=this.renderingRule&&dojo.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(f&&B&&f.length===B.length){var J=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;h.forEach(f,function(a,b){if(a.functionName){var c={name:J+a.functionName.replace(/ /gi,"_"),value:B[b].replace(/ /gi,"").split(",")};C.push(c);F&&F===dojo.toJson(a.toJson())&&(l=B[b])}})}f=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&
this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(a.catalogItems){var H=0,G,V,W=a.catalogItems.features.length;D=0;n=Array(W);s=Array(W);w=Array(W);for(t=0;t<W;t++)-1<a.properties.Values[t].toLowerCase().indexOf("nodata")&&D++;G=W-D;for(t=0;t<W;t++)D=!0,-1<a.properties.Values[t].toLowerCase().indexOf("nodata")?(V=G++,f||(D=!1,n.length--,s.length--,w.length--)):V=H++,D&&(n[V]=a.catalogItems.features[t],s[V]=a.properties.Values[t],
w[V]=n[V].attributes[z])}this._visibleRasters=[];var R;if((a=-1<l.toLowerCase().indexOf("nodata"))&&!f)n=[],s=[],w=[];l&&(!n&&!a)&&(z="ObjectId",n=[],R=new E(new e(this.fullExtent),null,{ObjectId:0}),n.push(R));var $=[];n?!this._map.spatialReference.equals(this.spatialReference)&&w&&0<w.length?r({url:this._url.path+"/query",content:{f:"json",objectIds:w.join(","),returnGeometry:!0,outSR:c.toJson(u._map.spatialReference.toJson()),outFields:z},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===
a.features.length)u._resolve([$,null,null],null,g,k);else{for(t=0;t<a.features.length;t++)for(x=0;x<n.length;x++)n[x].attributes[z]==a.features[t].attributes[z]&&(n[x].geometry=new y(a.features[t].geometry),n[x].geometry.setSpatialReference(u._map.spatialReference));m.call(u)}},error:function(a){u._resolve([$,null,null],null,g,k)}}):m.call(this):this._resolve([$,null,null],null,g,k)},getVisibleRasters:function(){var a=this._visibleRasters,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},
_getDomainFields:function(a){if(a){var b=[];h.forEach(a,function(a){if(a.domain){var c={};c.name=a.name;c.domain=a.domain;b.push(c)}});return b}},_getDomainValue:function(a,b){if(a&&a.codedValues){var c;h.some(a.codedValues,function(a){return a.code===b?(c=a.name,!0):!1});return c}},_requestData:function(a,b,c){this._rasterReadPromise&&this._rasterReadPromise.cancel();a=d.clone(a);var e=a._normalize(!0);this._prepareGetImageParameters(e,b,c);b=d.clone(this._params);this._cleanupRequestParams(b);b.extent=
a;c=null;this._useBrowserDecoding()&&(c=new F({ctx:this._context}));b={imageServiceParameters:b,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:c?d.hitch(c,"decode"):null};this._rasterReadPromise=this.raster.read(b,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(a){if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this.originalPixelData=a,this.hasDataChanged=!0,this._setPixelData(a)},_setPixelData:function(a){a=this._clonePixelData(a);
this.pixelFilter&&this.pixelFilter(a);this.pixelData=a;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_drawPixelData:function(){},_requestDataErrorHandler:function(a){},_clonePixelData:function(a){if(null===a||void 0===a)return a;var b={};a.extent&&(b.extent=d.clone(a.extent));a=a.pixelBlock;if(null===a||void 0===a)return b;b.pixelBlock=a.clone();return b},_getPixelBlockFromCanvas:function(a,b,c){a=a.getImageData(0,0,b,c).data;
for(var d=b*c,e=0,g=0,f=new Uint8Array(d),k=new Uint8Array(d),h=new Uint8Array(d),m=new Uint8Array(d),q=Infinity,l=Infinity,p=Infinity,r=-Infinity,n=-Infinity,s=-Infinity,t,x,u,e=0;e<d;e++)t=a[g++],x=a[g++],u=a[g++],q=q<t?q:t,r=r>t?r:t,l=l<x?l:x,n=n>x?n:x,p=p<u?p:u,s=s>u?s:u,f[e]=t,k[e]=x,h[e]=u,m[e]=a[g++]&1;return new v({width:b,height:c,pixels:[f,k,h],pixelType:"U8",mask:m,statistics:[{minValue:q,maxValue:r},{minValue:l,maxValue:n},{minValue:p,maxValue:s}]})},_useBrowserDecoding:function(){return(void 0===
this.pixelFilter||null===this.pixelFilter)&&("jpeg"==this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var a=this._url.path+"/multiDimensionalInfo",b=new f(m._dfdCanceller);if(this._multidimensionalInfo)return b.resolve(this._multidimensionalInfo),b;10.3<=this.version&&this.hasMultidimensions?(b._pendingDfd=r({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(d.hitch(this,function(a){this._multidimensionalInfo=
a.multidimensionalInfo;b.callback(a.multidimensionalInfo)}),function(a){b.errback(a)})):(a=Error("Layer does not support multidimensional info"),a.log=p.isDebug,b.errback(a));return b},getDefaultMultidimensionalDefinition:function(){var a,b,c,e=[],g=new f(m._dfdCanceller);if(this._defaultMultidimensionalDefinition)return g.resolve(this._defaultMultidimensionalDefinition),g;g._pendingDfd=this.getMultidimensionalInfo();g._pendingDfd.then(d.hitch(this,function(d){a=d;b=a.variables[0].dimensions;for(c in b)b.hasOwnProperty(c)&&
(b[c].hasRanges&&!0==b[c].hasRanges?e.push(new z({variableName:"",dimensionName:b[c].name,isSlice:!1,values:[b[c].values[0]]})):e.push(new z({variableName:"",dimensionName:b[c].name,isSlice:!0,values:[b[c].extent[0]]})));this._defaultMultidimensionalDefinition=e;g.callback(e)}),function(a){g.errback(a)});return g},_setDefaultMultidimensionalDefinition:function(a){var b,c={};this.getDefaultMultidimensionalDefinition().then(d.hitch(this,function(e){b=e;0<b.length&&(this.mosaicRule?(c=d.clone(this.mosaicRule),
c.multidimensionalDefinition=b):this.defaultMosaicRule?(c=d.clone(this.defaultMosaicRule),c.multidimensionalDefinition=b):c=new w({multidimensionalDefinition:b}),this.setMosaicRule(c,a))}))},_setDefaultRenderingRule:function(a){var b={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&"none"!==this.rasterFunctionInfos[0].name.toLowerCase())b.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&
"esri.layers.ArcGISImageServiceVectorLayer"==this.declaredClass&&10.3<this.version){var c="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;b.rasterFunction="Resample";b.rasterFunctionArguments={ResamplingType:c,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}b.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new x(b),this.setRenderingRule(this.defaultRenderingRule,a))},_cleanupRequestParams:function(a){if(!a)return a;if(a.time&&a.mosaicRule){var b=new w(c.fromJson(a.mosaicRule));
if(b&&b.multidimensionalDefinition&&0<b.multidimensionalDefinition.length){var d=h.filter(b.multidimensionalDefinition,function(a){return"StdTime"!==a.dimensionName});b.multidimensionalDefinition=d;a.mosaicRule=c.toJson(b.toJson())}}var b="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),e;for(e in b)a.hasOwnProperty(b[e])&&delete a[b[e]];return a},_removeVisualizationStretchFunction:function(a){var b=a&&a.functionName;if(!b||"stretch"!==b.toLowerCase())return a;
var c=a.functionArguments.Raster;return c&&c.functionName&&h.some(this.rasterFunctionInfos,function(a){return c.functionName===a.name})?c:a},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},
_isRasterFunctionInfoAvailable:function(a){return h.some(a&&(this.rasterFunctionInfos||[]),function(b){return b&&b.name&&b.name.toLowerCase()===a.toLowerCase()})},_createPixelData:function(a){a=new v({width:2,height:2,pixels:a,pixelType:this.pixelType,statistics:a});var b=this.fullExtent.getCenter(),b=new e(b.x,b.y,b.x+this.pixelSizeX,b.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:a,extent:b}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&m._resDfd(d,a,
e)},_toggleTime:function(){var a=this._map;this.timeInfo&&this.useMapTime&&a&&!this.suspended?(this._timeConnect||(this._timeConnect=l.connect(a,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(a.timeExtent)):(l.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(a,b){this.useMapTime=a;this._toggleTime();!b&&this._map&&this.refresh(!0)},_setTime:function(a){this._params&&(this._params.time=a?a.toJson().join(","):null)},_onTimeExtentChangeHandler:function(a){this.suspended||
(this._setTime(a),this.refresh(!0))}})})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(n,d,f,h,c,p){var l=n(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){d.isObject(a)&&(d.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),
this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new p(a.viewpoint)),this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=null,d=this.multidimensionalDefinition?this.multidimensionalDefinition.length:
0;if(d)for(var a=[],b=0;b<d;b++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[b].declaredClass?this.multidimensionalDefinition[b].toJson():this.multidimensionalDefinition[b]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return c.filter(a,
function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var c=l.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":c=l.METHOD_ATTRIBUTE;break;case "center":c=l.METHOD_CENTER;break;case "lockraster":c=l.METHOD_LOCKRASTER;break;case "nadir":c=l.METHOD_NADIR;break;case "northwest":c=l.METHOD_NORTHWEST;break;case "seamline":c=l.METHOD_SEAMLINE;break;case "viewpoint":c=l.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return l.OPERATION_FIRST;
case "last":return l.OPERATION_LAST;case "max":return l.OPERATION_MAX;case "min":return l.OPERATION_MIN;case "blend":return l.OPERATION_BLEND;case "mean":return l.OPERATION_MEAN;case "sum":return l.OPERATION_SUM}}});d.mixin(l,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",
OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});return l})},"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,d,f,h,c){var p=n(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(c){if(d.isObject(c)){var a=
0;this.functionName=c.rasterFunction;this.functionArguments=d.clone(c.rasterFunctionArguments||c.arguments);d.mixin(this,c);if(c=this.functionArguments)if(c.Raster=this._toRasterFunction(c.Raster),c.Raster2=this._toRasterFunction(c.Raster2),c.DEM=this._toRasterFunction(c.DEM),c.FillRaster=this._toRasterFunction(c.FillRaster),c.Rasters&&c.Rasters.length)for(a=0;a<c.Rasters.length;a++)c.Rasters[a]=this._toRasterFunction(c.Rasters[a])}},_toRasterFunction:function(c){return c&&(c.rasterFunction||c.functionName)?
new p(c):c},_rfToJson:function(c){c&&"esri.layers.RasterFunction"===c.declaredClass&&(c=c.toJson());return c},toJson:function(){var f=d.clone(this.functionArguments||this.arguments);if(f&&(f.Raster=this._rfToJson(f.Raster),f.Raster2=this._rfToJson(f.Raster2),f.DEM=this._rfToJson(f.DEM),f.FillRaster=this._rfToJson(f.FillRaster),f.Rasters&&f.Rasters.length)){var a,k=[];for(a=0;a<f.Rasters.length;a++)k.push(this._rfToJson(f.Rasters[a]));f.Rasters=k}return c.filter({rasterFunction:this.functionName,rasterFunctionArguments:f,
variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});return p})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,d,f,h,c){return n(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(c){d.isObject(c)&&d.mixin(this,c)},toJson:function(){return c.filter({variableName:this.variableName,
dimensionName:this.dimensionName,values:this.values,isSlice:this.isSlice},function(c){return null!==c})}})})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e){var g,y,w,x=null,z=null,D=function(a){"U1"===a||"U2"===
a||"U4"===a||"U8"===a?(a="U8",z=Math.pow(2,8)-1,x=Uint8Array):"U16"===a?(z=z||Math.pow(2,16)-1,x=Uint16Array):"U32"===a?(z=z||Math.pow(2,32)-1,x=Uint32Array):"S8"===a?(z=z||0-Math.pow(2,7),x=Int8Array):"S16"===a?(z=z||0-Math.pow(2,15),x=Int16Array):"S32"===a?(z=z||0-Math.pow(2,31),x=Int32Array):x=Float32Array;return a};return d(b,{declaredClass:"esri.layers.Raster",imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq".split(" "),
_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){if(!a)throw"Image Service URL is not defined";this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(b,d,e){var g=this,k=new h(m._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!b.imageServiceParameters)throw"Insufficient parameters to read data";var q=f.clone(b.imageServiceParameters),l=b.pixelType;c.some(this.validPixelTypes,function(a){return a===l})||
(q.pixelType="F32");c.some(this.validFormats,function(a){return a.toLowerCase()===q.format.toLowerCase()})||(q.format="lerc");var r=b.decodeFunc,n;this._prepareGetImageParameters(q);k._pendingDfd=s({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:f.mixin(q,{f:"image"}),load:function(a){var b=q.format.toUpperCase();"BSQ"!==b&&"BIP"!==b&&(b=g._getFormat(a));if("ERROR"===b)a=Error(String.fromCharCode.apply(null,new Uint8Array(a))),a.log=p.isDebug,g._resolve([a],null,e,k,!0);else{if(void 0===
r||null===r)r=g._getFormatDecoderDfd(b);r?r(a,{width:q.width,height:q.height,planes:null,pixelType:l,noDataValue:q.noData}).then(function(a){n={pixelBlock:a,extent:q.extent};g._resolve([n,q],"onRasterReadComplete",d,k)},function(a){g._resolve([a],null,e,k,!0)}):(a=Error("Format '"+q.format+"' is not supported."),a.log=p.isDebug,g._resolve([a],null,e,k,!0))}},error:function(a){g._resolve([a],null,e,k,!0)}});return k.promise},onRasterReadComplete:function(){},_prepareGetImageParameters:function(a){if(a.size&&
a.bbox){var b=a.size.split(",");a.width=parseFloat(b[0]);a.height=parseFloat(b[1]);a.extent||(b=a.bbox.split(","),a.extent=new q(parseFloat(b[0]),parseFloat(b[1]),parseFloat(b[2]),parseFloat(b[3]),new r(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var b=a.extent,c=b.spatialReference.wkid||l.toJson(b.spatialReference.toJson());
delete a._ts;f.mixin(a,{bbox:b.xmin+","+b.ymin+","+b.xmax+","+b.ymax,imageSR:c,bboxSR:c,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,c){var d=a.ymax-a.ymin,e=a.xmax-a.xmin;c>=b?a.ymax=a.ymin+e*b/c:(e=d*c/b,a.xmax=a.xmin+e);return a},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&m._resDfd(d,a,e)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;break;case "JPEG":b=this._decodeJpeg;
break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip}b=f.hitch(this,b);return function(a,c){var d=new h;try{var e=b(a,c);d.resolve(e)}catch(g){d.reject(g)}return d}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";255===a[0]&&216===a[1]?b="JPEG":137===a[0]&&80===a[1]&&78===a[2]&&71===a[3]?b="PNG":67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9]?b="LERC":-1<String.fromCharCode.apply(null,
a).toLowerCase().indexOf("error")&&(b="ERROR");return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!g)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var c=(new g).decode(a);if(c.height!==b.height||c.width!==b.width)throw"The decoded image dimensions are incorrect.";var d=[],e,f;for(e=0;e<c.pixels.length;e++)f=
c.pixels[e],d.push(this._calculateBandStatistics(f));return new t({width:c.width,height:c.height,pixels:c.pixels,pixelType:"U8",mask:c.mask,statistics:d})},_decodePng:function(a,b){if(!y)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var c=new Uint8Array(a),d=new y(c),c=new Uint8Array(4*b.width*b.height);d.copyToImageData(c,d.decodePixels());for(var e=d=0,g,e=new Uint8Array(b.width*b.height),d=0;d<b.width*b.height;d++)e[d]=c[4*d+3];for(var f=new t({width:b.width,height:b.height,
pixels:[],pixelType:"U8",mask:e,statistics:[]}),d=0;3>d;d++){g=new Uint8Array(b.width*b.height);for(e=0;e<b.width*b.height;e++)g[e]=c[4*e+d];f.addData({pixels:g,statistics:this._calculateBandStatistics(g)})}return f},_decodeBsq:function(a,b){if(!w)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);var c=w.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:z}),d=[],e,g=null;for(e=0;e<c.pixels.length;e++)g=
c.pixels[e],d.push(this._calculateBandStatistics(g));return new t({width:b.width,height:b.height,pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeBip:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);var c=w.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:x,noDataValue:z}),d=[],e,g=null;for(e=0;e<c.pixels.length;e++)g=c.pixels[e],d.push(this._calculateBandStatistics(g));return new t({width:b.width,height:b.height,
pixels:c.pixels,pixelType:b.pixelType,mask:c.maskData,statistics:d})},_decodeLerc:function(a,b){this._validateDecodeParams(b);z=b.noDataValue;b.pixelType=D(b.pixelType);for(var c=0,d,g=0,f,k=a.byteLength-10;g<k;){var h=e.decode(a,{inputOffset:g,encodedMaskData:d,returnMask:0===c?!0:!1,returnEncodedMask:0===c?!0:!1,returnFileInfo:!0,pixelType:x,noDataValue:z}),g=h.fileInfo.eofOffset;0===c&&(d=h.encodedMaskData,f=new t({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:h.maskData,statistics:[]}));
c++;if(h.height!==b.height||h.width!==b.width)throw"The decoded image dimensions are incorrect";f.addData({pixels:h.pixelData,statistics:{minValue:h.minValue,maxValue:h.maxValue,noDataValue:h.noDataValue}})}return f},_calculateBandStatistics:function(a){var b=Infinity,c=-Infinity,d=a.length,e,g=0;for(e=0;e<d;e++)g=a[e],b=g<b?g:b,c=g>c?g:c;return{minValue:b,maxValue:c}},_loadRasterFormatModules:function(){10>a("ie")||n(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw"],function(a,
b,c){g=a;y=b;w=c})}})})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(n,d,f,h){return n([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],constructor:function(c){if(c){if(!c.width||Math.floor(c.width)!==c.width)throw"PixelBlock: incorrect width";if(!c.height||Math.floor(c.height)!==c.height)throw"PixelBlock: incorrect height";if(!c.pixels||!c.statistics)throw"PixelBlock: pixel data or statistics not present";
this.width=c.width;this.height=c.height;this.pixels=c.pixels;this.pixelType=c.pixelType||null;this.statistics=c.statistics;this.mask=c.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):this.statistics.length},addData:function(c){if(!c.pixels||!c.statistics)throw"Pixel data or statistics are not present";if(c.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(c.statistics);
this.pixels.push(c.pixels)},getAsRGBA:function(){var c=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(c);break;default:this._fillFrom8Bit(c)}return new Uint8ClampedArray(c)},getAsRGBAFloat:function(){var c=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(c);return c},clone:function(){var c=new this.constructor;c.width=this.width;c.height=this.height;c.pixelType=this.pixelType;
this.mask&&(c.mask=new Uint8Array(this.mask));var f,h;if(this.pixels){c.pixels=[];h=this.pixels.length;for(f=0;f<h;f++)c.pixels[f]=new Float32Array(this.pixels[f])}if(this.statistics){c.statistics=[];h=this.statistics.length;for(f=0;f<h;f++)c.statistics[f]=d.clone(this.statistics[f])}return c},_fillFrom8Bit:function(c){var d=this.pixels,f=this.mask;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,k,b;a=k=b=d[0];3<=d.length&&(k=d[1],b=d[2]);
var d=new Uint32Array(c),h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(f&&f.length===h)for(c=0;c<h;c++)f[c]&&(d[c]=-16777216|b[c]<<16|k[c]<<8|a[c]);else for(c=0;c<h;c++)d[c]=-16777216|b[c]<<16|k[c]<<8|a[c]},_fillFromNon8Bit:function(c){var d=this.pixels,f=this.mask,a=this.statistics;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var k=1,b=0;a&&0<a.length?(b=a[0].minValue,
k=255/(a[0].maxValue-a[0].minValue)):(k=255,"S8"===this.pixelType?(b=-128,k=127):"U16"===this.pixelType?k=65535:"S16"===this.pixelType?(b=-32768,k=32767):"U32"===this.pixelType?k=4294967295:"S32"===this.pixelType?(b=-2147483648,k=2147483647):"F32"===this.pixelType?(b=-3.4*1E39,k=3.4*1E39):"F64"===this.pixelType&&(b=-Number.MAX_VALUE,k=Number.MAX_VALUE),k=255/(k-b));c=new Uint32Array(c);var a=this.width*this.height,h,q,r;h=d[0];if(h.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");
if(3<=d.length)if(q=d[1],r=d[2],f&&f.length===a)for(d=0;d<a;d++)f[d]&&(c[d]=-16777216|(r[d]-b)*k<<16|(q[d]-b)*k<<8|(h[d]-b)*k);else for(d=0;d<a;d++)c[d]=-16777216|(r[d]-b)*k<<16|(q[d]-b)*k<<8|(h[d]-b)*k;else if(f&&f.length===a)for(d=0;d<a;d++)q=(h[d]-b)*k,f[d]&&(c[d]=-16777216|q<<16|q<<8|q);else for(d=0;d<a;d++)q=(h[d]-b)*k,c[d]=-16777216|q<<16|q<<8|q},_fillFrom32Bit:function(c){var d=this.pixels,f=this.mask;if(!c||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");
var a,k,b;a=k=b=d[0];3<=d.length&&(k=d[1],b=d[2]);var h=this.width*this.height;if(a.length!==h)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var q=0;if(f&&f.length===h)for(d=0;d<h;d++)c[q++]=a[d],c[q++]=k[d],c[q++]=b[d],c[q++]=f[d];else for(d=0;d<h;d++)c[q++]=a[d],c[q++]=k[d],c[q++]=b[d],c[q++]=255}})})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var n={defaultNoDataValue:-3.4027999387901484E38,decode:function(f,h){var c;h=h||{};var p=h.inputOffset||
0,l=h.encodedMaskData||null===h.encodedMaskData,a={},k=new Uint8Array(f,p,10);a.fileIdentifierString=String.fromCharCode.apply(null,k);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+a.fileIdentifierString;var p=p+10,b=new DataView(f,p,24);a.fileVersion=b.getInt32(0,!0);a.imageType=b.getInt32(4,!0);a.height=b.getUint32(8,!0);a.width=b.getUint32(12,!0);a.maxZError=b.getFloat64(16,!0);p+=24;if(!l)if(b=new DataView(f,p,16),a.mask={},a.mask.numBlocksY=b.getUint32(0,
!0),a.mask.numBlocksX=b.getUint32(4,!0),a.mask.numBytes=b.getUint32(8,!0),a.mask.maxValue=b.getFloat32(12,!0),p+=16,0<a.mask.numBytes){var l=new Uint8Array(Math.ceil(a.width*a.height/8)),b=new DataView(f,p,a.mask.numBytes),k=b.getInt16(0,!0),s=2,q=0;do{if(0<k)for(;k--;)l[q++]=b.getUint8(s++);else for(var r=b.getUint8(s++),k=-k;k--;)l[q++]=r;k=b.getInt16(s,!0);s+=2}while(s<a.mask.numBytes);if(-32768!==k||q<l.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=l;p+=a.mask.numBytes}else 0==
(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(l=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=l);b=new DataView(f,p,16);a.pixels={};a.pixels.numBlocksY=b.getUint32(0,!0);a.pixels.numBlocksX=b.getUint32(4,!0);a.pixels.numBytes=b.getUint32(8,!0);a.pixels.maxValue=b.getFloat32(12,!0);p+=16;l=a.pixels.numBlocksX;k=a.pixels.numBlocksY;l+=0<a.width%l?1:0;k+=0<a.height%k?1:0;a.pixels.blocks=Array(l*k);s=1E9;for(r=q=0;r<k;r++)for(var m=0;m<l;m++){var t=0,b=new DataView(f,p,Math.min(10,
f.byteLength-p)),e={};a.pixels.blocks[q++]=e;var g=b.getUint8(0);t++;e.encoding=g&63;if(3<e.encoding)throw"Invalid block encoding ("+e.encoding+")";if(2===e.encoding)p++,s=Math.min(s,0);else{if(0!==g&&2!==g){g>>=6;e.offsetType=g;if(2===g)e.offset=b.getInt8(1),t++;else if(1===g)e.offset=b.getInt16(1,!0),t+=2;else if(0===g)e.offset=b.getFloat32(1,!0),t+=4;else throw"Invalid block offset type";s=Math.min(e.offset,s);if(1===e.encoding)if(g=b.getUint8(t),t++,e.bitsPerPixel=g&63,g>>=6,e.numValidPixelsType=
g,2===g)e.numValidPixels=b.getUint8(t),t++;else if(1===g)e.numValidPixels=b.getUint16(t,!0),t+=2;else if(0===g)e.numValidPixels=b.getUint32(t,!0),t+=4;else throw"Invalid valid pixel count type";}p+=t;if(3!=e.encoding)if(0===e.encoding){b=(a.pixels.numBytes-1)/4;if(b!==Math.floor(b))throw"uncompressed block has invalid length";t=new ArrayBuffer(4*b);g=new Uint8Array(t);g.set(new Uint8Array(f,p,4*b));t=new Float32Array(t);for(g=0;g<t.length;g++)s=Math.min(s,t[g]);e.rawData=t;p+=4*b}else 1===e.encoding&&
(b=Math.ceil(e.numValidPixels*e.bitsPerPixel/8),t=Math.ceil(b/4),t=new ArrayBuffer(4*t),g=new Uint8Array(t),g.set(new Uint8Array(f,p,b)),e.stuffedData=new Uint32Array(t),p+=b)}}a.pixels.minValue=s;a.eofOffset=p;var p=null!=h.noDataValue?h.noDataValue:n.defaultNoDataValue,k=h.encodedMaskData,t=h.returnMask,s=0,q=a.pixels.numBlocksX,r=a.pixels.numBlocksY,m=Math.floor(a.width/q),e=Math.floor(a.height/r),b=2*a.maxZError,k=k||(a.mask?a.mask.bitset:null),y,l=new (h.pixelType||Float32Array)(a.width*a.height);
t&&k&&(y=new Uint8Array(a.width*a.height));for(var t=new Float32Array(m*e),w,x,g=0;g<=r;g++){var z=g!==r?e:a.height%r;if(0!==z)for(var D=0;D<=q;D++){var v=D!==q?m:a.width%q;if(0!==v){var u=g*a.width*e+D*m,F=a.width-v,C=a.pixels.blocks[s],B,E;if(2>C.encoding){if(0===C.encoding)B=C.rawData;else{B=C.stuffedData;E=C.bitsPerPixel;w=C.numValidPixels;x=C.offset;var G=b,J=t,K=a.pixels.maxValue,N=(1<<E)-1,O=0,P=void 0,L=0,Q=void 0,S=void 0,M=Math.ceil((K-x)/G),P=4*B.length-Math.ceil(E*w/8);B[B.length-1]<<=
8*P;for(P=0;P<w;P++)0===L&&(S=B[O++],L=32),L>=E?(Q=S>>>L-E&N,L-=E):(L=E-L,Q=(S&N)<<L&N,S=B[O++],L=32-L,Q+=S>>>L),J[P]=Q<M?x+Q*G:K;B=t}E=0}else c=2===C.encoding?0:C.offset;var I;if(k)for(x=0;x<z;x++){u&7&&(I=k[u>>3],I<<=u&7);for(w=0;w<v;w++)u&7||(I=k[u>>3]),I&128?(y&&(y[u]=1),l[u++]=2>C.encoding?B[E++]:c):(y&&(y[u]=0),l[u++]=p),I<<=1;u+=F}else if(2>C.encoding)for(x=0;x<z;x++){for(w=0;w<v;w++)l[u++]=B[E++];u+=F}else for(x=0;x<z;x++){for(w=0;w<v;w++)l[u++]=c;u+=F}if(1===C.encoding&&E!==C.numValidPixels)throw"Block and Mask do not match";
s++}}}c=y;y={width:a.width,height:a.height,pixelData:l,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:p};c&&(y.maskData=c);h.returnEncodedMask&&a.mask&&(y.encodedMaskData=a.mask.bitset?a.mask.bitset:null);if(h.returnFileInfo&&(y.fileInfo=d(a),h.computeUsedBitDepths)){c=y.fileInfo;I=a.pixels.numBlocksX*a.pixels.numBlocksY;B={};for(E=0;E<I;E++)p=a.pixels.blocks[E],0===p.encoding?B.float32=!0:1===p.encoding?B[p.bitsPerPixel]=!0:B[0]=!0;a=Object.keys(B);c.bitDepths=a}return y}},d=function(d){return{fileIdentifierString:d.fileIdentifierString,
fileVersion:d.fileVersion,imageType:d.imageType,height:d.height,width:d.width,maxZError:d.maxZError,eofOffset:d.eofOffset,mask:d.mask?{numBlocksX:d.mask.numBlocksX,numBlocksY:d.mask.numBlocksY,numBytes:d.mask.numBytes,maxValue:d.mask.maxValue}:null,pixels:{numBlocksX:d.pixels.numBlocksX,numBlocksY:d.pixels.numBlocksY,numBytes:d.pixels.numBytes,maxValue:d.pixels.maxValue,minValue:d.pixels.minValue,noDataValue:this.noDataValue}}};return n})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),
function(n,d,f,h,c,p){return n(null,{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(c){d.mixin(this,c);this.isDataUV=c&&c.isDataUV?c.isDataUV:!1;this.computeMagnitudeAndDirection=d.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(c,a){this.inputUnit=c;this.outputUnit=a;this.unitConversionFactor=
1;this._updateUnitConvFactor()},_updateUnitConvFactor:function(){var c=p.indexOf(this.speedUnits,this.inputUnit),a=p.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=c&&0<=a){var d=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=d[c]/d[a]}},computeMagnitudeAndDirection:function(d){if(!c.isDefined(d))throw"Could not compute magnitude and direction. No pixel data is available.";var a=d.pixelBlock;if(!c.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var f=d.extent,b=(f.xmax-f.xmin)/a.width,h=(f.ymax-f.ymin)/a.height,q=f.xmin+b/2,f=f.ymax-h/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var p=180/Math.PI,m=[],n=0,e=0,g=0,y=!c.isDefined(a.mask),w,x,z,D,v,u,F,C;v=F=Infinity;u=C=-Infinity;for(n=0;n<a.height;n++)for(e=0;e<a.width;e++,g++)if(m.push([q+b*e,f-h*n]),y||a.mask[g])z=w=a.pixels[0][g]*this.unitConversionFactor,D=x=a.pixels[1][g],this.isDataUV&&(z=Math.sqrt(w*w+x*x),D=90-p*Math.atan2(x,w),a.pixels[0][g]=z*this.unitConversionFactor,
a.pixels[1][g]=D),z>u&&(u=z),z<v&&(v=z),D>C&&(C=D),D<F&&(F=D);a.statistics[0].maxValue=u;a.statistics[0].minValue=v;a.statistics[1].maxValue=C;a.statistics[1].minValue=F;d.locations=m;return d}})})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(n,d,f,h){var c;return d(null,{constructor:function(c){this.ctx=c.ctx;this._loadRasterFormatModule()},decode:function(c,d){if(!d.width||!d.height)throw"Native decoding requires the image format, width and height";
var a=new f,k,b=new Uint8Array(c),h=this._getFormat(c);if("error"===h)throw"invalid format";"jpeg"===h&&(k=this._getMask(b,d));var q="",r,m;for(r=0;r<b.length;r+=65535)m=b.subarray(r,r+65535>b.length-1?b.length-1:r+65535),q+=String.fromCharCode.apply(null,m);var b="data:image/"+h+";base64,"+window.btoa(q),n=new Image,e;n.src=b;var g=this;n.onload=function(){g.ctx.clearRect(0,0,d.width,d.height);g.ctx.drawImage(n,0,0);var b=g.ctx.getImageData(0,0,n.width,n.height);e=b.data;if(k)for(r=0;r<k.length;r++)e[4*
r+3]=k[r]?255:0;g.ctx.putImageData(b,0,0);a.resolve(null)};n.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(c){c=new Uint8Array(c,0,10);var d="error";255===c[0]&&216===c[1]?d="jpeg":137===c[0]&&(80===c[1]&&78===c[2]&&71===c[3])&&(d="png");return d},_getMask:function(d,f){var a;try{if(!c)throw"The zlib decoder module is not loaded.";var k=0,b=0,h=Math.round(d.length/2);1===h%2&&(h+=1);for(var q=d.length-2,k=h;k<q&&!(255===d[k]&&217===d[k+1]);k++);h=k+=2;if(h<d.length-
1){var r=(new c(d.subarray(h))).getBytes();a=new Uint8Array(f.width*f.height);for(k=h=0;k<r.length;k++)for(b=7;0<=b;b--)a[h++]=r[k]>>b&1}}catch(m){}return a},_loadRasterFormatModule:function(){10>h("ie")||n(["./Zlib"],function(d){c=d})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),function(n,d,f,h,c,p,l,a){n=n(l,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",
constructor:function(a){this._url.path+="/identify";this._handler=d.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(c,b,d,f,h){try{var m=new a(c);this._successHandler([m],"onComplete",d,h)}catch(l){this._errorHandler(l,f,h)}},execute:function(a,b,f,h){var l=h.assembly;a=this._encode(d.mixin({},this._url.query,{f:"json"},a.toJson(l&&l[0])));var m=this._handler,p=this._errorHandler;return c({url:this._url.path,content:a,callbackParamName:"callback",
load:function(a,c){m(a,c,b,f,h.dfd)},error:function(a){p(a,f,h.dfd)}})},onComplete:function(){}});p._createWrappers(n);return n})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(n,d,f,h,c,p){return n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(d){d.catalogItems&&(this.catalogItems=new p(d.catalogItems));d.location&&(this.location=c.fromJson(d.location));
this.catalogItemVisibilities=d.catalogItemVisibilities;this.name=d.name;this.objectId=d.objectId;this.value=d.value;this.processedValues=d.processedValues;this.properties=d.properties}})})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(n,d,f,h,c,p,l,a){return n(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,
renderingRule:null,renderingRules:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(c){var b=c&&c.geometry||this.geometry;c={geometry:b,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?f.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?f.toJson(this.renderingRule.toJson()):null};b&&(c.geometryType=a.getJsonType(b));b=this.timeExtent;c.time=b?b.toJson().join(","):
null;l.isDefined(this.pixelSizeX)&&l.isDefined(this.pixelSizeY)?c.pixelSize=f.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(c.pixelSize=this.pixelSize?f.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(c.renderingRules=f.toJson(h.map(this.renderingRules,function(a){return a.toJson()})));return c}})})},"jimu/LayerInfos/LayerInfoForDefaultTile":function(){define(["dojo/_base/declare","./LayerInfoForDefaultService"],function(n,d){return n(d,{constructor:function(d,
h){this.noLegend=!0},getExtent:function(){},initVisible:function(){},_setTopLayerVisible:function(d){},setLayerVisiblefromTopLayer:function(){},getOpacity:function(){},setOpacity:function(d){},isShowInMap:function(){return this.originOperLayer.mapService.layerInfo.layerObject.visible}})})},"jimu/LayerInfos/LayerInfoForDefaultTable":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/Deferred ./LayerInfoForDefault esri/layers/FeatureLayer".split(" "),function(n,d,f,h,c,p){return n(c,
{isTable:null,constructor:function(){this.newSubLayers=[];this.isTable=!0},init:function(){},getLayerObject:function(){var c=new h;this.layerObject.empty?this.layerObject.url?(this.layerObject=new p(this.layerObject.url,this.originOperLayer.options||{}),this.layerObject.on("load",d.hitch(this,function(){c.resolve(this.layerObject)})),this.layerObject.on("error",d.hitch(this,function(){c.resolve(null)}))):this.layerObject.featureCollectionData?(this.layerObject=new p(this.layerObject.featureCollectionData,
this.originOperLayer.options||{}),c.resolve(this.layerObject)):c.resolve(null):c.resolve(this.layerObject);return c},getLayerType:function(){var c=new h;c.resolve("Table");return c},isVisible:function(){return!1},isLeaf:function(){return!0},isRootLayer:function(){return!1},createLegendsNode:function(){return f.create("div",{"class":"legends-div"})},_initControlPopup:function(){this.controlPopupInfo={enablePopup:void 0,infoTemplate:void 0}}})})},"jimu/LayerInfos/LayerInfoForDefaultImage":function(){define("dojo/_base/declare dojo/dom-construct dojo/_base/array dojo/_base/lang dojo/Deferred dojo/promise/all esri/request ./LayerInfoForDefault".split(" "),
function(n,d,f,h,c,p,l,a){return n(a,{constructor:function(){this._addImageServiceLayerType()},_addImageServiceLayerType:function(){this.layerObject.type=this.layerObject.serviceDataType&&("esriImageServiceDataTypeVector-UV"===this.layerObject.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.layerObject.serviceDataType)?"ArcGISImageServiceVectorLayer":"ArcGISImageServiceLayer"},_initLegendsNode:function(a){10.2<=this.layerObject.version?this._legendRequestServer().then(h.hitch(this,
function(b){d.empty(a);f.forEach(b.layers,function(b){f.forEach(b.legend,function(b){if("\x3call other values\x3e"!==b.label){var c=d.create("div",{"class":"legend-div"},a),f=d.create("div",{"class":"legend-symbol jimu-float-leading",style:"width:50px;height:50px;position:relative"},c),h=null,h=b.imageData?"data:"+b.contentType+";base64,"+b.imageData:b.url;d.create("img",{"class":"legend-symbol-image",style:"overflow:auto;margin:auto;position:absolute;top:0;left:0;bottom:0;right:0",src:h},f);d.create("div",
{"class":"legend-label jimu-float-leading",innerHTML:b.label||" "},c)}},this)},this)}),h.hitch(this,function(){d.empty(a)})):d.empty(a)},_legendRequestServer:function(){var a=this.layerObject.url+"/legend",b={f:"json"};this.layerObject._params.bandIds&&(b.bandIds=this.layerObject._params.bandIds);this.layerObject._params.renderingRule&&(b.renderingRule=this.layerObject._params.renderingRule);return l({url:a,content:b,handleAs:"json",callbackParamName:"callback"})},getSupportTableInfo:function(){var a=
new c,b={isSupportedLayer:!1,isSupportQuery:!1,layerType:null},d=this.getLayerType(),f=this.getLayerObject();p({type:d,layerObject:f}).then(h.hitch(this,function(c){var d=c.type;c=c.layerObject;b.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(b.isSupportedLayer=!0);c.capabilities&&0<=c.capabilities.indexOf("Catalog")?b.isSupportQuery=!0:b.isSupportedLayer=!1;a.resolve(b)}),function(){a.resolve(b)});return a}})})},"jimu/LayerInfos/LayerInfoForDefaultStream":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/Deferred","dojo/promise/all","./LayerInfoForDefault"],function(n,d,f,h,c){return n(c,{getSupportTableInfo:function(){var c=new f,l={isSupportedLayer:!1,isSupportQuery:!0,layerType:null,otherReasonCanNotSupport:!0},a=this.getLayerType(),k=this.getLayerObject();h({type:a,layerObject:k}).then(d.hitch(this,function(a){var d=a.type;a=a.layerObject;l.layerType=d;0<=this._getLayerTypesOfSupportTable().indexOf(d)&&(l.isSupportedLayer=!0);if((d=a.getLatestObservations())&&0<d.length)l.otherReasonCanNotSupport=
!1;c.resolve(l)}),function(){c.resolve(l)});return c}})})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),function(n,d,f,h,c,p,l,a,k){return p("dijit.layout._LayoutWidget",[d,f,h],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);l.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);
var a=this.getParent&&this.getParent();if(!a||!a.isLayoutContainer)this.resize(),this.own(c.on("resize",n.hitch(this,"resize")))}},resize:function(b,c){var d=this.domNode;b&&a.setMarginBox(d,b);var f=c||{};n.mixin(f,b||{});if(!("h"in f)||!("w"in f))f=n.mixin(a.getMarginBox(d),f);var h=k.getComputedStyle(d),l=a.getMarginExtents(d,h),e=a.getBorderExtents(d,h),f=this._borderBox={w:f.w-(l.w+e.w),h:f.h-(l.h+e.h)},l=a.getPadExtents(d,h);this._contentBox={l:k.toPixelValue(d,h.paddingLeft),t:k.toPixelValue(d,
h.paddingTop),w:f.w-l.w,h:f.h-l.h};this.layout()},layout:function(){},_setupChild:function(a){l.add(a.domNode,this.baseClass+"-child "+(a.baseClass?this.baseClass+"-"+a.baseClass:""))},addChild:function(a,c){this.inherited(arguments);this._started&&this._setupChild(a)},removeChild:function(a){l.remove(a.domNode,this.baseClass+"-child"+(a.baseClass?" "+this.baseClass+"-"+a.baseClass:""));this.inherited(arguments)}})})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e){s("dijit-legacy-requires")&&e(0,function(){n(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return f("dijit.Menu",t,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):d.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(a){return r.get(this._iframeContentDocument(a))||
this._iframeContentDocument(a).__parent__||a.name&&document.frames[a.name]||null},_iframeContentDocument:function(a){return a.contentDocument||a.contentWindow&&a.contentWindow.document||a.name&&document.frames[a.name]&&document.frames[a.name].document||null},bindDomNode:function(d){d=h.byId(d,this.ownerDocument);var e;if("iframe"==d.tagName.toLowerCase()){var f=d;e=this._iframeContentWindow(f);e=q.body(e.document)}else e=d==q.body(this.ownerDocument)?this.ownerDocument.documentElement:d;var m={node:d,
iframe:f};c.set(d,"_dijitMenu"+this.id,this._bindings.push(m));var l=k.hitch(this,function(c){var d=this.selector,e=d?function(a){return b.selector(d,a)}:function(a){return a},g=this;return[b(c,e(this.leftClickToOpen?"click":"contextmenu"),function(a){a.stopPropagation();a.preventDefault();(new Date).getTime()<this._lastKeyDown+500||g._scheduleOpen(this,f,{x:a.pageX,y:a.pageY},a.target)}),b(c,e("keydown"),function(b){if(93==b.keyCode||b.shiftKey&&b.keyCode==a.F10||this.leftClickToOpen&&b.keyCode==
a.SPACE)b.stopPropagation(),b.preventDefault(),g._scheduleOpen(this,f,null,b.target),this._lastKeyDown=(new Date).getTime()})]});m.connects=e?l(e):[];f&&(m.onloadHandler=k.hitch(this,function(){var a=this._iframeContentWindow(f),a=q.body(a.document);m.connects=l(a)}),f.addEventListener?f.addEventListener("load",m.onloadHandler,!1):f.attachEvent("onload",m.onloadHandler))},unBindDomNode:function(a){var b;try{b=h.byId(a,this.ownerDocument)}catch(d){return}a="_dijitMenu"+this.id;if(b&&c.has(b,a)){for(var e=
c.get(b,a)-1,f=this._bindings[e],k;k=f.connects.pop();)k.remove();(k=f.iframe)&&(k.removeEventListener?k.removeEventListener("load",f.onloadHandler,!1):k.detachEvent("onload",f.onloadHandler));c.remove(b,a);delete this._bindings[e]}},_scheduleOpen:function(a,b,c,d){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:d,delegatedTarget:a,iframe:b,coords:c})},1))},_openMyself:function(a){function b(){n.refocus&&t&&t.focus();m.close(n)}var c=a.target,
d=a.iframe,e=a.coords,f=!e;this.currentTarget=a.delegatedTarget;if(e){if(d){a=p.position(d,!0);var c=this._iframeContentWindow(d),c=p.docScroll(c.document),k=l.getComputedStyle(d),q=l.toPixelValue,r=(s("ie")&&s("quirks")?0:q(d,k.paddingLeft))+(s("ie")&&s("quirks")?q(d,k.borderLeftWidth):0),d=(s("ie")&&s("quirks")?0:q(d,k.paddingTop))+(s("ie")&&s("quirks")?q(d,k.borderTopWidth):0);e.x+=a.x+r-c.x;e.y+=a.y+d-c.y}}else e=p.position(c,!0),e.x+=10,e.y+=10;var n=this,d=this._focusManager.get("prevNode");
a=this._focusManager.get("curNode");var t=!a||h.isDescendant(a,this.domNode)?d:a;m.open({popup:this,x:e.x,y:e.y,onExecute:b,onCancel:b,orient:this.isLeftToRight()?"L":"R"});this.focus();f||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);m.close(this)}},destroy:function(){d.forEach(this._bindings,function(a){a&&this.unBindDomNode(a.node)},this);this.inherited(arguments)}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare",
"./Grid","./OnDemandList"],function(n,d,f){return n("dgrid.OnDemandGrid",[d,f],{})})},"dgrid/Grid":function(){define("dojo/_base/kernel dojo/_base/declare dojo/on dojo/has put-selector/put ./List ./util/misc dojo/_base/sniff".split(" "),function(n,d,f,h,c,p,l){function a(a,b){b&&b.nodeType&&a.appendChild(b)}function k(a,b,c,d){if(this.formatter){d=this.formatter;var f=this.grid.formatterScope;c.innerHTML="string"===typeof d&&f?f[d](b,a):this.formatter(b,a)}else null!=b&&c.appendChild(document.createTextNode(b))}
var b=8>h("ie")&&!h("quirks");d=d("dgrid.Grid",p,{columns:null,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(a){return"object"!=typeof a?this.columns[a]:this.cell(a).column},listType:"grid",cell:function(a,b){if(a.column&&a.element)return a;a.target&&a.target.nodeType&&(a=a.target);var c;if(a.nodeType){do{if(this._rowIdToObject[a.id])break;var d=a.columnId;if(d){b=d;c=a;break}a=a.parentNode}while(a&&a!=this.domNode)}if(!c&&"undefined"!=typeof b){var f=this.row(a);if(d=f&&f.element)for(var d=
d.getElementsByTagName("td"),e=0;e<d.length;e++)if(d[e].columnId==b){c=d[e];break}}if(null!=a)return{row:f||this.row(a),column:b&&this.column(b),element:c}},createRowCells:function(a,d,f,k){var p=c("table.dgrid-row-table[role\x3dpresentation]"),e=9>h("ie")||h("quirks")?c(p,"tbody"):p,g,n,w,x,z,D,v,u,F,C;f=f||this.subRows;n=0;for(w=f.length;n<w;n++){D=f[n];g=c(e,"tr");D.className&&c(g,"."+D.className);x=0;for(z=D.length;x<z;x++){v=D[x];u=v.id;F=v.field?".field-"+l.escapeCssIdentifier(v.field,"-"):
"";(C="function"===typeof v.className?v.className(k):v.className)&&(F+="."+C);F=c(a+(".dgrid-cell.dgrid-cell-padding"+(u?".dgrid-column-"+l.escapeCssIdentifier(u,"-"):"")+F.replace(/ +/g,"."))+"[role\x3d"+("th"===a?"columnheader":"gridcell")+"]");F.columnId=u;b?(u=c(F,"!dgrid-cell-padding div.dgrid-cell-padding"),F.contents=u):u=F;if(C=v.colSpan)F.colSpan=C;if(C=v.rowSpan)F.rowSpan=C;d(u,v);g.appendChild(F)}}return p},left:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,-(b||
1),"dgrid-cell"))},right:function(a,b){a.element||(a=this.cell(a));return this.cell(this._move(a,b||1,"dgrid-cell"))},renderRow:function(b,d){var f=this.createRowCells("td",function(c,f){var e=b;f.get?e=f.get(b):"field"in f&&"_item"!=f.field&&(e=e[f.field]);f.renderCell?a(c,f.renderCell(b,e,c,d)):k.call(f,b,e,c,d)},d&&d.subRows,b);return c("div[role\x3drow]\x3e",f)},renderHeader:function(){var d=this,k=this.headerNode,l=k.childNodes.length;for(k.setAttribute("role","row");l--;)c(k.childNodes[l],"!");
l=this.createRowCells("th",function(c,d){var e=d.headerNode=c;b&&(c=c.parentNode);var f=d.field;f&&(c.field=f);if(d.renderHeaderCell)a(e,d.renderHeaderCell(e));else if("label"in d||d.field)e.appendChild(document.createTextNode("label"in d?d.label:d.field));!1!==d.sortable&&(f&&"_item"!=f)&&(c.sortable=!0,c.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[l.id=this.id+"-header"]=this.columns;k.appendChild(l);this._sortListener&&this._sortListener.remove();this._sortListener=
f(l,"click,keydown",function(a){if("click"==a.type||32==a.keyCode||!h("opera")&&13==a.keyCode){var b=a.target,c,g,l;do if(b.sortable){l=[{attribute:c=b.field||b.columnId,descending:(g=d._sort[0])&&g.attribute==c&&!g.descending}];c={bubbles:!0,cancelable:!0,grid:d,parentType:a.type,sort:l};f.emit(a.target,"dgrid-sort",c)&&(d._sortNode=b,d.set("sort",l));break}while((b=b.parentNode)&&b!=k)}})},resize:function(){var a=this.headerNode.firstChild,b=this.contentNode,c;this.inherited(arguments);if(!h("ie")||
7<h("ie")&&!h("quirks"))if(b.style.width="",b&&a&&(c=a.offsetWidth)!=b.offsetWidth)b.style.width=c+"px"},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(a,b){this.inherited(arguments);this.updateSortArrow(this._sort)},_findSortArrowParent:function(a){var b=this.columns,c;for(c in b){var d=b[c];if(d.field==a)return d.headerNode}},updateSortArrow:function(a,b){this._lastSortedArrow&&(c(this._lastSortedArrow,"\x3c!dgrid-sort-up!dgrid-sort-down"),
c(this._lastSortedArrow,"!"),delete this._lastSortedArrow);b&&(this._sort=a);if(a[0]){var d=a[0].attribute,f=a[0].descending,d=this._sortNode||this._findSortArrowParent(d),k;delete this._sortNode;d&&(d=d.contents||d,k=this._lastSortedArrow=c("div.dgrid-sort-arrow.ui-icon[role\x3dpresentation]"),k.innerHTML="\x26nbsp;",d.insertBefore(k,d.firstChild),c(d,f?".dgrid-sort-down":".dgrid-sort-up"),this.resize())}},styleColumn:function(a,b){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+
" .dgrid-column-"+l.escapeCssIdentifier(a,"-"),b)},_configColumns:function(a,b){var c=[],d=b instanceof Array;l.each(b,function(f,e){"string"==typeof f&&(b[e]=f={label:f});!d&&!f.field&&(f.field=e);e=f.id=f.id||(isNaN(e)?e:a+e);this._configColumn&&(this._configColumn(f,e,b,a),e=f.id);d&&(this.columns[e]=f);f.grid=this;"function"===typeof f.init&&f.init();c.push(f)},this);return d?b:c},_destroyColumns:function(){var a=this.subRows,b=a&&a.length,c,d,f,e;this.cleanup();for(c=0;c<b;c++){d=0;for(e=a[c].length;d<
e;d++)f=a[c][d],"function"===typeof f.destroy&&f.destroy()}},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;this.columns=!b||b instanceof Array?{}:b;if(a)for(b=0;b<a.length;b++)a[b]=this._configColumns(b+"-",a[b]);else this.subRows=[this._configColumns("",b)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(a){this._destroyColumns();this.subRows=null;this.columns=a;this._updateColumns()},_setSubRows:function(a){this._destroyColumns();this.subRows=
a;this._updateColumns()},setColumns:function(a){n.deprecated("setColumns(...)",'use set("columns", ...) instead',"dgrid 0.4");this.set("columns",a)},setSubRows:function(a){n.deprecated("setSubRows(...)",'use set("subRows", ...) instead',"dgrid 0.4");this.set("subRows",a)},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this._sort&&this._sort.length?this.updateSortArrow(this._sort):this.resize())}});
d.appendIfNode=a;d.defaultRenderCell=k;return d})},"put-selector/put":function(){(function(n){var d,f=/[-+,> ]/;n([],d=function(h,c){function p(c){function d(){g&&(e&&g!=e)&&(e==c&&(n||(n=f.test(z)&&h.createDocumentFragment()))?n:e).insertBefore(g,t||null)}for(var n,m,t,e,g,y=arguments,w=y[0],x=0;x<y.length;x++){var z=y[x];if("object"==typeof z){m=!1;if(z instanceof Array){g=h.createDocumentFragment();for(var D=0;D<z.length;D++)g.appendChild(p(z[D]));z=g}if(z.nodeType)g=z,d(),e=z,t=0;else for(D in z)g[D]=
z[D]}else if(m)m=!1,g.appendChild(h.createTextNode(z));else{1>x&&(c=null);m=!0;if(w=z.replace(l,function(f,m,l,n,r,w){m&&(d(),"-"==m||"+"==m?(e=(t=g||e).parentNode,g=null,"+"==m&&(t=t.nextSibling)):("\x3c"==m?e=g=(g||e).parentNode:(","==m?e=c:g&&(e=g),g=null),t=0),g&&(e=g));if((f=!l&&n)||!g&&(l||r))"$"==f?(f=y[++x],e.appendChild(h.createTextNode(f))):(f=f||p.defaultTag,(m=b&&y[x+1]&&y[x+1].name)&&(f="\x3c"+f+' name\x3d"'+m+'"\x3e'),g=k&&~(a=f.indexOf("|"))?h.createElementNS(k[f.slice(0,a)],f.slice(a+
1)):h.createElement(f));if(l)if("$"==n&&(n=y[++x]),"#"==l)g.id=n;else if(m=(f=g.className)&&(" "+f+" ").replace(" "+n+" "," "),"."==l)g.className=f?(m+n).substring(1):n;else if("!"==z){var D;b?p("div",g,"\x3c").innerHTML="":(D=g.parentNode)&&D.removeChild(g)}else m=m.substring(1,m.length-1),m!=f&&(g.className=m);r&&("$"==w&&(w=y[++x]),"style"==r?g.style.cssText=w:(l="!"==r.charAt(0)?(r=r.substring(1))&&"removeAttribute":"setAttribute",w=""===w?r:w,k&&~(a=r.indexOf("|"))?g[l+"NS"](k[r.slice(0,a)],
r.slice(a+1),w):g[l](r,w)));return""}))throw new SyntaxError("Unexpected char "+w+" in "+z);d();e=w=g||e}}c&&n&&c.appendChild(n);return w}f=c||f;var l=/(?:\s*([-+ ,<>]))?\s*(\.|!\.?|#)?([-\w\u00A0-\uFFFF%$|]+)?(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,a,k=!1;h=h||document;var b="object"==typeof h.createElement;p.addNamespace=function(a,b){h.createElementNS?(k||(k={}))[a]=b:h.namespaces.add(a,b)};p.defaultTag="div";p.forDocument=d;return p})})(function(n,d,f){f=f||d;"function"===typeof define?define([],
function(){return f()}):"undefined"==typeof window?require("./node-html")(module,f):put=f()})},"dgrid/List":function(){define("dojo/_base/kernel dojo/_base/declare dojo/dom dojo/on dojo/has ./util/misc dojo/has!touch?./TouchScroll xstyle/has-class put-selector/put dojo/_base/sniff xstyle/css!./css/dgrid.css".split(" "),function(n,d,f,h,c,p,l,a,k){function b(a,b){k(document.body,a,".dgrid-scrollbar-measure");var c=a["offset"+b]-a["client"+b];a.className="";document.body.removeChild(a);return c}function s(a){var b=
a?"."+a.replace(y,"."):"";this._class&&(b="!"+this._class.replace(y,"!")+b);k(this.domNode,b);this._class=a}function q(){return this._class}function r(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}}function m(a){"undefined"!==typeof a.x&&(this.bodyNode.scrollLeft=a.x);"undefined"!==typeof a.y&&(this.bodyNode.scrollTop=a.y)}a("mozilla","opera","webkit","ie","ie-6","ie-6-7","quirks","no-quirks","touch");var t,e;c.add("dom-scrollbar-width",function(a,c,d){return b(d,"Width")});c.add("dom-scrollbar-height",
function(a,c,d){return b(d,"Height")});c.add("dom-rtl-scrollbar-left",function(a,b,d){a=k("div");k(document.body,d,".dgrid-scrollbar-measure[dir\x3drtl]");k(d,a);b=!!c("ie")||!!c("trident")||a.offsetLeft>=c("dom-scrollbar-width");d.className="";document.body.removeChild(d);k(a,"!");d.removeAttribute("dir");return b});var g=0,y=/ +/g,w=7>c("ie")&&!c("quirks")?function(){var a,b,c;if(this._started&&(a=document.documentElement,b=a.clientWidth,a=a.clientHeight,c=this._prevWinDims||[],c[0]!==b||c[1]!==
a))this.resize(),this._prevWinDims=[b,a]}:function(){this._started&&this.resize()};return d("dgrid.List",c("touch")?l:null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,useTouchScroll:null,addUiClasses:!0,shouldObserveStore:!0,cleanEmptyObservers:!0,highlightDuration:250,postscript:function(a,b){var c=this;(this._Row=function(a,b,c){this.id=a;this.data=b;this.element=c}).prototype.remove=function(){c.removeRow(this.element)};b&&(this.srcNodeRef=b=b.nodeType?b:
document.getElementById(b));this.create(a,b)},listType:"list",create:function(a,b){var e=this.domNode=b||k("div"),f;a?(this.params=a,d.safeMixin(this,a),f=a["class"]||a.className||e.className,this._sort=a.sort||[],delete this.sort):this._sort=[];this.observers=[];this._numObservers=0;this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=e.id=e.id||this.id||"dgrid_"+g++;null===this.useTouchScroll&&(this.useTouchScroll=!c("dom-scrollbar-width"));this.buildRendering();
f&&s.call(this,f);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var a=this.domNode,b=this.addUiClasses,d=this,e,f,g,m;m=this.isRTL="rtl"==(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();a.className="";k(a,"[role\x3dgrid].dgrid.dgrid-"+this.listType+(b?".ui-widget":""));e=this.headerNode=k(a,"div.dgrid-header.dgrid-header-row"+(b?".ui-widget-header":"")+(this.showHeader?"":".dgrid-header-hidden"));
(c("quirks")||8>c("ie"))&&k(a,"div.dgrid-spacer");f=this.bodyNode=k(a,"div.dgrid-scroller");c("ff")&&(f.tabIndex=-1);this.headerScrollNode=k(a,"div.dgrid-header.dgrid-header-scroll.dgrid-scrollbar-width"+(b?".ui-widget-header":""));g=this.footerNode=k("div.dgrid-footer"+(this.showFooter?"":".dgrid-footer-hidden"));k(a,g);m&&(a.className+=" dgrid-rtl"+(c("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));h(f,"scroll",function(b){d.showHeader&&(e.scrollLeft=b.scrollLeft||f.scrollLeft);b.stopPropagation();
h.emit(a,"scroll",{scrollTarget:f})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=k(this.bodyNode,"div.dgrid-content"+(b?".ui-widget-content":""));this._listeners.push(this._resizeHandle=h(window,"resize",p.throttleDelayed(w,this)))},postCreate:c("touch")?function(){this.useTouchScroll&&this.inherited(arguments)}:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this._sort))},configStructure:function(){},
resize:function(){var a=this.bodyNode,b=this.headerNode,d=this.footerNode,f=b.offsetHeight,g=this.showFooter?d.offsetHeight:0,k=c("quirks")||7>c("ie");this.headerScrollNode.style.height=a.style.marginTop=f+"px";a.style.marginBottom=g+"px";k&&(a.style.height="",a.style.height=Math.max(this.domNode.offsetHeight-f-g,0)+"px",g&&(d.style.bottom="1px",setTimeout(function(){d.style.bottom=""},0)));t||(t=c("dom-scrollbar-width"),e=c("dom-scrollbar-height"),c("ie")&&(t++,e++),p.addCssRule(".dgrid-scrollbar-width",
"width: "+t+"px"),p.addCssRule(".dgrid-scrollbar-height","height: "+e+"px"),17!=t&&!k&&(p.addCssRule(".dgrid-header-row","right: "+t+"px"),p.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+t+"px")));k&&(b.style.width=a.clientWidth+"px",setTimeout(function(){b.scrollLeft=a.scrollLeft},0))},addCssRule:function(a,b){var c=p.addCssRule(a,b);this.cleanAddedRules&&this._listeners.push(c);return c},on:function(a,b){var d=h(this.domNode,a,b);c("dom-addeventlistener")||this._listeners.push(d);return d},
cleanup:function(){var a=this.observers,b;for(b in this._rowIdToObject)if(this._rowIdToObject[b]!=this.columns){var c=document.getElementById(b);c&&this.removeRow(c,!0)}for(b=0;b<a.length;b++)(c=a[b])&&c.cancel();this.observers=[];this._numObservers=0;this.preload=null},destroy:function(){if(this._listeners){for(var a=this._listeners.length;a--;)this._listeners[a].remove();delete this._listeners}this._started=!1;this.cleanup();k(this.domNode,"!");this.useTouchScroll&&this.inherited(arguments)},refresh:function(){this.cleanup();
this._rowIdToObject={};this._autoId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},newRow:function(a,b,c,d,e){if(b){var f=this.insertRow(a,b,c,d,e);k(f,".dgrid-highlight"+(this.addUiClasses?".ui-state-highlight":""));setTimeout(function(){k(f,"!dgrid-highlight!ui-state-highlight")},this.highlightDuration);return f}},adjustRowIndices:function(a){var b=a.rowIndex;if(-1<b){do-1<a.rowIndex&&(this.maintainOddEven&&-1<(a.className+" ").indexOf("dgrid-row ")&&k(a,"."+(1==b%2?"dgrid-row-odd":"dgrid-row-even")+
"!"+(0==b%2?"dgrid-row-odd":"dgrid-row-even")),a.rowIndex=b++);while((a=a.nextSibling)&&a.rowIndex!=b)}},renderArray:function(a,b,c){function d(){var b=arguments;if(-1<n)for(var f=0;f<b.length;f++){var g=b[f],k=l[g?0:l.length-1];if(k=k&&e(k)){var m=k[g?"previousSibling":"nextSibling"];m&&(m=h.row(m));m&&m.element!=k&&(g=g?"unshift":"push",a[g](m.data),l[g](m.element),c.count++)}}}function e(a){return!f.isDescendant(a,h.domNode)&&document.getElementById(a.id)?h.row(a.id.slice(h.id.length+5)).element:
a}function g(a){t=h.insertRow(a,s,null,m++,c);t.observerIndex=n;return t}function k(a){y=a.slice(0);(p=b?b.parentNode:h.contentNode)&&p.parentNode&&(p!==h.contentNode||a.length)?(p.insertBefore(s,b||null),(t=a[a.length-1])&&h.adjustRowIndices(t)):q[n]&&h.cleanEmptyObservers&&"undefined"!==typeof n&&(q[n].cancel(),q[n]=0,h._numObservers--);l=a;r&&(r.rows=l)}c=c||{};var h=this,m=c.start||0,q=this.observers,l,p,n;b||(this._lastCollection=a);if(a.observe&&this.shouldObserveStore){h._numObservers++;var r=
a.observe(function(f,g,k){var m,q,r;-1<g&&l[g]&&(m=l.splice(g,1)[0],m.parentNode==p&&((q=m.nextSibling)&&g!=k&&q.rowIndex--,h.removeRow(m)),c.count--,h._processScroll&&h._processScroll());if(-1<k){if(l.length)if(0===k)r=(r=l[k])&&e(r);else{if(r=l[k-1])r=e(r),r=(r.connected||r).nextSibling}else r=h._getFirstRowSibling&&h._getFirstRowSibling(p);m&&(r&&m.id===r.id)&&(r=(r.connected||r).nextSibling);r&&!r.parentNode&&(r=document.getElementById(r.id));m=b&&b.parentNode||r&&r.parentNode||h.contentNode;
if(m=h.newRow(f,m,r,c.start+k,c))if(m.observerIndex=n,l.splice(k,0,m),!q||k<g)q=m.previousSibling,q=!q||q.rowIndex+1==m.rowIndex||0==m.rowIndex?m:q;c.count++}0===g?d(1,1):g===a.length-(-1===k?0:1)&&d(0,0);g!=k&&q&&h.adjustRowIndices(q);h._onNotification(l,f,g,k)},!0);n=q.push(r)-1}var s=document.createDocumentFragment(),t,y;if(a.map){if(l=a.map(g,console.error),l.then)return a.then(function(b){a=b;return l.then(function(a){k(a);d(1,1,0,0);return y})})}else{l=[];for(var w=0,M=a.length;w<M;w++)l[w]=
g(a[w])}k(l);d(1,1,0,0);return y},_onNotification:function(a,b,c,d){},renderHeader:function(){},_autoId:0,insertRow:function(a,b,c,d,e){var f=e.parentId,f=this.id+"-row-"+(f?f+"-":"")+(this.store&&this.store.getIdentity?this.store.getIdentity(a):this._autoId++),g=document.getElementById(f),k=g&&g.previousSibling;g&&(g===c&&(c=(c.connected||c).nextSibling),this.removeRow(g));g=this.renderRow(a,e);g.className=(g.className||"")+" dgrid-row "+(1==d%2?"dgrid-row-odd":"dgrid-row-even")+(this.addUiClasses?
" ui-state-default":"");this._rowIdToObject[g.id=f]=a;b.insertBefore(g,c||null);k&&this.adjustRowIndices(k);g.rowIndex=d;return g},renderRow:function(a,b){return k("div",""+a)},removeRow:function(a,b){a=a.element||a;delete this._rowIdToObject[a.id];b||k(a,"!")},row:function(a){var b;if(a instanceof this._Row)return a;a.target&&a.target.nodeType&&(a=a.target);if(a.nodeType){do{var c=a.id;if(b=this._rowIdToObject[c])return new this._Row(c.substring(this.id.length+5),b,a);a=a.parentNode}while(a&&a!=
this.domNode)}else return"object"==typeof a?b=this.store.getIdentity(a):(b=a,a=this._rowIdToObject[this.id+"-row-"+b]),new this._Row(b,a,document.getElementById(this.id+"-row-"+b))},cell:function(a){return{row:this.row(a)}},_move:function(a,b,c,d){var e,f;f=e=a.element;b=b||1;do if(a=e[0>b?"previousSibling":"nextSibling"]){do if((e=a)&&-1<(e.className+" ").indexOf(c+" ")){f=e;b+=0>b?1:-1;break}while(a=(!d||!e.hidden)&&e[0>b?"lastChild":"firstChild"])}else if(e=e.parentNode,!e||e===this.bodyNode||
e===this.headerNode)break;while(b);return f},up:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,-(b||1),"dgrid-row",c))},down:function(a,b,c){a.element||(a=this.row(a));return this.row(this._move(a,b||1,"dgrid-row",c))},scrollTo:c("touch")?function(a){return this.useTouchScroll?this.inherited(arguments):m.call(this,a)}:m,getScrollPosition:c("touch")?function(){return this.useTouchScroll?this.inherited(arguments):r.call(this)}:r,get:function(a){var b="_get"+a.charAt(0).toUpperCase()+
a.slice(1);return"function"===typeof this[b]?this[b].apply(this,[].slice.call(arguments,1)):this[a]},set:function(a,b){if("object"===typeof a)for(var c in a)this.set(c,a[c]);else c="_set"+a.charAt(0).toUpperCase()+a.slice(1),"function"===typeof this[c]?this[c].apply(this,[].slice.call(arguments,1)):this[a]=b;return this},_getClass:q,_setClass:s,_getClassName:q,_setClassName:s,_setSort:function(a,b){this._sort="string"!=typeof a?a:[{attribute:a,descending:b}];this.refresh();this._lastCollection&&(a.length&&
("string"!=typeof a&&(b=a[0].descending,a=a[0].attribute),this._lastCollection.sort(function(c,d){var e=c[a],f=d[a];void 0===e&&(e="");void 0===f&&(f="");return e==f?0:e>f==!b?1:-1})),this.renderArray(this._lastCollection))},sort:function(a,b){n.deprecated("sort(...)",'use set("sort", ...) instead',"dgrid 0.4");this.set("sort",a,b)},_getSort:function(){return this._sort},_setShowHeader:function(a){var b=this.headerNode;this.showHeader=a;k(b,(a?"!":".")+"dgrid-header-hidden");this.renderHeader();this.resize();
a&&(b.scrollLeft=this.getScrollPosition().x)},setShowHeader:function(a){n.deprecated("setShowHeader(...)",'use set("showHeader", ...) instead',"dgrid 0.4");this.set("showHeader",a)},_setShowFooter:function(a){this.showFooter=a;k(this.footerNode,(a?"!":".")+"dgrid-footer-hidden");this.resize()}})})},"dgrid/util/misc":function(){define(["dojo/has","put-selector/put"],function(n,d){n.add("dom-contains",function(a,b,c){return!!c.contains});var f=[],h,c,p,l=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,a={defaultDelay:15,
throttle:function(c,b,d){var f=!1;d=d||a.defaultDelay;return function(){f||(f=!0,c.apply(b,arguments),setTimeout(function(){f=!1},d))}},throttleDelayed:function(c,b,d){var f=!1;d=d||a.defaultDelay;return function(){if(!f){f=!0;var a=arguments;setTimeout(function(){f=!1;c.apply(b,a)},d)}}},debounce:function(c,b,d){var f;d=d||a.defaultDelay;return function(){f&&(clearTimeout(f),f=null);var a=arguments;f=setTimeout(function(){c.apply(b,a)},d)}},each:function(a,b,c){var d,f;if(a)if("number"===typeof a.length){d=
0;for(f=a.length;d<f;d++)b.call(c,a[d],d,a)}else for(d in a)b.call(c,a[d],d,a)},contains:function(a,b){return n("dom-contains")?a.contains(b):a.compareDocumentPosition(b)&8},addCssRule:function(a,b){h||(h=d(document.getElementsByTagName("head")[0],"style"),h=h.sheet||h.styleSheet,c=h.deleteRule?"deleteRule":"removeRule",p=h.cssRules?"cssRules":"rules");var l=f.length;f[l]=(h.cssRules||h.rules).length;h.addRule?h.addRule(a,b):h.insertRule(a+"{"+b+"}",f[l]);return{get:function(a){return h[p][f[l]].style[a]},
set:function(a,b){"undefined"!==typeof f[l]&&(h[p][f[l]].style[a]=b)},remove:function(){var a=f[l],b,d;if(void 0!==a){h[c](a);f[l]=void 0;b=l+1;for(d=f.length;b<d;b++)f[b]>a&&f[b]--}}}},escapeCssIdentifier:function(a,b){return"string"===typeof a?a.replace(l,b||"\\$1"):a}};return a})},"xstyle/has-class":function(){define(["dojo/has"],function(n){var d={};return function(){for(var f,h=arguments,c=0;c<h.length;c++)if(f=h[c],!d[f]){d[f]=!0;var p=f.match(/^(no-)?(.+?)((-[\d\.]+)(-[\d\.]+)?)?$/),l=n(p[2]),
a=-p[4];if((0<a?a<=l&&(-p[5]||a)>=l:!!l)==!p[1])document.documentElement.className+=" has-"+f}}})},"xstyle/css":function(){define(["require"],function(n){function d(d,h,c){var p=document.documentElement;d=p.insertBefore(document.createElement(d),p.firstChild);d.id=h;h=(d.currentStyle||getComputedStyle(d,null))[c];p.removeChild(d);return h}return{load:function(f,h,c,p){function l(){var a=d("x-parse",null,"content");a&&"none"!=a?h([eval(a)],c):c()}var a=h.toUrl(f),k=h.cache["url:"+a];if(k)return k.xCss&&
(k=k.cssText),n(["./util/createStyleSheet"],function(a){a(k)}),l();if("none"==d("div",f.replace(/\//g,"-").replace(/\..*/,"")+"-loaded","display"))return l();n(["./load-css"],function(b){b(a,l)})}}})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/dom dojo/on ./util/misc put-selector/put".split(" "),function(n,d,f,h,c,p,l,a,k){return f("dgrid.OnDemandList",[n,d],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,
farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:a.defaultDelay,keepScrollPosition:!1,rowHeight:22,postCreate:function(){this.inherited(arguments);var b=this;l(this.bodyNode,"scroll",a[this.pagingMethod](function(a){b._processScroll(a)},null,this.pagingDelay))},destroy:function(){this.inherited(arguments);this._refreshTimeout&&clearTimeout(this._refreshTimeout)},renderQuery:function(a,d){function f(a){k(x,"!");if(a)throw l._refreshDeferred&&(l._refreshDeferred.reject(a),delete l._refreshDeferred),
a;}var l=this,m=d&&d.container||this.contentNode,p={query:a,count:0,options:d},e,g=this.preload,n,w={node:k(m,"div.dgrid-preload",{rowIndex:0}),count:0,query:a,next:p,options:d};w.node.style.height="0";p.node=e=k(m,"div.dgrid-preload");p.previous=w;e.rowIndex=this.minRowsPerPage;g?((p.next=g.next)&&e.offsetTop>=g.node.offsetTop?p.previous=g:(p.next=g,p.previous=g.previous),p.previous.next=p,p.next.previous=p):this.preload=p;var x=k(e,"-div.dgrid-loading");k(x,"div.dgrid-below").innerHTML=this.loadingMessage;
d=h.mixin(this.get("queryOptions"),d,{start:0,count:this.minRowsPerPage},"level"in a?{queryLevel:a.level}:null);this._trackError(function(){return n=a(d)});if("undefined"===typeof n)f();else return c.when(l.renderArray(n,e,d),function(a){return c.when("undefined"===typeof n.total?n.length:n.total,function(b){var c=a.length,f=e.parentNode,g=l.noDataNode;k(x,"!");"queryLevel"in d||(l._total=b);0===b&&f&&(g&&(k(g,"!"),delete l.noDataNode),l.noDataNode=g=k("div.dgrid-no-data"),f.insertBefore(g,l._getFirstRowSibling(f)),
g.innerHTML=l.noDataMessage);for(g=f=0;g<c;g++)f+=l._calcRowHeight(a[g]);c&&f&&(l.rowHeight=f/c);b-=c;p.count=b;e.rowIndex=c;b?e.style.height=Math.min(b*l.rowHeight,l.maxEmptySpace)+"px":(e.style.display="none",d.count++);l._previousScrollPosition&&(l.scrollTo(l._previousScrollPosition),delete l._previousScrollPosition);l._processScroll();l._refreshDeferred&&(l._refreshDeferred.resolve(n),delete l._refreshDeferred);return a},f)},f),n},refresh:function(a){var d=this,f=a&&a.keepScrollPosition,h;"undefined"===
typeof f&&(f=this.keepScrollPosition);f&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this.store)return f=this._refreshDeferred=new c,h=d.renderQuery(function(a){return d.store.query(d.query,a)}),"undefined"===typeof h&&f.reject(),f.then(function(a){d._refreshTimeout=setTimeout(function(){l.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:d,results:a});d._refreshTimeout=null},0);delete d._refreshDeferred;return a},function(a){delete d._refreshDeferred;
throw a;})},resize:function(){this.inherited(arguments);this._processScroll()},_getFirstRowSibling:function(a){return a.lastChild},_calcRowHeight:function(a){var c=a.nextSibling;return c&&!/\bdgrid-preload\b/.test(c.className)?c.offsetTop-a.offsetTop:a.offsetHeight},lastScrollTop:0,_processScroll:function(a){function d(a,b,c,e){var g=m.farOffRemoval,h=a.node;if(b>2*g){for(var l,n=h[c],p=0,r=0,s=[];l=n;){var t=m._calcRowHeight(l);if(p+t+g>b||0>n.className.indexOf("dgrid-row")&&0>n.className.indexOf("dgrid-loading"))break;
n=l[c];p+=t;r+=l.count||1;m.removeRow(l,!0);s.push(l)}a.count+=r;e?(h.rowIndex-=r,f(a)):h.style.height=h.offsetHeight+p+"px";var y=k("div",s);setTimeout(function(){k(y,"!")},1)}}function f(a,b){a.node.style.height=Math.min(a.count*m.rowHeight,b?Infinity:m.maxEmptySpace)+"px"}function l(a,b){do a=b?a.next:a.previous;while(a&&!a.node.offsetWidth);return a}var m=this,p=m.bodyNode;a=a&&a.scrollTop||this.getScrollPosition().y;var p=p.offsetHeight+a,e,g,n=m.preload,w=m.lastScrollTop,x=m.bufferRows*m.rowHeight,
z=x-m.rowHeight,D,v,u,F=!0;for(m.lastScrollTop=a;n&&!n.node.offsetWidth;)n=n.previous;for(;n&&n!=e;){e=m.preload;m.preload=n;g=n.node;var C=g.offsetTop;if(p+1+z<C)n=l(n,F=!1);else if(a-1-z>C+g.offsetHeight)n=l(n,F=!0);else{var B=((g.rowIndex?a-x:p)-C)/m.rowHeight,C=(p-a+2*x)/m.rowHeight,E=Math.max(Math.min((a-w)*m.rowHeight,m.maxRowsPerPage/2),m.maxRowsPerPage/-2),C=C+Math.min(Math.abs(E),10);0==g.rowIndex&&(B-=C);B=Math.max(B,0);10>B&&(0<B&&C+B<m.maxRowsPerPage)&&(C+=Math.max(0,B),B=0);C=Math.min(Math.max(C,
m.minRowsPerPage),m.maxRowsPerPage,n.count);if(0==C)n=l(n,F);else{var C=Math.ceil(C),B=Math.min(Math.floor(B),n.count-C),G=h.mixin(m.get("queryOptions"),n.options);n.count-=C;var J=g,K,N=m.queryRowsOverlap;if(E=(0<g.rowIndex||g.offsetTop>a)&&n){var O=n.previous;O&&(d(O,a-(O.node.offsetTop+O.node.offsetHeight),"nextSibling"),0<B&&O.node==g.previousSibling?(B=Math.min(n.count,B),n.previous.count+=B,f(n.previous,!0),g.rowIndex+=B,N=0):C+=B,n.count-=B);G.start=g.rowIndex-N;G.count=Math.min(C+N,m.maxRowsPerPage);
g.rowIndex=G.start+G.count}else n.next&&(d(n.next,n.next.node.offsetTop-p,"previousSibling",!0),J=g.nextSibling,J==n.next.node?(n.next.count+=n.count-B,n.next.node.rowIndex=B+C,f(n.next),n.count=B,N=0):K=!0),G.start=n.count,G.count=Math.min(C+N,m.maxRowsPerPage);K&&(J&&J.offsetWidth)&&(K=J.offsetTop);f(n);"level"in n.query&&(G.queryLevel=n.query.level);if("queryLevel"in G||!(G.start>m._total||0>G.count)){g=k(J,"-div.dgrid-loading[style\x3dheight:"+C*m.rowHeight+"px]");k(g,"div.dgrid-"+(E?"below":
"above")).innerHTML=m.loadingMessage;g.count=C;var P=n.query(G);if(void 0===m._trackError(function(){return P})){k(g,"!");return}(function(a,b,d,e){u=c.when(m.renderArray(e,a,G),function(g){v=e;J=a.nextSibling;k(a,"!");if(d&&J&&J.offsetWidth){var h=m.getScrollPosition();m.scrollTo({x:h.x,y:h.y+J.offsetTop-d,preserveMomentum:!0})}c.when(e.total||e.length,function(a){"queryLevel"in G||(m._total=a);b&&(b.count=a-b.node.rowIndex,0===b.count&&G.count++,f(b))});m._processScroll();return g},function(b){k(a,
"!");throw b;})}).call(this,g,E,K,P);n=n.previous}}}}if(u&&(D=this._refreshDeferred))delete this._refreshDeferred,c.when(u,function(){D.resolve(v)})},removeRow:function(a,c){if(a){var d=a.previousSibling,f=a.nextSibling,d=d&&(null!=d.observerIndex?d.observerIndex:d.previousObserverIndex),h=f&&(null!=f.observerIndex?f.observerIndex:f.nextObserverIndex),f=a.observerIndex;a.observerIndex=void 0;c&&(a.nextObserverIndex=h,a.previousObserverIndex=d);if(this.cleanEmptyObservers&&(-1<f&&f!==d&&f!==h)&&(d=
this.observers,h=d[f])){if(!c)for(var k=h.rows,e=0;e<k.length;e++)if(k[e]!=a&&p.isDescendant(k[e],this.domNode))return this.inherited(arguments);h.cancel();this._numObservers--;d[f]=0}}this.inherited(arguments)}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/on dojo/aspect put-selector/put".split(" "),function(n,d,f,h,c,p,l){function a(a){return a}function k(a){if("object"!==typeof a)a=Error(a);else if("cancel"===a.dojoType)return;
a.grid=this;c.emit(this.domNode,"dgrid-error",{grid:this,error:a,cancelable:!0,bubbles:!0})&&console.error(a)}return d("dgrid._StoreMixin",null,{store:null,query:null,queryOptions:null,getBeforePut:!0,noDataMessage:"",loadingMessage:"",constructor:function(){this.query={};this.queryOptions={};this.dirty={};this._updating={};this._columnsWithSet={};p.before(this,"configStructure",f.hitch(this,function(){this._columnsWithSet={}}))},postCreate:function(){this.inherited(arguments);this.store&&this._updateNotifyHandle(this.store)},
destroy:function(){this.inherited(arguments);this._notifyHandle&&this._notifyHandle.remove()},_configColumn:function(a){a.set&&(this._columnsWithSet[a.field]=a);this.inherited(arguments)},_updateNotifyHandle:function(a){this._notifyHandle&&(this._notifyHandle.remove(),delete this._notifyHandle);a&&("function"===typeof a.notify&&this.shouldObserveStore)&&(this._notifyHandle=p.after(a,"notify",f.hitch(this,"_onNotify"),!0),a=this.get("sort"),(!a||!a.length)&&console.warn("Observable store detected, but no sort order specified. You may experience quirks when adding/updating items.  These can be resolved by setting a sort order on the list or grid."))},
_setStore:function(a,c,d){this._updateNotifyHandle(a);this.store=a;this.dirty={};this.set("query",c,d)},_setQuery:function(a,c){var d=c&&c.sort;this.query=void 0!==a?a:this.query;this.queryOptions=c||this.queryOptions;this._started&&(d?this.set("sort",d):this.refresh())},setStore:function(a,c,d){n.deprecated("setStore(...)",'use set("store", ...) instead',"dgrid 0.4");this.set("store",a,c,d)},setQuery:function(a,c){n.deprecated("setQuery(...)",'use set("query", ...) instead',"dgrid 0.4");this.set("query",
a,c)},_getQueryOptions:function(){var a=f.delegate(this.queryOptions,{});if("function"===typeof this._sort||this._sort.length)a.sort=this._sort;return a},_getQuery:function(){var a=this.query;return"object"==typeof a&&null!=a?f.delegate(a,{}):a},_setSort:function(a,c){this.store&&(this._lastCollection=null);this.inherited(arguments)},_onNotify:function(a,c){this.inherited(arguments);a&&1>this._numObservers&&this.refresh({keepScrollPosition:!0})},refresh:function(){var a=this.inherited(arguments);
this.store||(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return a},renderArray:function(){var a=this,c=this.inherited(arguments);this.store||h.when(c,function(c){c.length&&a.noDataNode&&l(a.noDataNode,"!")});return c},insertRow:function(a,c,d,h,k){var l=this.store,e=this.dirty,l=l&&l.getIdentity(a),g;l in e&&!(l in this._updating)&&(g=e[l]);g&&(a=f.delegate(a,g));return this.inherited(arguments)},updateDirty:function(a,c,d){var f=this.dirty,
h=f[a];h||(h=f[a]={});h[c]=d},setDirty:function(a,c,d){n.deprecated("setDirty(...)","use updateDirty() instead","dgrid 0.4");this.updateDirty(a,c,d)},save:function(){function a(b,e){return function(a){var g=c._columnsWithSet,k=c._updating,m,l;if("function"===typeof a.set)a.set(e);else for(m in e)a[m]=e[m];for(m in g)l=g[m].set(a),void 0!==l&&(a[m]=l);k[b]=!0;return h.when(d.put(a),function(){delete f[b];delete k[b]})}}var c=this,d=this.store,f=this.dirty,k=new h,l=k.promise,e=function(a){var b;return c.getBeforePut||
!(b=c.row(a).data)?function(){return d.get(a)}:function(){return b}},g;for(g in f)var n=a(g,f[g]),l=l.then(e(g)).then(n);k.resolve();return l},revert:function(){this.dirty={};this.refresh()},_trackError:function(b){var c;"string"==typeof b&&(b=f.hitch(this,b));try{c=b()}catch(d){k.call(this,d)}return h.when(c,a,f.hitch(this,k))},newRow:function(){var a=this.inherited(arguments);this.noDataNode&&(l(this.noDataNode,"!"),delete this.noDataNode);return a},removeRow:function(a,c){var d={element:a};!c&&
(this.noDataMessage&&this.up(d).element===a&&this.down(d).element===a)&&(this.noDataNode=l(this.contentNode,"div.dgrid-no-data"),this.noDataNode.innerHTML=this.noDataMessage);return this.inherited(arguments)}})})},"dgrid/Selection":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/Deferred dojo/on dojo/has dojo/aspect ./List dojo/has!touch?./util/touch put-selector/put dojo/query dojo/_base/sniff".split(" "),function(n,d,f,h,c,p,l,a,k){function b(a,b){for(var c=a.unselectable=b?"on":
"",d=a.getElementsByTagName("*"),e=d.length;--e;)"INPUT"===d[e].tagName||"TEXTAREA"===d[e].tagName||(d[e].unselectable=c)}function s(a,d){var e=a.bodyNode,f=d?"text":21>c("ff")?"-moz-none":"none";r&&"msUserSelect"!==r?e.style[r]=f:c("dom-selectstart")?!d&&!a._selectstartHandle?a._selectstartHandle=h(e,"selectstart",function(a){var b=a.target&&a.target.tagName;"INPUT"!==b&&"TEXTAREA"!==b&&a.preventDefault()}):d&&a._selectstartHandle&&(a._selectstartHandle.remove(),delete a._selectstartHandle):(b(e,
!d),!d&&!a._unselectableHandle?a._unselectableHandle=p.after(a,"renderRow",function(a){b(a,!0);return a}):d&&a._unselectableHandle&&(a._unselectableHandle.remove(),delete a._unselectableHandle))}c.add("dom-comparedocumentposition",function(a,b,c){return!!c.compareDocumentPosition});c.add("pointer",function(a){return"PointerEvent"in a?"pointer":"MSPointerEvent"in a?"MSPointer":!1});c.add("css-user-select",function(a,b,c){a=c.style;b=["Khtml","O","ms","Moz","Webkit"];c=b.length;var d="userSelect";do if("undefined"!==
typeof a[d])return d;while(c--&&(d=b[c]+"UserSelect"));return!1});c.add("dom-selectstart","undefined"!==typeof document.onselectstart);var q=c("mac")?"metaKey":"ctrlKey",r=c("css-user-select"),m=(l=c("pointer"))&&"MS"===l.slice(0,2),t=l?l+(m?"Down":"down"):"mousedown",e=l?l+(m?"Up":"up"):"mouseup";"WebkitUserSelect"===r&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(r=!1);return d("dgrid.Selection",null,{selectionDelegate:".dgrid-row",selectionEvents:t+","+e+",dgrid-cellfocusin",
selectionTouchEvents:c("touch")?a.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this._initSelectionEvents();var a=this.selectionMode;this.selectionMode="";this._setSelectionMode(a)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&
this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(a){a!=this.selectionMode&&(this.clearSelection(),this.selectionMode=a,this._selectionHandlerName="_"+a+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},setSelectionMode:function(a){n.deprecated("setSelectionMode(...)",'use set("selectionMode", ...) instead',"dgrid 0.4");this.set("selectionMode",a)},_setAllowTextSelection:function(a){"undefined"!==typeof a?
s(this,a):s(this,"none"===this.selectionMode);this.allowTextSelection=a},_handleSelect:function(a,b){if(this[this._selectionHandlerName]&&this.allowSelect(this.row(b))&&!("dgrid-cellfocusin"===a.type&&"mousedown"===a.parentType||a.type===e&&b!=this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=a;if(!a.keyCode||!a.ctrlKey||32==a.keyCode)if(!a.shiftKey&&a.type===t&&this.isSelected(b))this._waitForMouseUp=b;else this[this._selectionHandlerName](a,b);this._selectionTriggerEvent=
null}},_singleSelectionHandler:function(a,b){var c=a.keyCode?a.ctrlKey:a[q];this._lastSelected===b?this.select(b,null,!c||!this.isSelected(b)):(this.clearSelection(),this.select(b),this._lastSelected=b)},_multipleSelectionHandler:function(a,b){var c=this._lastSelected,d=a.keyCode?a.ctrlKey:a[q],e;a.shiftKey||(e=d?null:!0,c=null);this.select(b,c,e);c||(this._lastSelected=b)},_extendedSelectionHandler:function(a,b){(2===a.button?!this.isSelected(b):!(a.keyCode?a.ctrlKey:a[q]))&&this.clearSelection(null,
!0);this._multipleSelectionHandler(a,b)},_toggleSelectionHandler:function(a,b){this.select(b,null,null)},_initSelectionEvents:function(){var b=this,d=this.contentNode,f=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};c("touch")&&!c("pointer")&&this.selectionTouchEvents?(h(d,a.selector(f,this.selectionTouchEvents),function(a){b._handleSelect(a,this);b._ignoreMouseSelect=this}),h(d,h.selector(f,this.selectionEvents),function(a){b._ignoreMouseSelect!==this?b._handleSelect(a,
this):a.type===e&&(b._ignoreMouseSelect=null)})):h(d,h.selector(f,this.selectionEvents),function(a){b._handleSelect(a,this)});this.addKeyHandler&&this.addKeyHandler(32,function(a){b._handleSelect(a,a.target)});if(this.allowSelectAll)this.on("keydown",function(a){a[q]&&(65==a.keyCode&&!/\bdgrid-input\b/.test(a.target.className))&&(a.preventDefault(),b[b.allSelected?"clearSelection":"selectAll"]())});this._setStore&&p.after(this,"_setStore",function(){b._updateDeselectionAspect()});this._updateDeselectionAspect()},
_updateDeselectionAspect:function(){function a(c,d,e){c=d||c&&c[b.idProperty||"id"];if(null!=c&&(d=(c=b.row(c))&&b.selection[c.id]))b[e](c,null,d)}var b=this,c=this.store,d,e;this._removeDeselectSignals&&this._removeDeselectSignals();c&&c.notify?(d=p.before(c,"notify",function(b,c){b||a(b,c,"deselect")}),e=p.after(c,"notify",function(b,c){a(b,c,"select")},!0),this._removeDeselectSignals=function(){d.remove();e.remove()}):(d=p.before(this,"removeRow",function(a,b){var c;b||(c=this.row(a))&&c.id in
this.selection&&this.deselect(c)}),this._removeDeselectSignals=function(){d.remove()})},allowSelect:function(a){return!0},_fireSelectionEvent:function(a){var b=this._selectionEventQueues[a],c=this._selectionTriggerEvent,d;d={bubbles:!0,grid:this};c&&(d.parentType=c.type);d[this._selectionTargetType]=b;this._selectionEventQueues[a]=[];h.emit(this.contentNode,"dgrid-"+a,d)},_fireSelectionEvents:function(){var a=this._selectionEventQueues,b;for(b in a)a[b].length&&this._fireSelectionEvent(b)},_select:function(a,
b,c){var d,e,f;"undefined"===typeof c&&(c=!0);a.element||(a=this.row(a));if(!1===c||this.allowSelect(a))if(d=this.selection,e=!!d[a.id],null===c&&(c=!e),f=a.element,!c&&!this.allSelected?delete this.selection[a.id]:d[a.id]=c,f&&(c?k(f,".dgrid-selected"+(this.addUiClasses?".ui-state-active":"")):k(f,"!dgrid-selected!ui-state-active")),c!==e&&f&&this._selectionEventQueues[(c?"":"de")+"select"].push(a),b)if(b.element||(b=this.row(b)),b){if(b=b.element){d=this._determineSelectionDirection(f,b);d||(b=
document.getElementById(b.id),d=this._determineSelectionDirection(f,b));for(;a.element!=b&&(a=this[d](a));)this._select(a,null,c)}}else this._lastSelected=f,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")},_determineSelectionDirection:c("dom-comparedocumentposition")?function(a,b){var c=
b.compareDocumentPosition(a);return c&1?!1:2===c?"down":"up"}:function(a,b){return 1>b.sourceIndex?!1:b.sourceIndex>a.sourceIndex?"down":"up"},select:function(a,b,c){this._select(a,b,c);this._fireSelectionEvents()},deselect:function(a,b){this.select(a,b,!1)},clearSelection:function(a,b){this.allSelected=!1;for(var c in this.selection)a!==c&&this._select(c,null,!1);b||(this._lastSelected=null);this._fireSelectionEvents()},selectAll:function(){this.allSelected=!0;this.selection={};for(var a in this._rowIdToObject){var b=
this.row(this._rowIdToObject[a]);this._select(b.id,null,!0)}this._fireSelectionEvents()},isSelected:function(a){if("undefined"===typeof a||null===a)return!1;a.element||(a=this.row(a));return a.id in this.selection?!!this.selection[a.id]:this.allSelected&&(!a.data||this.allowSelect(a))},refresh:function(){this.deselectOnRefresh&&this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var a=this,b=this.inherited(arguments);f.when(b,function(b){var c=a.selection,
d,e,f;for(d=0;d<b.length;d++)e=a.row(b[d]),(f=e.id in c?c[e.id]:a.allSelected)&&a._select(e,null,f);a._fireSelectionEvents()});return b}})})},"xstyle/main":function(){define("xstyle/main",["require","put-selector/put"],function(n,d){function f(a,b){return a&&a.then?a.then(b):b(a)}function h(a,b,c){return f(a,function(a){var d=b[0];if(!a)return c(d||a);if(d&&a.get)return h(a.get(d),b.slice(1),c);if(a.receive)return a.receive(d?function(a){h(a,b,c)}:c);if(d)return h(a[d],b.slice(1),c);c(a)})}function c(a,
b,c){h(a,b.slice(0,b.length-1),function(a){var d=b[b.length-1];a.set?a.set(d,c):a[d]=c})}function p(a){a=C.getElementsByTagName(a);for(var b=0;b<a.length;b++)k(a[b])}function l(){return this.join("")}function a(a){this.value=a}function k(a,c,d){function e(){n(["xstyle/load-imports"],function(b){b(a,function(){k(a,c,!0)})})}var f=a.sheet||a.styleSheet||a,g=f.needsParsing,h=f.rules||f.cssRules;if(f.imports&&!d&&f.imports.length)return e();if(!g)for(var m=0;m<h.length;m++){var l=h[m];if(l.href&&!d)return e();
l.selectorText&&"x-"==l.selectorText.substring(0,2)&&(g=!0,/^'/.test(l.style.content))}b(f.localSource||(f.ownerNode||f.ownerElement).innerHTML,f,c)}function b(c,d,h){function k(a,b,c){(G[a]||(G[a]={}))[b]=c}function m(a){G[a]||(G[a]={});k("selector","x-"+a,{onRule:function(b){b.eachProperty(function(b,c){var d=c.toString();do{d=d.match(/([^, \(]+)(?:[, ]+(.+))?/);if(!d)break;var e=d[1];if("module"==e)return k(a,b,c[1].args[0]);if("default"==e){if("pseudo"==a)try{C.querySelectorAll("x:"+b);break}catch(f){}}else if("prefix"!=
e)return k(a,b,function(){return c})}while(d=d[2])})}})}function q(){}function p(a){this.caller=a;this.args=[]}function r(a,b){b.onRule();var c=G.selector[a];c&&s(c,"onRule",b)}function s(a,b,c,e){if(a){var f=H,g=function(a){"string"==typeof a&&d.addRule(f.fullSelector(),a);0==--aa&&h&&h(d)};aa++;var k=function(a){function h(a){console.error("Error occurred processing "+b.slice(2).toLowerCase()+" "+c+("{"==f.operator?' in rule "'+f.selector+'" {'+f.cssText:"")+". "+a.message);a&&console.error(a)}
try{var k=a[b](c,e,f,d);f instanceof p&&(f.result=k);k&&k.then?k.then(g,h):g(k)}catch(m){h(m)}};"string"==typeof a?n([a],k):k(a)}}function u(c,d){function e(a,b){b||(m+=a);if(E)if(E.push)"string"==typeof E[E.length-1]&&"string"==typeof a?E[E.length-1]+=a:a&&E.push(a);else if("string"==typeof E&&"string"==typeof a)E+=a;else{var c=[E,a];c.toString=l;E=c}else E=a}H=K;for(var f=w.lastIndex=0,k=!0,m="",q=!0;;){var n=w.exec(c),p=n[4],t=n[1],C=n[2],n=n[3],M,I,E,U,n=n&&B(n),t=B(t);if(q){if(C?(m=I=t,M=C.charAt(0),
U="?"==C.charAt(1)):m=n=t,E=n,I||"/"!=p)q=!1}else n=n?t+C:t,e(n);switch(p){case "'":case '"':var T="'"==p?x:z;T.lastIndex=w.lastIndex;(p=T.exec(c))||error("unterminated string");p=p[1];w.lastIndex=T.lastIndex;e(new a(p));continue;case "/":"*"==c[w.lastIndex]?(D.lastIndex=w.lastIndex+1,D.exec(c),w.lastIndex=D.lastIndex):e("/");continue;case "\\":p=T.lastIndex++;e(c.charAt(p));continue;case "(":case "{":case "[":var Y=!1;if("{"==p){q=!0;e(t=H.newRule(m),!0);if(M){k=!1;if(!C||"\x3e"==C.charAt(1))E.creating=
!0;"\x3d"==M&&n&&(Y=!0)}H.root&&k&&(t.cssRule=d.cssRules[f++])}else C=n.match(/(.*?)([\w-]*)$/),e(t=H.newCall(C[2],E,H)),t.ref=g(H,C[2]),(E.calls||(E.calls=[])).push(t);t.parent=H;t.selector=E.creating?".x-generated-"+v++:H.root?m:H.selector+" "+m;Y&&(C=g(H,n.match(/[^\s]+$/)[0],!0))&&y(C,t);H.currentName=I;H.currentSequence=E;H.assignmentOperator=M;L.push(H=t);H.operator=p;H.start=w.lastIndex;m="";H.selector&&H.selector.replace(/:([-\w]+)/,function(a,b){var c=G.pseudo[b];c&&s(c,"onPseudo",b,H)});
E=I=null;continue}if(E)if(t=E[0],t.charAt&&"@"==t.charAt(0))"import"==E[0].slice(1,7)&&(C=b.getStyleSheet(d.cssRules[f++],E,d),aa++,n=w.lastIndex,u(C.localSource,C),w.lastIndex=n);else try{H[":"==M?"setValue":"declareProperty"](I,E,U)}catch(X){console.error(X.stack||X)}switch(p){case ":":q=!0;M=":";break;case "}":case ")":case "]":F[H.operator]!=p&&console.error("Incorrect opening operator "+H.operator+" with closing operator "+p);I=null;H.cssText=c.slice(H.start,w.lastIndex-1);"}"==p&&(r(H.selector,
H),k=!0,m="");L.pop();H=L[L.length-1];E=H.currentSequence;I=H.currentName;M=H.assignmentOperator;H.root&&"}"==p&&(q=!0,M=!1);break;case "":h&&h();return;case ";":E=null,q=!0,M=k=!1,m=""}}}d.addRule||(d.addRule=function(a,b,c){return this.insertRule(a+"{"+b+"}",0<=c?c:this.cssRules.length)});d.deleteRule||(d.deleteRule=d.removeRule);var G={property:{}};m("property");m("function");m("pseudo");G["function"]["var"]=S;G["function"]["extends"]=S;var aa=1;(d.href||location.href).replace(/[^\/]+$/,"");q.prototype=
{eachProperty:function(a){for(var b=this.values||0,c=0;c<b.length;c++){var d=b[c];a.call(this,d||"unnamed",b[d])}},fullSelector:function(){return(this.parent?this.parent.fullSelector():"")+(this.selector||"")+" "},newRule:function(a){return(this.rules||(this.rules={}))[a]=new q},newCall:function(a,b,c){return new p(a)},addSheetRule:function(a,b){if(b&&"@"!=a.charAt(0)){var c=d.addRule(a,b);-1==c&&(c=d.cssRules.length-1);return d.cssRules[c]}},onRule:function(){this.getCssRule()},getCssRule:function(){this.cssRule||
(this.cssRule=this.addSheetRule(this.selector,this.cssText));return this.cssRule},get:function(a){return this.values[a]},declareProperty:function(a,b,c){if("\x3e"==b[0].toString().charAt(0))a||(this.generator=b,b=t(b,this),S.addRenderer("",b,this,b));else{var d=a in E.style||g(this,a);if(!c||!d)(this.properties||(this.properties={}))[a]=b,d&&console.warn('Overriding existing property "'+a+'"')}},setValue:function(a,b){var c=this.values||(this.values=[]);c.push(a);c[a]=b;if(c=b.calls)for(var d=0;d<
c.length;d++){var h=c[d],k=h.ref;k&&"function"==typeof k.call&&k.call(h,this,a,b)}if(a){do{if(c=g(this,a)){var m=this;f(e(m,a,c),function(c){c=c.splice?c:[c];for(var d=0;d<c.length&&!c[d].put(b,m,a);d++);});break}a=a.substring(0,a.lastIndexOf("-"))}while(a)}},cssText:""};var T=p.prototype=new q;T.declareProperty=T.setValue=function(a,b){this.args.push(b)};T.toString=function(){var a=this.operator;return a+this.args+F[a]};var H,K=new q;K.root=!0;K.properties={Math:Math,module:function(a){return{then:function(b){n([a],
b)}}},item:{forElement:function(a){for(;!a.item;)a=a.parentNode;return{element:a,receive:function(b){b(a.item)}}}},prefix:{put:function(a,b,c){if("string"==typeof E.style[J+c])return b.addSheetRule(b.selector,J+c+":"+a)}},"var":{put:function(a,b,c){(b.variables||(b.variables={}))[c]=a;b=(b=b.variableListeners)&&b[c]||0;for(c=0;c<b.length;c++)b[c](a)},call:function(a,b,c,d){this.receive(function(a){b.addSheetRule(b.selector,c+": "+d.toString().replace(/var\([^)]+\)/g,a))},b,a.args[0])},receive:function(a,
b,c){var d=b;do{if(b=d.variables&&d.variables[c])return d=d.variableListeners||(d.variableListeners={}),(d[c]||(d[c]=[])).push(a),a(b);d=d.parent}while(d);a()}},on:{put:function(a,b,c){console.log("add event listener");e(b,c,a)}}};K.css=c;K.parse=u;var L=[K];u(c,d);0==--aa&&h&&h(d);return K}function s(){p("link");p("style");if(!L)if(L=!0,K["dom-qsa2.1"]){for(var a=0,b=O.length;a<b;a++)q(O[a]);r()}else for(var c=C.all,a=0,b=c.length;a<b;a++)m(c[a])}function q(a){for(var b=C.querySelectorAll(a.selector),
c=a.name,d=0,e=b.length;d<e;d++){var f=b[d],g=f.elementalStyle;g||(g=f.elementalStyle={},f.elementalSpecificities={});var h=f.renderings;h||(h=f.renderings=[],P.push(f));h.push({name:c,rendered:g[c]==a.propertyValue,renderer:a});g[c]=a.propertyValue}}function r(){for(var a=0;a<P.length;a++){var b=P[a],c=b.renderings,e=b.elementalStyle;delete b.renderings;for(var f=0;f<c.length;f++){var g=c[f],h=g.renderer,k=h.rendered;Q=e[g.name]==h.propertyValue;if(!k&&Q)try{h.render(b)}catch(m){console.error(m,
m.stack),d(b,"div.error",m.toString())}k&&(!Q&&h.unrender)&&(h.unrender(b),c.splice(f--,1))}}P=[]}function m(a,b){for(var c=0,d=O.length;c<d;c++){var e=O[c];(!b||b==e.selector)&&(N?N.call(a,e.selector):a.currentStyle[e.name]==e.propertyValue)&&e.render(a)}}function t(a,b){v++;a=a.sort?a:[a];return function(c,g){for(var h=c,k=0,m=a.length;k<m;k++){var l=a[k];try{if(l.eachProperty)if(l.args)if("("==l.operator){var q=a[k+1];q&&q.eachProperty&&d(h,q.selector);var n=l.args.toString(),p=e(l,0,n);(function(a,
c){f(p,function(e){e.forElement&&(e=e.forElement(c));var f=a.appendChild(C.createTextNode("Loading"));e.receive(function(b){if(b&&b.sort){f&&(f.parentNode.removeChild(f),f=null);var c=q&&q.eachProperty&&q.get("each");c&&(c=t(c,q));b.forEach(c?function(b){c(a,b)}:function(b){d(a,u[a.tagName]||"div",b)})}else"value"in a?(a.value=b,a["-x-variable"]=e):f.nodeValue=b},b,n)})})(h,c)}else d(h,l.toString());else d(h,l.selector),S.update(h,l.selector);else if("string"==typeof l){"\x3d"==l.charAt(0)&&(l=l.slice(1));
for(var r=l.split(","),l=0,s=r.length;l<s;l++){var y=r[l].trim();if(y){var y=y.replace(/\([^)]*\)/,function(a){}),w=d(0==l?h:c,y);g&&(w.item=g);q=a[k+1];w!=h&&(!q||!q.eachProperty)&&S.update(w);h=w}}}else h.appendChild(C.createTextNode(l.value))}catch(v){console.error(v,v.stack),h.appendChild(C.createTextNode(v))}}return h}}function e(a,b,d){function k(){var a=l.length+1,b=[],d=[],e,g,m=function(c){return function(f){b[c]=f;a--;if(0>=a){g=!0;e=r?r.apply(this,b):b[0];for(f=0;f<d.length;f++)d[f](e)}}};
if(r)for(var q=0;q<l.length;q++){var n=l[q];h(n[0],n.slice(1),m(q))}else{var n=l[0],p={then:function(a){d.push(a)}};f(n[0],function(a){p=a;for(var b=1;b<n.length;b++)if(p&&p.get)p=p.get(n[b]);else{p={receive:function(b){h(a,n.slice(1),b)},put:function(a){c(resolve,n.slice(1),a)}};break}for(b=0;b<d.length;b++)d[b](p)});return p}m(-1)();return e&&e.then?e:{receive:function(a){d&&d.push(a);g&&a(e)}}}var m=a["var-expr-"+b];if(l)return m;var l=[],q;l.id=v++;var n=[],p;d=d.join?d.join(""):d.toString();
m=d.match(/^[\w_$\/\.-]*$/);d=d.replace(/("[^\"]*")|([\w_$\.\/-]+)/g,function(b,c,d){if(d){p=d.split("/");b=p.join("_");n.push(b);l.push(p);c=p[0];d=g(a,c);if("string"==typeof d||d instanceof Array)d=e(a,c,d);else if(!d)throw Error('Could not find reference "'+c+'"');d.forElement&&(q=!0);p[0]=d}return b});if(!m)var r=Function.apply(this,n.concat(["return xstyleReturn("+d+")"]));l.func=r;a["var-expr-"+b]=l;return a["var-expr-"+b]=q?{forElement:function(b){for(var c,d=b;!N.call(b,a.selector);)b=b.parentNode;
for(b=0;b<l.length;b++){var e=l[b],f=e[0];f.forElement&&(f=e[0]=f.forElement(d));e=f.element;if(d!=c){for(;d!=e;){if(d==c)return;d=d.parentNode}c=d}}d=c["expr-result-"+l.id];d||(c["expr-result-"+l.id]=d=k(),d.element=c);return d}}:k()}function g(a,b,c){do{var d=a.properties&&a.properties[b]||c&&a.rules&&a.rules[b];a=a.parent}while(!d&&a);return d}function y(a,b){b.cssText+=a.cssText;"values,properties,variables,calls".replace(/\w+/g,function(c){a[c]&&(b[c]=Object.create(a[c]))});var c=b.getCssRule();
a.eachProperty(function(a,d){b.setValue(a,d);if(a){var e=c.style;e[a]||(e[a]=d)}});a.generator&&b.declareProperty(null,a.generator)}var w=/\s*([^{\}\[\]\(\)\/\\'":=;]*)([=:]\??\s*([^{\}\[\]\(\)\/\\'":;]*))?([{\}\[\]\(\)\/\\'":;]|$)/g,x=/((?:\\.|[^'])*)'/g,z=/((?:\\.|[^"])*)"/g,D=/\*\//g,v=0,u={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},F={"{":"}","[":"]","(":")"},C=document,B="".trim?function(a){return a.trim()}:function(a){return a.replace(/^\s+|\s+$/g,"")},E=C.createElement("div");
a.prototype.toString=function(){return'"'+this.value.replace(/["\\\n\r]/g,"\\$\x26")+'"'};var G=navigator.userAgent,J=-1<G.indexOf("WebKit")?"-webkit-":-1<G.indexOf("Firefox")?"-moz-":-1<G.indexOf("MSIE")?"-ms-":-1<G.indexOf("Opera")?"-o-":"";b.getStyleSheet=function(a,b){return a.styleSheet};C.addEventListener("change",function(a){a=a.target;var b=a["-x-variable"];b.put&&b.put(a.value)});var E=C.createElement("div"),K={"dom-qsa2.1":!!E.querySelectorAll},N=E.matches||E.matchesSelector||E.webkitMatchesSelector||
E.mozMatchesSelector||E.msMatchesSelector||E.oMatchesSelector,O=[],P=[],L;/e/.test(C.readyState||"")?setTimeout(s,200):C.addEventListener("DOMContentLoaded",s);var Q,S={process:k,vendorPrefix:J,applyProperty:function(a,b){return"opacity"==a&&"-ms-"==J?"filter: alpha(opacity\x3d"+100*b+"); zoom: 1;":J+a+":"+b+";"},onFunction:function(a,b,c){},onCall:function(a,b){function c(){var b=e,f="extends"==a?"rules":"variables";do{if(!b)throw Error('Could not find "'+d[0]+'" in the defined '+f);var g=b[f]&&
b[f][d[0]],b=b.parent}while(!g);return g}var d=b.args,e=b.parent;if("extends"==a){var f=c();y(f,e)}else if("var"==a)return function(a){a.addSheetRule(a.selector,a.currentName+": "+a.currentSequence.toString().replace(/var\([^)]+\)/g,c()))}},parse:b,addRenderer:function(a,b,c,d){a={selector:c.selector,propertyValue:b,name:a,render:d};O.push(a);L&&q(a);r()},update:m,clearRenderers:function(){O=[]},load:function(a,b,c,d){b(["xstyle/css"],function(e){e.load(a,b,c,d)})}};return S});xstyleReturn=function(n){return 1==
arguments.length?n:[].slice.call(arguments)}},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(n,d,f){return n("dojo.store.Memory",null,{constructor:function(d){for(var c in d)this[c]=d[c];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:f,get:function(d){return this.data[this.index[d]]},getIdentity:function(d){return d[this.idProperty]},put:function(d,c){var f=this.data,l=this.index,a=this.idProperty,
a=d[a]=c&&"id"in c?c.id:a in d?d[a]:Math.random();if(a in l){if(c&&!1===c.overwrite)throw Error("Object already exists");f[l[a]]=d}else l[a]=f.push(d)-1;return a},add:function(d,c){(c=c||{}).overwrite=!1;return this.put(d,c)},remove:function(d){var c=this.index,f=this.data;if(d in c)return f.splice(c[d],1),this.setData(f),!0},query:function(f,c){return d(this.queryEngine(f,c)(this.data))},setData:function(d){d.items?(this.idProperty=d.identifier||this.idProperty,d=this.data=d.items):this.data=d;this.index=
{};for(var c=0,f=d.length;c<f;c++)this.index[d[c][this.idProperty]]=c}})})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(n){return function(d,f){function h(c){c=n.filter(c,d);var h=f&&f.sort;h&&c.sort("function"==typeof h?h:function(a,b){for(var c,d=0;c=h[d];d++){var f=a[c.attribute],m=b[c.attribute],f=null!=f?f.valueOf():f,m=null!=m?m.valueOf():m;if(f!=m)return!!c.descending==(null==f||f>m)?-1:1}return 0});if(f&&(f.start||f.count)){var a=c.length;c=c.slice(f.start||
0,(f.start||0)+(f.count||Infinity));c.total=a}return c}switch(typeof d){default:throw Error("Can not query with a "+typeof d);case "object":case "undefined":var c=d;d=function(d){for(var f in c){var a=c[f];if(a&&a.test){if(!a.test(d[f],d))return!1}else if(a!=d[f])return!1}return!0};break;case "string":if(!this[d])throw Error("No filter function "+d+" was found in store");d=this[d];case "function":}h.matches=d;return h}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q){f.isAsync||a(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var r=d("dojo.dnd.Source",s,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(a,b){h.mixin(this,h.mixin({},b));var d=this.accept;if(d.length){this.accept={};for(var f=0;f<d.length;++f)this.accept[d[f]]=1}this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;
this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&c.add(this.node,"dojoDndSource");this.targetState="";this.accept&&c.add(this.node,"dojoDndTarget");this.horizontal&&c.add(this.node,"dojoDndHorizontal");this.topics=[k.subscribe("/dnd/source/over",h.hitch(this,"onDndSourceOver")),k.subscribe("/dnd/start",h.hitch(this,"onDndStart")),k.subscribe("/dnd/drop",h.hitch(this,"onDndDrop")),k.subscribe("/dnd/cancel",h.hitch(this,"onDndCancel"))]},checkAcceptance:function(a,b){if(this==
a)return!this.copyOnly||this.selfAccept;for(var c=0;c<b.length;++c){for(var d=a.getItem(b[c].id).type,f=!1,h=0;h<d.length;++h)if(d[h]in this.accept){f=!0;break}if(!f)return!1}return!0},copyState:function(a,b){if(a)return!0;2>arguments.length&&(b=this==q.manager().target);if(b){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){r.superclass.destroy.call(this);n.forEach(this.topics,function(a){a.remove()});this.targetAnchor=null},onMouseMove:function(a){if(!(this.isDragging&&
"Disabled"==this.targetState)){r.superclass.onMouseMove.call(this,a);var c=q.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&(Math.abs(a.pageX-this._lastX)>this.delay||Math.abs(a.pageY-this._lastY)>this.delay)){var d=this.getSelectedNodes();d.length&&c.startDrag(this,d,this.copyState(b.getCopyKeyState(a),!0))}if(this.isDragging){d=!1;if(this.current){if(!this.targetBox||this.targetAnchor!=this.current)this.targetBox=p.position(this.current,!0);d=this.horizontal?a.pageX-this.targetBox.x<
this.targetBox.w/2==p.isBodyLtr(this.current.ownerDocument):a.pageY-this.targetBox.y<this.targetBox.h/2}if(this.current!=this.targetAnchor||d!=this.before)this._markTargetAnchor(d),c.canDrop(!this.current||c.source!=this||!(this.current.id in this.selection))}}},onMouseDown:function(a){if(!this.mouseDown&&this._legalMouseDown(a)&&(!this.skipForm||!b.isFormElement(a)))this.mouseDown=!0,this._lastX=a.pageX,this._lastY=a.pageY,r.superclass.onMouseDown.call(this,a)},onMouseUp:function(a){this.mouseDown&&
(this.mouseDown=!1,r.superclass.onMouseUp.call(this,a))},onDndSourceOver:function(a){this!==a?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):this.isDragging&&(a=q.manager(),a.canDrop("Disabled"!=this.targetState&&(!this.current||a.source!=this||!(this.current.id in this.selection))))},onDndStart:function(a,b,c){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==a?c?"Copied":"Moved":"");b=this.accept&&this.checkAcceptance(a,b);this._changeState("Target",b?
"":"Disabled");this==a&&q.manager().overSource(this);this.isDragging=!0},onDndDrop:function(a,b,c,d){if(this==d)this.onDrop(a,b,c);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(a,b,c){if(this!=a)this.onDropExternal(a,b,c);else this.onDropInternal(b,c)},onDropExternal:function(a,c,d){var f=this._normalizedCreator;
this._normalizedCreator=this.creator?function(b,c){return f.call(this,a.getItem(b.id).data,c)}:d?function(c){var d=a.getItem(c.id);c=c.cloneNode(!0);c.id=b.getUniqueId();return{node:c,data:d.data,type:d.type}}:function(b){var c=a.getItem(b.id);a.delItem(b.id);return{node:b,data:c.data,type:c.type}};this.selectNone();!d&&!this.creator&&a.selectNone();this.insertNodes(!0,c,this.before,this.current);!d&&this.creator&&a.deleteSelectedNodes();this._normalizedCreator=f},onDropInternal:function(a,c){var d=
this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(c)this._normalizedCreator=this.creator?function(a,b){return d.call(this,this.getItem(a.id).data,b)}:function(a){var c=this.getItem(a.id);a=a.cloneNode(!0);a.id=b.getUniqueId();return{node:a,data:c.data,type:c.type}};else{if(!this.current)return;this._normalizedCreator=function(a){var b=this.getItem(a.id);return{node:a,data:b.data,type:b.type}}}this._removeSelection();this.insertNodes(!0,a,this.before,this.current);this._normalizedCreator=
d}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){r.superclass.onOverEvent.call(this);q.manager().overSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOver()},onOutEvent:function(){r.superclass.onOutEvent.call(this);q.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(a){this.current==this.targetAnchor&&this.before==a||(this.targetAnchor&&this._removeItemClass(this.targetAnchor,
this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=a,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":"After"))},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(a){this._changeState("Source",a?"Copied":"Moved")},_legalMouseDown:function(a){if("touchstart"!=a.type&&!l.isLeft(a))return!1;
if(!this.withHandles)return!0;for(a=a.target;a&&a!==this.node;a=a.parentNode){if(c.contains(a,"dojoDndHandle"))return!0;if(c.contains(a,"dojoDndItem")||c.contains(a,"dojoDndIgnore"))break}return!1}});return r})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q){var r=d("dojo.dnd.Selector",q,{constructor:function(a,c){c||
(c={});this.singular=c.singular;this.autoSync=c.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(k(this.node,b.press,h.hitch(this,"onMouseDown")),k(this.node,b.release,h.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var b=new a,d=s._empty,e;for(e in this.selection)e in d||b.push(c.byId(e));return b},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(a,b){this._addItemClass(c.byId(b),
"Selected");this.selection[b]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var a=s._empty,b;for(b in this.selection)if(!(b in a)){var d=c.byId(b);this.delItem(b);p.destroy(d)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(a,b){b=b||f.global;var c=this.selection,d=s._empty,h;for(h in c)h in d||a.call(b,this.getItem(h),h,this)},sync:function(){r.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var a=[],b=s._empty,
c;for(c in this.selection)c in b||this.getItem(c)||a.push(c);n.forEach(a,function(a){delete this.selection[a]},this);return this},insertNodes:function(a,b,c,d){var f=this._normalizedCreator;this._normalizedCreator=function(b,c){var d=f.call(this,b,c);a?(this.anchor?this.anchor!=d.node&&(this._removeItemClass(d.node,"Anchor"),this._addItemClass(d.node,"Selected")):(this.anchor=d.node,this._removeItemClass(d.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[d.node.id]=1):(this._removeItemClass(d.node,
"Selected"),this._removeItemClass(d.node,"Anchor"));return d};r.superclass.insertNodes.call(this,b,c,d);this._normalizedCreator=f;return this},destroy:function(){r.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(a){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!s.getCopyKeyState(a)&&!a.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,l.isLeft(a)&&(a.stopPropagation(),a.preventDefault());else{if(!this.singular&&a.shiftKey){s.getCopyKeyState(a)||
this._removeSelection();var b=this.getAllNodes();if(b.length&&(this.anchor||(this.anchor=b[0],this._addItemClass(this.anchor,"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var c=0,d;c<b.length&&!(d=b[c],d==this.anchor||d==this.current);++c);for(++c;c<b.length;++c){d=b[c];if(d==this.anchor||d==this.current)break;this._addItemClass(d,"Selected");this.selection[d.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==
this.current?s.getCopyKeyState(a)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1):s.getCopyKeyState(a)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),
this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);a.stopPropagation();a.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},
onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=k(this.node,b.move,h.hitch(this,"onMouseMove"))},onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var a=s._empty,b;for(b in this.selection)if(!(b in a)){var d=c.byId(b);d&&this._removeItemClass(d,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),
this.anchor=null);return this}});return r})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m){d=d("dojo.dnd.Container",k,{skipForm:!1,allowNested:!1,constructor:function(a,b){this.node=p.byId(a);b||(b={});this.creator=b.creator||null;this.skipForm=b.skipForm;this.parent=b.dropParent&&p.byId(b.dropParent);
this.map={};this.current=null;this.containerState="";l.add(this.node,"dojoDndContainer");(!b||!b._skipStartup)&&this.startup();this.events=[s(this.node,r.over,h.hitch(this,"onMouseOver")),s(this.node,r.out,h.hitch(this,"onMouseOut")),s(this.node,"dragstart",h.hitch(this,"onSelectStart")),s(this.node,"selectstart",h.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(a){return this.map[a]},setItem:function(a,b){this.map[a]=b},delItem:function(a){delete this.map[a]},forInItems:function(a,
b){b=b||f.global;var c=this.map,d=m._empty,h;for(h in c)h in d||a.call(b,c[h],h,this);return b},clearItems:function(){this.map={}},getAllNodes:function(){return q((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var a={};this.getAllNodes().forEach(function(b){if(b.id){var c=this.getItem(b.id);if(c){a[b.id]=c;return}}else b.id=m.getUniqueId();var c=b.getAttribute("dndType"),d=b.getAttribute("dndData");a[b.id]={data:d||b.innerHTML,type:c?c.split(/\s*,\s*/):["text"]}},this);
this.map=a;return this},insertNodes:function(a,b,c){this.parent.firstChild?b?c||(c=this.parent.firstChild):c&&(c=c.nextSibling):c=null;var d;if(c)for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),c.parentNode.insertBefore(d.node,c);else for(b=0;b<a.length;++b)d=this._normalizedCreator(a[b]),this.setItem(d.node.id,{data:d.data,type:d.type}),this.parent.appendChild(d.node);return this},destroy:function(){n.forEach(this.events,function(a){a.remove()});
this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(a,b,c){a._skipStartup=!0;return new c(b,a)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var a=this.parent.getElementsByTagName("tbody");a&&a.length&&(this.parent=a[0])}this.defaultCreator=m._defaultCreator(this.parent);this.sync()},onMouseOver:function(a){for(var b=a.relatedTarget;b&&b!=this.node;)try{b=b.parentNode}catch(c){b=null}b||(this._changeState("Container",
"Over"),this.onOverEvent());b=this._getChildByEvent(a);this.current!=b&&(this.current&&this._removeItemClass(this.current,"Over"),b&&this._addItemClass(b,"Over"),this.current=b)},onMouseOut:function(a){for(a=a.relatedTarget;a;){if(a==this.node)return;try{a=a.parentNode}catch(b){a=null}}this.current&&(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(a){if(!this.skipForm||!m.isFormElement(a))a.stopPropagation(),
a.preventDefault()},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(a,b){var c="dojoDnd"+a,d=a.toLowerCase()+"State";l.replace(this.node,c+b,c+this[d]);this[d]=b},_addItemClass:function(a,b){l.add(a,"dojoDndItem"+b)},_removeItemClass:function(a,b){l.remove(a,"dojoDndItem"+b)},_getChildByEvent:function(a){if(a=a.target)for(var b=a.parentNode;b;a=b,b=a.parentNode)if((b==this.parent||this.allowNested)&&l.contains(a,"dojoDndItem"))return a;return null},_normalizedCreator:function(a,
b){var c=(this.creator||this.defaultCreator).call(this,a,b);h.isArray(c.type)||(c.type=["text"]);c.node.id||(c.node.id=m.getUniqueId());l.add(c.node,"dojoDndItem");return c}});m._createNode=function(b){return!b?m._createSpan:function(c){return a.create(b,{innerHTML:c})}};m._createTrTd=function(b){var c=a.create("tr");a.create("td",{innerHTML:b},c);return c};m._createSpan=function(b){return a.create("span",{innerHTML:b})};m._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};m._defaultCreator=
function(a){a=a.tagName.toLowerCase();var b="tbody"==a||"thead"==a?m._createTrTd:m._createNode(m._defaultCreatorNodes[a]);return function(a,c){var d=a&&h.isObject(a),f,k;d&&a.tagName&&a.nodeType&&a.getAttribute?(f=a.getAttribute("dndData")||a.innerHTML,d=(d=a.getAttribute("dndType"))?d.split(/\s*,\s*/):["text"],k=a):(f=d&&a.data?a.data:a,d=d&&a.type?a.type:["text"],k=("avatar"==c?m._createSpan:b)(String(f)));k.id||(k.id=m.getUniqueId());return{node:k,data:f,type:d}}};return d})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s,q,r,m){var t=d("dojo.dnd.Manager",[p],{constructor:function(){this.source=this.avatar=null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:l("touch")?0:16,OFFSET_Y:l("touch")?-64:16,overSource:function(a){this.avatar&&(this.target=a&&"Disabled"!=a.targetState?a:null,this.canDropFlag=Boolean(this.target),this.avatar.update());b.publish("/dnd/source/over",a)},outSource:function(a){this.avatar?this.target==a&&(this.target=null,this.canDropFlag=
!1,this.avatar.update(),b.publish("/dnd/source/over",null)):b.publish("/dnd/source/over",null)},startDrag:function(a,d,l){function m(a){a.preventDefault();a.stopPropagation()}r.autoScrollStart(h.doc);this.source=a;this.nodes=d;this.copy=Boolean(l);this.avatar=this.makeAvatar();h.body().appendChild(this.avatar.node);b.publish("/dnd/start",a,d,this.copy);this.events=[k(h.doc,s.move,f.hitch(this,"onMouseMove")),k(h.doc,s.release,f.hitch(this,"onMouseUp")),k(h.doc,"keydown",f.hitch(this,"onKeyDown")),
k(h.doc,"keyup",f.hitch(this,"onKeyUp")),k(h.doc,"dragstart",m),k(h.body(),"selectstart",m)];c.add(h.body(),"dojoDnd"+(l?"Copy":"Move"))},canDrop:function(a){a=Boolean(this.target&&a);this.canDropFlag!=a&&(this.canDropFlag=a,this.avatar.update())},stopDrag:function(){c.remove(h.body(),["dojoDndCopy","dojoDndMove"]);n.forEach(this.events,function(a){a.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new m(this)},updateAvatar:function(){this.avatar.update()},
onMouseMove:function(a){var b=this.avatar;b&&(r.autoScrollNodes(a),b=b.node.style,b.left=a.pageX+this.OFFSET_X+"px",b.top=a.pageY+this.OFFSET_Y+"px",b=Boolean(this.source.copyState(q.getCopyKeyState(a))),this.copy!=b&&this._setCopyStatus(b));l("touch")&&a.preventDefault()},onMouseUp:function(a){if(this.avatar){if(this.target&&this.canDropFlag){var c=Boolean(this.source.copyState(q.getCopyKeyState(a)));b.publish("/dnd/drop/before",this.source,this.nodes,c,this.target,a);b.publish("/dnd/drop",this.source,
this.nodes,c,this.target,a)}else b.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(c){if(this.avatar)switch(c.keyCode){case a.CTRL:c=Boolean(this.source.copyState(!0));this.copy!=c&&this._setCopyStatus(c);break;case a.ESCAPE:b.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(b){this.avatar&&b.keyCode==a.CTRL&&(b=Boolean(this.source.copyState(!1)),this.copy!=b&&this._setCopyStatus(b))},_setCopyStatus:function(a){this.copy=a;this.source._markDndStatus(this.copy);this.updateAvatar();
c.replace(h.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});q._manager=null;t.manager=q.manager=function(){q._manager||(q._manager=new t);return q._manager};return t})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(n,d,f,h,c,p,l,a){return n("dojo.dnd.Avatar",null,{constructor:function(a){this.manager=a;this.construct()},construct:function(){var a=p.create("table",
{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),b=this.manager.source,c,d=p.create("tbody",null,a),f=p.create("tr",null,d),m=p.create("td",null,f),n=Math.min(5,this.manager.nodes.length),e=0;l("highcontrast")&&p.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},m);p.create("span",{innerHTML:b.generateText?this._generateText():""},m);for(h.set(f,{"class":"dojoDndAvatarHeader",style:{opacity:0.9}});e<n;++e)b.creator?c=b._normalizedCreator(b.getItem(this.manager.nodes[e].id).data,
"avatar").node:(c=this.manager.nodes[e].cloneNode(!0),"tr"==c.tagName.toLowerCase()&&(f=p.create("table"),p.create("tbody",null,f).appendChild(c),c=f)),c.id="",f=p.create("tr",null,d),m=p.create("td",null,f),m.appendChild(c),h.set(f,{"class":"dojoDndAvatarItem",style:{opacity:(9-e)/10}});this.node=a},destroy:function(){p.destroy(this.node);this.node=!1},update:function(){c.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(l("highcontrast")){var d=f.byId("a11yIcon"),b="+";this.manager.canDropFlag&&
!this.manager.copy?b="\x3c ":!this.manager.canDropFlag&&!this.manager.copy?b="o":this.manager.canDropFlag||(b="x");d.innerHTML=b}a("tr.dojoDndAvatarHeader td span"+(l("highcontrast")?" span":""),this.node).forEach(function(a){a.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html",
"./hccss"],function(n,d,f,h){return n("dijit.CheckedMenuItem",f,{baseClass:"dijitMenuItem dijitCheckedMenuItem",templateString:h,checked:!1,_setCheckedAttr:function(c){this.domNode.setAttribute("aria-checked",c?"true":"false");this._set("checked",c)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(c){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(c)}})})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(n,d,f,h,c,p,l,a,k,b,s){var q=k("dijit.ColorPalette",[f,h,c],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:d,baseClass:"dijitColorPalette",_dyeFactory:function(a,b,c,d){return new this._dyeClass(a,
b,c,d)},buildRendering:function(){this.inherited(arguments);this._dyeClass=k(q._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],l.getLocalization("dojo","colors",this.lang))}});q._Color=k("dijit._Color",a,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":n.toUrl("./themes/a11y/colors7x10.png"),"3x4":n.toUrl("./themes/a11y/colors3x4.png")},constructor:function(b,c,d,e){this._title=e;this._row=c;this._col=d;this.setColor(a.named[b])},getValue:function(){return this.toHex()},fillCell:function(a,c){var d=s.substitute(p("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:c,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});b.place(d,a)}});return q})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(n,d,f,h,c,p,l,a,k,b,s){return n("dijit._PaletteMixin",a,{defaultTimeout:500,timeoutChangeRate:0.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(a){return new ("string"==
typeof this.dyeClass?p.getObject(this.dyeClass):this.dyeClass)(a)},_preparePalette:function(a,b){this._cells=[];var d=this._blankGif;this.own(l(this.gridNode,k,p.hitch(this,"_onCellClick")));for(var f=0;f<a.length;f++)for(var e=h.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),g=0;g<a[f].length;g++){var n=a[f][g];if(n){var w=this._dyeFactory(n,f,g,b[n]),n=h.create("td",{"class":this.cellClass,tabIndex:"-1",title:b[n],role:"gridcell"},e);w.fillCell(n,d);n.idx=this._cells.length;this._cells.push({node:n,
dye:w})}}this._xDim=a[0].length;this._yDim=a.length;var x={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in x)this.own(s.addKeyListener(this.domNode,{keyCode:c[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var a=x[z];return function(b){this._navigateByKey(a,b)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){b.focus(this._currentFocus)},
_onCellClick:function(a){for(var c=a.target;"TD"!=c.tagName;){if(!c.parentNode||c==this.gridNode)return;c=c.parentNode}var d=this._getDye(c).getValue();this._setCurrent(c);b.focus(c);this._setValueAttr(d,!0);a.stopPropagation();a.preventDefault()},_setCurrent:function(a){"_currentFocus"in this&&d.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=a)&&d.set(a,"tabIndex",this.tabIndex)},_setValueAttr:function(a,b){0<=this._selectedCell&&f.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(a)for(var c=0;c<this._cells.length;c++)if(a==this._cells[c].dye.getValue()){this._selectedCell=c;f.add(this._cells[c].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?a:null);if(b||void 0===b)this.onChange(a)},onChange:function(){},_navigateByKey:function(a,c){if(-1!=c){var d=this._currentFocus.idx+a;d<this._cells.length&&-1<d&&(d=this._cells[d].node,this._setCurrent(d),this.defer(p.hitch(b,"focus",d)))}},_getDye:function(a){return this._cells[a.idx].dye}})})},
"dojo/_base/query":function(){define(["../query","./NodeList"],function(n){return n})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(n,d,f,h,c,p,l,a,k){h("dijit-legacy-requires")&&p(0,function(){n(["dijit/form/RadioButton"])});return d("dijit.form.CheckBox",[l,a],{templateString:k,baseClass:"dijitCheckBox",_setValueAttr:function(a,
c){"string"==typeof a&&(this.inherited(arguments),a=!0);this._created&&this.set("checked",a,c)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&c("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&c("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");
this.inherited(arguments)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(n,d){return n("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(f){this._set("readOnly",f);d.set(this.focusNode,"readOnly",f)},_setLabelAttr:void 0,_getSubmitValue:function(d){return null==d||""===d?"on":d},_setValueAttr:function(f){f=this._getSubmitValue(f);this._set("value",f);d.set(this.focusNode,
"value",f)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));d.set(this.focusNode,"value",this.value)},_onClick:function(d){return this.readOnly?(d.stopPropagation(),d.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox","./ComboBoxMixin"],function(n,d,f){return n("dijit.form.ComboBox",[d,f],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),
function(n,d,f,h,c,p,l,a,k){return n("dijit.form.ComboBoxMixin",[a,p],{dropDownClass:l,hasDownArrow:!0,templateString:k,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},_setHasDownArrowAttr:function(a){this._set("hasDownArrow",a);this._buttonNode.style.display=a?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(a){a.get||h.mixin(a,{_oldAPI:!0,get:function(a){var b=new d;this.fetchItemByIdentity({identity:a,
onItem:function(a){b.resolve(a)},onError:function(a){b.reject(a)}});return b.promise},query:function(a,b){var f=new d(function(){k.abort&&k.abort()});f.total=new d;var k=this.fetch(h.mixin({query:a,onBegin:function(a){f.total.resolve(a)},onComplete:function(a){f.resolve(a)},onError:function(a){f.reject(a)}},b));return c(f)}});this._set("store",a)},postMixInProperties:function(){var a=this.params.store||this.store;a&&this._setStoreAttr(a);this.inherited(arguments);if(!this.params.store&&this.store&&
!this.store._oldAPI){var c=this.declaredClass;h.mixin(this.store,{getValue:function(a,b){f.deprecated(c+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");return a[b]},getLabel:function(a){f.deprecated(c+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return a.name},fetch:function(a){f.deprecated(c+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],
h.hitch(this,function(b){(new b({objectStore:this})).fetch(a)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(n,d,f,h,c,p,l,a,k,b,s){d=d("dijit.form._AutoCompleterMixin",s,{item:null,
autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(b){var c=0;if("number"==typeof b.selectionStart)c=b.selectionStart;else if(a("ie")){var d=b.ownerDocument.selection.createRange().duplicate();b=b.createTextRange();d.move("character",0);b.move("character",0);try{b.setEndPoint("EndToEnd",d),c=String(b.text).replace(/\r/g,"").length}catch(f){}}return c},_setCaretPos:function(a,c){c=parseInt(c);b.selectInputText(a,c,c)},_setDisabledAttr:function(a){this.inherited(arguments);
this.domNode.setAttribute("aria-disabled",a?"true":"false")},_onKey:function(a){if(!(32<=a.charCode)){var b=a.charCode||a.keyCode;if(!(b==h.ALT||b==h.CTRL||b==h.META||b==h.SHIFT)){var c=this.dropDown,d=null;this._abortQuery();this.inherited(arguments);if(!a.altKey&&!a.ctrlKey&&!a.metaKey)switch(this._opened&&(d=c.getHighlightedOption()),b){case h.PAGE_DOWN:case h.DOWN_ARROW:case h.PAGE_UP:case h.UP_ARROW:this._opened&&this._announceOption(d);a.stopPropagation();a.preventDefault();break;case h.ENTER:if(d){if(d==
c.nextButton){this._nextSearch(1);a.stopPropagation();a.preventDefault();break}else if(d==c.previousButton){this._nextSearch(-1);a.stopPropagation();a.preventDefault();break}a.stopPropagation();a.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case h.TAB:b=this.get("displayedValue");if(c&&(b==c._messages.previousMessage||b==c._messages.nextMessage))break;d&&this._selectOption(d);case h.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},
_autoCompleteText:function(a){var c=this.focusNode;b.selectInputText(c,c.value.length);var d=this.ignoreCase?"toLowerCase":"substr";0==a[d](0).indexOf(this.focusNode.value[d](0))?(d=this.autoComplete?this._getCaretPos(c):c.value.length,d+1>c.value.length&&(c.value=a,b.selectInputText(c,d))):(c.value=a,b.selectInputText(c))},_openResultList:function(a,b,d){var f=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();!a.length&&0==d.start?this.closeDropDown():(this._nextSearch=this.dropDown.onPage=
c.hitch(this,function(b){a.nextPage(-1!==b);this.focus()}),this.dropDown.createOptions(a,d,c.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in d?(d.direction?this.dropDown.highlightFirstOption():d.direction||this.dropDown.highlightLastOption(),f&&this._announceOption(this.dropDown.getHighlightedOption())):this.autoComplete&&(!this._prev_key_backspace&&!/^[*]+$/.test(b[this.searchAttr].toString()))&&this._announceOption(this.dropDown.containerNode.firstChild.nextSibling))},
_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var a=this.get("displayedValue"),b=this.dropDown;b&&(a==b._messages.previousMessage||a==b._messages.nextMessage)?this._setValueAttr(this._lastValueReported,
!0):"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",a)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState());this.focusNode.removeAttribute("aria-activedescendant")},_setItemAttr:function(a,b,c){var d="";a&&(c||(c=this.store._oldAPI?this.store.getValue(a,this.searchAttr):a[this.searchAttr]),d=this._getValueField()!=this.searchAttr?this.store.getIdentity(a):c);this.set("value",d,b,c,a)},_announceOption:function(a){if(a){var b;if(a==
this.dropDown.nextButton||a==this.dropDown.previousButton)b=a.innerHTML,this.item=void 0,this.value="";else{var c=this.dropDown.items[a.getAttribute("item")];b=(this.store._oldAPI?this.store.getValue(c,this.searchAttr):c[this.searchAttr]).toString();this.set("item",c,!1,b)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",f.get(a,"id"));this._autoCompleteText(b)}},_selectOption:function(a){this.closeDropDown();a&&this._announceOption(a);
this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=void 0;this.inherited(arguments)},_startSearch:function(a){if(!this.dropDown){var b=this.id+"_popup";this.dropDown=new (c.isString(this.dropDownClass)?c.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:c.hitch(this,this._selectOption),id:b,
dir:this.dir,textDir:this.textDir})}this._lastInput=a;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new k({},this.srcNodeRef),!("value"in this.params))){var a=this.item=this.store.fetchSelectedItem();if(a){var b=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(a,b):a[b]}}},postCreate:function(){var a=p('label[for\x3d"'+this.id+'"]');a.length&&
(a[0].id||(a[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",a[0].id));this.inherited(arguments);n.after(this,"onSearch",c.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(a){a=this.labelFunc(a,this.store);var b=this.labelType;"none"!=this.highlightMatch&&("text"==this.labelType&&this._lastInput)&&(a=this.doHighlight(a,this._lastInput),b="html");return{html:"html"==b,label:a}},doHighlight:function(a,b){var c=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?
"g":""),d=this.queryExpr.indexOf("${0}");b=l.escapeString(b);return this._escapeHtml(a.replace(RegExp((0==d?"^":"")+"("+b+")"+(d==this.queryExpr.length-4?"$":""),c),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},_escapeHtml:function(a){return a=String(a).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(a,
b){return(b._oldAPI?b.getValue(a,this.labelAttr||this.searchAttr):a[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(a,b,c,d){this._set("item",d||null);null==a&&(a="");this.inherited(arguments)}});a("dojo-bidi")&&d.extend({_setTextDirAttr:function(a){this.inherited(arguments);this.dropDown&&this.dropDown._set("textDir",a)}});return d})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(n,
d,f,h,c,p){function l(a){return{id:a.value,value:a.value,name:f.trim(a.innerText||a.textContent||"")}}return n("dijit.form.DataList",c,{constructor:function(a,c){this.domNode=d.byId(c);f.mixin(this,a);this.id&&p.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:h("option",this.domNode).map(l)}])},destroy:function(){p.remove(this.id)},fetchSelectedItem:function(){var a=h("\x3e option[selected]",this.domNode)[0]||h("\x3e option",this.domNode)[0];return a&&l(a)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),
function(n,d,f,h,c,p,l){return n("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(a){this._set("list",a)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(a){return RegExp("^"+a.replace(/(\\.)|(\*)|(\?)|\W/g,function(a,b,c,d){return c?".*":d?".":b?b:"\\"+a})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&
(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(a){if(!this.disabled&&!this.readOnly){var c=a.charOrCode;if(!("type"in a&&"key"==a.type.substring(0,3)&&(a.altKey||(a.ctrlKey||a.metaKey)&&"x"!=c&&"v"!=c||c==d.SHIFT))){this._prev_key_backspace=
a=!1;switch(c){case d.DELETE:case d.BACKSPACE:a=this._maskValidSubsetError=this._prev_key_backspace=!0;break;default:a="string"==typeof c||229==c}if(a)if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},_startSearch:function(a){this._abortQuery();var d=this,b=f.clone(this.query),h={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},l=
c.substitute(this.queryExpr,[a.replace(/([\\\*\?])/g,"\\$1")]),n,m=function(){var a=d._fetchHandle=d.store.query(b,h);!d.disabled&&!(d.readOnly||n!==d._lastQuery)&&p(a,function(c){d._fetchHandle=null;!d.disabled&&(!d.readOnly&&n===d._lastQuery)&&p(a.total,function(a){c.total=a;var f=d.pageSize;if(isNaN(f)||f>c.total)f=c.total;c.nextPage=function(a){h.direction=a=!1!==a;h.count=f;a?(h.start+=c.length,h.start>=c.total&&(h.count=0)):(h.start-=f,0>h.start&&(h.count=Math.max(f+h.start,0),h.start=0));0>=
h.count?(c.length=0,d.onSearch(c,b,h)):m()};d.onSearch(c,b,h)})},function(a){d._fetchHandle=null;d._cancelingQuery||console.error(d.declaredClass+" "+a.toString())})};f.mixin(h,this.fetchProperties);this.store._oldAPI?n=l:(n=this._patternToRegExp(l),n.toString=function(){return l});this._lastQuery=b[this.searchAttr]=n;this._queryDeferHandle=this.defer(m,this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var a=this.list;a&&
(this.store=l.byId(a))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(n,d,f,h,c,p,l,a){return n("dijit.form._ComboBoxMenu",[c,p,a,l],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(d.add(this.previousButton,"dijitMenuItemRtl"),d.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var a=this.ownerDocument.createElement("div");a.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");a.setAttribute("role","option");return a},onHover:function(a){d.add(a,"dijitMenuItemHover")},onUnhover:function(a){d.remove(a,
"dijitMenuItemHover")},onSelect:function(a){d.add(a,"dijitMenuItemSelected")},onDeselect:function(a){d.remove(a,"dijitMenuItemSelected")},_page:function(a){var b=0,c=this.domNode.scrollTop,d=f.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();b<d;){var h=this.getHighlightedOption();if(a){if(!h.previousSibling||"none"==h.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!h.nextSibling||"none"==h.nextSibling.style.display)break;this.selectNextNode()}h=
this.domNode.scrollTop;b+=(h-c)*(a?-1:1);c=h}},handleKey:function(a){switch(a.keyCode){case h.DOWN_ARROW:return this.selectNextNode(),!1;case h.PAGE_DOWN:return this._page(!1),!1;case h.UP_ARROW:return this.selectPreviousNode(),!1;case h.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(n,d,f,h,c){var p=d("dijit.form._ComboBoxMenuMixin"+
(h("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=c.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(c){this._set("value",c);this.onChange(c)},onClick:function(c){if(c==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(c==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(c)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(c,a){var d=this._createMenuItem(),b=a(c);b.html?d.innerHTML=b.label:d.appendChild(d.ownerDocument.createTextNode(b.label));""==d.innerHTML&&(d.innerHTML="\x26#160;");return d},createOptions:function(c,a,d){this.items=c;this.previousButton.style.display=0==a.start?"none":"";f.set(this.previousButton,"id",this.id+
"_prev");n.forEach(c,function(a,b){var c=this._createOption(a,d);c.setAttribute("item",b);f.set(c,"id",this.id+b);this.nextButton.parentNode.insertBefore(c,this.nextButton)},this);var b=!1;c.total&&!c.total.then&&-1!=c.total?a.start+a.count<c.total?b=!0:a.start+a.count>c.total&&a.count==c.length&&(b=!0):a.count==c.length&&(b=!0);this.nextButton.style.display=b?"":"none";f.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var c=this.containerNode;2<c.childNodes.length;)c.removeChild(c.childNodes[c.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});h("dojo-bidi")&&(p=d("dijit.form._ComboBoxMenuMixin",
p,{_createOption:function(){var c=this.inherited(arguments);this.applyTextDir(c);return c}}));return p})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(n,d,f,h){return n("dijit.form._ListMouseMixin",h,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(c,d){this._setSelectedAttr(d,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(d)})},_onMouseDown:function(c,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(d,!1)},_onMouseUp:function(c,d){this._isDragging=!1;var f=this.selected,a=this._hoveredNode;f&&d==f?this.defer(function(){this._onClick(c,
f)}):a&&this.defer(function(){this._onClick(c,a)})},_onMouseOut:function(c,d){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(c,d){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=d;this.onHover(d);this._isDragging&&this._setSelectedAttr(d,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(n,d,f){return n("dijit.form._ListBase",null,{selected:null,_listConnect:function(f,c){var n=this;return n.own(d(n.containerNode,d.selector(function(c,a,d){return c.parentNode==d},f),function(d){n[c](d,this)}))},selectFirstNode:function(){for(var d=this.containerNode.firstChild;d&&"none"==d.style.display;)d=d.nextSibling;this._setSelectedAttr(d,!0)},selectLastNode:function(){for(var d=this.containerNode.lastChild;d&&"none"==d.style.display;)d=d.previousSibling;this._setSelectedAttr(d,
!0)},selectNextNode:function(){var d=this.selected;if(d){for(d=d.nextSibling;d&&"none"==d.style.display;)d=d.nextSibling;d?this._setSelectedAttr(d,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var d=this.selected;if(d){for(d=d.previousSibling;d&&"none"==d.style.display;)d=d.previousSibling;d?this._setSelectedAttr(d,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(d,c){if(this.selected!=d){var n=this.selected;if(n)this.onDeselect(n);
d&&(c&&f.scrollIntoView(d),this.onSelect(d));this._set("selected",d)}else if(d)this.onSelect(d)}})})},"url:esri/dijit/templates/InfoWindow.html":'\x3cdiv id\x3d"${id}.infowindow" class\x3d"infowindow" dojoAttachPoint\x3d"_infowindow"\r\n  \x3e\x3cdiv style\x3d"position:relative;"\r\n    \x3e\x3cdiv class\x3d"window" dojoAttachPoint\x3d"_window"\r\n      \x3e\x3cdiv class\x3d"top"\r\n        \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_topleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n    \t\t\x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_topright"\r\n    \t\t\t\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\r\n    \t\t\t\x3e\x3cdiv class\x3d"user" dojoAttachPoint\x3d"_user"\r\n    \t\t\t  \x3e\x3cdiv class\x3d"titlebar" dojoAttachPoint\x3d"_titlebar"\r\n    \t\t\t    \x3e\x3ca class\x3d"hide" dojoAttachPoint\x3d"_hide" dojoAttachEvent\x3d"onclick:hide"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/a\r\n              \x3e\x3cdiv class\x3d"title" dojoAttachPoint\x3d"_title"\x3e${title}\x3c/div\r\n    \t\t\t  \x3e\x3c/div\r\n            \x3e\x3cdiv class\x3d"border" dojoAttachPoint\x3d"_border"\x3e\x3c/div\r\n    \t\t\t  \x3e\x3cdiv class\x3d"layout content" dojoAttachPoint\x3d"_content, containerNode"\r\n    \t\t\t  \x3e\x3c/div\r\n    \t\t\t\x3e\x3c/div\r\n    \t\t\x3e\x3c/div\r\n        \x3e\x3cdiv class\x3d"bottom"\r\n          \x3e\x3cdiv class\x3d"left" dojoAttachPoint\x3d"_bottomleft"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n\t\t      \x3e\x3cdiv class\x3d"right" dojoAttachPoint\x3d"_bottomright"\x3e\x3cdiv class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n        \x3e\x3c/div\r\n      \x3e\x3c/div\r\n    \x3e\x3c/div\r\n    \x3e\x3cdiv class\x3d"pointer" dojoAttachPoint\x3d"_pointer"\x3e\x3cdiv dojoAttachPoint\x3d"_sprite" class\x3d"sprite"\x3e\x3c/div\x3e\x3c/div\r\n  \x3e\x3c/div\r\n\x3e\x3c/div\x3e',
"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n        \x3cimg data-dojo-attach-point\x3d"loadingImg"/\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:jimu/dijit/templates/SymbolChooser.html":'\x3cdiv style\x3d"width:320px;"\x3e\r\n\t\x3cdiv class\x3d"symbol-section point-symbol-section" data-dojo-attach-point\x3d"pointSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-sym-class-select-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"pointSymClassSelect" data-dojo-type\x3d"dijit/form/Select"\r\n\t\t\t\t\t\t style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'0\' selected\x3d"selected"\x3e${nls.basic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'1\'\x3eA-Z\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'2\'\x3e${nls.arrows}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'3\'\x3e${nls.business}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'4\'\x3e${nls.cartographic}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'5\'\x3e${nls.nationalParkService}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'6\'\x3e${nls.outdoorRecreation}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'7\'\x3e${nls.peoplePlaces}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'8\'\x3e${nls.safetyHealth}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'9\'\x3e${nls.shapes}\x3c/option\x3e\r\n\t\t\t\t\t\t\t \x3coption value\x3d\'10\'\x3e${nls.transportation}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr class\x3d"point-icon-tables-tr"\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"pointIconTables"\x3e\r\n\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.symbolSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:18,smallDelta:1,largeDelta:10,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,128]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOpacityTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOutlineColorTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"pointOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:[0,0,128,255]\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr data-dojo-attach-point\x3d"pointOulineWidthTr"\x3e\r\n\t\t\t\t\t\x3ctd\x3e${nls.outlineWidth}:\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"pointOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n                        data-dojo-props\x3d\'value:1,smallDelta:1,constraints:{min:0,max:5},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section line-symbol-section" data-dojo-attach-point\x3d"lineSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineSymPreview" style\x3d"width:100%;overflow:hidden;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"lineIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.style}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cselect data-dojo-attach-point\x3d"lineStylesSelect" data-dojo-type\x3d"dijit/form/Select" style\x3d"width:100%;height:30px;"\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"solid"\x3e${nls.solid}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dash"\x3e${nls.dash}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dot"\x3e${nls.dot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"dashdot"\x3e${nls.dashDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\t\x3coption value\x3d"longdashdotdot"\x3e${nls.dashDotDot}\x3c/option\x3e\r\n\t\t\t\t\t\t\x3c/select\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"lineAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:1\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.width}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"lineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:3,smallDelta:1,constraints:{min:1,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section fill-symbol-section" data-dojo-attach-point\x3d"fillSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillSymPreview" style\x3d"width:100%;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\x3cdiv class\x3d"icon-tables" data-dojo-attach-point\x3d"fillIconTables"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.color}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#9bbb59"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.transparency}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillAlpha" data-dojo-type\x3d"jimu/dijit/_Transparency" data-dojo-props\x3d\'alpha:0.5\' style\x3d"width:100%;font-size:13px;"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"fillOutlineColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#738c3d"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.outlineWidth}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"fillOutlineWidth" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;"\r\n\t\t\t\t\t\tdata-dojo-props\x3d\'value:2,smallDelta:1,constraints:{min:0,max:50},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\t\x3cdiv class\x3d"symbol-section text-symbol-section" data-dojo-attach-point\x3d"textSection"\x3e\r\n\t\t\x3ctable class\x3d"symbol-set-table" cellspacing\x3d"0"\x3e\r\n\t\t\t\x3ccolgroup\x3e\r\n\t\t\t\t\x3ccol width\x3d"130px"\x3e\x3c/col\x3e\r\n\t\t\t\t\x3ccol width\x3d"auto"\x3e\x3c/col\x3e\r\n\t\t\t\x3c/colgroup\x3e\r\n\t\t\t\x3ctbody\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.preview}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan data-dojo-attach-point\x3d"textPreview"\x3e\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.text}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput class\x3d"text-input" data-dojo-attach-point\x3d"inputText" type\x3d"text" style\x3d"width:100%;" /\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontColor}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cdiv data-dojo-attach-point\x3d"textColor" data-dojo-type\x3d"jimu/dijit/ColorPicker" style\x3d"width:100%;height:30px;" data-dojo-props\x3d\'color:"#000"\'\x3e\x3c/div\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cspan\x3e${nls.fontSize}:\x3c/span\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\x3cinput data-dojo-attach-point\x3d"textFontSize" data-dojo-type\x3d"dijit/form/NumberSpinner" style\x3d"width:100%;" data-dojo-props\x3d\'value:20,smallDelta:1,constraints:{min:1,max:100},intermediateChanges:true\'\x3e\x3c/input\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/tbody\x3e\r\n\t\t\x3c/table\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dojox/widget/ColorPicker/ColorPicker.html":'\x3ctable class\x3d"dojoxColorPicker" dojoAttachEvent\x3d"onkeypress: _handleKey" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\x3ctr\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxColorPickerBox"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg title\x3d"${saturationPickerTitle}" alt\x3d"${saturationPickerTitle}" class\x3d"dojoxColorPickerPoint" src\x3d"${_pickerPointer}" tabIndex\x3d"0" dojoAttachPoint\x3d"cursorNode" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cimg role\x3d"presentation" alt\x3d"" dojoAttachPoint\x3d"colorUnderlay" dojoAttachEvent\x3d"onclick: _setPoint, onmousedown: _stopDrag" class\x3d"dojoxColorPickerUnderlay" src\x3d"${_underlay}" ondragstart\x3d"return false"\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\x3cdiv class\x3d"dojoxHuePicker"\x3e\r\n\t\t\t\t\x3c!-- Forcing ABS in style attr due to dojo DND issue with not picking it up form the class. --\x3e\r\n\t\t\t\t\x3cimg dojoAttachPoint\x3d"hueCursorNode" tabIndex\x3d"0" class\x3d"dojoxHuePickerPoint" title\x3d"${huePickerTitle}" alt\x3d"${huePickerTitle}" src\x3d"${_huePickerPointer}" style\x3d"position: absolute; top: 0px; left: 0px;"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"dojoxHuePickerUnderlay" dojoAttachPoint\x3d"hueNode"\x3e\r\n\t\t\t\t    \x3cimg role\x3d"presentation" alt\x3d"" dojoAttachEvent\x3d"onclick: _setHuePoint, onmousedown: _stopDrag" src\x3d"${_hueUnderlay}"\x3e\r\n\t\t\t\t\x3c/div\x3e\r\n\t\t\t\x3c/div\x3e\r\n\t\t\x3c/td\x3e\r\n\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerPreviewContainer"\x3e\r\n\t\t\t\t\t\t\x3ctable cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top" class\x3d"dojoxColorPickerRightPad"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"previewNode" class\x3d"dojoxColorPickerPreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd valign\x3d"top"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv dojoAttachPoint\x3d"safePreviewNode" class\x3d"dojoxColorPickerWebSafePreview"\x3e\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\x3ctd valign\x3d"bottom"\x3e\r\n\t\t\t\t\t\t\x3ctable class\x3d"dojoxColorPickerOptional" cellpadding\x3d"0" cellspacing\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerRgb" dojoAttachPoint\x3d"rgbNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_r"\x3e${redLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_r" dojoAttachPoint\x3d"Rval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_g"\x3e${greenLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_g" dojoAttachPoint\x3d"Gval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_b"\x3e${blueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_b" dojoAttachPoint\x3d"Bval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dijitInline dojoxColorPickerHsv" dojoAttachPoint\x3d"hsvNode"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctable cellpadding\x3d"1" cellspacing\x3d"1" role\x3d"presentation"\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_h"\x3e${hueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_h" dojoAttachPoint\x3d"Hval"size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${degLabel}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_s"\x3e${saturationLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_s" dojoAttachPoint\x3d"Sval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3ctr\x3e\x3ctd\x3e\x3clabel for\x3d"${_uId}_v"\x3e${valueLabel}\x3c/label\x3e\x3c/td\x3e\x3ctd\x3e\x3cinput id\x3d"${_uId}_v" dojoAttachPoint\x3d"Vval" size\x3d"1" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e ${percentSign}\x3c/td\x3e\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\t\x3ctr\x3e\r\n\t\t\t\t\t\t\t\t\x3ctd colspan\x3d"2"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3cdiv class\x3d"dojoxColorPickerHex" dojoAttachPoint\x3d"hexNode" aria-live\x3d"polite"\x3e\t\r\n\t\t\t\t\t\t\t\t\t\t\x3clabel for\x3d"${_uId}_hex"\x3e\x26nbsp;${hexLabel}\x26nbsp;\x3c/label\x3e\x3cinput id\x3d"${_uId}_hex" dojoAttachPoint\x3d"hexCode, focusNode, valueNode" size\x3d"6" class\x3d"dojoxColorPickerHexCode" dojoAttachEvent\x3d"onchange: _colorInputChange"\x3e\r\n\t\t\t\t\t\t\t\t\t\x3c/div\x3e\r\n\t\t\t\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\t\t\t\x3c/table\x3e\r\n\t\t\t\t\t\x3c/td\x3e\r\n\t\t\t\t\x3c/tr\x3e\r\n\t\t\t\x3c/table\x3e\r\n\t\t\x3c/td\x3e\r\n\t\x3c/tr\x3e\r\n\x3c/table\x3e\r\n\r\n',
"url:jimu/dijit/templates/_Transparency.html":'\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d"opacitySlider" data-dojo-type\x3d"dijit/form/HorizontalSlider" showbuttons\x3d"true" value\x3d"0" minimum\x3d"0" maximum\x3d"100" discretevalues\x3d"101" intermediatechanges\x3d"true" style\x3d"width:100%;" data-dojo-attach-event\x3d"change: _onAlphaChanged"\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"topDecoration" labels\x3d"${nls.opaque},${nls.transparent}" style\x3d"height: 1.5em; font-size: 0.8em; color: #666"\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv data-dojo-type\x3d"dijit/form/HorizontalRule" container\x3d"bottomDecoration" count\x3d"5" style\x3d"height: 5px;"\x3e\r\n    \x3c/div\x3e\r\n    \x3col data-dojo-type\x3d"dijit/form/HorizontalRuleLabels" container\x3d"bottomDecoration" style\x3d"height: 1em; font-size: 0.75em; color: darkblue;"\x3e\r\n      \x3cli\x3e0%\x3c/li\x3e\r\n      \x3cli\x3e50%\x3c/li\x3e\r\n      \x3cli\x3e100%\x3c/li\x3e\r\n    \x3c/ol\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:jimu/dijit/templates/TabContainer3.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"control-node" data-dojo-attach-point\x3d"controlNode"\x3e\r\n    \x3ctable data-dojo-attach-point\x3d"controlTable" class\x3d"control-table" cellpading\x3d"0"\x3e\r\n      \x3ctbody\x3e\r\n        \x3ctr data-dojo-attach-point\x3d"tabTr"\x3e\r\n        \x3c/tr\x3e\r\n      \x3c/tbody\x3e\r\n    \x3c/table\x3e\r\n  \x3c/div\x3e\r\n  \x3cdiv class\x3d"container-node" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\r\n  \x3cdiv class\x3d"tab-shelter" data-dojo-attach-point\x3d"shelter"\x3e\x3c/div\x3e\r\n\x3c/div\x3e',
"url:jimu/dijit/templates/DrawBox.html":'\x3cdiv style\x3d"position:relative;width:100%;"\x3e\r\n\t\x3cdiv class\x3d"draw-items"\x3e\r\n\t\t\x3cdiv title\x3d"${nls.point}" data-geotype\x3d"POINT" data-commontype\x3d"point" class\x3d"draw-item point-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.line}" data-geotype\x3d"LINE" data-commontype\x3d"polyline" class\x3d"draw-item line-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polyline}" data-geotype\x3d"POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolyline}" data-geotype\x3d"FREEHAND_POLYLINE" data-commontype\x3d"polyline" class\x3d"draw-item freehand-polyline-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.triangle}" data-geotype\x3d"TRIANGLE" data-commontype\x3d"polygon" class\x3d"draw-item triangle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.extent}" data-geotype\x3d"EXTENT" data-commontype\x3d"polygon" class\x3d"draw-item extent-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.circle}" data-geotype\x3d"CIRCLE" data-commontype\x3d"polygon" class\x3d"draw-item circle-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.ellipse}" data-geotype\x3d"ELLIPSE" data-commontype\x3d"polygon" class\x3d"draw-item ellipse-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.polygon}" data-geotype\x3d"POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.freehandPolygon}" data-geotype\x3d"FREEHAND_POLYGON" data-commontype\x3d"polygon" class\x3d"draw-item freehand-polygon-icon"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv title\x3d"${nls.text}" data-geotype\x3d"TEXT" data-commontype\x3d"text" class\x3d"draw-item text-icon" data-dojo-attach-point\x3d"textIcon"\x3e\x3c/div\x3e\r\n\t\t\x3cspan class\x3d"drawings-clear jimu-float-trailing" data-dojo-attach-point\x3d"btnClear"\x3e${nls.clear}\x3c/span\x3e\r\n\t\x3c/div\x3e\r\n\x3c/div\x3e',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"text" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(n){n(['dojo/i18n!*preload*jimu/nls/main*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/urlUtils esri/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main".split(" "),function(n,d,f,h,c,p,l,a,k,b,s,q,r,m,t,e,g,y,w,x,z,D,v){p={};t.defaults.io.timeout=18E4;"function"!==typeof b.getAll&&(b.getAll=function(a){var c=[];(a=b(a))&&
c.push(a);return c});window.jimuNls=v;y.setProtocolErrorHandler(function(){return!0});t=x.getAncestorWindow();var u=!1;try{u=0===t.location.href.indexOf("https://")}catch(F){console.log(F),u="https:"===window.location.protocol}e.setRequestPreCallback(function(a){a.content&&a.content.printFlag&&(a.timeout=3E5);u&&(a.url=a.url.replace(/^http(s?):\/\//gi,"//"));-1!==a.url.indexOf("/queryRelatedRecords?")&&!x.isHostedService(a.url)&&(a.url=a.url.replace("FeatureServer","MapServer"));return a});l(window,
"mousedown",function(b){if(a.isMiddle(b))return b.preventDefault(),b.stopPropagation(),b.returnValue=!1});String.prototype.startWith=function(a){return this.substr(0,a.length)===a?!0:!1};String.prototype.endWith=function(a){return this.substr(this.length-a.length,a.length)===a?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=c.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",
timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.0";window.productVersion="ArcGIS Online 4.1";p.initApp=function(){var a,b;console.log("jimu.js init...");a=window.location.search;a=""===a?{}:r.queryToObject(a.substr(1));if(a.mobileBreakPoint)try{b=parseInt(a.mobileBreakPoint,10),jimuConfig.breakPoints[0]=b}catch(c){console.error("mobileBreakPoint URL parameter must be a number.",c)}f.getInstance();h.setStyle(jimuConfig.loadingId,"display","none");h.setStyle(jimuConfig.mainPageId,
"display","block");b=d.getInstance({mapId:jimuConfig.mapId,urlParams:a},jimuConfig.layoutId);a=n.getInstance(a);b.startup();a.loadConfig()};return p});