// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"dojox/data/CsvStore":function(){define("dojo/_base/lang dojo/_base/declare dojo/_base/xhr dojo/_base/kernel dojo/data/util/filter dojo/data/util/simpleFetch".split(" "),function(f,t,k,p,l,v){t=t("dojox.data.CsvStore",null,{constructor:function(a){this._attributes=[];this._attributeIndexes={};this._dataArray=[];this._arrayOfAllItems=[];this._loadFinished=!1;a.url&&(this.url=a.url);this._csvData=a.data;a.label?this.label=a.label:""===this.label&&(this.label=void 0);this._storeProp=
"_csvStore";this._idProp="_csvId";this._features={"dojo.data.api.Read":!0,"dojo.data.api.Identity":!0};this._loadInProgress=!1;this._queuedFetches=[];this.identifier=a.identifier;""===this.identifier?delete this.identifier:this._idMap={};"separator"in a&&(this.separator=a.separator);"urlPreventCache"in a&&(this.urlPreventCache=a.urlPreventCache?!0:!1)},url:"",label:"",identifier:"",separator:",",urlPreventCache:!1,_assertIsItem:function(a){if(!this.isItem(a))throw Error(this.declaredClass+": a function was passed an item argument that was not an item");
},_getIndex:function(a){a=this.getIdentity(a);this.identifier&&(a=this._idMap[a]);return a},getValue:function(a,b,c){this._assertIsItem(a);var d=c;if("string"===typeof b)b=this._attributeIndexes[b],null!=b&&(d=this._dataArray[this._getIndex(a)][b]||c);else throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");return d},getValues:function(a,b){var c=this.getValue(a,b);return c?[c]:[]},getAttributes:function(a){this._assertIsItem(a);var b=[];a=this._dataArray[this._getIndex(a)];
for(var c=0;c<a.length;c++)""!==a[c]&&b.push(this._attributes[c]);return b},hasAttribute:function(a,b){this._assertIsItem(a);if("string"===typeof b){var c=this._attributeIndexes[b],d=this._dataArray[this._getIndex(a)];return"undefined"!==typeof c&&c<d.length&&""!==d[c]}throw Error(this.declaredClass+": a function was passed an attribute argument that was not a string");},containsValue:function(a,b,c){var d=void 0;"string"===typeof c&&(d=l.patternToRegExp(c,!1));return this._containsValue(a,b,c,d)},
_containsValue:function(a,b,c,d){a=this.getValues(a,b);for(b=0;b<a.length;++b){var e=a[b];if("string"===typeof e&&d)return null!==e.match(d);if(c===e)return!0}return!1},isItem:function(a){if(a&&a[this._storeProp]===this)if(a=a[this._idProp],this.identifier){if(this._dataArray[this._idMap[a]])return!0}else if(0<=a&&a<this._dataArray.length)return!0;return!1},isItemLoaded:function(a){return this.isItem(a)},loadItem:function(a){},getFeatures:function(){return this._features},getLabel:function(a){if(this.label&&
this.isItem(a))return this.getValue(a,this.label)},getLabelAttributes:function(a){return this.label?[this.label]:null},_fetchItems:function(a,b,c){var d=this,e=function(a,e){var c=null;if(a.query){var m,g,c=[],n=a.queryOptions?a.queryOptions.ignoreCase:!1,f={};for(m in a.query)g=a.query[m],"string"===typeof g&&(f[m]=l.patternToRegExp(g,n));for(n=0;n<e.length;++n){var w=!0,k=e[n];for(m in a.query)g=a.query[m],d._containsValue(k,m,g,f[m])||(w=!1);w&&c.push(k)}}else c=e.slice(0,e.length);b(c,a)};if(this._loadFinished)e(a,
this._arrayOfAllItems);else if(""!==this.url)if(this._loadInProgress)this._queuedFetches.push({args:a,filter:e});else{this._loadInProgress=!0;var n=k.get({url:d.url,handleAs:"text",preventCache:d.urlPreventCache});n.addCallback(function(b){try{d._processData(b),e(a,d._arrayOfAllItems),d._handleQueuedFetches()}catch(m){c(m,a)}});n.addErrback(function(e){d._loadInProgress=!1;if(c)c(e,a);else throw e;});var m=null;a.abort&&(m=a.abort);a.abort=function(){n&&-1===n.fired&&n.cancel();m&&m.call(a)}}else if(this._csvData)try{this._processData(this._csvData),
this._csvData=null,e(a,this._arrayOfAllItems)}catch(g){c(g,a)}else{var f=Error(this.declaredClass+": No CSV source data was provided as either URL or String data input.");if(c)c(f,a);else throw f;}},close:function(a){},_getArrayOfArraysFromCsvFileContents:function(a){if(f.isString(a)){var b=RegExp("^\\s+","g"),c=RegExp("\\s+$","g"),d=RegExp('""',"g"),e=[],n=this._splitLines(a);for(a=0;a<n.length;++a){var m=n[a];if(0<m.length){for(var m=m.split(this.separator),g=0;g<m.length;){var w=m[g].replace(b,
""),h=w.replace(c,""),r=h.charAt(0),q=h.charAt(h.length-1),k=h.charAt(h.length-2),s=h.charAt(h.length-3);if(2===h.length&&'""'==h)m[g]="";else if('"'==r&&('"'!=q||'"'==q&&'"'==k&&'"'!=s)){if(g+1===m.length)return;m[g]=w+this.separator+m[g+1];m.splice(g+1,1)}else'"'==r&&'"'==q&&(h=h.slice(1,h.length-1),h=h.replace(d,'"')),m[g]=h,g+=1}e.push(m)}}this._attributes=e.shift();for(a=0;a<this._attributes.length;a++)this._attributeIndexes[this._attributes[a]]=a;this._dataArray=e}},_splitLines:function(a){var b=
[],c,d="",e=!1;for(c=0;c<a.length;c++){var n=a.charAt(c);switch(n){case '"':e=!e;d+=n;break;case "\r":e?d+=n:(b.push(d),d="",c<a.length-1&&"\n"==a.charAt(c+1)&&c++);break;case "\n":e?d+=n:(b.push(d),d="");break;default:d+=n}}""!==d&&b.push(d);return b},_processData:function(a){this._getArrayOfArraysFromCsvFileContents(a);this._arrayOfAllItems=[];if(this.identifier&&void 0===this._attributeIndexes[this.identifier])throw Error(this.declaredClass+": Identity specified is not a column header in the data set.");
for(a=0;a<this._dataArray.length;a++){var b=a;this.identifier&&(b=this._dataArray[a][this._attributeIndexes[this.identifier]],this._idMap[b]=a);this._arrayOfAllItems.push(this._createItemFromIdentity(b))}this._loadFinished=!0;this._loadInProgress=!1},_createItemFromIdentity:function(a){var b={};b[this._storeProp]=this;b[this._idProp]=a;return b},getIdentity:function(a){return this.isItem(a)?a[this._idProp]:null},fetchItemByIdentity:function(a){var b,c=a.scope?a.scope:p.global;if(this._loadFinished)b=
this._createItemFromIdentity(a.identity),this.isItem(b)||(b=null),a.onItem&&a.onItem.call(c,b);else{var d=this;if(""!==this.url)this._loadInProgress?this._queuedFetches.push({args:a}):(this._loadInProgress=!0,b=k.get({url:d.url,handleAs:"text"}),b.addCallback(function(e){try{d._processData(e);var b=d._createItemFromIdentity(a.identity);d.isItem(b)||(b=null);a.onItem&&a.onItem.call(c,b);d._handleQueuedFetches()}catch(g){a.onError&&a.onError.call(c,g)}}),b.addErrback(function(e){this._loadInProgress=
!1;a.onError&&a.onError.call(c,e)}));else if(this._csvData)try{d._processData(d._csvData),d._csvData=null,b=d._createItemFromIdentity(a.identity),d.isItem(b)||(b=null),a.onItem&&a.onItem.call(c,b)}catch(e){a.onError&&a.onError.call(c,e)}}},getIdentityAttributes:function(a){return this.identifier?[this.identifier]:null},_handleQueuedFetches:function(){if(0<this._queuedFetches.length){for(var a=0;a<this._queuedFetches.length;a++){var b=this._queuedFetches[a],c=b.filter,d=b.args;c?c(d,this._arrayOfAllItems):
this.fetchItemByIdentity(b.args)}this._queuedFetches=[]}}});f.extend(t,v);return t})},"jimu/CSVUtils":function(){define("exports dojo/_base/lang dojo/_base/array dojo/_base/html dojo/has dojo/Deferred jimu/utils esri/lang esri/tasks/QueryTask esri/tasks/query".split(" "),function(f,t,k,p,l,v,a,b,c,d){f.exportCSV=function(a,b,c){return f._createCSVStr(b,c).then(function(b){return f._download(a+".csv",b)})};f.exportCSVFromFeatureLayer=function(a,b,c){c=c||{};return f._getExportData(b,{datas:c.datas,
fromClient:c.fromClient,outFields:c.outFields,filterExpression:c.filterExpression}).then(function(g){return f._formattedData(b,g,{formatNumber:c.formatNumber,formatDate:c.formatDate,formatCodedValue:c.formatCodedValue,popupInfo:c.popupInfo}).then(function(b){return f.exportCSV(a,b.datas,b.columns)})})};f.exportCSVByAttributes=function(a,b,c,g){g=t.mixin({},g);g.datas=c;return f.exportCSVFromFeatureLayer(a,b,g)};f.exportCSVByGraphics=function(a,b,c,g){c=k.map(c,function(a){return a.attributes});return f.exportCSVByAttributes(a,
b,c,g)};f._createCSVStr=function(a,b){var c=new v,g="",d=0,h=0,f="",q="";try{k.forEach(b,function(a){g=g+f+a;f=","});for(var g=g+"\r\n",d=a.length,h=b.length,l=0;l<d;l++){for(var f="",s=0;s<h;s++)q=a[l][b[s]],!q&&"number"!==typeof q&&(q=""),q&&/[",\r\n]/g.test(q)&&(q='"'+q.replace(/(")/g,'""')+'"'),g=g+f+q,f=",";g+="\r\n"}c.resolve(g)}catch(p){console.error(p),c.resolve("")}return c};f._isIE11=function(){return 11===a.has("ie")};f._isEdge=function(){return a.has("edge")};f._getDownloadUrl=function(a){return window.Blob&&
window.URL&&window.URL.createObjectURL?(a=new Blob(["\ufeff"+a],{type:"text/csv"}),URL.createObjectURL(a)):"data:attachment/csv;charset\x3dutf-8,\ufeff"+encodeURIComponent(a)};f._download=function(a,b){var c=new v;try{if(l("ie")&&10>l("ie")){var d=window.top.open("about:blank","_blank");d.document.write("sep\x3d,\r\n"+b);d.document.close();d.document.execCommand("SaveAs",!0,a);d.close()}else if(10===l("ie")||f._isIE11()||f._isEdge()){var k=new Blob(["\ufeff"+b],{type:"text/csv"});navigator.msSaveBlob(k,
a)}else{var h=p.create("a",{href:f._getDownloadUrl(b),target:"_blank",download:a},document.body);if(l("safari")){var r=document.createEvent("MouseEvents");r.initEvent("click",!0,!0);h.dispatchEvent(r)}else h.click();p.destroy(h)}c.resolve()}catch(q){c.reject(q)}return c};f._getExportData=function(a,b){var c=new v,d=null,l=b.datas,d=b.outFields;if(!d||!d.length)d=a.fields;l&&0<l.length?c.resolve({data:l||[],outFields:d}):b.fromClient?(l=k.map(a.graphics,function(a){return a.attributes}),c.resolve({data:l||
[],outFields:d})):f._getExportDataFromServer(a,d,b).then(function(a){c.resolve({data:a||[],outFields:d})});return c};f._getExportDataFromServer=function(a,b,m){var g=new v;if("esri.layers.FeatureLayer"!==a.declaredClass)return g.resolve([]),g;var f=new c(a.url),h=new d;h.where=m.filterExpression||a.getDefinitionExpression&&a.getDefinitionExpression()||"1\x3d1";0<b.length?(a=k.map(b,function(a){return a.name}),h.outFields=a):h.outFields=["*"];h.returnGeometry=!1;f.execute(h,function(a){a=k.map(a.features,
function(a){return a.attributes});g.resolve(a)},function(a){console.error(a);g.resolve([])});return g};f._formattedData=function(a,b,c){var d=new v,l=[],h=b.data;b=b.outFields;for(var r=0,q=h.length;r<q;r++){for(var p={},s=0;s<b.length;s++){var t=b[s];p[t.alias||t.name]=f._getExportValue(h[r][t.name],t,a.objectIdField,a.typeIdField,h[r][a.typeIdField],a.types,c)}l.push(p)}a=k.map(b,function(a){return a.alias||a.name});d.resolve({datas:l,columns:a});return d};f._getExportValue=function(c,d,f,g,l,h,
r){function q(a){if(p&&b.isDefined(p.fieldInfos))for(var c=0,d=p.fieldInfos.length;c<d;c++){var e=p.fieldInfos[c];if(e.fieldName===a)return e.format}return null}var p=r.popupInfo,s=!!d.domain&&r.formatCodedValue;r="esriFieldTypeDate"===d.type&&r.formatDate;var t=f&&d.name===f;g=g&&d.name===g;return r?a.fieldFormatter.getFormattedDate(c,q(d.name)):g?a.fieldFormatter.getTypeName(c,h):s?a.fieldFormatter.getCodedValue(d.domain,c):!s&&!r&&!t&&!g?(s=null,f&&h&&0<h.length&&(f=(f=k.filter(h,function(a){return a.id===
l}))&&f[0])&&(f.domains&&f.domains[d.name]&&f.domains[d.name].codedValues)&&(s=a.fieldFormatter.getFormattedCodedValue(f.domains[d.name],c)),null!==s?s:c):c}})},"widgets/GeoLookup/layerQueryDetails":function(){define(["dojo/Evented","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","esri/geometry/geometryEngine"],function(f,t,k,p,l){return t([f],{declaredClass:"layerQueryDetails",layer:null,fields:null,intersectField:null,valueIn:null,valueOut:null,numberOfRequest:0,requestComplete:0,numberOfHits:0,
totalRecords:0,currentNumber:0,deferreds:[],complete:!1,hasError:!1,constructor:function(f){t.safeMixin(this,f)},addDeferred:function(f,a){f.then(k.hitch(this,function(b){b&&p.forEach(a,k.hitch(this,function(a){p.forEach(b.features,k.hitch(this,function(b){l.intersects(a.geometry,b.geometry)&&(p.forEach(this.fields,function(e){b.attributes[e]&&(a.attributes[e]=b.attributes[e])},this),a.attributes[this.intersectField]=this.valueIn,a.symbol=this.valueInSym,this.numberOfHits++)}));this.currentNumber++;
this.requestComplete++}));this.currentNumber=this.currentNumber;this.requestComplete=this.requestComplete;this.numberOfHits=this.numberOfHits;this.emit("requestComplete",{layerID:this.layer.id,currentNumber:this.currentNumber,totalRecords:this.totalRecords,intesected:this.numberOfHits,name:this.layer.label});this.isComplete()&&this.emit("complete",{layerID:this.layer.id})}),k.hitch(this,function(a){this.hasError=!0;console.log("error: "+a);this.emit("error",{layerID:this.layer.id});return a}));this.deferreds.push(f)},
isComplete:function(){return this.complete=this.numberOfRequest===this.requestComplete?!0:!1}})})},"widgets/GeoLookup/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings","dojo/text!./config.json"],function(){})},"url:widgets/GeoLookup/Widget.html":'\x3cdiv style\x3d"width:100%;height:100%;overflow-y:auto"\x3e\r\n\r\n   \x3c!-- \x3cdiv data-dojo-type\x3d"dijit/layout/ContentPane" style\x3d"height:100%;width:100%"\x3e --\x3e\r\n        \x3cdiv class\x3d"widgetDescription" data-dojo-attach-point\x3d"widgetDescription"\x3e\x3c/div\x3e\r\n        \x3cform data-dojo-attach-point\x3d"inputForm"\x3e\r\n        \x3cdiv class\x3d"divCheckPlot"\x3e\r\n        \t\x3cdiv class\x3d"plotChoice"\x3e\x3cinput type\x3d"checkbox" id\x3d"chkboxPlotOnly" data-dojo-attach-point\x3d"chkboxPlotOnly"\x3e\x3clabel\x3e${nls.plotOnly}\x3c/label\x3e\x3c/div\x3e\r\n        \t\x3cdiv class\x3d"projectionChoice"\x3e\r\n        \t\t\x3clabel class\x3d"labelPad"\x3e${nls.projectionChoice}\x3c/label\x3e\r\n        \t\t\x3cinput type\x3d"radio" name\x3d"rdProjection" id\x3d"rdProjectionLat" data-dojo-attach-point\x3d"rdProjection" value\x3d"latlon" checked\x3e\x3clabel class\x3d"labelPad"\x3e${nls.projectionLat}\x3c/label\x3e\r\n        \t\t\x3cinput type\x3d"radio" name\x3d"rdProjection" id\x3d"rdProjectionMap" data-dojo-attach-point\x3d"rdProjection" value\x3d"map"\x3e\x3clabel\x3e${nls.projectionMap}\x3c/label\x3e\r\n        \t\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3ctable data-dojo-attach-point\x3d"actionButtonsContainer" cellspacing\x3d"0" class\x3d"tblActionContainer"\x3e\r\n        \x3ctr\x3e\r\n        \t\x3ctd width\x3d"100%" class\x3d"tdCSVButton"\x3e\r\n        \t\t\x3cinput type\x3d"file" id\x3d"csvFileInput" data-dojo-attach-point\x3d"csvFileInput" data-dojo-attach-event\x3d"change:fileSelected" accept\x3d".csv"\x3e\r\n\t\t\t\t\x3cdiv class\x3d"jimu-btn hide" data-dojo-attach-point\x3d"showFileDialogBtn" data-dojo-attach-event\x3d"click:showFileDialog"\x3e${nls.selectCSV}\x3c/div\x3e\r\n\t\t\t\x3c/td\x3e\r\n        \t\x3ctd width\x3d"25%" class\x3d"tdDownloadButton"\x3e\x3cdiv class\x3d"download-CSVresult" data-dojo-attach-point\x3d"downloadResultsBtn" data-dojo-attach-event\x3d"click:downloadCSVResults"\x3e${nls.downloadResults}\x3c/div\x3e\x3c/td\x3e\r\n        \t\x3ctd width\x3d"25%" class\x3d"tdClearButton"\x3e\x3cdiv class\x3d"clear-CSVresult" data-dojo-attach-point\x3d"clearResultsBtn" data-dojo-attach-event\x3d"click:clearCSVResults"\x3e${nls.clearResults}\x3c/div\x3e\x3c/td\x3e\r\n        \x3c/tr\x3e\r\n        \x3c/table\x3e\r\n        \x3c/form\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"results" class\x3d"hide"\x3e\r\n        \t\x3cdiv class\x3d"results-header"\x3e${nls.messages}\x3c/div\x3e\r\n            \x3ctable class\x3d"widgets-results-table" data-dojo-attach-point\x3d"widgetsResultsTable" cellspacing\x3d"0"\x3e\r\n                \x3ctbody data-dojo-attach-point\x3d"widgetsResultsTableBody"\x3e\r\n\r\n                    \x3ctr class\x3d"controls"\x3e\r\n\r\n                        \x3ctd class\x3d"tdProcessing"\x3e\r\n                            \x3cdiv data-dojo-attach-point\x3d"resultsLoadingImage" id\x3d"resultsLoadingImage" class\x3d"status processing" /\x3e\r\n                        \x3c/td\x3e\r\n                        \x3ctd\x3e\r\n                            \x3cdiv class\x3d"result-text" data-dojo-attach-point\x3d"resultsLoading"\x3e${nls.loadingCSV}\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                    \x3c/tr\x3e\r\n\r\n                    \x3ctr class\x3d"controls"\x3e\r\n\r\n                        \x3ctd class\x3d"tdProcessing"\x3e\r\n                            \x3cdiv data-dojo-attach-point\x3d"resultsPlottingImage" id\x3d"resultsPlottingImage" class\x3d"status processing" /\x3e\r\n\r\n                        \x3c/td\x3e\r\n                        \x3ctd\x3e\r\n                            \x3cdiv class\x3d"result-text" data-dojo-attach-point\x3d"resultsPlotting"\x3e${nls.plottingRows}\x3c/div\x3e\r\n                        \x3c/td\x3e\r\n                    \x3c/tr\x3e\r\n\r\n                \x3c/tbody\x3e\r\n\r\n            \x3c/table\x3e\r\n            \x3cdiv class\x3d"errorLink" data-dojo-attach-point\x3d"enrichErrors" data-dojo-attach-event\x3d"click:showErrorTable"\x3e\x3c/div\x3e\r\n            \x3cdiv class\x3d"hide errorList" id\x3d"enrichErrorsList" data-dojo-attach-point\x3d"enrichErrorsList"\x3e\x3c/div\x3e\r\n        \x3c/div\x3e\r\n        \x3c!--  \x3c/div\x3e--\x3e\r\n        \x3cdiv data-dojo-attach-point\x3d"loading" data-dojo-type\x3d"jimu/dijit/LoadingIndicator" data-dojo-props\x3d\'hidden:true\'\x3e\x3c/div\x3e\r\n   \x3c!-- \x3c/div\x3e --\x3e\r\n\x3c/div\x3e',
"url:widgets/GeoLookup/css/style.css":'.solutions-widget-geolookup .widgetDescription {text-align: left; color: #66696C; font-family: proxima-nova; font-style: normal; margin: 0px 0px 20px 0px; font-size: 14px;}.solutions-widget-geolookup .uploadBox {margin: 30px 0 15px 0; float: left;}.solutions-widget-geolookup .hide {display: none;}.solutions-widget-geolookup .fileInputNonHTML5 {position: fixed;}.solutions-widget-geolookup .fileInputHTML5 {position: fixed; width: 0px; height: 0px;}.solutions-widget-geolookup .divCheckPlot {color: #686868; font-family: proxima-nova; font-style: normal; font-size: 12px; padding-bottom: 25px; width: 100%; position: relative;}.solutions-widget-geolookup .plotChoice {position: absolute; left: 0px; top: 0px; width: 35%;}.solutions-widget-geolookup .projectionChoice {text-align: right; width: 65%; position: absolute; right: 0px; top: 0px;}.solutions-widget-geolookup .labelPad {padding-right: 5px;}.solutions-widget-geolookup .widgets-results-table {margin: 1px;}.solutions-widget-geolookup .tblActionContainer {width: 100%; padding-bottom: 30px;}.solutions-widget-geolookup .tdCSVButton {text-align: left; width: 100%;}.solutions-widget-geolookup .tdDownloadButton {text-align: right; width: 25%;}.solutions-widget-geolookup .tdClearButton {text-align: right; width: 25%;}.solutions-widget-geolookup .clear-CSVresult {text-align: right; color: #51b1fe; font-family: proxima-nova; font-style: normal; margin: 0px 0px 0px 0px; font-size: 14px; cursor:pointer;}.solutions-widget-geolookup .download-CSVresult {text-align: left; color: #51b1fe; font-family: proxima-nova; font-style: normal; margin: 0px 10px 0px 0px; font-size: 14px; cursor:pointer;} .solutions-widget-geolookup .controls {width: 100%; height: 42px; vertical-align: middle; padding-top: 0px; padding-bottom: 0px; margin-bottom: 0px; margin-top: 0px; font-size:12px;}.solutions-widget-geolookup .status {background-repeat: no-repeat; background-position: left; width: 20px;}.solutions-widget-geolookup .processing {content: url("./images/processing.gif");}.solutions-widget-geolookup .processing:before {content: url("./images/processing.gif");}.solutions-widget-geolookup .tdProcessing {width: 30px; text-align: left;}.solutions-widget-geolookup .complete {content: url("./images/complete.png");}.solutions-widget-geolookup .complete:before {content: url("./images/complete.png");}.solutions-widget-geolookup .error {content: url("./images/x_symbol_red.png");}.solutions-widget-geolookup .error:before {content: url("./images/x_symbol_red.png");}.solutions-widget-geolookup .bypass {content: url("");}.solutions-widget-geolookup .results-header {color: #66696C; font-family: proxima-nova; font-style: Semibold; font-size: 14px; padding-bottom: 0px;}.solutions-widget-geolookup .result-text {color: #686868; font-family: proxima-nova; font-style: normal; font-size: 12px;}.solutions-widget-geolookup .errorLink {color: #0000FF; cursor:pointer; font-family: proxima-nova; font-style: normal; font-size: 12px;}.solutions-widget-geolookup .errorList {color: #686868; font-family: proxima-nova; font-style: normal; font-size: 12px;}',
"url:widgets/GeoLookup/config.json":'{\r\n    "latFields": [ "lat", "latitude", "y", "ycenter", "point_y" ],\r\n    "longFields": [ "lon", "long", "longitude", "x", "xcenter", "point_x" ],\r\n    "valueOut": "Out",\r\n    "valueIn": "In",\r\n    "intersectField": "intersected",\r\n    "maxRowCount" : "10000",\r\n    "cacheNumber": "500",\r\n  \t"SymbolWithin": {\r\n    \t"angle": 0,\r\n    \t"xoffset": 0,\r\n    \t"yoffset": 0,\r\n    \t"type": "esriPMS",\r\n    \t"url": "http://static.arcgis.com/images/Symbols/Basic/RedSphere.png",\r\n    \t"imageData": "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\x3d",\r\n    \t"contentType": "image/png",\r\n    \t"width": 18,\r\n    \t"height": 18\r\n  \t},\r\n  \t"SymbolOutside": {\r\n    \t"angle": 0,\r\n    \t"xoffset": 0,\r\n    \t"yoffset": 0,\r\n    \t"type": "esriPMS",\r\n    \t"url": "http://static.arcgis.com/images/Symbols/Basic/BlueSphere.png",\r\n    \t"imageData": "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\x3d\x3d",\r\n    \t"contentType": "image/png",\r\n    \t"width": 18,\r\n    \t"height": 18\r\n  \t}\r\n}\r\n',
"*now":function(f){f(['dojo/i18n!*preload*widgets/GeoLookup/nls/Widget*["ar","cs","da","de","en","el","es","et","fi","fr","he","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sv","th","tr","zh-cn","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("dojo/_base/declare dijit/_WidgetsInTemplateMixin jimu/BaseWidget dojo/dom dojo/on dojo/sniff dojo/_base/html dojo/_base/lang dojo/_base/array dojo/string dojo/dom-class dojo/dom-construct dojo/dom-style dojox/data/CsvStore esri/geometry/webMercatorUtils esri/layers/FeatureLayer esri/geometry/Multipoint esri/geometry/Point esri/InfoTemplate esri/tasks/query esri/tasks/QueryTask esri/SpatialReference esri/symbols/jsonUtils esri/renderers/UniqueValueRenderer jimu/dijit/Message jimu/CSVUtils jimu/utils ./layerQueryDetails".split(" "),function(f,
t,k,p,l,v,a,b,c,d,e,n,m,g,w,h,r,q,B,s,C,D,A,E,x,F,y,G){return f([k,t],{baseClass:"solutions-widget-geolookup",csvStore:null,layerLoaded:!1,lookupLayersFieldNames:[],lookupLayersFields:[],combinedFields:[],latField:null,longField:null,renderer:null,srWebMerc:null,syncLayers:null,enrichFilter:null,enrichResultsProg:{},enrichResultsText:{},errorList:null,postCreate:function(){this.inherited(arguments);e.add(this.downloadResultsBtn,"hide")},startup:function(){this.inherited(arguments);this.loading.show();
a.place(a.toDom(this.nls.description),this.widgetDescription);this._buildRenderer();if(y.file.supportHTML5()){var u=p.byId(this.id);this.own(l(u,"dragover",function(a){a.preventDefault()}));this.own(l(u,"dragenter",function(a){a.preventDefault()}));this.own(l(u,"drop",b.hitch(this,this._handleCSVDrop)))}this.srWebMerc=new D({wkid:102100});!y.file.supportHTML5()&&!v("safari")&&y.file.isEnabledFlash()?y.file.loadFileAPI().then(b.hitch(this,function(){console.log("loading FileAPI");e.add(this.csvFileInput,
"fileInputNonHTML5, js-fileapi-wrapper")})):(e.add(this.csvFileInput,"fileInputHTML5"),e.remove(this.showFileDialogBtn,"hide"));this._initalizeLookupLayers();c.forEach(this.config.enrichLayers,function(a){var b=a.id,c=a.id+"_prog",u=n.toDom("\x3ctr class\x3d'controls'\x3e\x3ctd\x3e\x3cdiv id\x3d'"+c+"' class\x3d'status processing' /\x3e\x3c/td\x3e\x3ctd\x3e\x3cdiv id\x3d'"+b+"' class\x3d'result-text' \x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e");n.place(u,this.widgetsResultsTableBody);this.enrichResultsProg[b]=
p.byId(c);this.enrichResultsText[b]=p.byId(b);this.enrichResultsText[b].innerHTML=d.substitute(this.nls.results.recordsEnriched,{"0":0,1:0,2:0,3:a.label})},this);e.add(this.clearResultsBtn,"jimu-state-disabled");this.loading.hide()},_buildRenderer:function(){this.symIn=A.fromJson(this.config.SymbolWithin);this.symOut=A.fromJson(this.config.SymbolOutside);this.renderer=new E(this.symOut,this.config.intersectField);this.renderer.addValue(this.config.valueIn,this.symIn);this.renderer.addValue(this.config.valueOut,
this.symOut)},_initalizeLookupLayers:function(){this.lookupLayersField=[];this.lookupLayersFieldNames=[];var a,b;c.forEach(this.config.enrichLayers,function(d){a=c.map(d.fields,function(a){return a.fieldName});b=c.map(d.fields,function(a){return a.label});c.forEach(a,function(c){var d={name:null,alias:null,type:"esriFieldTypeString",editable:!0,domain:null};if(0>this.lookupLayersFieldNames.indexOf(c)){var e=a.indexOf(c);d.name=c;d.alias=b[e];this.lookupLayersFieldNames.push(d.name);this.lookupLayersFields.push(d)}},
this)},this)},fileSelected:function(){y.file.supportHTML5()?this._processFiles(this.csvFileInput.files):y.file.supportFileAPI()?this._processFiles(window.FileAPI.getFiles(this.csvFileInput)):console.log("no file handler support !");this.csvFileInput.value=null;e.add(this.downloadResultsBtn,"hide")},_handleCSVDrop:function(a){a.preventDefault();a=a.dataTransfer;e.contains(this.showFileDialogBtn,"jimu-state-disabled")||(e.add(this.downloadResultsBtn,"hide"),this._processFiles(a.files))},_processFiles:function(a){e.add(this.showFileDialogBtn,
"jimu-state-disabled");this._resetResults();0<a.length&&(a=a[0],-1!==a.name.indexOf(".csv")?a?this.handleCSV(a):(x({message:this.nls.error.fileIssue}),e.remove(this.showFileDialogBtn,"jimu-state-disabled"),this.clearCSVResults()):(new x({message:this.nls.error.notCSVFile}),e.remove(this.showFileDialogBtn,"jimu-state-disabled"),this.clearCSVResults()))},showFileDialog:function(){e.contains(this.showFileDialogBtn,"jimu-state-disabled")||this.csvFileInput.click()},handleCSV:function(a){if(y.file.supportHTML5()){var c=
new FileReader;c.onload=b.hitch(this,function(){this._processCSVData(c.result)});c.readAsText(a)}else window.FileAPI.readAsText(a,b.hitch(this,function(a){"load"===a.type&&this._processCSVData(a.result)}))},_processCSVData:function(a){if(2<a.length){var c=a.indexOf("\n"),f=b.trim(a.substr(0,c)),h=a.replace(f,"");""!==f&&2<h.length?(console.log(c),c=this._getSeparator(f),this.csvStore=new g({data:a,separator:c}),this.csvStore.fetch({onComplete:b.hitch(this,this._csvReadComplete),onError:b.hitch(this,
function(a){e.remove(this.showFileDialogBtn,"jimu-state-disabled");var c=d.substitute(this.nls.error.fetchingCSV,{"0":a.message});x({message:c});console.error(c,a)})})):(new x({message:this.nls.error.CSVNoRecords}),e.remove(this.showFileDialogBtn,"jimu-state-disabled"),this.clearCSVResults())}else new x({message:this.nls.error.CSVEmptyFile}),e.remove(this.showFileDialogBtn,"jimu-state-disabled"),this.clearCSVResults()},_csvReadComplete:function(a){if(a.length<=parseInt(this.config.maxRowCount,10)){var b=
a.length.toString();e.remove(this.results,"hide");this.resultsLoading.innerHTML=d.substitute(this.nls.results.csvLoaded,{"0":b});e.replace(this.resultsLoadingImage,"complete","processing");var f=1,g=this._generateFeatureCollectionTemplateCSV(this.csvStore,a),l=this._generateDefaultPopupInfo(g),l=new B(this._buildInfoTemplate(l));this.longField=this.latField=null;c.some(this.csvFields,function(a){var b;b=c.indexOf(this.config.latFields,a.toLowerCase());-1!==b&&(this.latField=a);b=c.indexOf(this.config.longFields,
a.toLowerCase());-1!==b&&(this.longField=a);return this.latField&&this.longField?!0:!1},this);if(null===this.latField||null===this.longField)x({message:this.nls.error.invalidCoord}),this.clearCSVResults();else{var z=0;this.errorList=[];c.forEach(a,function(a,e){var u=!1,h={};c.forEach(this.combinedFields,function(b){var c=Number(this.csvStore.getValue(a,b));h[b]=isNaN(c)?this.csvStore.getValue(a,b):c},this);h.__OBJECTID=f;h[this.config.intersectField]=this.config.valueOut;f++;if(isNaN(h[this.latField])||
isNaN(h[this.longField]))u=!0,z+=1,this.errorList.push(parseInt(a._csvId,10)+2),this.enrichErrors.innerHTML=d.substitute(this.nls.results.recordsError,{"0":z});else var l=parseFloat(h[this.latField]),m=parseFloat(h[this.longField]);u||(u={geometry:("latlon"===this.inputForm.rdProjection.value?new q(w.lngLatToXY(m,l),this.srWebMerc):new q(m,l,this.srWebMerc)).toJson(),attributes:h},g.featureSet.features.push(u),this.resultsPlotting.innerHTML=d.substitute(this.nls.results.recordsPlotted,{"0":(e-z+1).toString(),
1:b}))},this);this.layerLoaded&&this.map.removeLayer(this.featureLayer);this.featureLayer=new h(g,{infoTemplate:l,id:"csvLayer",name:"CSV Layer"});this.featureLayer.setRenderer(this.renderer);e.replace(this.resultsPlottingImage,"complete","processing");e.remove(this.clearResultsBtn,"jimu-state-disabled");this._zoomToData(this.featureLayer);var k;if(this.chkboxPlotOnly.checked){for(k in this.enrichResultsText)this.enrichResultsText.hasOwnProperty(k)&&(this.enrichResultsText[k].innerHTML="");for(k in this.enrichResultsProg)this.enrichResultsProg.hasOwnProperty(k)&&
m.set(this.enrichResultsProg[k],"display","none")}else for(k in this._enrichData(this.featureLayer,this.config.enrichLayers),this.enrichResultsProg)this.enrichResultsProg.hasOwnProperty(k)&&m.set(this.enrichResultsProg[k],"display","block")}}else new x({message:d.substitute(this.nls.error.tooManyRecords,{"0":this.config.maxRowCount})}),this.clearCSVResults()},_enrichData:function(a,d){this.syncLayers=[];var e=0,f=1,g=[];g[e]=[];c.forEach(a.graphics,b.hitch(this,function(b){f>=parseInt(this.config.cacheNumber,
10)?(g[e].push(b),a.graphics.length>(e+1)*parseInt(this.config.cacheNumber,10)&&(e++,f=1,g[e]=[])):(g[e].push(b),f++)}));c.forEach(d,function(d){var e=c.map(d.fields,function(a){return a.fieldName}),f=new G({layer:d,numberOfRequest:a.graphics.length,totalRecords:a.graphics.length,numberOfHits:0,fields:e,intersectField:this.config.intersectField,valueIn:this.config.valueIn,valueOut:this.config.valueOut,valueInSym:this.symIn,valueOutSym:this.symOut});this.own(l(f,"complete",b.hitch(this,this._syncComplete)));
this.own(l(f,"requestComplete",b.hitch(this,this._requestComplete)));this.own(l(f,"error",b.hitch(this,this._deferredErrorCallback)));this.syncLayers.push(f);this.queryCallback(g,0,d,e,f)},this)},queryCallback:function(a,d,e,f,g){var h,l=new r(this.map.spatialReference);c.forEach(a[d],function(a){(a=a.geometry)&&l.addPoint({x:a.x,y:a.y})});var m=new C(e.url);if(0===d){var k=new s;k.returnGeometry=!0;k.outFields=["*"];k.geometry=l;h=m.execute(k,b.hitch(this,this.queryCallback(a,d+1,e,f,g)),b.hitch(this,
this.queryErrorback(e)));g.addDeferred(h,a[d]);this.featureLayer.redraw()}else return function(c){if(a.length>d){var k=new s;k.returnGeometry=!0;k.outFields=["*"];k.geometry=l;h=m.execute(k,b.hitch(this,this.queryCallback(a,d+1,e,f,g)),b.hitch(this,this.queryErrorback(e)));g.addDeferred(h,a[d]);this.featureLayer.redraw()}return{results:c}}},queryErrorback:function(a){return b.hitch(this,function(b){this.enrichResultsProg.hasOwnProperty(a.id)&&(e.replace(this.enrichResultsProg[a.id],"error","complete"),
e.replace(this.enrichResultsProg[a.id],"error","processing"));console.log(b);return b})},_deferredErrorCallback:function(a){this.enrichResultsProg.hasOwnProperty(a.layerID)&&(e.replace(this.enrichResultsProg[a.layerID],"error","complete"),e.replace(this.enrichResultsProg[a.layerID],"error","processing"))},_syncComplete:function(a){e.replace(this.enrichResultsProg[a.layerID],"complete","processing");c.some(this.syncLayers,function(a){return!a.isComplete()},this)||(this.featureLayer.redraw(),e.remove(this.showFileDialogBtn,
"jimu-state-disabled"),e.remove(this.downloadResultsBtn,"hide"))},_requestComplete:function(a){this.enrichResultsText[a.layerID].innerHTML=d.substitute(this.nls.results.recordsEnriched,{"0":a.currentNumber,1:a.totalRecords,2:a.intesected,3:a.name});this.featureLayer.redraw()},_resetResults:function(){e.replace(this.resultsLoadingImage,"processing","complete");e.replace(this.resultsPlottingImage,"processing","complete");var a,f="";for(a in this.enrichResultsProg)this.enrichResultsProg.hasOwnProperty(a)&&
(e.replace(this.enrichResultsProg[a],"processing","error"),e.replace(this.enrichResultsProg[a],"processing","complete"));var g=b.hitch(this,function(b){b.id===a&&(h=b)});for(a in this.enrichResultsProg)if(this.enrichResultsText.hasOwnProperty(a)){var h;c.forEach(this.config.enrichLayers,g);h&&(f=h.label);this.enrichResultsText[a].innerHTML=d.substitute(this.nls.results.recordsEnriched,{"0":0,1:0,2:0,3:f})}this.resultsLoading.innerHTML=d.substitute(this.nls.results.csvLoaded,{"0":0});this.enrichErrors.innerHTML=
"";this.resultsPlotting.innerHTML=d.substitute(this.nls.results.recordsPlotted,{"0":0,1:0})},downloadCSVResults:function(){F.exportCSVFromFeatureLayer(this.nls.savingCSV,this.featureLayer,{fromClient:!0})},clearCSVResults:function(){this.layerLoaded&&this.map.removeLayer(this.featureLayer);this._resetResults();e.add(this.downloadResultsBtn,"hide");e.add(this.results,"hide");m.set(this.enrichErrorsList,"display","none");e.remove(this.showFileDialogBtn,"jimu-state-disabled");e.add(this.clearResultsBtn,
"jimu-state-disabled")},destroy:function(){this.layerLoaded&&this.map.removeLayer(this.featureLayer);this.inherited(arguments)},_getSeparator:function(a){var b=0,d="";c.forEach([",","      ",";","|"],function(c){var e=a.split(c).length;e>b&&(b=e,d=c)});return d},_generateFeatureCollectionTemplateCSV:function(a,d){var e={layerDefinition:null,featureSet:{features:[],geometryType:"esriGeometryPoint",spatialReference:{wkid:102100}},layerDefinition:{geometryType:"esriGeometryPoint",objectIdField:"__OBJECTID",
type:"Feature Layer",typeIdField:"",fields:[{name:"__OBJECTID",alias:"Row Number",type:"esriFieldTypeOID",editable:!1,domain:null}],types:[],capabilities:"Query"}};this.csvFields=a.getAttributes(d[0]);this.combinedFields=b.clone(this.csvFields);this.combinedFields.push(this.config.intersectField);c.forEach(this.combinedFields,function(b){var c=a.getValue(d[0],b);isNaN(Number(c))||b===this.config.intersectField?e.layerDefinition.fields.push({name:b,alias:b,type:"esriFieldTypeString",editable:!0,domain:null}):
e.layerDefinition.fields.push({name:b,alias:b,type:"esriFieldTypeDouble",editable:!0,domain:null})},this);e.layerDefinition.fields.push({name:"Out",alias:"GLProcessed",type:"esriFieldTypeString",editable:!1,visible:!1,domain:null});this.combinedFields=this.combinedFields.concat(this.lookupLayersFieldNames);e.layerDefinition.fields=e.layerDefinition.fields.concat(this.lookupLayersFields);return e},_generateDefaultPopupInfo:function(a){var d={esriFieldTypeDouble:1,esriFieldTypeSingle:1},e={esriFieldTypeInteger:1,
esriFieldTypeSmallInteger:1},f={esriFieldTypeDate:1},g=null;a=c.map(a.layerDefinition.fields,b.hitch(this,function(a){"NAME"===a.name.toUpperCase()&&(g=a.name);var c="esriFieldTypeGlobalID"!==a.type&&"esriFieldTypeGeometry"!==a.type;"GLProcessed"===a.alias&&(c=!1);var h=null;if(c){var k=a.name.toLowerCase();if(-1<",stretched value,fnode_,tnode_,lpoly_,rpoly_,poly_,subclass,subclass_,rings_ok,rings_nok,".indexOf(","+k+",")||k.indexOf("_i")===k.length-2)c=!1;a.type in e?h={places:0,digitSeparator:!0}:
a.type in d?h={places:4,digitSeparator:!0}:a.type in f&&(h={dateFormat:"shortDateShortTime"})}return b.mixin({},{fieldName:a.name,label:a.alias,isEditable:!1,tooltip:"",visible:c,format:h,stringFieldOption:"textbox"})}));return{title:g?"{"+g+"}":"",fieldInfos:a,description:null,showAttachments:!1,mediaInfos:[]}},_buildInfoTemplate:function(a){var b='\x3cdiv style\x3d"font-weight:bold;"\x3e'+this.nls.results.label+"\x3c/div\x3e",d={content:b+'\x3cdiv style\x3d"border:none;border-top: 1px solid #333333;margin-top: 6px;margin-bottom: 6px;"\x3e\x3c/div\x3e\x3ctable\x3e'};
c.forEach(a.fieldInfos,function(a){a.visible&&(d.content+='\x3ctr\x3e\x3ctd valign\x3d"top" style\x3d"color:#888888;padding-right:5px;"\x3e',d.content+=a.label+": \x3c/td\x3e",d.content+='\x3ctd valign\x3d"top" style\x3d"padding:2px;padding-bottom:5px;"\x3e${',d.content+=a.fieldName+"}\x3c/td\x3e\x3c/tr\x3e")});d.content+="\x3c/table\x3e";return d},_zoomToData:function(a){var b=new r(this.map.spatialReference);c.forEach(a.graphics,function(a){(a=a.geometry)&&b.addPoint({x:a.x,y:a.y})});a.name="CSV Layer";
this.map.addLayer(this.featureLayer);this.layerLoaded=!0;0<b.points.length&&(this.map.setExtent(b.getExtent().expand(1.05),!0),this.chkboxPlotOnly.checked&&e.remove(this.showFileDialogBtn,"jimu-state-disabled"))},showErrorTable:function(){if("none"===m.get(this.enrichErrorsList,"display")){var a="";c.forEach(this.errorList,b.hitch(this,function(b){a=a+d.substitute(this.nls.results.recordsErrorList,{"0":b})+"\x3cbr\x3e"}));this.enrichErrorsList.innerHTML=a;m.set(this.enrichErrorsList,"display","block")}else m.set(this.enrichErrorsList,
"display","none")}})});